"use strict";_SL.nmspc("resmanager").list=function(){var a={urlList:gCONTEXT_PATH+"system/restore_schedule_list.json",urlForm:gCONTEXT_PATH+"system/restore_schedule_form.html",urlDelete:gCONTEXT_PATH+"system/restore_schedule_delete.do",urlRetry:gCONTEXT_PATH+"system/restore_schedule_retry.do",formId:"#searchResManager",gridId:"#gridResManager",dialogId:"#retry_msg_dlg",dialogFormId:"#formRetryDlg"},b={form:$(a.formId),grid:$(a.gridId),dialog:$(a.dialogId),dialogForm:$(a.dialogFormId)},c=function(){var c=b.grid.parent().siblings(".grid-bottom").find(".btn-add"),e=b.grid.parent().siblings(".grid-bottom").find(".btn-delete");d(b.grid),b.form.find(".form-submit").off().on("click",function(){_SL.validate(b.form)&&g()}),c.off().on("click",function(){h(a.urlForm)}),e.off().on("click",function(){var a=[],c=$.map(b.grid.find("[name=chk_idx]"),function(a){if(a.checked)return a.value}),d=b.grid.jqxGrid("getdisplayrows"),e=[];for(var f in d)for(var g=0,h=c.length;g<h;g++)c[g]==d[f].boundindex&&e.push(d[f].boundindex);if(e.length>0){for(var g in e){var j=b.grid.jqxGrid("getrowdata",e[g]);if(!j)break;var k={request_id:j.request_id,restore_dt:_SL.formatDate(j.restore_dt,"yyyy-MM-dd HH:mm","yyyyMMddHH")};a.push(k)}i(a)}else _alert("선택 된 데이터가 없습니다.")}),b.dialog.jqxWindow({height:150,width:400,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5,cancelButton:b.dialog.find("[data-button-cancel=true]")}),b.dialog.find(".btn-retry").on("click",f)},d=function(c){var d={datatype:"json",datafields:[{name:"request_id",type:"string"},{name:"restore_dt",type:"string"},{name:"status",type:"string"},{name:"reg_dt",type:"string"},{name:"user_id",type:"string"},{name:"collector_id",type:"string"},{name:"message",type:"string"},{name:"collector_nm",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(d.totalrecords=a.totalRows)},cache:!1,url:a.urlList},f=new $.jqx.dataAdapter(d,{beforeLoadComplete:function(a){for(var b in a){var c=a[b].request_id;a[b].restore_dt&&(c+="||"+a[b].restore_dt,a[b].restore_dt=_SL.formatDate(a[b].restore_dt,"yyyyMMddHH","yyyy-MM-dd HH:mm")),a[b].reg_dt&&(a[b].reg_dt=_SL.formatDate(a[b].reg_dt,"yyyyMMddHHmmss","yyyy-MM-dd HH:mm")),a[b].del_id=c}return a},formatData:function(b){var c,d={},e=$(a.formId).serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(b,d),b},loadComplete:function(a){b.grid.find(".iconscontainer").remove()},loadError:function(a,b,c){alert(c)}});c.jqxGrid({source:f,sortable:!0,width:"100%",virtualmode:!0,selectionmode:"none",enablehover:!1,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"DelId",datafield:"del_id",hidden:!0,cellsrenderer:function(a,b,c,d,e,f){return f.del_id}},{text:"Collector",datafield:"collector_nm"},{text:"복원일시",datafield:"restore_dt",width:"20%",cellsalign:"center"},{text:"등록일",datafield:"reg_dt",width:"20%",cellsalign:"center"},{text:"상태",datafield:"status",width:"10%",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g;switch(c){case 0:g='<button type="button" class="btn-link">요청</button>';break;case 1:g="진행";break;case 2:g="완료";break;case-1:g='<button type="button" class="btn-link">오류</button>'}return $(d).html(g)[0].outerHTML}},{text:"",sortable:!1,width:50,cellsalign:"center",renderer:function(){return'<div style="margin-left: 11px; margin-top: 5px;"></div>'},rendered:function(a){$(a).jqxCheckBox({width:30,height:16,animationShowDelay:0,animationHideDelay:0}),$(a).bind("change",function(a){b.grid.find("[name=chk_idx]").prop("checked",a.args.checked)})},cellsrenderer:function(a,b,c,d,e,f){if(0==f.status||f.status==-1)return $(d).html('<input type="checkbox" name="chk_idx" value="'+f.boundindex+'" class="form-transform"><span class="form-clone"></span>')[0].outerHTML}}]}),c.on("cellclick",function(a){var b=a.args.datafield,c=a.args.value,d=a.args.row.bounddata;"status"===b&&(0==c?e(d.request_id,d.restore_dt,d.collector_id,""):c==-1&&e(d.request_id,d.restore_dt,d.collector_id,d.message))})},e=function(a,c,d,e){b.dialog.find("[name=request_id]").val(a),b.dialog.find("[name=restore_dt]").val(c),b.dialog.find("[name=collector_id]").val(d),b.dialog.find("[name=retry_message]").val(e),b.dialog.jqxWindow("open")},f=function(){var c=1==$(this).data("after-close");$("body").requestData(a.urlRetry,_SL.serializeMap(b.dialogForm),{callback:function(a,b,d){var e=a.RESULT_CODE;switch(e){case"SUCCESS":_alert("데이터 복원을 재시도 하였습니다.",{onAgree:function(){onClose(c)}});break;case"ERROR":_alert("복원 요청중 오류가 발생하였습니다.<br>다시 시도하세요.");break;case"RUNNING":_alert("데이터 복원이 실행 중입니다.");break;default:_alert("복원요청에 실패했습니다.<br>다시 시도하세요.")}}})},g=function(){b.grid.jqxGrid("updatebounddata")},h=function(a){new ModalPopup(a,{width:520,height:210,onClose:function(){g()}})},i=function(b){_confirm("삭제하시겠습니까?",{onAgree:function(){$("body").requestData(a.urlDelete,{restore_ids:b},{callback:function(a){g()}})}})};return{init:c}}(),$(function(){slapp.resmanager.list.init()});