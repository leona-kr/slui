"use strict";_SL.nmspc("integrity").list=function(){var a={urlList:gCONTEXT_PATH+"system/integrity_list.json",urlChkIntegrity:gCONTEXT_PATH+"system/integrity_check.json",urlUpdateIntegrity:gCONTEXT_PATH+"system/integrity_update.do",formId:"#searchIntegrityList",gridId:"#gridIntegrityList",dialogId:"#view_detail"},b={form:$(a.formId),grid:$(a.gridId),dialog:$(a.dialogId)},c=function(){var a=b.grid.parent().siblings(".grid-bottom").find(".btn-update");d(b.grid),b.form.find(".form-submit").off().on("click",function(){_SL.validate(b.form)&&f()}),a.off().on("click",function(){var a=[],c=[],d=$.map(b.grid.find("[name=chk_idx]"),function(a){if(a.checked)return a.value}),e=b.grid.jqxGrid("getdisplayrows"),f="";for(var g in e)for(var i=0,j=d.length;i<j;i++)d[i]==e[g].boundindex&&c.push(e[g].boundindex);if(c.length>0){for(var i=0,k=c.length;i<k;i++){var l=b.grid.jqxGrid("getrowdata",c[i]);""===l.cur_md5&&(f+="[시스템 : "+l.system_nm+"] [파일명 : "+l.file_nm+"]<br/>"),a.push(l.integrity_id)}if(""!=f)return f+="파일이없어 Update 할수 없습니다.",void _alert(f);h(a)}else _alert("변경할 건을 선택하세요.")}),b.dialog.jqxWindow({height:100,width:500,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5})},d=function(c){var d={datatype:"json",datafields:[{name:"integrity_id",type:"string"},{name:"system_nm",type:"string"},{name:"file_path",type:"string"},{name:"file_nm",type:"string"},{name:"ori_md5",type:"string"},{name:"ori_md5_dt",type:"string"},{name:"cur_md5",type:"string"},{name:"cur_md5_dt",type:"string"},{name:"change_opt",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(d.totalrecords=a.totalRows)},cache:!1,url:a.urlList},f=new $.jqx.dataAdapter(d,{formatData:function(b){var c,d={},e=$(a.formId).serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(b,d),b},loadComplete:function(){b.grid.find(".iconscontainer").remove(),g()},loadError:function(a,b,c){alert(c)}});c.jqxGrid({source:f,sortable:!0,width:"100%",selectionmode:"none",virtualmode:!0,rendergridrows:function(a){return a.data},columns:[{text:"",sortable:!1,width:40,cellsalign:"center",renderer:function(){return'<div style="margin-left: 7px; margin-top: 5px;"></div>'},rendered:function(a){$(a).jqxCheckBox({width:30,height:16,animationShowDelay:0,animationHideDelay:0}),$(a).bind("change",function(a){b.grid.find("[name=chk_idx]").prop("checked",a.args.checked)})},cellsrenderer:function(a,b,c,d,e,f){if("Y"==f.change_opt)return $(d).html('<input type="checkbox" name="chk_idx" value="'+f.boundindex+'" class="form-transform"><span class="form-clone"></span>')[0].outerHTML}},{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"시스템명",datafield:"system_nm",width:"12%",cellsalign:"center"},{text:"파일명",datafield:"file_nm",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g=f.file_path;return $(d).html('<label class="hasTooltip" data-value="'+g+'">'+c+"</label>")[0].outerHTML}},{text:"상태",datafield:"change_opt",width:"10%",cellsrenderer:function(a,b,c,d,e,f){return"Y"==c?$(d).html('&nbsp;<span class="label-danger text-danger">비정상</span>')[0].outerHTML:"N"==c?$(d).html('&nbsp;<span class="label-success">정상</span>')[0].outerHTML:void 0}},{text:"원본",datafield:"ori_md5",width:"20%",cellsrenderer:function(a,b,c,d,e,f){var g=f.change_opt,h=c.substring(0,30)+(c.length>30?"...":"");return"Y"==g?$(d).html('<div style="cursor:pointer;" class="text-danger">'+h+"</div>")[0].outerHTML:"N"==g?$(d).html('<div style="cursor:pointer;">'+h+"</div>")[0].outerHTML:void 0}},{text:"현재",datafield:"cur_md5",width:"20%",cellsrenderer:function(a,b,c,d,e,f){var g=f.change_opt,h=c.substring(0,30)+(c.length>30?"...":"");return"Y"==g?$(d).html('<div style="cursor:pointer;" class="text-danger">'+h+"</div>")[0].outerHTML:"N"==g?$(d).html('<div style="cursor:pointer;">'+h+"</div>")[0].outerHTML:void 0}},{text:"무결성검사",datafield:"Edit",columntype:"button",width:100,cellsrenderer:function(a,b,c,d,e,f){return"검사"},buttonclick:function(a){var b=c.jqxGrid("getrowdata",a);i(b.file_path,b.file_nm,b.system_nm)}}]}),c.on("cellclick",function(b){if("agent_nm"===b.args.datafield){var c=b.args.row.bounddata.agent_id;viewDetail(a.urlForm+"?agent_id="+c)}if("inspection"===b.args.datafield&&viewAgentControl(b.args.row.bounddata.agent_ip),"ori_md5"===b.args.datafield){var d=b.args.row.bounddata;d.ori_md5.length>0&&e(d.ori_md5,d.cur_md5)}else if("cur_md5"===b.args.datafield){var d=b.args.row.bounddata;d.cur_md5.length>0&&e(d.ori_md5,d.cur_md5)}})},e=function(a,c){b.dialog.find("#view_text_ori").text("원본 :"+a),b.dialog.find("#view_text_cur").text("현재 :"+c),b.dialog.jqxWindow({position:"center"}),b.dialog.jqxWindow("open")},f=function(){b.grid.jqxGrid("updatebounddata"),b.grid.jqxGrid("clearselection"),g()},g=function(){setTimeout(function(){$(".hasTooltip").each(function(){var a=$(this).data("value");$(this).jqxTooltip({position:"mouse",content:a})})},500)},h=function(b){$("body").requestData(a.urlUpdateIntegrity,{id_list:b},{callback:function(a,b,c){_alert(c,{onAgree:function(){f()}})}})},i=function(b,c,d){var e=b,g=c,h=c;h.indexOf(".jar")!=-1&&(h="../"+h),$("body").requestData(a.urlChkIntegrity,{filePath:e,nFileName:h,systemName:d,oFileName:g},{callback:function(a,b,c){_alert(a.message,{onAgree:function(){f()}})}})};return{init:c}}(),$(function(){slapp.integrity.list.init()});