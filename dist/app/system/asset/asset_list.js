"use strict";_SL.nmspc("asset").list=function(){var a={urlList:gCONTEXT_PATH+"system/asset_list.json",urlForm:gCONTEXT_PATH+"system/asset_form.html",urlDownload:gCONTEXT_PATH+"system/asset_export.do",urlEqpJson:gCONTEXT_PATH+"system/eqp_codes.json",formId:"#searchAssetList",gridId:"#gridAssetList"},b={form:$(a.formId),grid:$(a.gridId)},c=function(){var c=b.grid.parent().siblings(".grid-bottom").find(".btn-add"),f=b.form.find(".btn-download");b.form.find("[name=s_eqp_type_cd]").chosen({search_contains:!0}),d(b.grid),b.form.find(".form-submit").off().on("click",function(){_SL.validate(b.form)&&e()}),c.off().on("click",function(){g(a.urlForm)}),f.off().on("click",function(){h()})},d=function(b){var c={datatype:"json",datafields:[{name:"asset_id",type:"string"},{name:"open_time",type:"string"},{name:"asset_nm",type:"string"},{name:"add_route",type:"string"},{name:"ip_type",type:"string"},{name:"ip_cnt",type:"string"},{name:"group_cd",type:"string"},{name:"group_nm",type:"string"},{name:"eqp_type_cd",type:"string"},{name:"eqp_type_nm",type:"string"},{name:"sip",type:"string"},{name:"eip",type:"string"},{name:"weight",type:"string"},{name:"weak_score",type:"string"},{name:"os",type:"string"},{name:"manager",type:"string"},{name:"grade",type:"string"},{name:"division",type:"string"},{name:"department",type:"string"},{name:"comments",type:"string"},{name:"proc_id",type:"string"},{name:"proc_ip",type:"string"},{name:"proc_dt",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(c.totalrecords=a.totalRows)},cache:!1,url:a.urlList},d=new $.jqx.dataAdapter(c,{formatData:function(b){var c,d={},e=$(a.formId).serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(b,d),b},loadComplete:function(){f()},loadError:function(a,b,c){alert(c)}});b.jqxGrid({source:d,sortable:!0,width:"100%",virtualmode:!0,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"그룹",datafield:"group_nm",cellsalign:"center",width:"15%"},{text:"자산명",datafield:"asset_nm",cellsrenderer:function(a,b,c,d,e,f){return $(d).html('<button type="button" class="btn-link">'+c+"</button>")[0].outerHTML}},{text:"자산 IP",datafield:"sip",width:"20%",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g=f.sip,h="[시작IP ~ 종료IP]";for(var i in assetIpList)f.asset_id==assetIpList[i].asset_id&&(h+="<br/>"+assetIpList[i].sip+" ~ "+assetIpList[i].eip);return f.sip!=f.eip&&(g=f.sip+" - "+f.eip),0!=f.ip_cnt&&(g+="외 "+f.ip_cnt+" 건"),$(d).html('<label class="hasTooltip" data-value="'+h+'">'+g+"</label>")[0].outerHTML}},{text:"종류",datafield:"eqp_type_nm",cellsalign:"center",width:"20%"},{text:"중요도",datafield:"weight",width:"10%",cellsrenderer:function(a,b,c,d,e,f){var g="",h="";switch(c){case 1:g="Low",h="label-success";break;case 2:g="Middle",h="label-attention";break;case 3:g="High",h="label-danger"}return $(d).html('<span class="'+h+'" style="margin-left:4px;">'+g+"</span>")[0].outerHTML}},{text:"취약점",datafield:"weak_score",width:"10%",cellsrenderer:function(a,b,c,d,e,f){var g="",h="";switch(c){case 1:g="Low",h="label-success";break;case 2:g="Middle",h="label-attention";break;case 3:g="High",h="label-danger"}return $(d).html('<span class="'+h+'" style="margin-left:4px;">'+g+"</span>")[0].outerHTML}}]}),b.on("cellclick",function(b){if("asset_nm"===b.args.datafield){var c=b.args.row.bounddata.asset_id;g(a.urlForm+"?asset_id="+c)}})},e=function(){b.grid.jqxGrid("updatebounddata"),f()},f=function(){setTimeout(function(){b.grid.find(".hasTooltip").each(function(a){var b=$(this).data("value");$(this).jqxTooltip({position:"mouse",content:b})})},500)},g=function(a){new ModalPopup(a,{width:850,height:610,onClose:function(){e()}})},h=function(){_SL.validate(b.form)&&b.form.attr({action:a.urlDownload}).submit()};return{init:c}}(),$(function(){slapp.asset.list.init()});