"use strict";_SL.nmspc("auth").form=function(){var a={formId:"#formAuth",menuTreeId:"#authMenuTree",urlSelect:gCONTEXT_PATH+"system/auth_list.json",urlSave:gCONTEXT_PATH+"system/auth_save.do",urlRoleForm:gCONTEXT_PATH+"system/role_form.html",urlExist:gCONTEXT_PATH+"system/role_nm_exist.json"},b={form:$(a.formId),menuTree:$(a.menuTreeId),roleId:$(a.formId+" [name=role_id]")},c={tree:null},d=function(){e(),b.roleId.trigger("change")},e=function(){b.roleId.on("change",f),b.form.find(".btn-save").on("click",h),b.form.find(".btn-role-form").exModalPopup(a.urlRoleForm,{width:300,height:135,onOpen:i,onClose:j})},f=function(){var c={role_id:b.roleId.val()};$("body").requestData(a.urlSelect,c,{callback:g})},g=function(a){for(var d,e={title:"전체",key:"ALL",icon:"/resources/imgs/plugins/dynatree/base.gif",children:[]},f=[],g={},h=0,i=a.length;h<i;h++)d=a[h],"M"!=d.menu_div&&"P"!=d.menu_div||(g[d.group_key]={title:d.menu_nm,isFolder:!0,children:[]},1==d.menu_level?e.children.push(g[d.group_key]):g[d.p_group_key].children.push(g[d.group_key])),"F"==d.menu_div&&g[d.group_key].children.push({title:d.menu_nm,select:"true"==d.sel_opt,key:d.menu_id,menu_cate:d.menu_cate}),"H"==d.menu_div&&f.push({menu_id:d.menu_id,menu_cate:d.menu_cate});b.menuTree.dynatree({minExpandLevel:3,checkbox:!0,selectMode:3,children:[e],onExpand:function(){b.form.parents(".nano").nanoScroller()}}),c.tree?c.tree.reload():c.tree=b.menuTree.dynatree("getTree")},h=function(){var d=(1==$(this).data("after-close"),function(){var d=c.tree.getSelectedNodes(),e=$.map(d,function(a){if("_"!=a.data.key.charAt(0)&&"ALL"!=a.data.key)return a.data.key}),f={role_id:b.roleId.val(),menu_list:e};$("body").requestData(a.urlSave,f,{callback:function(a,b,c){_alert(c)}})});_confirm("저장 하시겠습니까?",{onAgree:d})},i=function(){slapp.role.form.setRole(b.roleId.val(),b.roleId.find(":selected").text())},j=function(){b.roleId.find(":selected").text(slapp.role.form.getRole().role_nm),slui.attach.setTransformSelect(a.formId)};return{init:d}}(),$(function(){slapp.auth.form.init()});