"use strict";_SL.nmspc("audit").list=function(){var a={urlList:gCONTEXT_PATH+"system/audit_list.json",urlForm:gCONTEXT_PATH+"management/agent_form.html",formId:"#searchAudittList",gridId:"#gridAuditList",dialogId:"#view_dlg"},b={form:$(a.formId),grid:$(a.gridId),dialog:$(a.dialogId)},c=function(){d(b.grid),b.form.find(".form-submit").off().on("click",function(){_SL.validate(b.form)&&e()}),b.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var c=function(a,b){var c=a.siblings(".tform-select");c.find(".tform-select-t").text(b).end().find(".tform-select-option[data-value="+b+"]").addClass("selected").end(),a.val(b)},d=_SL.formatDate.addMin(b.form.find("[name=endDay]").val()+b.form.find("[name=endHour]").val()+b.form.find("[name=endMin]").val(),-a);c(b.form.find("[name=startDay]"),d.substring(0,8)),c(b.form.find("[name=startHour]"),d.substring(8,10)),c(b.form.find("[name=startMin]"),d.substring(10,12))}}),b.form.find("[name=startDay],[name=startHour],[name=startMin],[name=endDay],[name=endHour],[name=endMin]").change(function(){var a=b.form.find("[name=timeSet]"),c=a.siblings(".tform-select").find("[data-value=0]").text();a.val(0).siblings(".tform-select").find(".tform-select-t").text(c)}),b.dialog.jqxWindow({height:400,width:700,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5})},d=function(c){var d={datatype:"json",datafields:[{name:"user_id",type:"string"},{name:"user_nm",type:"string"},{name:"log_dt",type:"string"},{name:"log_cd",type:"string"},{name:"log_nm",type:"string"},{name:"user_ip",type:"string"},{name:"log_title",type:"string"},{name:"remark",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(d.totalrecords=a.totalRows)},cache:!1,url:a.urlList},e=new $.jqx.dataAdapter(d,{beforeLoadComplete:function(a){for(var b in a)a[b].log_dt&&(a[b].log_dt=_SL.formatDate(a[b].log_dt,"yyyyMMddHHmmss","yyyy-MM-dd HH:mm:ss"));return a},formatData:function(b){var c,d={},e=$(a.formId).serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(b,d),b},loadError:function(a,b,c){alert(c)}});c.jqxGrid({source:e,sortable:!0,width:"100%",virtualmode:!0,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"발생시간",datafield:"log_dt",width:"15%",cellsalign:"center"},{text:"제목",datafield:"log_title",cellsrenderer:function(a,b,c,d,e,f){return $(d).html('<button type="button" class="btn-link">'+c+"</button>")[0].outerHTML}},{text:"종류",datafield:"log_nm",width:"15%",cellsalign:"center"},{text:"사용자",datafield:"user_id",width:"15%",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g=null==f.user_id?"-":f.user_nm+"("+f.user_id+")";return $(d).html(g)[0].outerHTML}},{text:"사용자 IP",datafield:"user_ip",width:"15%",cellsalign:"center"}]}),c.on("cellclick",function(a){"log_title"===a.args.datafield&&(b.dialog.find("[name=view_cont]").val(a.args.row.bounddata.remark),b.dialog.jqxWindow("open"))})},e=function(){b.grid.jqxGrid("updatebounddata")};return{init:c}}(),$(function(){slapp.audit.list.init()});