"use strict";_SL.nmspc("parser").logManagerForm=function(){var a={formId:"#formLogParserManager",urlSelect:gCONTEXT_PATH+"management/log_parser_manager_form.json",urlComCodeForm:gCONTEXT_PATH+"sysdata/comcode_form.html",urlUsedCheck:gCONTEXT_PATH+"management/log_psr_mng_check_used.json",urlXmlCheck:gCONTEXT_PATH+"management/log_psr_xml_check.json",urlLogPsrNameCheck:gCONTEXT_PATH+"management/log_parser_name_exist.json",urlParserGenerator:gCONTEXT_PATH+"management/parser_generator.do?menu_idx=1",urlDelete:gCONTEXT_PATH+"management/log_psr_mng_delete.do",add:{action:gCONTEXT_PATH+"management/log_psr_add.do",message:"등록 하시겠습니까?"},update:{action:gCONTEXT_PATH+"management/log_psr_mng_update.do",message:"수정 하시겠습니까?"}},b={form:$(a.formId),trHandleOpt1:$(a.formId+" #handle_opt_1_wrap"),trHandleOpt2:$(a.formId+" #handle_opt_2_wrap"),trLogCateValue:$(a.formId+" #log_cate_value_wrap"),comment1:$(a.formId+" #comment1"),logPsrId:$(a.formId+" [name=log_psr_id]"),logPsrNm:$(a.formId+" [name=log_psr_nm]"),sample:$(a.formId+" [name=sample]"),psrXml:$(a.formId+" [name=psr_xml]"),description:$(a.formId+" [name=description]"),logCateCd:$(a.formId+" [name=log_cate_cd]"),logTypeCd:$(a.formId+" [name=log_type_cd]"),handleType:$(a.formId+" [name=handle_type]"),handleOptChar:$(a.formId+" [name=handle_opt_1_char]"),handleOptIndex:$(a.formId+" [name=handle_opt_1_index]"),handleOpt:$(a.formId+" [name=handle_opt]"),logCateValue:$(a.formId+" [name=log_cate_value]"),categoryCode:$(a.formId+" .btn-register-category").data("value")},c={isNew:""==b.logPsrId.val(),mode:""==b.logPsrId.val()?a.add:a.update},d=function(){e(),c.isNew||f(),c.isNew?(b.psrXml.data("nCheck",-1),b.form.find(".btn-delete").hide(),m.initHandleType()):(b.psrXml.data("nCheck",1),$("body").requestData(a.urlUsedCheck,{log_psr_id:b.logPsrId.val()},{callback:function(a,b,c){connCnt=a.CONN_CNT,useCnt=a.USE_CNT,m.initHandleType()}}))},e=function(){b.form.find(".btn-save").on("click",h),b.form.find(".btn-delete").on("click",i),b.form.find(".btn-register-category").exModalPopup(a.urlComCodeForm+"?code_type="+b.categoryCode,{width:550,height:455,onClose:function(){k(b.logCateCd),slui.attach.setTransformSelect(a.formId)}}),b.form.find(".config_tab li").click(function(){return g($(this).index()),!1}),b.form.find("#psr_generator").on("click",l),b.handleType.change(m.changeHandleType),b.psrXml.change(m.changePsrXml)},f=function(){var c=b.logPsrId.val(),d={log_psr_id:c},e=function(a){_SL.setDataToForm(a,b.form,{log_type_cd:{converter:function(a,c){b.form.find("[name=log_type_cd]").val(a),b.form.find("[name=b_log_type_cd]").val(a)}},handle_type:{converter:function(a,c){b.form.find("[name=handle_type]").val(a),b.form.find("[name=b_handle_type]").val(a)}},handle_opt:{converter:function(a,c){b.form.find("[name=handle_opt]").val(a),b.form.find("[name=b_handle_opt]").val(a)}}})};$("body").requestData(a.urlSelect,d,{callback:e})},g=function(c){switch(b.form.find(".config_tab li").removeClass("tab-item-active"),b.form.find(".config_tab li").eq(c).addClass("tab-item-active"),c){case 0:b.form.find("#default").css("display","block"),b.form.find("#parserDefault").css("display","none");break;case 1:b.form.find("#default").css("display","none"),b.form.find("#parserDefault").css("display","block")}slui.attach.setTransformSelect(a.formId)},h=function(){m.save()},i=function(){m.remove()},j=function(a){a&&b.form.find("[data-layer-close=true]").click()},k=function(b){var c=slapp.comcode.form.getCode();b.append('<option value="'+c.code_id+'">'+c.code_name+"</option>"),b.val(c.code_id),slui.attach.setTransformSelect(a.formId)},l=function(){b.form.attr({action:a.urlParserGenerator,method:"post"}).submit()},m={initHandleType:function(){var a,c;switch(b.trHandleOpt2.jqxTooltip("destroy"),b.logCateValue.jqxTooltip("destroy"),a=b.handleType.val()){case"2":b.trHandleOpt2.jqxTooltip({content:tooltip1,position:"mouse"});break;case"3":b.logCateValue.jqxTooltip({content:tooltip2,position:"mouse"}),b.comment1.css("visibility","visible")}if("1"==a||"2"==a)if(b.form.find("#handle_opt_"+a+"_wrap").show(),"1"==a){if(c=b.handleOpt.val(),""!=c){var d=c.split("|"),e="";2==d.length&&(e=parseInt(d[1])+1),b.handleOptChar.val(d[0].replace(new RegExp(SEPARATOR_PIPE_STR,"g"),"|")),b.handleOptIndex.val(e)}b.trHandleOpt2.hide()}else b.trHandleOpt1.hide();else b.trHandleOpt1.hide(),b.trHandleOpt2.hide();"-1"!=a?b.trLogCateValue.show():b.trLogCateValue.hide()},changeHandleType:function(){b.trHandleOpt1.hide(),b.trHandleOpt2.hide(),b.comment1.css("visibility","hidden"),b.trHandleOpt2.jqxTooltip("destroy"),b.logCateValue.jqxTooltip("destroy");var a=b.handleType.val();switch(a){case"-1":b.handleOpt.val(""),b.trLogCateValue.hide();break;case"1":"2"==b.form.find("[name=b_handle_type]").val()&&(b.handleOptChar.val(""),b.handleOptIndex.val("")),b.trLogCateValue.show(),b.form.find("#handle_opt_"+a+"_wrap").show();break;case"2":"1"==b.form.find("[name=b_handle_type]").val()&&b.handleOpt.val(""),b.trLogCateValue.show(),b.form.find("#handle_opt_"+a+"_wrap").show(),b.trHandleOpt2.jqxTooltip({content:tooltip1,position:"mouse"});break;case"3":b.trLogCateValue.show(),b.handleOpt.val(""),b.logCateValue.jqxTooltip({content:tooltip2,position:"mouse"}),b.comment1.css("visibility","visible")}},changePsrXml:function(){var b=$(this);b.val();b.data("nCheck",0),$("body").requestData(a.urlXmlCheck,{psr_xml:b.val()},{callback:function(a,c,d){"OK"==a?b.data("nCheck",1):b.data("nCheck",-1)}})},getDataFormPage:function(){return{log_psr_id:b.logPsrId.val(),log_type_cd:b.logTypeCd.val(),handle_type:b.handleType.val(),handle_opt:1==b.handleType.val()?b.handleOptChar.val().replace(/\|/g,SEPARATOR_PIPE_STR)+"|"+(parseInt(b.handleOptIndex.val())-1):b.handleOpt.val(),log_psr_nm:b.logPsrNm.val(),psr_xml:b.psrXml.val(),sample:b.sample.val(),log_cate_value:b.logCateValue.val(),log_cate_cd:b.logCateCd.val(),description:b.description.val()}},slvalidate:function(){if(_SL.validate(b.form.find("#default"))){if(""==b.form.find("[name=log_cate_cd]").val())return _alert("로그 분류(을)를 입력하세요."),g(1),!1;if(""==b.form.find("[name=log_type_cd]").val())return _alert("로그 타입(을)를 입력하세요."),g(1),!1;switch(b.form.find("[name=handle_type]").val()){case"1":if(""==b.form.find("[name=handle_opt_1_char]").val())return _alert("구분자(을)를 입력하세요."),g(1),!1;if(""==b.form.find("[name=handle_opt_1_index]").val())return _alert("위치(을)를 입력하세요."),g(1),!1;break;case"2":if(""==b.form.find("[name=handle_opt]").val())return _alert("구분 Option(을)를 입력하세요."),g(1),!1}return"-1"==b.form.find("[name=handle_type]").val()||""!=b.form.find("[name=log_cate_value]").val()||(_alert("구분 값(을)를 입력하세요."),g(1),!1)}return g(0),!1},save:function(){if(m.slvalidate()){var d=m.getDataFormPage(),e=b.form.find("[name=b_log_type_cd]").val(),f=b.form.find("[name=b_handle_type]").val(),h=b.form.find("[name=b_handle_opt]").val(),i=b.logTypeCd.val(),k=b.handleType.val(),l=d.handle_opt,n=!1,o="";if(!c.isNew){if(void 0==connCnt)return void _alert("장비 연동 여부 체크에 실패했습니다.<br/> 다시 시도하세요.");if(connCnt>0&&(e!=i&&(o+="<span class='text-info'>로그타입</span>",n=!0),f!=k&&(o+=""==o?"<span class='text-info'>로그파서 구분방법</span>":"과 <span class='text-info'>로그파서 구분방법</span>",n=!0),f==k&&h!=l&&(o+=""==o?"<span class='text-info'>구분 Option</span>":"과 <span class='text-info'>구분 Option</span>",n=!0),(e!=i||f!=k||h!=l)&&!_confirm("장비에 연동중인 로그파서입니다.<br/>"+o+"을 수정하면<br/>오류가 발생 할 수 있습니다.<br/>수정하시겠습니까?")))return;if(useCnt>0&&!n&&(e!=i&&(o+="<span class='text-info'>로그타입</span>"),f!=k&&(o+=""==o?"<span class='text-info'>로그파서 구분방법</span>":"과 <span class='text-info'>로그파서 구분방법</span>"),f==k&&h!=l&&(o+=""==o?"<span class='text-info'>구분 Option</span>":"과 <span class='text-info'>구분 Option</span>"),(e!=i||f!=k||h!=l)&&!_confirm("장비에 연동중인 로그파서입니다.<br/>"+o+"을 수정하면<br/>오류가 발생 할 수 있습니다.<br/>수정하시겠습니까?")))return}switch(b.psrXml.data("nCheck")){case 1:break;case 0:return void _alert("Parser XML 체크 중입니다. 체크 후 저장하세요.");case-1:return _alert("잘못된 Parser XML 입니다."),void g(0);case-2:return void _alert("Parser XML 체크중 에러 발생으로 체크되지 않았습니다.");default:return void _alert("잘못된 체크 코드입니다.")}var p=1==b.form.find(".btn-save").data("after-close"),q=function(){$("body").requestData(c.mode.action,d,{callback:function(a,b,c){"SUC_COM_0001"==b&&a&&(d.log_psr_id=a,slapp.parser.logForm&&slapp.parser.logForm.addLogParser(d)),_alert(c,{onAgree:function(){j(p)}})}})};c.isNew?$("body").requestData(a.urlLogPsrNameCheck,d,{callback:function(a,b,c){"OK"==a?q():"EXIST"==a?_alert("동일한 로그파서명이 있어 처리 할 수 없습니다."):_alert("저장 처리중 에러가 발생했습니다.<br/> 다시 실행하세요.")}}):q()}},remove:function(){var c=1==b.form.find(".btn-delete").data("after-close"),d=m.getDataFormPage(),e="";return void 0==connCnt?void _alert("장비 연동 여부 체크에 실패했습니다.<br>다시 시도하세요."):connCnt>0?void _alert("장비에 연동중인 파서입니다.<br>삭제할수없습니다."):(e=useCnt>0?"파서에 등록된 로그파서입니다.<br>삭제하면 오류가 발생 할 수 있습니다.<br>삭제하시겠습니까?":"삭제하시겠습니까?",void _confirm(e,{onAgree:function(){$("body").requestData(a.urlDelete,d,{callback:function(a,b,d){_alert(d,{onAgree:function(){j(c)}})}})}}))}};return{init:d}}(),$(function(){slapp.parser.logManagerForm.init()});