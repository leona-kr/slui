"use strict";_SL.nmspc("collector").form=function(){var a={formId:"#formCollector",urlSelect:gCONTEXT_PATH+"management/collector.json",urlExist:gCONTEXT_PATH+"management/collector_exist.json",urlExistIp:gCONTEXT_PATH+"common/asset_check_ip.json",urlExistAgent:gCONTEXT_PATH+"management/rel_agent_exist.json",urlDelete:gCONTEXT_PATH+"management/collector_delete.do",add:{action:gCONTEXT_PATH+"management/collector_insert.do",message:"등록 하시겠습니까?"},update:{action:gCONTEXT_PATH+"management/collector_update.do",message:"수정 하시겠습니까?"}},b={form:$(a.formId),collectorId:$(a.formId+" [name=collector_id]")},c={isNew:""==b.collectorId.val(),mode:""==b.collectorId.val()?a.add:a.update},d=function(){e(),c.isNew?b.form.find(".btn-delete").hide():b.collectorId.addClass("form-text").prop("readonly",!0),c.isNew||f()},e=function(){b.form.find(".btn-save").on("click",g),b.form.find(".btn-delete").on("click",h)},f=function(){var c=b.collectorId.val(),d={collector_id:c},e=function(a){_SL.setDataToForm(a,b.form,{collector_ip:{converter:function(a,c){b.form.find("[name=b_collector_ip]").val(a),b.form.find("[name=collector_ip]").val(a)}}})};$("body").requestData(a.urlSelect,d,{callback:e})},g=function(){if(_SL.validate(b.form)){var d,e;d=b.form.find("[name=b_collector_ip]").val(),e=b.form.find("[name=collector_ip]").val();var f=1==$(this).data("after-close"),g=function(){d!=e?$("body").requestData(a.urlExistIp,{sip:e,chk_type:1},{callback:function(a){"OK"==a?h():"EXIST"==a?_alert("이미 등록된 IP입니다."):_alert("IP 중복 체크에 실패했습니다.<br>다시 시도하세요.")}}):h()},h=function(){$("body").requestData(c.mode.action,_SL.serializeMap(b.form),{callback:function(a,b,c){_alert(c,{onAgree:function(){i(f)}})}})};c.isNew?$("body").requestData(a.urlExist,{collector_id:b.collectorId.val()},{callback:function(a){1==a?g():_alert("사용중인 아이디가 있어 저장 할 수 없습니다.")}}):g()}},h=function(){var c=b.collectorId.val(),d=1==$(this).data("after-close"),e=function(){_confirm("삭제하시겠습니까?",{onAgree:function(){$("body").requestData(a.urlDelete,_SL.serializeMap(b.form),{callback:function(a,b,c){_alert(c,{onAgree:function(){i(d)}})}})}})};$("body").requestData(a.urlExistAgent,{collector_id:c},{callback:function(a){1==a?e():_alert("연동중인 Agent가 존재합니다.<br>연동된 Agent를 확인하세요.")}})},i=function(a){a&&b.form.find("[data-layer-close=true]").click()};return{init:d}}(),$(function(){slapp.collector.form.init()});