"use strict";_SL.nmspc("equipment").form=function(){var a={formId:"#formEquip",psrTreeId:"#psrTree",urlEqpJson:gCONTEXT_PATH+"system/eqp_codes.json",urlSelect:gCONTEXT_PATH+"management/equip_form.json",urlSelectPsrTree:gCONTEXT_PATH+"management/log_psr_list.json",urlComCodeForm:gCONTEXT_PATH+"sysdata/comcode_form.html",urlPerFormLimitForm:gCONTEXT_PATH+"event/performance_limit_form.html",urlExistIp:gCONTEXT_PATH+"management/equip_check_ip.json",urlDelete:gCONTEXT_PATH+"management/equip_delete.do",add:{action:gCONTEXT_PATH+"management/equip_add.do",message:"등록 하시겠습니까?"},update:{action:gCONTEXT_PATH+"management/equip_update.do",message:"수정 하시겠습니까?"}},b={form:$(a.formId),psrTree:$(a.psrTreeId),eqpId:$(a.formId+" [name=eqp_id]"),equipCodeType:$(a.formId+" .btn-register-equip").data("value"),groupCodeType:$(a.formId+" .btn-register-group").data("value")},c={isNew:""==b.eqpId.val(),mode:""==b.eqpId.val()?a.add:a.update},d=function(){b.form.find("[name=eqp_type_cd]").chosen({search_contains:!0,width:"100%"}),e(),b.psrTree.hide(),c.isNew?b.form.find(".btn-delete").hide():b.eqpId.addClass("form-text").prop("readonly",!0),c.isNew||f(),h()},e=function(){b.form.find(".btn-save").on("click",j),b.form.find(".btn-delete").on("click",k),b.form.find(".btn-register-equip").exModalPopup(a.urlComCodeForm+"?code_type="+b.equipCodeType,{width:550,height:455,onClose:function(){n(b.form.find("[name=eqp_type_cd]"))}}),b.form.find(".btn-register-group").exModalPopup(a.urlComCodeForm+"?code_type="+b.groupCodeType,{width:550,height:455,onClose:function(){m(b.form.find("[name=group_cd]"))}}),b.form.find("[name=psr_id]").change(g),b.form.find(".btn-register-threshold").exModalPopup(a.urlPerFormLimitForm,{width:550,height:420,onClose:function(){o(b.form.find("[name=threshold_id]"))}}),b.form.find("[name=stat_chk_type]").change(function(a){"2"==a.target.value?(b.form.find("[name=input_port]").show(),b.form.find("[name=stat_chk_port]").attr("data-valid","Port 번호,required,number")):(b.form.find("[name=input_port]").hide(),b.form.find("[name=stat_chk_port]").removeAttr("data-valid"))}),b.psrTree.draggable({handle:".area-head"})},f=function(){var c=b.eqpId.val(),d={eqp_id:c},e=function(c){_SL.setDataToForm(c,b.form,{eqp_ip:{converter:function(a,c){b.form.find("[name=b_eqp_ip]").val(a),b.form.find("[name=eqp_ip]").val(a)}},eqp_type_cd:{converter:function(a,c){b.form.find("[name=eqp_type_cd]").val(a),b.form.find("[name=eqp_type_cd]").trigger("chosen:updated"),b.form.find("[name=b_eqp_type_cd]").val(a)}},agent_id:{converter:function(a,c){b.form.find("[name=agent_id]").val(a),b.form.find("[name=b_agent_id]").val(a)}},psr_id:{converter:function(a,c){b.form.find("[name=psr_id]").val(a),b.form.find("[name=b_psr_id]").val(a)}}}),slui.attach.setTransformSelect(a.formId),b.form.find("[name=stat_chk_type]:checked").trigger("change"),g()};$("body").requestData(a.urlSelect,d,{callback:e})},g=function(){var c=b.form.find("[name=psr_id]").val();$("body").requestData(a.urlSelectPsrTree,{psr_id:c},{callback:function(a,c,d){a.length>0?i(a):b.psrTree.hide()}})},h=function(){b.psrTree.find(".dynTree").dynatree({minExpandLevel:2,onClick:function(a,b){if("root"==a.data.key)return!1},persist:!1,children:[{title:"erere",key:"root",icon:!1,children:[{title:"Security",key:"log_type_cd_1",isFolder:!0},{title:"Traffic",key:"log_type_cd_2",isFolder:!0},{title:"System",key:"log_type_cd_3",isFolder:!0},{title:"SMS",key:"log_type_cd_4",isFolder:!0}]}]})},i=function(a){var c,d=b.form.find("[name=psr_id] :selected").text(),e=b.psrTree.find(".dynTree").dynatree("getTree");e.reload(),e.getNodeByKey("root").setTitle(_SL.htmlEscape(d));for(var f=0;null!=a&&f<a.length;f++){var g=a[f];c=e.getNodeByKey("log_type_cd_"+g.log_type_cd),c.addChild({title:g.log_psr_nm,key:"log_psr_id_"+g.log_psr_id,dto:g}),c.data.dto||(c.data.dto={psr_id:g.psr_id,log_type_cd:g.log_type_cd},c.toggleExpand())}b.psrTree.show()},j=function(){if(_SL.validate(b.form)){var d=1==$(this).data("after-close"),e=function(){$("body").requestData(c.mode.action,_SL.serializeMap(b.form),{callback:function(a,b,c){_alert(c,{onAgree:function(){l(d)}})}})},f=b.form.find("[name=b_eqp_ip]").val(),g=b.form.find("[name=eqp_ip]").val();f!=g?$("body").requestData(a.urlExistIp,{eqp_ip:g},{callback:function(a){"OK"==a?e():"EXIST"==a?_alert("이미 장비에 등록된 IP입니다."):_alert("IP 중복 체크에 실패했습니다.<br> 다시 시도하세요.")}}):e()}},k=function(){var c=b.eqpId.val(),d=1==$(this).data("after-close");_confirm("삭제하시겠습니까?",{onAgree:function(){$("body").requestData(a.urlDelete,{eqp_id:c},{callback:function(a,b,c){_alert(c,{onAgree:function(){l(d)}})}})}})},l=function(a){a&&b.form.find("[data-layer-close=true]").click()},m=function(b){var c=slapp.comcode.form.getCode();b.append("<option value='"+c.code_id+"'>"+c.code_name+"</option>"),b.val(c.code_id),slui.attach.setTransformSelect(a.formId)},n=function(a){var b=slapp.comcode.form.getCode();a.append("<option value='"+b.code_id+"'>"+b.code_name+"</option>"),a.val(b.code_id),a.trigger("chosen:updated")},o=function(b){var c=slapp.sms.form.getThreshold();b.append("<option value='"+c.threshold_id+"'>"+c.threshold_name+"</option>"),b.val(c.threshold_id),slui.attach.setTransformSelect(a.formId)};return{init:d}}(),$(function(){slapp.equipment.form.init()});