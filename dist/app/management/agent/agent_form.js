"use strict";_SL.nmspc("agent").form=function(){var a={formId:"#formAgent",urlSelect:gCONTEXT_PATH+"management/agent.json",urlExistIp:gCONTEXT_PATH+"common/asset_check_ip.json",urlExistEqu:gCONTEXT_PATH+"management/agent_check_delete.json",urlDelete:gCONTEXT_PATH+"management/agent_delete.do",add:{action:gCONTEXT_PATH+"management/agent_insert.do",message:"등록 하시겠습니까?"},update:{action:gCONTEXT_PATH+"management/agent_update.do",message:"수정 하시겠습니까?"}},b={form:$(a.formId),agentId:$(a.formId+" [name=agent_id]")},c={isNew:""==b.agentId.val(),mode:""==b.agentId.val()?a.add:a.update},d=function(){e(),c.isNew?b.form.find(".btn-delete").hide():b.agentId.addClass("form-text").prop("readonly",!0),c.isNew||f()},e=function(){b.form.find(".btn-save").on("click",g),b.form.find(".btn-delete").on("click",h)},f=function(){var c=b.agentId.val(),d={agent_id:c},e=function(c){_SL.setDataToForm(c,b.form,{agent_ip:{converter:function(a,c){b.form.find("[name=b_agent_ip]").val(a),b.form.find("[name=agent_ip]").val(a)}}}),slui.attach.setTransformSelect(a.formId)};$("body").requestData(a.urlSelect,d,{callback:e})},g=function(){if(_SL.validate(b.form)){var d=(1==$(this).data("after-close"),function(){$("body").requestData(c.mode.action,_SL.serializeMap(b.form),{callback:function(a,b,c){_alert(c,{onAgree:function(){i(!0)}})}})}),e=b.form.find("[name=b_agent_ip]").val(),f=b.form.find("[name=agent_ip]").val();e!=f?$("body").requestData(a.urlExistIp,{sip:f,chk_type:2},{callback:function(a){"OK"==a?d():"EXIST"==a?_alert("이미 등록된 IP입니다."):_alert("IP 중복 체크에 실패했습니다.<br>다시 시도하세요.")}}):d()}},h=function(){var c=b.agentId.val(),d=(1==$(this).data("after-close"),function(){_confirm("삭제하시겠습니까?",{onAgree:function(){$("body").requestData(a.urlDelete,{agent_id:c},{callback:function(a,b,c){_alert(c,{onAgree:function(){i(!0)}})}})}})});$("body").requestData(a.urlExistEqu,{agent_id:c},{callback:function(a){"OK"==a?d():"EXIST"==a?_alert("연동된 장비가 존재합니다.<br>먼저 연동된 장비를 삭제하세요."):_alert("연동된 장비 존재 여부 체크에 실패했습니다.<br>다시 시도하세요.")}})},i=function(a){a&&b.form.find("[data-layer-close=true]").click()};return{init:d}}(),$(function(){slapp.agent.form.init()});