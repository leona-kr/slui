"use strict";_SL.nmspc("collectInfo").view=function(){var a={urlList:gCONTEXT_PATH+"monitoring/collect_info_view.json",urlChartData:gCONTEXT_PATH+"monitoring/detail_collect_info_chart.json",urlLoadEqp:gCONTEXT_PATH+"common/equipment_list.json",formId:"#searchCollectInfoView",gridId:"#gridCollectInfoView",lineChartContId:"#logCateLineChart",lineChartId:"colViewChartCont"},b={form:$(a.formId),grid:$(a.gridId),chtCont:$(a.lineChartContId),eqpTyp:$(a.formId+" [name=s_eqp_type_cd]"),eqpNm:$(a.formId+" [name=s_eqp_nm]"),eqpIp:$(a.formId+" [name=s_eqp_ip]"),grpCd:$(a.formId+" [name=s_group_cd]"),colYn:$(a.formId+" [name=s_collect_yn]"),logCd:$(a.formId+" [name=s_log_cate_cd]"),logCds:$(a.formId+" [name=s_log_cate_cds]"),period:$(a.formId+" [name=period]"),sDay:$(a.formId+" [name=startDay]"),sHour:$(a.formId+" [name=startHour]"),sMin:$(a.formId+" [name=startMin]"),eDay:$(a.formId+" [name=endDay]"),eHour:$(a.formId+" [name=endHour]"),eMin:$(a.formId+" [name=endMin]"),pEqpIp:$(a.formId+" [name=p_eqp_ip]"),pEqpTyp:$(a.formId+" [name=p_eqp_type_cd]")},c=function(){d(b.grid),e(),g()},d=function(c){var d={datatype:"json",datafields:[{name:"collect_allow_time",type:"string"},{name:"collect_yn",type:"string"},{name:"eqp_ip",type:"string"},{name:"eqp_nm",type:"string"},{name:"eqp_type_cd",type:"string"},{name:"eqp_type_nm",type:"string"},{name:"log_cate_cd",type:"string"},{name:"log_cate_nm",type:"string"},{name:"max_recv_time",type:"string"},{name:"min_recv_time",type:"string"},{name:"last_recv_time",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(d.totalrecords=a.totalRows)},cache:!1,url:a.urlList},e=new $.jqx.dataAdapter(d,{beforeLoadComplete:function(a){for(var c in a){var d=a[c].eqp_type_cd;b.eqpTyp.val(d)}return a},formatData:function(b){var c,d={},e=$(a.formId).serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(b,d),b},loadError:function(a,b,c){_alert(c)}});c.jqxGrid({source:e,sortable:!1,width:"100%",virtualmode:!0,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"로그분류코드",datafield:"log_cate_nm",cellsalign:"center"},{text:"정상수집 허용시간",datafield:"collect_allow_time",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){switch(c){case 5:c="5분";break;case 10:c="10분";break;case 30:c="30분";break;case 60:c="1시간";break;case 180:c="3시간";break;case 360:c="6시간";break;case 720:c="12시간";break;case 1440:c="1일";break;default:c="-"}return $(d).html(c)[0].outerHTML}},{text:"최종 수집시간",datafield:"last_recv_time",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g=f.min_recv_time,h=f.max_recv_time,i=f.collect_yn,j=_SL.formatDate(),k="";if(null!=g){k="Y"==i?g.toString():h.toString();var l=_SL.formatDate.diff(k,j)/6e4;if(""!=k){l<0&&(l=0);var m=parseInt(l/1440),n=parseInt(l%1440/60),o=parseInt(l%1440%60),p="";0!=m&&(p+=m+"일 "),0==m&&0==n||(p+=n+"시간 "),0==m&&0==n&&0==o||(p+=o+"분"),k=""!=p?_SL.formatDate(k,"yyyyMMddHHmm","yyyy-MM-dd HH:mm")+("("+p+" 전)"):_SL.formatDate(k,"yyyyMMddHHmm","yyyy-MM-dd HH:mm")+"(1분내)"}}return $(d).html(k)[0].outerHTML}},{text:"수집상태",datafield:"collect_yn",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g;return g="Y"==c?"<span class='label-success'>수집</span>":"<span class='label-danger'>미수집</span>",$(d).html(g)[0].outerHTML}}]})},e=function(){b.form.find(".btn-submit").off().on("click",function(){if(_SL.validate(b.form)){var a=b.sDay.val()+b.sHour.val()+b.sMin.val(),c=b.eDay.val()+b.eHour.val()+b.eMin.val(),d=_SL.formatDate.diff(a,c);$("#s_eqp_ip").val();if(d<=0)return void _alert("시작일이 종료일보다 큽니다.");if(d/6e4>b.form.find("[name=timeSet] option:last-child").val())return void _alert("검색 기간 초과입니다.");b.form.find("[name=currPage]").val(1),i()}}),b.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var c=function(a,b){var c=a.siblings(".tform-select");c.find(".tform-select-t").text(b).end().find(".tform-select-option[data-value="+b+"]").addClass("selected").end(),a.val(b)},d=_SL.formatDate.addMin(b.form.find("[name=endDay]").val()+b.form.find("[name=endHour]").val()+b.form.find("[name=endMin]").val(),-a);c(b.form.find("[name=startDay]"),d.substring(0,8)),c(b.form.find("[name=startHour]"),d.substring(8,10)),c(b.form.find("[name=startMin]"),d.substring(10,12))}}),b.form.find("[name=startDay],[name=startHour],[name=startMin],[name=endDay],[name=endHour],[name=endMin]").change(function(){var a=b.form.find("[name=timeSet]"),c=a.siblings(".tform-select").find("[data-value=0]").text();a.val(0).siblings(".tform-select").find(".tform-select-t").text(c)}),f(!0),$("[name=s_eqp_type_cd]").change(function(){f(!1)})},f=function(c){var d=b.eqpTyp.val(),e=b.pEqpTyp.val();if(""==d&&""==e)return b.form.find("[name=s_eqp_ip]").html("<option value=''>[Name(IP Address)]</option>"),void slui.attach.setTransformSelect(a.formId);""!=d&&""!=e&&b.pEqpTyp.val(""),""==d&&c&&(b.eqpTyp.val(e),b.pEqpTyp.val(""));var f={s_eqp_type_cd:b.eqpTyp.val()},g=function(d){b.form.find("[name=s_eqp_ip]").html("<option value=''>[Name(IP Address)]</option>");var e=d.eqp_list;for(var f in e){var g=e[f].eqp_ip,h=e[f].eqp_nm;b.eqpIp.append($("<option>").val(g).text(h+"("+g+")")),b.pEqpIp.val()==g&&c&&b.eqpIp.val(g),slui.attach.setTransformSelect(a.formId)}};$("body").requestData(a.urlLoadEqp,f,{callback:g})},g=function(){var c=b.eqpIp.val(),d=b.eqpTyp.val();""==c&&(c=b.pEqpIp.val()),""==d&&(d=b.eqpTyp.val()),$.getJSON(a.urlChartData,{s_eqp_ip:c,s_eqp_type_cd:d,start_time:b.sDay.val()+b.sHour.val()+b.sMin.val(),end_time:b.eDay.val()+b.eHour.val()+b.eMin.val()},function(a){var c=a.logCateList,d=a.logChartList;if(j.dataSource.chart=$.extend({},slui.chart.chartConfig,j.dataSource.chart),0==c.length){var e=j;b.chtCont.html('<div class="item-board item-board-wide" >\t\t\t\t\t\t\t<div class="board-head">\t\t\t\t\t\t\t\t<div class="btns-group">\t\t\t\t\t\t\t\t\t<button type="button" class="btn-toggle" data-toggle-handle="true" data-toggle-target="#colViewToggleChart" data-toggle-class="hide">\t\t\t\t\t\t\t\t\t\t<i class="icon-chevron-up"></i>\t\t\t\t\t\t\t\t\t</button>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="chart-group" id="colViewToggleChart">\t\t\t\t\t\t\t\t<div id="colViewChartCont" class="chart_container"></div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>'),e.renderAt="colViewChartCont",h(e)}else{b.chtCont.empty();for(var f in c){var g=0,i=c[f].code_id,k=c[f].code_name,e=$.extend(!0,{},j);e.dataSource.data=[],e.renderAt="colViewChartCont"+i;for(var f in d[i]){var l=d[i],m={};if(m={label:l[f].label.substring(3,8),value:l[f].value},g+=l[f].value,0!=f&&l[f-1].label.substring(0,2)!=l[f].label.substring(0,2)){var n=l[f-1].label.substring(0,2)+"일",o=l[f].label.substring(0,2)+"일";e.dataSource.data.push({vline:!0,label:n,dashed:"1",dashLen:"3",dashGap:"2",color:"656565",labelHAlign:"right"}),e.dataSource.data.push({vline:!0,label:o,dashed:"1",dashLen:"3",dashGap:"2",color:"656565",labelHAlign:"left"})}e.dataSource.data.push(m)}var p=k+" - (총 "+_SL.formatNumber(g)+"건)";b.chtCont.append("<div class='item-board item-board-wide' >\t\t\t\t\t\t\t\t<div class='board-head'>"+p+"\t\t\t\t\t\t\t\t\t<div class='btns-group'>\t\t\t\t\t\t\t\t\t\t<button type='button' class='btn-toggle' data-toggle-handle='true' data-toggle-target='#colViewToggleChart"+i+"' data-toggle-class='hide'>\t\t\t\t\t\t\t\t\t\t\t<i class='icon-chevron-up'></i>\t\t\t\t\t\t\t\t\t\t</button>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class='chart-group' id='colViewToggleChart"+i+"'>\t\t\t\t\t\t\t\t\t<div id='colViewChartCont"+i+"' class='chart_container'></div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>"),h(e)}}var q=b.chtCont.parents("[class^=page-]").attr("class").split(" ")[0];slui.attach.setToggleLayer("."+q)})},h=function(a){FusionCharts.ready(function(){new FusionCharts(a).render()})},i=function(){b.grid.jqxGrid("updatebounddata"),g()},j={type:"area2d",width:"100%",height:"135",dataFormat:"json",dataSource:{chart:{bgColor:"#fafafa",formatnumberscale:"1",plotfillalpha:"60",plotfillcolor:"#00acc6",plotfillratio:"10,90",showvalues:"0",yAxisName:"Count"},data:[]}};return{init:c}}(),$(function(){slapp.collectInfo.view.init()});