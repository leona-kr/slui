"use strict";_SL.nmspc("performance").view=function(){var a={s_eqp_type_cd:"",s_eqp_ip:""},b={urlView:gCONTEXT_PATH+"monitoring/performance_view.json",urlLoadEqpType:gCONTEXT_PATH+"common/eqp_type_use_list.json",urlLoadEqp:gCONTEXT_PATH+"common/equipment_list.json",urlCpuChart:gCONTEXT_PATH+"monitoring/cpu_chart.json",urlMemoryChart:gCONTEXT_PATH+"monitoring/memory_chart.json",urlDiskChart:gCONTEXT_PATH+"monitoring/disk_chart.json",urlNetworkChart:gCONTEXT_PATH+"monitoring/network_chart.json",gridId:"#gridPerformView",formId:"#searchPerformView",cpuId:"#cpuContainer",memoryId:"#memoryContainer",diskId:"#diskContainer",networkId:"#networkContainer"},c={grid:$(b.gridId),form:$(b.formId),cpu:$(b.cpuId),memory:$(b.memoryId),disk:$(b.diskId),network:$(b.networkId)},d=function(){var b=c.form.find("[name=param_eqp_type_cd]").val(),d=c.form.find("[name=param_eqp_ip]").val();a.s_eqp_ip=d?d:"",a.s_eqp_type_cd=b?b:"",f(c.grid),h(c.cpu.attr("id")),h(c.memory.attr("id")),h(c.disk.attr("id")),h(c.network.attr("id")),c.form.find(".form-submit").off().on("click",function(){_SL.validate(c.form)&&g(a)}),e(),c.form.find("[name=s_eqp_type_cd]").change(n),m()},e=function(){c.form.find(".btn-submit").off().on("click",function(){var a=c.form.find("[name=startDay]").val()+c.form.find("[name=startHour]").val()+c.form.find("[name=startMin]").val(),d=c.form.find("[name=endDay]").val()+c.form.find("[name=endHour]").val()+c.form.find("[name=endMin]").val(),e=_SL.formatDate.diff(a,d);return e<=0?void _alert("시작일이 종료일보다 큽니다."):e/6e4>$(b.formId+" option:last-child").val()?void _alert("검색 기간 초과입니다."):void(_SL.validate()&&g())}),c.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var b=function(a,b){var c=a.siblings(".tform-select");c.find(".tform-select-t").text(b).end().find(".tform-select-option[data-value="+b+"]").addClass("selected").end(),a.val(b)},d=_SL.formatDate.addMin(c.form.find("[name=endDay]").val()+c.form.find("[name=endHour]").val()+c.form.find("[name=endMin]").val(),-a);b(c.form.find("[name=startDay]"),d.substring(0,8)),b(c.form.find("[name=startHour]"),d.substring(8,10)),b(c.form.find("[name=startMin]"),d.substring(10,12))}}),c.form.find("[name=startDay],[name=startHour],[name=startMin],[name=endDay],[name=endHour],[name=endMin]").change(function(){var a=c.form.find("[name=timeSet]"),b=a.siblings(".tform-select").find("[data-value=0]").text();a.val(0).siblings(".tform-select").find(".tform-select-t").text(b)})},f=function(a){var d=$.extend({},_SL.serializeMap(c.form)),e={datatype:"json",data:d,datafields:[{name:"eqp_time",type:"string"},{name:"cpu_used",type:"string"},{name:"used_percent",type:"string"},{name:"read_bytes",type:"string"},{name:"write_bytes",type:"string"},{name:"rx_bytes",type:"string"},{name:"tx_bytes",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(e.totalrecords=a.totalRows)},cache:!1,url:b.urlView},f=new $.jqx.dataAdapter(e,{beforeLoadComplete:function(a){_SL.formatNumber.Options.decimals=1;for(var b in a)a[b].eqp_dt=a[b].eqp_time,a[b].eqp_time=_SL.formatDate(a[b].eqp_time,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),a[b].read_bytes=_SL.formatNumber(a[b].read_bytes/1048576),a[b].write_bytes=_SL.formatNumber(a[b].write_bytes/1048576),a[b].rx_bytes=_SL.formatNumber(a[b].rx_bytes/1048576),a[b].tx_bytes=_SL.formatNumber(a[b].tx_bytes/1048576);return a},formatData:function(a){var b,d={},e=c.form.serializeArray();for(b in e)d[e[b].name]=e[b].value;return $.extend(a,d),a},loadError:function(a,b,c){_alert(c)}});a.jqxGrid({source:f,width:"100%",virtualmode:!0,enablehover:!1,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"장비시간",datafield:"eqp_time",cellsalign:"center"},{text:"CPU",datafield:"cpu_used",width:"12%",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).text(c+"%")[0].outerHTML}},{text:"Memory",datafield:"used_percent",width:"12%",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).text(c+"%")[0].outerHTML}},{text:"Read",datafield:"read_bytes",width:"10%",columngroup:"disk_bps",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).text(c+"MB")[0].outerHTML}},{text:"Write",datafield:"write_bytes",width:"10%",columngroup:"disk_bps",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).text(c+"MB")[0].outerHTML}},{text:"Inbound",datafield:"rx_bytes",width:"10%",columngroup:"netw_bps",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).text(c+"MB")[0].outerHTML}},{text:"Outbound",datafield:"tx_bytes",width:"10%",columngroup:"netw_bps",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).text(c+"MB")[0].outerHTML}}],columngroups:[{text:"Disk(MBps)",align:"center",name:"disk_bps"},{text:"Network(MBps)",align:"center",name:"netw_bps"}]}),a.on("cellclick",function(a){})},g=function(){c.cpu.empty(),c.memory.empty(),c.disk.empty(),c.network.empty(),h(c.cpu.attr("id")),h(c.memory.attr("id")),h(c.disk.attr("id")),h(c.network.attr("id")),f(c.grid)},h=function(a){var d="",e=$.extend({},_SL.serializeMap(c.form)),f=function(b){switch(a){case"cpuContainer":i(b.list,b.trs,a);break;case"memoryContainer":j(b.list,b.trs,a);break;case"diskContainer":k(b.list,b.trs,a);break;case"networkContainer":l(b.list,b.trs,a);break;default:return}};if(""!=e.s_eqp_ip||""!=e.param_eqp_ip){switch(a){case"cpuContainer":d=b.urlCpuChart;break;case"memoryContainer":d=b.urlMemoryChart;break;case"diskContainer":d=b.urlDiskChart;break;case"networkContainer":d=b.urlNetworkChart;break;default:return}$("body").requestData(d,e,{callback:f})}},i=function(a,b,c){if(null!=a&&0!=a.length){var d=new FusionCharts({type:"area2d",renderAt:c,width:"100%",height:"300",dataFormat:"json"}),e={chart:{caption:"CPU Monitoring",numberSuffix:"%",showvalues:"0",formatnumberscale:"1",plotfillcolor:"#00acc6",yAxisMaxValue:"100",showBorder:"1"},trendlines:[{line:[{startvalue:b.trs_cpu_low,color:"#ff8400",displayvalue:"",tooltext:"CPU 임계치",alpha:100,showOnTop:1}]}]};e.chart=$.extend({},slui.chart.chartConfig,e.chart),e.data=a,d.setJSONData(JSON.stringify(e)),d.render()}},j=function(a,b,c){if(null!=a&&0!=a.length){var d=new FusionCharts({type:"area2d",renderAt:c,width:"100%",height:"300",dataFormat:"json"}),e={chart:{caption:"Memory Monitoring",numberSuffix:"%",showvalues:"0",plotfillcolor:"#00acc6",yAxisMaxValue:"100",showBorder:"1"},trendlines:[{line:[{startvalue:b.trs_mem_low,color:"#ff8400",displayvalue:"",tooltext:"Memory 임계치",alpha:100,showOnTop:1}]}]};e.chart=$.extend({},slui.chart.chartConfig,e.chart),e.data=a,d.setJSONData(JSON.stringify(e)),d.render()}},k=function(a,b,c){if(null!=a&&0!=a.length){var d=new FusionCharts({type:"msarea",renderAt:c,width:"100%",height:"300",dataFormat:"json"}),e={chart:{caption:"Disk Monitoring",numberSuffix:"B",showvalues:"0",plotfillalpha:"60",numvdivlines:"10",showBorder:"1"},trendlines:[{line:[{startvalue:b.trs_io_read,color:"#ff8400",tooltext:"Read 임계치",alpha:100,showOnTop:"1"},{startvalue:b.trs_io_write,color:"#6dd0f7",tooltext:"Write 임계치",alpha:100,showOnTop:"1"}]}]};e.chart=$.extend({},slui.chart.chartConfig,e.chart),e.categories=new Array,e.categories[0]={category:a};for(var f=[],g=[],h=Math.max(""==b.trs_io_read?0:b.trs_io_read,""==b.trs_io_write?0:b.trs_io_write),i=0;i<a.length;i++)h=Math.max(Math.max(a[i].value,a[i].value2),h),f[i]={value:a[i].value},g[i]={value:a[i].value2};e.chart.yAxisMaxValue=_SL.getChartMaxValue(h),e.dataset=new Array,e.dataset[0]={seriesname:"Read",data:f},e.dataset[1]={seriesname:"Write",data:g},d.setJSONData(JSON.stringify(e)),d.render()}},l=function(a,b,c){if(null!=a&&0!=a.length){var d=new FusionCharts({type:"msarea",renderAt:c,width:"100%",height:"300",dataFormat:"json"}),e={chart:{caption:"Network Monitoring",numberSuffix:"B",showvalues:"0",numvdivlines:"10",plotfillalpha:"60",showBorder:"1"},trendlines:[{line:[{startvalue:b.trs_net_rx,color:"#ff8400",tooltext:"Inbound 임계치",alpha:100,showOnTop:"1"},{startvalue:b.trs_net_tx,color:"#6dd0f7",tooltext:"Outbound 임계치",alpha:100,showOnTop:"1"}]}]};e.chart=$.extend({},slui.chart.chartConfig,e.chart),e.categories=[],e.categories[0]={category:a};for(var f=[],g=[],h=Math.max(""==b.trs_net_rx?0:b.trs_net_rx,""==b.trs_net_tx?0:b.trs_net_tx),i=0;i<a.length;i++)h=Math.max(Math.max(a[i].value,a[i].value2),h),f[i]={value:a[i].value},g[i]={value:a[i].value2};e.chart.yAxisMaxValue=_SL.getChartMaxValue(h),e.dataset=[],e.dataset[0]={seriesname:"Inbound",data:f},e.dataset[1]={seriesname:"Outbound",data:g},d.setJSONData(JSON.stringify(e)),d.render()}},m=function(){$("body").requestData(b.urlLoadEqpType,{},{callback:function(d){var e=c.form.find("[name=s_eqp_type_cd]:eq(0)");$.each(d.eqp_type_list,function(){e.append('<option value="'+this.eqp_type_cd+'">'+this.eqp_type_nm+"</option>")}),""!=a.s_eqp_type_cd&&(e.val(a.s_eqp_type_cd),a.s_eqp_type_cd="",n()),slui.attach.setTransformSelect(b.formId)}})},n=function(){var d=c.form.find("[name=s_eqp_type_cd]").val();return c.form.find("[name=s_eqp_ip]").html("<option value=''>[Name(IP Address)]</option>"),null==d&&(d=""),""==d?(c.form.find("[name=s_eqp_ip]").html("<option value=''>[Name(IP Address)]</option>"),void slui.attach.setTransformSelect(b.formId)):void $("body").requestData(b.urlLoadEqp,{s_eqp_type_cd:d},{callback:function(d){var e=c.form.find("[name=s_eqp_ip]");$.each(d.eqp_list,function(){e.append('<option value="'+this.eqp_ip+'">'+this.eqp_nm+"("+this.eqp_ip+")</option>")}),""!=a.s_eqp_ip&&(e.val(a.s_eqp_ip),a.s_eqp_ip=""),slui.attach.setTransformSelect(b.formId)}})};return{init:d}}(),$(function(){slapp.performance.view.init()});