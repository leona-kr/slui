"use strict";_SL.nmspc("logsearch")["export"]=function(){var a,b,c=gCONTEXT_PATH+"monitoring/",d={DOM:{btnExcel:"#logBtns .btn-excel",dlg:"#windowProgress",msg:".progress-msg",rateTxt:".progress-rate-txt",rateBox:".progress-rate-box",hiddenFrame:"hiddenIFrame"},URL:{logExport:c+"log_search_export.do",exportStat:c+"log_export_stat.json",exportStop:c+"log_export_stop.do"}},e={dlg:$(d.DOM.dlg)},f={$hFrm:null,procId:"",itvId:0},g=function(){b=slapp.logsearch.dynPaging,a=slapp.logsearch.manager,e.dlg.jqxWindow({height:90,width:300,autoOpen:!1,showCloseButton:!0,keyboardCloseKey:1,resizable:!1,isModal:!0,modalOpacity:.5}),$(d.DOM.btnExcel).on("click",h),e.dlg.find(".jqx-window-close-button").off("click").on("click",function(){_confirm("중지 하시겠습니까?",{onAgree:function(){n(!0)}})})},h=function(){return 0==b.isSearched()||b.isCancel()?void _alert("검색 완료 후 실행하세요."):b.getTotal()>gMaxSaveLogCount?void _alert("전체 건수 : "+_SL.formatNumber(b.getTotal())+"건<br>"+_SL.formatNumber(gMaxSaveLogCount)+"건 이상은 다운로드 할 수 없습니다."):void _confirm("다운로드 하시겠습니까?",{onAgree:i})},i=function(){f.procId=_SL.formatDate("yyyyMMddHHmmss");var c={start_time:b.getStartTime()==gAllPeriodStartTime?"":b.getStartTime(),end_time:b.getStartTime()==gAllPeriodStartTime?"":b.getEndTime(),query:b.getQuery(),mylogs_id:b.getMylogsId(),total:b.getTotal(),user_fields:b.getViewFields().join(","),proc_id:f.procId,separator:",",action:gLogSearchParam.action};a.submitToFrame(d.URL.logExport,c),m()},j=function(a){e.dlg.find(d.DOM.msg).html(a),e.dlg.jqxWindow("isOpen")||e.dlg.jqxWindow("open")},k=function(a){e.dlg.find(d.DOM.rateTxt).text(a+"%"),e.dlg.find(d.DOM.rateBox).css("width",a+"%")},l=function(){e.dlg.jqxWindow("close")},m=function(){console.log("startCheckProcStat..."),f.itvId=setInterval(o,1e3),k(0),j("다운로드 파일 생성중입니다...")},n=function(a){console.log("stopCheckProcStat... bUser : "+a),a?(j("다운로드 중지중입니다..."),$("body").requestData(d.URL.exportStop,{proc_id:f.procId},{callback:function(){console.log("STOP")}})):(f.itvId>0&&(clearInterval(f.itvId),f.itvId=0),a||e.dlg.jqxWindow("isOpen")&&l())},o=function(){$("body").requestData(d.URL.exportStat,{proc_id:f.procId},{callback:function(a,b,c){if(a.stat){if("SEL"==a.stat||"DWN"==a.stat){var d=0==a.read_cnt?0:Math.round(100*a.read_cnt/a.total_cnt,0);k(d)}"SEL"!=a.stat&&n(!1)}else n(!1)}})};g()}();