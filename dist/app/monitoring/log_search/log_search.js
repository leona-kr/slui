"use strict";_SL.nmspc("logsearch").manager=function(){var a,b="hiddenFrame",c="data-mylogs-mode",d=gCONTEXT_PATH+"monitoring/va_toolkit.do?dummy",e=gCONTEXT_PATH+"monitoring/log_search.html",f=function(b,e){slapp.logsearch.searchTime={isPreset:!0,to:e.end_time,from:e.start_time},a=_SL.formatDate.diff(_SL.formatDate("yyyyMMddHHmmss"),b,"yyyyMMddHHmmss")/1e3|0,gIsMyLogsMode&&$("["+c+"=hide]").hide(),slapp.logsearch.dnt.init(),slapp.logsearch.query.init(),slapp.logsearch.layer.init(),slapp.logsearch.dynPaging.init(),slapp.logsearch.contextmenu.init(),slapp.logsearch.submit.init(),slapp.logsearch.mysearch.init(),slapp.logsearch.mylogsDlg.init(),slapp.logsearch.dlgViewField.init(),$("#btnSettingMyLogs").togglePage(gCONTEXT_PATH+"monitoring/mylogs_group_form.html"),$("body").on("addkeyword.logsearch",function(a,b,c){slapp.logsearch.query.addKeyword(b,c)}),$(".btn-visual").on("click",function(){var a=slapp.logsearch.dynPaging;g(d,{start_time:a.getStartTime(),end_time:a.getEndTime(),expert_keyword:a.getQuery()})})},g=function(a,b,c){var d=$("<form>").attr($.extend({action:a,method:"post"},c||{}));for(var e in b)d.append($("<input type='hidden'>").attr("name",e).val(b[e]));d.appendTo("body").submit().remove()},h=function(a,c){0==$("iframe").size()&&$("<iframe>").attr("name",b).css({display:"none",visibility:"hidden"}).appendTo("body"),g(a,c,{target:b})},i=function(a){var b=$.extend({},gLogSearchParam,{expert_keyword:slapp.logsearch.dynPaging.getQuery(),template_id:"popup"},a);g(e,b,{target:"logSearchWin_"+(new Date).getTime()})};return{init:f,getServerTime:function(b){return _SL.formatDate.addSec(new Date,a,b)},submit:g,submitToFrame:h,openSearch:i}}(),slapp.logsearch.option={textUserDefined:"User Defined",textDefaultTime:"Last 5 Min",valueDefaultTime:5,isAuto:null!=$.cookie("sl_sa")?parseInt($.cookie("sl_sa")):1,closeDntAuto:!0,closeDntAfterSearch:!0,dntRecentYear:3,dntTypes:["year","month","day","hour","minute"],recentName:"sl_sr",assetName:"sl_ss"},slapp.logsearch.submit=function(){var a,b,c="#btnSearchSubmit",d="#btnSearchTimes",e="#textSearchTimes",f="시작일이 종료일보다 큽니다",g=function(){j(),h()},h=function(){$(c).off().on("click",function(){i()&&j()})},i=function(){a=slapp.logsearch.dnt.getSelectedTime("from"),b=slapp.logsearch.dnt.getSelectedTime("to");var c=_SL.formatDate.diff(a,b,"yyyyMMddHHmm")/1e3|0;return!(c<0)||void _alert(f)},j=function(){l(),m(),k(),slapp.logsearch.option.isAuto&&slapp.logsearch.layer.hideLayer(),slapp.logsearch.dynPaging.search()},k=function(){slapp.logsearch.recent.setSave(),slapp.logsearch.recent.setLists();var a=_SL.formatDate.diff(slapp.logsearch.searchTime.from,slapp.logsearch.searchTime.to,"yyyyMMddHHmm")/1e3|0;if(slapp.logsearch.option.valueDefaultTime=parseInt(a/60),slapp.logsearch.searchTime.isPreset&&$(".sp-preset button[data-value="+parseInt(a/60)+"]").size()>0)var b=$(".sp-preset button[data-value="+parseInt(a/60)+"]").text();else{var b=slapp.logsearch.option.textUserDefined;slapp.logsearch.searchTime.isPreset=!1,slapp.logsearch.dnt.selectedTime.isPreset=!1}$(d).text(b),slapp.logsearch.option.closeDntAfterSearch&&slapp.logsearch.dnt.hideLayer()},l=function(){slapp.logsearch.searchTime.from=slapp.logsearch.dnt.getSelectedTime("from"),slapp.logsearch.searchTime.to=slapp.logsearch.dnt.getSelectedTime("to"),slapp.logsearch.searchTime.isPreset=slapp.logsearch.dnt.selectedTime.isPreset},m=function(){var a=slapp.logsearch.searchTime.from,b=slapp.logsearch.searchTime.to,c=[a.slice(0,4),a.slice(4,6),a.slice(6,8),a.slice(8,10),a.slice(10,12)],d=[b.slice(0,4),b.slice(4,6),b.slice(6,8),b.slice(8,10),b.slice(10,12)],f=$(e+" [data-time=from]"),g=$(e+" [data-time=to]");f.text(c[0]+"-"+c[1]+"-"+c[2]+" "+c[3]+":"+c[4]),g.text(d[0]+"-"+d[1]+"-"+d[2]+" "+d[3]+":"+d[4])};return{init:g,submitSearch:j}}(),slapp.logsearch.query=function(){var a,b=slapp.logsearch.manager,c="#areaSearch",d=function(){a=$(c)},e=function(){return a.val()},f=function(b){a.val(b)},g=function(b,c){if(gIsMyLogsMode)return void j(b,c);var d,e=h(a),f=i(a),g=/(?:\s*(OR|AND|NOT)\s*)$/,k=g.test(e),m=/(?:\s*\+\s*)$/,n=m.test(e),o=!0,p=!0;k||n||""==e?(d=b+":"+_SL.luceneValueEscape(c),n&&(o=!1)):d=f.indexOf(b)!=-1&&e.indexOf(b)!=-1?"OR "+b+":"+_SL.luceneValueEscape(c):"AND "+b+":"+_SL.luceneValueEscape(c),l(d,o,p)},h=function(a){if("undefined"!=typeof a){var b=a[0].selectionStart;a[0].selectionEnd;return $.trim(a.val().substring(0,b))}return""},i=function(a){if("undefined"!=typeof a){var b=a[0].selectionStart,c=a[0].selectionEnd,d=a.val().length;return $.trim(a.val().substring(0,b)+a.val().substring(c,d))}return""},j=function(a,c){var d=e();""==d?d=a+":"+_SL.luceneValueEscape(c):d+=" AND "+a+":"+_SL.luceneValueEscape(c),b.openSearch({expert_keyword:d,mylogs_id:""})},k=function(b){var c=($.trim(a.val()),!1),d=!1;""!=b&&(/AND|OR|NOT/.test(b)&&(c=d=!0),l(b,c,d))},l=function(b,c,d){var e,f,g,h,i,j,k=a[0];if(k.focus(),"selectionStart"in k)return g=k.value,e=k.selectionStart,f=k.selectionEnd,h=g.substring(0,e),i=g.substring(e,f),j=g.substring(f),c&&h.length>0&&/\S$/.test(h)&&(b=" "+b),d&&/^\S/.test(j)&&(b+=" "),k.value=h+b+j,void(k.selectionStart=k.selectionEnd=f+b.length-i.length);if(document.selection){var l=document.selection.createRange();if(l&&l.parentElement()==k)return void(l.text=c?" ":""+b+d+" ")}k.value(k.value+c?" ":""+b+d+" ")};return{init:d,getQuery:e,setQuery:f,addKeyword:g,addOperator:k,replaceSelection:l}}(),slapp.logsearch.progressbar=function(){var a,b=".section-search .area-progress",c=".bar-state",d=".btn-stop",e=$(b),f=$(c,b),g=function(){a=slapp.logsearch.dynPaging,$(d,e).off().on("click",function(){a.stopSearch()})},h=function(a){var c=function(){f.width("0px"),e.show()};void 0!=a?($(b).is(":hidden")&&c(),f.width(Math.round(a)+"%")):c()},i=function(){$(b).hide()};return{init:g,show:h,hide:i}}(),slapp.logsearch.layer=function(){var a,b="#btnSearchToggle",c="#areaSearch",d="#layerSearch",e="#checkAuto",f="#listSearchRecent",g="btn-search",h="area-layer-module",i="open",j="btn-dnt",k="active",l="hover",m="sl_sa",n=slapp.logsearch.option.isAuto,o=!1,p=function(){a=slapp.logsearch.query,q(),slapp.logsearch.assets.init(),slapp.logsearch.recent.setLists(),$(e).prop("checked",n),gIsMyLogsMode&&($("#log_search_container").hide(),$("#bt_logs_save").hide(),$(".log-action-bt img").hide(),$("#export_btn").show()),gLogSelectable&&$("#bt_proc_incd").show()},q=function(){$(b).on("click",function(){o?z():y()}),$(c).on("keyup",s).on("focus",function(){n&&!o&&y()}).on("keydown",function(a){switch(a.keyCode){case 13:return slapp.logsearch.submit.submitSearch(),!1;case 40:r(0);break;case 38:r(1);break;case 27:u()}}),$(e).on("change",function(){$(this).prop("checked")?(n=!0,slapp.logsearch.option.isAuto=!0,$.cookie(m,1,{expires:30}),v()):(n=!1,slapp.logsearch.option.isAuto=!1,$.cookie(m,0,{expires:30}),w())}),$(d+" .sp-ari button").each(function(){$(this).on("click",function(){a.addOperator($(this).val())})})},r=function(a){if($(d).is(":hidden"))return!1;for(var b=$(f+" li"),e=-1,g=b.size(),h=0,i=g;h<i;h++)b.eq(h).hasClass(k)&&(e=h);0===a&&e<g-1?e++:1===a&&e>0&&e--,b.removeClass(l),b.removeClass(k),b.eq(e).addClass(k),$(c).val(b.eq(e).text().trim())},s=function(){},t=function(){$(b).addClass(i),o=!0,$(d).show(),n&&v(),slui.attach.setTransformSelect(d),$(d+" .nano").nanoScroller()},u=function(){$(b).removeClass(i),o=!1,$(d).hide(),n&&w()},v=function(){document.querySelector("body").addEventListener("mousedown",x)},w=function(){document.querySelector("body").removeEventListener("mousedown",x)},x=function(){if(o){var a=event,b=!($(a.target).hasClass(h)||$(a.target).parents().hasClass(h)||$(a.target).hasClass(j)||$(a.target).parents().hasClass(j)||$(a.target).hasClass(g)||$(a.target).parents().hasClass(g)||$(a.target).parents().hasClass("modal-alert")||$(a.target).parents().hasClass("pop-items")||"btnSearchToggle"==a.target.id);1==b&&u()}},y=function(){t()},z=function(){u()};return{init:p,showLayer:y,hideLayer:z}}(),slapp.logsearch.recent=function(){var a="#areaSearch",b="#listSearchRecent",c="hover",d="active",e=5,f=slapp.logsearch.option.recentName,g=null!=$.cookie(f)?$.cookie(f).split(","):[],h=function(){var b=$(a).val().trim();if(""!=b){for(var c=0,d=g.length;c<d;c++)g[c]!==b||g.splice(c,1);g.unshift(b),g.length>e&&g.pop(e-1),$.cookie(f,g.toString(),{expires:30})}},i=function(){if(g.length>0){for(var f=$(b).empty(),h=0,i=g.length;h<i&&!(h>e-1);h++)f.append("<li>"+g[h]+"</li>");f.find("li").each(function(){$(this).off().on("click",function(){$(a).val($(this).text()),slapp.logsearch.submit.submitSearch()}).on("mouseover",function(){$(this).addClass(c),$(b+" ."+d).removeClass(d)}).on("mouseout",function(){$(this).removeClass(c)})})}};return{setSave:h,setLists:i}}(),slapp.logsearch.assets=function(){var a,b,c=null,d="#layerAsset",e="#layerField",f="#layerBook",g="#selectAsset",h="#inputField",i="#inputBook",j="#layerSearchfields",k="list-default",l="list-empty",m="item-title",n="active",o="hover",p=[],q=[],r=slapp.logsearch.option.assetName,s=function(a){if(c=slapp.logsearch.query,t(),void 0==a){var b=null!=$.cookie(r)?$.cookie(r):"0";u(b)}else u(a);$(g).val(b).on("change",function(){u($(this).val(),!0)}),v()},t=function(){var a,b,c,d=$("#layerBook ul");$(document.createDocumentFragment());for(a=0,b=gCodebookList.length;a<b;a++)c=gCodebookList[a],d.append($("<li>").attr("data-codeid",c.code_id).attr("data-codetype",c.code_type).text("["+c.code_id+"] "+c.code_nm))},u=function(c,g){"0"===c?($(i).hide(),$(f).hide(),$(h).show().val(""),$(e+" ."+l).hide(),$(e+" ul").show(),$(e).show(),$(e).nanoScroller(),g&&a.init()):"1"===c&&($(h).hide(),$(e).hide(),$(i).show().val(""),$(f+" ."+l).hide(),$(f+" ul").show(),$(f).show(),$(f).nanoScroller(),g&&b.init()),$(d+" ."+n).removeClass(n),$.cookie(r,c,{expires:30})},v=function(){$(d+" ."+k+" li:not(."+m+")").each(function(){var a=$(this).text().trim();$(this).attr("data-ui","tooltip").attr("data-text",a),$(this).on("mouseover",function(){$(this).addClass(o),$(f).is(":visible")&&($(this).siblings().removeClass(n),$(j).is(":visible")&&$(".pop-select").data("jqx-id")!=$(this).attr("id")&&$(j).fadeOut(200))}).on("mouseout",function(){$(this).removeClass(o)}).on("click keydown",function(a){$(e).is(":visible")?c.replaceSelection($(this).attr("data-id")+":",!0,!1):$(f).is(":visible")&&($(this).siblings().removeClass(n),$(this).addClass(n),w($(this),a))}),"layerField"==$(this).parents(".sp-list").attr("id")&&p.push({text:$(this).text().toLowerCase()}),"layerBook"==$(this).parents(".sp-list").attr("id")&&q.push({text:$(this).text().toLowerCase()})}),a=new ListSearchUi,a.element=h,a.list=e+" ul",a.origin=p,a.init(),b=new ListSearchUi,b.element=i,b.list=f+" ul",b.origin=q,b.init(),slui.attach.tooltip(d)},w=function(a,b){var c=$(a).attr("data-codeid"),d=$(a).attr("data-codetype"),e=gCodeTypeToFld[d];if(void 0!=e||e.length>0){for(var f=$(j).empty(),g=0,h=e.length;g<h;g++)f.append($("<span>").attr("data-codeid",c).attr("data-fieldnm",e[g]).text(gFieldCaptions[e[g]]+"("+e[g]+")"));x(a,b)}},x=function(a,b){var d=function(a){var b=a.target,c=$(b).attr("id")!=j.split("#")[1]&&$(b).parents().attr("id")!=j.split("#")[1]&&$(b).attr("id")!=f.split("#")[1]&&$(b).parents().attr("id")!=f.split("#")[1];c&&($(j).fadeOut(200),$("body").off("mouseover",d),$(f+" ."+n).removeClass(n))},e=b.clientX+10,g=a.offset().top,h=$(j);"keydown"==b.type&&(e=$(b.target).offset().left+$(b.target).width()-10),h.show(),h.offset({top:g,left:e}).data("jqx-id",a.attr("id")).fadeIn(200,function(){$(this).find("span").off().on("click",function(){c.addKeyword($(this).attr("data-fieldnm"),$(this).attr("data-codeid"))}),$("body").on("mouseover",d)}),g=h.offset().top};return{init:s}}(),slapp.logsearch.mysearch=function(){var a,b,c="#listMysearch",d="#inputMysearch",e="#btnImportFilter",f="#areaMylabel",g="#btnMyfilterSave",h="active",i="hover",j="btn-del",k="btn-setting",l="btn-add",m="btn-cancel",n="삭제 하시겠습니까?",o=gCONTEXT_PATH+"monitoring/",p=o+"myfilter_keywords.json",q=o+"myfilter_detail.json",r=o+"myfilter_insert.do",s=o+"myfilter_update.do",t=o+"myfilter_delete.do",u=o+"myfilter_share_list.json",v=o+"myfilter_import.do",w=[],x=function(){a=slapp.logsearch.dynPaging,b=slapp.logsearch.query,y(),z(),$(g).on("click",function(){E.open()}),D.init(),E.init();var e=new ListSearchUi;e.element=d,e.list=c,e.origin=w,e.init()},y=function(){$(c+" li").each(function(){var e=$(this).text().trim();$(this).attr("data-ui","tooltip").attr("data-text",e),$(this).on("click keydown",function(){var e=$.trim($(this).text()),f=$(this).attr("data-id"),g={myfilter_id:$(this).attr("data-id")},i=function(c){b.setQuery(c.keywords),c.view_fields&&a.changeFieldCaption(c.view_fields.split(","),!0),a.search(),A(e,f)};$("body").requestData(p,g,{callback:i}),$(d).val(e),$(c+" ."+h).removeClass(h),$(c+" li").show()}).on("mouseover",function(){$(this).addClass(i),$(c+" li."+h).removeClass(h)}).on("mouseout",function(){$(this).removeClass(i)}),w.push({text:$(this).text().toLowerCase()})}),$(c).parents(".nano").nanoScroller(),slui.attach.tooltip(c)},z=function(){$(c+" li ."+j).each(function(){$(this).off().on("click",function(a){var b=$(this).parents("li");_confirm(n,{onAgree:function(){var a={myfilter_id:b.attr("data-id")},c=function(a,c,e){b.remove(),y(),B(),$(d).val("")};$("body").requestData(t,a,{callback:c})}}),a.stopPropagation()})}),$(c+" li ."+k).each(function(){$(this).off().on("click",function(a){var b=$(this).parents("li").attr("data-id");E.open(b),a.stopPropagation()})})},A=function(a,b){$(g).hide(),$(f).show().data("id",b),$(f+" span").text(a),$(f+" ."+k).off().on("click",function(){E.open(b)}),$(f+" ."+m).off().on("click",function(){B()})},B=function(){$(f).hide().data("id",""),$(f+" span").text(""),$(g).show(),$("#areaSearch").val("")},C=function(){B()},D=function(){var a,b="#windowImportFilter",c=function(){a=$(b);var c=$(b+" .area-lists ul");a.jqxWindow({width:450,height:300,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5,cancelButton:$(b+" ."+m),initContent:function(){$(b+" .nano").nanoScroller()}}).on("open",function(){c.empty(),$("body").requestData(u,{myfilter_type:"2"},{callback:function(a){if(a.length>0)for(var e=0,f=a.length;e<f;e++){var g=a[e],h=$("<li />").data(g).appendTo(c).on("click",d),i=$("<input />").attr("type","checkbox").attr("id","sharedFilter"+e).appendTo(h);$("<label />").text(g.myfilter_name).attr("for","sharedFilter"+e).appendTo(h);g.duplicated_cnt>0&&(h.addClass("disabled"),i.prop("disabled",!0).prop("checked",!0))}slui.attach.setTransforms(b)}})}),$(e).on("click",function(){a.jqxWindow("open")}),$(b+" ."+l).on("click",f)},d=function(){$(b+" .area-keyword").text($(this).data("keywords"))},f=function(){var a=$(b+" .area-lists [type=checkbox]:not([disabled]):checked");if(a.size()>0){var c=[];a.each(function(){var a=$(this).parent().data();c.push({myfilter_id:a.myfilter_id,myfilter_type:a.myfilter_type,myfilter_name:a.myfilter_name,myfilter_desc:a.myfilter_desc,share_yn:"N",page_name:a.page_name})}),g(c)}},g=function(a){$("body").requestData(v,a,{callback:function(a,b,c){for(var d=0,e=a.length;d<e;d++)E.insertElement(a[d]);y(),z(),_alert(c,{onAgree:h})}})},h=function(){a.jqxWindow("close")};return{init:c}}(),E=function(){var d,e,g="#windowMylistSetting",h=gCONTEXT_PATH+"system/comuser_list_to_select.html",i=function(){d=$(g),e=$("form",d),d.jqxWindow({width:640,height:390,autoOpen:!1,minWidth:640,minHeight:390,maxWidth:640,maxHeight:500,resizable:!0,isModal:!0,modalOpacity:.5,cancelButton:$(g+" ."+m),initContent:function(){slui.attach.setTransformSelect(g)}}).on("open",function(){slui.attach.setTransformSelect(g)}),$("[name=view_fields]",e).chosen({width:"100%",search_contains:!0,placeholder_text_multiple:"[선택하세요]",max_selected_options:50}),$("ul.chosen-choices",e).sortable({cancel:".search-field"}).disableSelection(),$(" ."+l,d).on("click",w),e.on("click",".btn-mini",function(){if("Y"==$("[name=share_yn]:checked",e).val()){var a=$(this).find("i").hasClass("icon-plus"),b=$(this).closest("[data-opt]").attr("data-opt");a?"group"==b?n():new ModalPopup(h,{width:900,height:600,draggable:!0,onClose:o}):$("[name=share_"+b+"_list] option:selected",e).remove()}}),$("[name=share_yn]",e).on("change",v)},n=function(){var a=$("[name=user_group_list]",e).val(),b=$("[name=user_group_list] :selected",e).text();return""==a?void _alert("기관을 선택하세요."):$("[name=share_group_list] option",e).is(function(){return this.value==a})?void _alert("동일한 기관이 존재합니다."):void $("[name=share_group_list]",e).append(new Option(b,a))},o=function(){var a=slapp.user.listSel.getParam().userDataArr,b=$("[name=share_user_list]",e),c={};b.each(function(){c[$(this).val()]=$(this).text()}),$.each(a,function(){c[this.user_id]||b.append(new Option(this.user_nm+" ["+this.user_id+"]",this.user_id))})},p=function(a){a?$("body").requestData(q,{myfilter_id:a},{callback:u}):t(),d.jqxWindow("open")},t=function(){var b={myfilter_id:"",myfilter_name:"",myfilter_desc:"",view_fields:a.getViewFields().join(","),share_yn:"N",share_group_list:[],share_user_list:[]};u(b)},u=function(a){_SL.setDataToForm(a,e,{view_fields:{converter:function(a,b){a&&$("[name=view_fields]",e).setSelectionOrder(a.split(","),!0)}},share_group_list:{converter:function(a,b){_SL.appendToSelect(a,b,"group_id","group_nm")}},share_user_list:{converter:function(a,b){_SL.appendToSelect(a,b,"user_id","user_nm")}}}),v(),slui.attach.setTransformSelect(g)},v=function(){"N"==$("[name=share_yn]:checked",e).val()?($("[name=user_group_list],[name=share_group_list],[name=share_user_list]",e).prop("disabled",!0).attr("selected",!1),$(".btn-mini",e).prop("disabled",!0),d.find(".tform-select").addClass("disabled")):($("[name=user_group_list],[name=share_group_list],[name=share_user_list]",e).prop("disabled",!1).attr("selected",!0),$(".btn-mini",e).prop("disabled",!1),d.find(".tform-select").removeClass("disabled"))},w=function(){if(_SL.validate(e)){var d=$("[name=view_fields]",e).getSelectionOrder();if(0==d.length)return void _alert("표시필드를 선택하세요.");var g=_SL.serializeMap(e);g.view_fields=d.join(","),g.keywords=b.getQuery(),"Y"!=g.share_yn&&(g.share_group_list=g.share_user_list=[]),$("body").requestData(""==g.myfilter_id?r:s,g,{callback:function(b,e,h){""==g.myfilter_id?(x(b),y(),z()):($(c).find("[data-id="+b.myfilter_id+"]").text(b.myfilter_name),$(f+" span").text(b.myfilter_name)),a.changeFieldCaption(d),_alert(h,{onAgree:A})}})}},x=function(a){$(c).append($('<li data-id="'+a.myfilter_id+'">'+a.myfilter_name+'<span class="btns"><button type="button" class="'+k+'"><i class="icon-cog"></i></button><button type="button" class="'+j+'"><i class="icon-trash"></i></button></span></li>'))},A=function(){d.jqxWindow("close")};return{init:i,open:p,close:A,insertElement:x}}();return{init:x,hideLabel:C}}(),slapp.logsearch.dnt=function(){var a=slapp.logsearch.option,b="#btnSearchTimes",c="#layerDateTime",d="active",e="btn-active",f="area-layer-dnt",g="sp-dnt",h="sp-col",i="lst",j="btn-dnt",k="btn-search",l=c+" .sp-preset",m=c+" ."+g,n=c+" .btn-preset",o=c+" .btn-close",p=c+" .btn-now",q=["from","to"],r="click",s={},t=function(){u("to",slapp.logsearch.searchTime.to),u("from",slapp.logsearch.searchTime.from),s.isPreset=slapp.logsearch.searchTime.isPreset,$(b).on(r,function(){$(c).is(":visible")?E():C()})},u=function(a,b,c){if(2===arguments.length){var d=[b.slice(0,4),b.slice(4,6),b.slice(6,8),b.slice(8,10),b.slice(10,12)];a===q[1]?s.to=d:a===q[0]&&(s.from=d)}else 3===arguments.length&&(a===q[1]?s.to[c]=b:a===q[0]&&(s.from[c]=b))},v=function(a,b){var c,d=s.to,e=s.from;if(a===q[1]?c=d:a===q[0]&&(c=e),1===arguments.length)c=c[0]+c[1]+c[2]+c[3]+c[4];else if(2===arguments.length)c=c[b];else{var f=d[0]+d[1]+d[2]+d[3]+d[4],g=e[0]+e[1]+e[2]+e[3]+e[4];c={to:f,from:g}}return c},w=function(){E()},x=function(b,c,e,f,g){var h=0,i=0,j=0;switch(c){case a.dntTypes[0]:h=e-a.dntRecentYear+1,i=e,j=e;break;case a.dntTypes[1]:h=1,i=12,j=e;break;case a.dntTypes[2]:h=1,i=void 0!=g?g%4==0&&g%100!=0||g%400==0?29:28:f<=7&&f%2==1||f>=8&&f%2==0?31:30,j=e;break;case a.dntTypes[3]:h=0,i=23,j=e;break;case a.dntTypes[4]:h=0,i=59,j=e}for(b.empty();h<=i;h++){var k=h.toString();k.length<2&&(k="0"+k);var l=$("<button />").attr("type","button").data("value",k).data("type",c).text(k).appendTo(b);k===j&&l.addClass(d)}},y=function(b,c){for(var d=[b.slice(0,4),b.slice(4,6),b.slice(6,8),b.slice(8,10),b.slice(10,12)],e=0;e<a.dntTypes.length;e++)"02"==d[1]&&2===e?x(c.find("."+i+":eq("+e+")"),a.dntTypes[e],d[e],d[1],d[0]):x(c.find("."+i+":eq("+e+")"),a.dntTypes[e],d[e],d[1])},z=function(b){var f=function(){$(m).each(function(b){var c=q[b];$(this).find("button").each(function(){$(this).off().on(r,function(){var b=a.dntTypes.indexOf($(this).data("type")),f=$(this).data("value"),g=$(l+" ."+e).data("value"),j=function(){if(c===q[1]&&$(l).is(":visible")){var a=_SL.formatDate.addMin(v("to"),g*-1);u("from",a)}};$(this).siblings().removeClass(d),$(this).addClass(d),B("button",$(this).parents(".nano")),u(c,f,b),j();var k=$(this).parents("."+h),m=k.index(),n=k.next().find("."+i);if(0===m){var o=k.next().next().find("."+i);x(n,a.dntTypes[1],"01"),x(o,a.dntTypes[2],"01"),B("button",n.parents(".nano")),B("button",o.parents(".nano")),u(c,"01",1),u(c,"01",2),j()}else if(1===m){if("02"===f){var p=v(c,0);x(n,a.dntTypes[2],"01",f,p)}else x(n,a.dntTypes[2],"01",f);B("button",n.parents(".nano")),u(c,"01",2),j()}z("dntBtn")})})})};"dntBtn"==b?f():"scroll"==b?($(c+" .nano").nanoScroller(),B()):($(c+" .nano").nanoScroller(),B(),f(),$(l+" button").each(function(){$(this).off().on(r,function(){$(this).addClass(e),$(this).siblings().removeClass(e),u("from",_SL.formatDate.addMin(v("to"),$(this).data("value")*-1))})}),$(o).off().on(r,function(){E()}),$(p).off().on(r,function(){var a=slapp.logsearch.manager.getServerTime(),b=$(m).eq(1);if(y(a,b),z("dntBtn"),B("unit",b),u("to",a),slapp.logsearch.searchTime.isPreset){var c=$(l+" button."+e).data("value");u("from",_SL.formatDate.addMin(a,c*-1))}}),$(n).off().on(r,function(){if($(this).hasClass(e)){$(this).removeClass(e).blur(),$(l).hide(),$(m).eq(0).show(),z("dntBtn"),z("scroll");for(var b="",c=0,d=a.dntTypes.length;c<d;c++)b+=$(m).eq(0).find(".lst:eq("+c+") .active").data("value");u("from",b),s.isPreset=!1}else{$(this).addClass(e),$(m).eq(0).hide(),$(l).show(),z("scroll");var f=$(l).find("."+e).data("value");u("from",_SL.formatDate.addMin(v("to"),f*-1)),s.isPreset=!0}}),$("body").on(r,F))},A=function(){$(c+" .nano").nanoScroller({destroy:!0}),$(o).off(r),$(p).off(r),$(n).off(r),$("body").off(r,F)},B=function(a,b){var c=function(a){var b=a.find("."+d).index()-2;if(b==-2)a.nanoScroller({scroll:"top"});else if(b==-1){var c=a.find("button").outerHeight();a.nanoScroller({scrollTop:c})}else{var e=a.find("button:eq("+b+")");a.nanoScroller({scrollTo:e})}};"unit"==a?b.find(".nano").each(function(){c($(this))}):"button"==a?c(b):$(m+" .nano").each(function(){c($(this))})},C=function(){$(c).fadeIn(200),D(),z()},D=function(){slapp.logsearch.searchTime.isPreset?($(n).addClass(e),$(l).show(),$(m).eq(0).hide(),$(l+" button").removeClass(d)):($(n).removeClass(e),$(l).hide(),$(m).eq(0).show());var b=slapp.logsearch.searchTime.to,c=slapp.logsearch.searchTime.from,f=$(m).eq(1),g=$(m).eq(0),h=$(l).find("[data-value="+a.valueDefaultTime+"]");y(b,f),y(c,g),h.addClass(e),h.siblings().removeClass(e)},E=function(){u("to",slapp.logsearch.searchTime.to),u("from",slapp.logsearch.searchTime.from),$(c).fadeOut(200),A()},F=function(){if(a.closeDntAuto){var b=event,c=!($(b.target).hasClass(f)||$(b.target).parents().hasClass(f)||$(b.target).hasClass(j)||$(b.target).parents().hasClass(j)||$(b.target).hasClass(k)||$(b.target).parents().hasClass(k)||$(b.target).parents().hasClass("modal-alert")||$(b.target).parents().hasClass("pop-items"));c===!0&&E()}};return{init:t,selectedTime:s,getSelectedTime:v,setSelectedTime:u,hideLayer:w}}();var ListSearchUi=function(){this.classActive="active",this.classHover="hover",this.classListEmpty="list-empty",this.classItemTitle="item-title",this.textEmpty="검색 결과가 없습니다",this.element,this.list,this.origin};ListSearchUi.prototype={init:function(){var a=this;$(a.element).on("keyup",function(b){if(13===b.keyCode||40===b.keyCode||38===b.keyCode)return!1;var c=$(this).val().toLowerCase().trim(),d=[];if(""!==c){for(var e=0,f=a.origin.length;e<f;e++)a.origin[e].text.indexOf(c)>-1&&d.push(e);a._makeList(d)}else a._makeList()}).on("keydown",function(b){var c=$(a.list+" ."+a.classActive);switch(b.keyCode){case 13:if(c.size()<1)return!1;$(this).val(c.text().trim()),c.keydown();break;case 40:a._movePosition(0);break;case 38:a._movePosition(1)}})},_makeList:function(a){var b=this;if($(b.list).siblings().remove(),$(b.list).show(),$(b.list+" ."+b.classActive).removeClass(b.classActive),void 0==a)$(b.list+" li").css("display","");else if(void 0!=a&&a.length>0){$(b.list+" li").hide();for(var c=0,d=a.length;c<d;c++){var e=a[c],f=$(b.list+" li:not(."+b.classItemTitle+")").eq(e);f.hasClass(b.classItemTitle)||f.css("display","")}$(b.list+" li:visible").eq(0).addClass(b.classActive)}else $(b.list).hide(),$(b.list).after('<div class="'+b.classListEmpty+'">'+b.textEmpty+"</div>")},_movePosition:function(a){for(var b=this,c=$(b.list+" li:visible"),d=-1,e=c.size(),f=0,g=e;f<g;f++)c.eq(f).hasClass(b.classActive)&&(d=f);0===a&&d<e-1?d++:1===a&&d>0&&d--;var h=c.eq(d);c.eq(d).hasClass(b.classItemtitle)&&(d++,h=c.eq(d)),c.removeClass(b.classHover),c.removeClass(b.classActive),h.addClass(b.classActive),$(b.element).val(h.text().trim()),c.parents().hasClass("nano")&&c.parents(".nano").nanoScroller({scrollTo:c.eq(d)})}},slapp.logsearch.dlgViewField=function(){var a,b,c,d,e,f="#windowViewFields",g=".btn-save",h=".btn-delete",i=".btn-ok",j=".btn-cancel",k="[",l=gCONTEXT_PATH+"monitoring/myviewfield_list.json",m=gCONTEXT_PATH+"monitoring/myviewfield_insert.do",n=gCONTEXT_PATH+"monitoring/myviewfield_update.do",o=gCONTEXT_PATH+"monitoring/myviewfield_delete.do",p=function(){a=slapp.logsearch.dynPaging,b=$(f),c=$("form",b),d=$("[name=view_id]",c),e=$("[name=view_fields]",c),b.jqxWindow({width:640,height:150,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5,cancelButton:$(f+" "+j),initContent:function(){slui.attach.setTransformSelect(f)}}).on("open",function(){b.find(".jqx-window-content").css({height:"initial",overflow:"visible"}),slui.attach.setTransformSelect(f)}),e.chosen({width:"100%",search_contains:!0,placeholder_text_multiple:"[선택하세요]",max_selected_options:50}),$("ul.chosen-choices",c).sortable({cancel:".search-field"}).disableSelection(),d.on("change",r),$(g,b).on("click",t),$(h,b).on("click",u),$(i,b).on("click",s),y.init(v)},q=function(a){d.empty().append($("<option/>").attr({value:"",selected:!0,"data-view-fields":a.join(",")}).text("새로 등록...")),e.setSelectionOrder(a,!0),$("body").requestData(l,{},{callback:function(a){$.each(a,function(a,b){$("<option>").attr({value:b.view_id,title:b.view_name,"data-view-fields":b.view_fields}).text(b.view_name).appendTo(d)}),d.trigger("change")}}),b.jqxWindow("open")},r=function(){var a=d.val();""!=a&&e.setSelectionOrder(d.find(":selected").attr("data-view-fields").split(","),!0)},s=function(){var c=e.getSelectionOrder();return 0==c.length?void _alert("표시할 필드를 선택하세요."):(a.changeFieldCaption(c),void b.jqxWindow("close"))},t=function(){var a={view_id:d.val(),view_name:""==d.val()?"":d.find(":selected").text(),view_fields:e.getSelectionOrder().join(",")};return 0==a.view_fields.length?void _alert("표시할 필드를 선택하세요."):void(0==a.view_name.indexOf(k)?w(a):y.open(a.view_name))},u=function(){var a=d.val(),b=d.find(":selected").text();return""==a?(_alert("삭제할 내 표시필드를 선택하세요."),!1):0==b.indexOf(k)?(_alert("기본 표시필드는 삭제할 수 없습니다."),!1):void _confirm("삭제 하시겠습니까?",{onAgree:function(){$("body").requestData(o,{view_id:d.val()},{callback:function(a,b,c){d.find(":selected").remove(),d.val(""),_alert(c),slui.attach.setTransformSelect(f)}})}})},v=function(a){w({view_id:d.val(),view_name:a,view_fields:e.getSelectionOrder().join(",")})},w=function(b){$("body").requestData(""==b.view_id?m:n,b,{callback:function(c,e,g){""==b.view_id?$("<option/>").attr({value:c.view_id,title:c.view_name,"data-field-value":c.view_fields,selected:!0}).text(c.view_name).appendTo(d):c.view_name&&d.find(":selected").attr({title:c.view_name,"data-field-value":c.view_fields}).text(c.view_name),_alert(g),a.changeFieldCaption(c.view_fields.split(",")),slui.attach.setTransformSelect(f)}})},x=function(){b.jqxWindow("close")},y=function(){var a,b,c,d="#windowViewName",e=".btn-save",f=".btn-cancel",g="[",h=function(g){a=$(d),b=$("form",a),c=$("[name=view_name]",b),a.jqxWindow({height:115,width:300,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5,cancelButton:$(d+" "+f),initContent:function(){slui.attach.setTransformSelect(d)}}),$(e,a).on("click",function(){j(g)})},i=function(b){c.val(b),a.jqxWindow("open")},j=function(b){var d=c.val();return""==d?void _alert("이름을 입력하세요."):0==d.indexOf(g)?void _alert("'"+g+"'로 시작되는 이름은 사용할 수 없습니다."):(a.jqxWindow("close"),void b(d))};return{init:h,open:i}}();return{init:p,open:q,close:x}}();