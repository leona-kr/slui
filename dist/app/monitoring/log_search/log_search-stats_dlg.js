"use strict";_SL.nmspc("logsearch").statsDlg=function(){var a,b=gCONTEXT_PATH+"monitoring/",c={DOM:{dlg:"#statsDlg",statsType:"[name=stats_type]",topCnt:"[name=top_cnt]",groupField:"[name=group_field]",statsFunc:"[name=stats_func]",funcField:"[name=func_field]",periodMin:"[name=period_min]",timelineStatsFunc:"[name=timeline_stats_func]",timelineFuncField:"[name=timeline_func_field]",timelineSeriesField:"[name=timeline_series_field]",timelineSeriesFldset:"#timeline_series_fldset",timelineTInpVal:"[name=timeline_t_inp_val]",timelineSeriesVals:"[name=timeline_series_vals]",timelineSeriesValEtc:"[name=timeline_series_val_etc]",btnStats:"btn-stats",btnSearch:"btn-search",btnCancel:"btn-cancel",btnPlus:"btn-plus",btnMinus:"btn-minus"},URL:{groupStats:b+"group_stats.html",timelineStats:b+"time_stats.html"}},d={dlg:$(c.DOM.dlg),statsType:$(c.DOM.statsType),topCnt:$(c.DOM.topCnt),groupField:$(c.DOM.groupField),statsFunc:$(c.DOM.statsFunc),funcField:$(c.DOM.funcField),periodMin:$(c.DOM.periodMin),timelineStatsFunc:$(c.DOM.timelineStatsFunc),timelineFuncField:$(c.DOM.timelineFuncField),timelineSeriesField:$(c.DOM.timelineSeriesField),timelineSeriesFldset:$(c.DOM.timelineSeriesFldset),timelineTInpVal:$(c.DOM.timelineTInpVal),timelineSeriesVals:$(c.DOM.timelineSeriesVals),timelineSeriesValEtc:$(c.DOM.timelineSeriesValEtc)},e=function(){a=slapp.logsearch.dynPaging,d.dlg.jqxWindow({width:480,height:100,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5,cancelButton:d.dlg.find("."+c.DOM.btnCancel)}).on("open",function(){slui.attach.setTransformSelect(c.DOM.dlg)}),d.groupField.chosen({search_contains:!0,width:"100%",placeholder_text_multiple:"[선택하세요]"}),d.groupField.next().find(".chosen-results").css("max-height","100px"),d.funcField.chosen({search_contains:!0,width:"100%",placeholder_text_single:"[선택하세요]"}),d.funcField.next().find(".chosen-results").css("max-height","100px"),d.timelineFuncField.chosen({search_contains:!0,width:"100%",placeholder_text_single:"[선택하세요]"}),d.timelineFuncField.next().find(".chosen-results").css("max-height","100px"),d.timelineSeriesField.chosen({search_contains:!0,width:"100%",placeholder_text_single:"[미지정]"}),d.timelineSeriesField.next().find(".chosen-results").css("max-height","100px"),$("."+c.DOM.btnStats).on("click",f),d.statsType.on("click",function(){$(".stats_fieldset").hide(),$("#"+$(this).val()+"_fieldset").show(),slui.attach.setTransformSelect(c.DOM.dlg)}),d.statsFunc.change(h),d.timelineStatsFunc.change(h),d.timelineSeriesField.change(h),d.dlg.find("."+c.DOM.btnPlus).click(i),d.dlg.find("."+c.DOM.btnMinus).click(j)},f=function(){var b,e,f,i;if(!a.isSearched()||a.isCancel())return void _alert("검색 완료 후 실행하세요.");if(a.getTotal()>gSearchLimitCount)return void _alert("전체 건수 : "+_SL.formatNumber(a.getTotal())+"건\n"+_SL.formatNumber(gSearchLimitCount)+"건 이상은 조회 하실수 없습니다.");for(d.topCnt.val(10),d.groupField.empty(),e=a.getViewFields(),b=0;b<e.length;b++)f=e[b],i=null==gFieldCaptions[f]?f+" ["+f+"]":gFieldCaptions[f]+" ["+f+"]",$("<option/>").attr({value:f,title:i}).text(i).appendTo(d.groupField);for(d.groupField.trigger("chosen:updated"),d.funcField.empty(),b=0;b<e.length;b++)f=e[b],i=null==gFieldCaptions[f]?f+" ["+f+"]":gFieldCaptions[f]+" ["+f+"]",$("<option/>").attr({value:f,title:i}).text(i).appendTo(d.funcField);d.funcField.val(""),d.funcField.trigger("chosen:updated"),d.statsFunc.val("count"),h();var j=a.getStartTime(),k=a.getEndTime(),l=_SL.formatDate.diff(j,k)/36e5,m=[1,10];l>720?m=[1440]:l>168?m=[60,1440]:l>72?m=[60,1440]:l>12&&(m=[10,60]),d.periodMin.empty();for(var b in m){var n=m[b]>=60?m[b]/60+"시간":m[b]+"분";$("<option/>").attr({value:m[b],title:m[b]}).text(n).appendTo(d.periodMin)}d.timelineFuncField.empty(),d.timelineSeriesField.empty(),d.timelineSeriesField.append($("<option/>").attr({value:""}).text("[미지정]"));for(var b=0;b<e.length;b++)f=e[b],i=gFieldCaptions[f]+" ["+f+"]",$("<option/>").attr({value:f,title:i}).text(i).appendTo(d.timelineFuncField).clone().appendTo(d.timelineSeriesField);d.timelineFuncField.val(""),d.timelineFuncField.trigger("chosen:updated"),d.timelineSeriesVals.empty(),d.timelineSeriesField.val(""),d.timelineSeriesField.trigger("chosen:updated"),d.timelineStatsFunc.val("count"),h(),d.statsType.eq(0).trigger("click"),d.timelineSeriesValEtc.filter("[value=N]").prop("checked",!0),d.dlg.on("click","."+c.DOM.btnSearch,g),d.dlg.jqxWindow("open"),d.dlg.find(".jqx-window-content").css({height:"initial",overflow:"visible"})},g=function(){if("group"==d.statsType.filter(":checked").val()){var b=d.groupField.getSelectionOrder();if("count"!=d.statsFunc.val()&&null==d.funcField.val())return void _alert("분석할 통계필드를 선택하세요.");var e=$.map(b,function(a){return a}),f=$.map(b,function(a){return null==gFieldCaptions[a]?a:gFieldCaptions[a]}),g={start_time:a.getStartTime(),end_time:a.getEndTime(),query:a.getQuery(),group_field:e,group_field_txt:f,top_cnt:d.topCnt.val(),stats_func:d.statsFunc.val(),func_field:d.funcField.val(),funcFieldNm:gFieldCaptions[d.funcField.val()]||d.funcField.val()};new ModalPopup(c.URL.groupStats+"?"+$.param(g,!0),{width:800,height:760,setScroll:!0})}else{if("count"!=d.timelineStatsFunc.val()&&null==d.timelineFuncField.val())return void _alert("분석할 통계필드를 선택하세요.");var h=[];if(""!=d.timelineSeriesField.val()&&(d.timelineSeriesVals.find("option").attr("selected",!0),h=d.timelineSeriesVals.val(),!h))return void _alert("범례 항목을 입력하세요");var g={start_time:a.getStartTime(),end_time:a.getEndTime(),query:a.getQuery(),period_min:d.periodMin.val(),stats_func:d.timelineStatsFunc.val(),func_field:d.timelineFuncField.val(),func_field_nm:gFieldCaptions[d.timelineFuncField.val()]||d.timelineFuncField.val(),series_field:d.timelineSeriesField.val(),series_vals:h,series_val_etc:d.timelineSeriesValEtc.filter(":checked").val()};new ModalPopup(c.URL.timelineStats+"?"+$.param(g,!0),{width:1e3,height:350,draggable:!0})}},h=function(){var a=function(a,b,c){c[a.val()==b?"hide":"show"]()};a(d.statsFunc,"count",d.funcField.next()),a(d.timelineStatsFunc,"count",d.timelineFuncField.next()),a(d.timelineSeriesField,"",d.timelineSeriesFldset)},i=function(){var a=d.timelineTInpVal.val(),b=d.timelineSeriesVals.find("option");if(""==a)return void _alert("범례 항목에 추가할 값을 입력하세요.");for(var c=0;c<b.length;c++)if(b.eq(c).val()==a)return void _alert("중복된 값이 존재합니다.");d.timelineSeriesVals.append($("<option>").val(a).text(a)),d.timelineTInpVal.val("").focus()},j=function(){d.timelineSeriesVals.find(":selected").remove()};return{init:e}}();