"use strict";_SL.nmspc("logsearch").contextmenu=function(){var a,b,c=gCONTEXT_PATH+"monitoring/",d={DOM:{logTable:"#logTable"},URL:{stringCodec:gCONTEXT_PATH+"common/string_codec.html",ipCheck:gCONTEXT_PATH+"common/ipcheck.html",netflowList:gCONTEXT_PATH+"analysis/netflow_list.html",codeBookView:c+"code_book_view.html",virusTotal:gCONTEXT_PATH+"common/virusTotal.html",parser:gCONTEXT_PATH+"management/parser_generator.do",attackpatternAdvice:c+"attackpattern_advice.html"},idSeperator:",",sameValueFields:["src_ip","dstn_ip","eqp_ip"]},e={sameValueMap:{},relAnalInfoMap:{}},f=function(){b=slapp.logsearch.manager,a=slapp.logsearch.dynPaging;var c,f,r,s;for(r in d.sameValueFields)f=d.sameValueFields[r],s="sv_"+f,e.sameValueMap[s]={field:f,name:gFieldCaptions[f]+" 기준",callback:i};for(r in gRelationAnalysisList)f=gRelationAnalysisList[r],f.field&&(s=f.field+"_"+f.value.split(d.idSeperator).join("_"),e.relAnalInfoMap[s]=f);c={string_codec:{name:"문자열 변환",callback:q},check_ip:{name:"IP 상세정보",disabled:g,callback:k},netflow:{name:"NetFlow 분석",disabled:g,callback:j},code_book:{name:"코드북 확인",disabled:l,callback:m},virus_total:{name:"바이러스 분석",callback:n},same_value:{name:"동일값 조회",items:e.sameValueMap},separator1:"-----",rel_anal:{name:"연관분석",disabled:g,items:e.relAnalInfoMap},se_perator2:"----",eps:{name:"내부망분석",disabled:g,items:{eps_conn_log:{name:"네트워크 통신 로그",callback:function(a,b){o("conn.log",b)}},eps_http_log:{name:"HTTP 통신 로그",callback:function(a,b){o("http.log",b)}},eps_dns_log:{name:"DNS  통신 로그",callback:function(a,b){o("dns.log",b)}}}}},$.contextMenu({selector:".context-menu-one",zIndex:1003,callback:p,items:c}),$.contextMenu({selector:".context-menu-two",zIndex:1003,callback:h,items:{string_codec:{name:"문자열 변환",callback:q},open_parser:{name:"Open XML Parser"}}})},g=function(a,b){var c=b.$trigger.text();return!_SL.ip.check(c)},h=function(b,c){var e=new RegExp(gOverLengthSuffix+"$"),f=c.$trigger.data("rowIndex"),g=c.$trigger.data("fieldName");if(!g)return void console.log("Invalid data-value!! >> onCtxOpenParser[rowIndex:%o, fieldName:%o]",f,g);var h=a.getFieldValue(f,g),i=function(a){$("<form>").attr({action:d.URL.parser,method:"post"}).append($("<input type='hidden' name='sample'>").val(a)).appendTo("body").submit().remove()};if(e.test(h)){var j=parseInt(a.getFieldValue(f,"eqp_dt").substring(0,12)),k="eqp_dt:["+j+"00 TO "+j+"59] AND key:"+a.getFieldValue(f,"key");$("body").requestData("log_field_view.json",{query:k,field_name:g},{callback:i})}else i(h)},i=function(c,d){var f=e.sameValueMap[c].field,g=d.$trigger.data("rowIndex"),h=d.$trigger.data("fieldName");if(!h)return void console.log("Invalid data-value!! >> onCtxSameValue[rowIndex:%o, fieldName:%o]",g,h);var i=a.getFieldValue(g,h),j=a.getFieldValue(g,f),k={expert_keyword:h+":"+_SL.luceneValueEscape(i)+" AND "+f+":"+(j?j:"")};b.openSearch(k)},j=function(b,c){var e=30,f=c.$trigger.data("rowIndex"),g=c.$trigger.data("fieldName");if(!g)return void console.log("Invalid data-value!! >> onCtxNetflow[rowIndex:%o, fieldName:%o]",f,g);var h=a.getFieldValue(f,"eqp_dt"),i=_SL.formatDate.addMin(h,-(e/2)+1),j=_SL.formatDate.addMin(i,e),k=_SL.formatDate(),l=_SL.formatDate.diff(j,k);l<0&&(i=_SL.formatDate.addMin(i,l/6e4),j=_SL.formatDate.addMin(j,l/6e4));var m={start_time:i,end_time:j,query:"data_type:TRAFFIC_LOG",s_field_nm:g,s_field_val:a.getFieldValue(f,g)},n=$("#netFlowForm");0==n.length&&(n=$('<form id="netFlowForm">'),$.each(m,function(a,b){n.append('<input type="hidden" name="'+a+'">')}),$("body").append(n)),$.each(m,function(a,b){$('[name="'+a+'"]',n).val(b)});var o="netflow_popup_"+(new Date).getTime();n.attr({action:d.URL.netflowList,target:o,method:"post"}).submit()},k=function(a,b){var c=d.URL.ipCheck+"?asset=asset&search_ip="+b.$trigger.text();new ModalPopup(c,{width:850,height:580,setScroll:!0})},l=function(a,b){var c=(b.$trigger.data("rowIndex"),b.$trigger.data("fieldName"));return!c||null==gFldToCodes[c]},m=function(b,c){var e=c.$trigger.data("rowIndex"),f=c.$trigger.data("fieldName");if(!f)return void console.log("Invalid data-value!! >> onCtxCodeBook[rowIndex:%o, fieldName:%o]",e,f);var g=gFldToCodeTypes[f],h=a.getFieldValue(e,f),i={code_type:g,field_name:f,code_id:h};new ModalPopup(d.URL.codeBookView+"?"+$.param(i,!0),{width:640,height:425})},n=function(a,b){var c=d.URL.virusTotal,e=b.$trigger.text();new ModalPopup(c,{width:850,height:580,setScroll:!0,type:"post",data:{search_txt:e}})},o=function(c,d){var e="log_type_Name",f=c,g=d.$trigger.data("rowIndex"),h=d.$trigger.data("fieldName");if(!h)return void console.log("Invalid data-value!! >> onCtxEps[rowIndex:%o, fieldName:%o]",g,h);var i=a.getFieldValue(g,h),j={expert_keyword:h+":"+i+" AND "+e+":"+f};b.openSearch(j)},p=function(c,f){var g=e.relAnalInfoMap[c].field,h=e.relAnalInfoMap[c].value.split(d.idSeperator),i=f.$trigger.data("rowIndex"),j=f.$trigger.data("fieldName");if(!j)return void console.log("Invalid data-value!! >> onCtxLogType[rowIndex:%o, fieldName:%o]",i,j);var k=a.getFieldValue(i,j),l={expert_keyword:j+":"+k+" AND "+g+":"+(h.length>1?"(":"")+h.join(" ")+(h.length>1?")":"")};b.openSearch(l)},q=function(b,c){var e=new RegExp(gOverLengthSuffix+"$"),f=c.$trigger.data("rowIndex"),g=c.$trigger.data("fieldName");if(!g)return void console.log("Invalid data-value!! >> onCtxStringCodec[rowIndex:%o, fieldName:%o]",f,g);var h=a.getFieldValue(f,g),i={codec:"BASE64",method:"ENC",org_txt:h};if(e.test(h)){var j=parseInt(a.getFieldValue(f,"eqp_dt").substring(0,12)),k="eqp_dt:["+j+"00 TO "+j+"59] AND key:"+a.getFieldValue(f,"key");i.query=k,i.field_name=g}new ModalPopup(d.URL.stringCodec,{type:"post",data:i,width:1e3,height:530})};return{init:f}}();