"use strict";_SL.nmspc("logsearch").groupStats=function(){var a=gCONTEXT_PATH+"monitoring/",b={DOM:{content:"#groupStatsContent",chartType:"#groupStatsChartType",chart:"#groupStatsChart",list:"#groupStatsList",form:"#formGroupStats",total:".group-stats-total",spantime:".group-stats-spantime",btnExcel:".btn-excel"},URL:{groupStats:a+"group_stats.json",excel:a+"group_stats_excel.do",logSearch:a+"log_search.html"},chartId:"groupStatsChartId"},c={content:$(b.DOM.content),chartType:$(b.DOM.chartType),chart:$(b.DOM.chart),list:$(b.DOM.list),form:$(b.DOM.form),total:$(b.DOM.content+" "+b.DOM.total),spantime:$(b.DOM.content+" "+b.DOM.spantime),btnExcel:$(b.DOM.content+" "+b.DOM.btnExcel)},d={param:{},data:{}},e=function(){d.param=_SL.serializeMap(c.form),d.param.group_field&&!$.isArray(d.param.group_field)&&(d.param.group_field=[d.param.group_field],d.param.group_field_txt=[d.param.group_field_txt]),loading.show(),c.chartType.on("change",function(){d.chart.chartType($(this).val())}),c.btnExcel.on("click",function(){c.form.submit()}),c.list.find("tbody").on("click","tr",function(){var a=$(this).data("row_index");"undefined"!=typeof a&&j(a)}),f()},f=function(){$("body").requestData(b.URL.groupStats,d.param,{callback:function(a,b,e){d.data=a,c.form.find("[name=strJsonResultList]").val(a.strJsonResultList),c.form.find("[name=totalRecord]").val(a.totalRecord),loading.hide(),g()}})},g=function(){h(),i()},h=function(){var a=d.data.chartData,b=c.chartType.val();k=$.extend({},slui.chart.chartConfig,k);for(var e=0,f=a.length;e<f;e++)a[e].link="javascript:slapp.logsearch.groupStats.openSearch('"+_SL.htmlEscape(a[e].rank)+"');";d.chart=new FusionCharts({type:b,width:"100%",height:"280",renderAt:"groupStatsChart",dataFormat:"json",dataSource:{chart:k,data:a}}).render()},i=function(){var a,b,e,f=d.param.group_field,g=d.param.group_field_txt,h="count"==d.param.stats_func,i=h?"건수":d.param.stats_func.toUpperCase()+" ("+d.param.funcFieldNm+")",j=c.list.find("thead"),k=c.list.find("tbody"),l=d.data.resultList;if(j.empty(),k.empty(),c.total.text(_SL.formatNumber(d.data.totalRecord)),c.spantime.text(_SL.formatNumber(d.data.spanTime/1e3)),f){b=$("<tr>").append($("<th>").text("순위")),a=f?f.length:0;for(var m=0;m<a;m++)b.append($("<th>").text(g[m]));if(b.append($("<th>").text(i)).append($("<th>").text("비율")),j.append(b),0!=l.length||d.data.etcData){for(var m=0,n=l.length;m<n;m++){e=l[m],b=$("<tr>").data("row_index",m).append($("<td class='align-center'>").text(e.rank));for(var o=0;o<a;o++)b.append($("<td>").text(_SL.ifEmpty(e[f[o]],"-")));b.append($("<td class='align-right'>").attr("title",e.total).text(h?e.total:e.func_value)).append($("<td class='align-right'>").text(e.percentage)),k.append(b)}d.data.etcData&&(e=d.data.etcData,$("<tr>").append($("<td class='align-center'>").attr("colspan",a+1).text(e.group_field)).append($("<td class='align-right'>").attr("title",e.total).text(h?e.total:e.func_value)).append($("<td class='align-right'>").text(e.percentage)).appendTo(k))}else $("<tr>").append($("<td class='align-center'>").attr("colspan",a+3).text("There is no Search Result")).appendTo(k)}else e=l[0],j.append($("<tr>").append($("<th>").text(i))),k.append($("<tr>").append($("<td class='align-center'>").attr("title",e?e.total:"").text(e?h?e.total:e.func_value:"There is no Search Result")))},j=function(a){var c,e=d.param.query,f=d.param.group_field,g=d.data.resultList[a];if(""!=d.param.group_field){""!=e&&(e="("+e+")");for(var h=0;h<f.length;h++)c=f[h],""!=e&&(e+=" AND "),e+="-"==g[c]?"NOT "+c+":*":c+":"+_SL.luceneValueEscape(g[c])}$("<form>").attr({target:"logSearchWin_"+(new Date).getTime(),action:b.URL.logSearch,method:"post"}).append($("<input type='hidden' name='start_time'>").val(d.param.start_time)).append($("<input type='hidden' name='end_time'>").val(d.param.end_time)).append($("<input type='hidden' name='expert_keyword'>").val(e)).append($("<input type='hidden' name='template_id'>").val("popup")).appendTo("body").submit().remove()},k={showBorder:"1"};return e(),{openSearch:j}}();