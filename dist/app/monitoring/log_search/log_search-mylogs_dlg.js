"use strict";_SL.nmspc("logsearch").mylogsDlg=function(){var a,b=gCONTEXT_PATH+"monitoring/",c={DOM:{btnLogsSave:"#btnLogsSave",dlg:"#windowMylogsDlg",form:"[name=mylogsDlgForm]",btnCancel:".btn-cancel"},URL:{groupList:b+"mylogs_group_list.json",userList:gCONTEXT_PATH+"system/comuser_list_to_select.html",insert:b+"mylogs_insert.do",saveToFile:b+"mylogs_to_file.do"}},d={btnLogsSave:$(c.DOM.btnLogsSave),dlg:$(c.DOM.dlg),form:$(c.DOM.dlg+" "+c.DOM.form)},e=function(){a=slapp.logsearch.dynPaging,d.dlg.jqxWindow({width:640,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5,cancelButton:d.dlg.find(c.DOM.btnCancel),initContent:function(){slui.attach.setTransformSelect(c.DOM.dlg)}}),d.form=$(c.DOM.form,d.dlg),d.btnLogsSave.on("click",h),$(".btn-add",d.form).on("click",l),$("[name=share_yn]",d.form).on("click",k),$(".btn-mini",d.form).on("click",function(){if("Y"==$("[name=share_yn]:checked",d.form).val()){var a=$(this).find("i").hasClass("icon-plus"),b=$(this).closest("[data-opt]").attr("data-opt");a?"group"==b?f():new ModalPopup(c.URL.userList,{width:900,height:600,draggable:!0,onClose:g}):$("[name=share_"+b+"_list] :selected",d.form).remove()}})},f=function(){var a=$("[name=user_group_list]",d.form).val(),b=$("[name=user_group_list] :selected",d.form).text();return""==a?void _alert("기관을 선택하세요."):$("[name=share_group_list] option",d.form).is(function(){return this.value==a})?void _alert("동일한 기관이 존재합니다."):void $("[name=share_group_list]",d.form).append(new Option(b,a))},g=function(){var a=slapp.user.listSel.getParam().userDataArr,b=$("[name=share_user_list]",d.form),c={};b.each(function(){c[$(this).val()]=$(this).text()}),$.each(a,function(){c[this.user_id]||b.append(new Option(this.user_nm+" ["+this.user_id+"]",this.user_id))})},h=function(){0==$("[name=chk_idx]:checked").length?0==a.getTotal()?_alert("저장할 로그가 없습니다."):!a.isSearched()||a.isCancel()?_alert("검색 완료 후 실행하세요."):gMaxSaveLogCount>0&&a.getTotal()>gMaxSaveLogCount?_alert("전체 건수 : "+_SL.formatNumber(a.getTotal())+"건\n"+_SL.formatNumber(gMaxSaveLogCount)+"건 이상은 저장하실 수 없습니다."):_confirm("검색결과 전체를 저장하시겠습니까?",{onAgree:i}):i()},i=function(){var b=[];d.form[0].reset(),d.form.find("share_user_list").empty(),d.form.find("share_group_list").empty(),$("[name=chk_idx]:checked").each(function(c,d){b.push(a.getLog(d.value))}),$("[name=mylogs_list_json]",d.form).val(JSON.stringify(b));var c={mylogs_id:"",mylogs_name:"",mylogs_desc:"",share_yn:"N",search_stime:a.getStartTime(),search_etime:a.getEndTime(),search_query:a.getQuery(),search_count:a.getTotal(),save_count:0==b.length?a.getTotal():b.length};_SL.setDataToForm(c,d.form),j(),k(),d.dlg.jqxWindow("open")},j=function(){$("body").requestData(c.URL.groupList,{},{callback:function(a){var b,c,e={},f=null;for(var g in a)b=a[g],e[b.group_id]={title:b.group_name,isFolder:!1,key:b.group_id,children:[]},c=e[b.parent_group_id],c?c.children.push(e[b.group_id]):f=e[b.group_id];$("[name=group_id]",d.form).empty(),$("[name=group_id]",d.form).append(new Option(f.title,f.key)),$("[name=group_id]",d.form).slSelectTree({minExpandLevel:2,autoFocus:!0,clickFolderMode:3,children:f})}})},k=function(){"N"==$("[name=share_yn]:checked",d.form).val()?($("[name=user_group_list],[name=share_group_list],[name=share_user_list]",d.form).prop("disabled",!0).attr("selected",!1),$("[name=user_group_list]").siblings(".tform-select").addClass("disabled"),$(".btn-mini",d.form).prop("disabled",!0)):($("[name=user_group_list],[name=share_group_list],[name=share_user_list]",d.form).prop("disabled",!1).attr("selected",!0),$("[name=user_group_list]").siblings(".tform-select").removeClass("disabled"),$(".btn-mini",d.form).prop("disabled",!1))},l=function(){if(_SL.validate(d.form)){var a=function(){var a=_SL.serializeMap(d.form);"Y"!=a.share_yn&&(a.share_group_list=a.share_user_list=[]),$("body").requestData(c.URL.insert,a,{callback:function(b,d,e){"[]"==a.mylogs_list_json?(a.mylogs_id=b,$("body").requestData(c.URL.saveToFile,a,{callback:function(a,b,c){0!=b.indexOf("SUC")&&_alert(c)}}),e="저장 요청 되었습니다."):e="저장 되었습니다.",_alert(e,{onAgree:m})}})};_confirm("저장 하시겠습니까?",{onAgree:a})}},m=function(){d.dlg.jqxWindow("close")};return{init:e}}();