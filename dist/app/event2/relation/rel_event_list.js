"use strict";_SL.nmspc("relEvent").list=function(){var a={},b={urlList:gCONTEXT_PATH+"event2/rel_event_list.json",urlLogSearch:gCONTEXT_PATH+"monitoring/log_search.html",urlSmsEvent:gCONTEXT_PATH+"event/sms_event_list.html",formId:"#searchRelEventList",tableHeadId:"#relEventTableHead",tableListId:"#relEventTableList"},c={form:$(b.formId),tableHead:$(b.tableHeadId),tableList:$(b.tableListId+" tbody"),sDay:$(b.formId+" [name=startDay]"),sHour:$(b.formId+" [name=startHour]"),sMin:$(b.formId+" [name=startMin]"),eDay:$(b.formId+" [name=endDay]"),eHour:$(b.formId+" [name=endHour]"),eMin:$(b.formId+" [name=endMin]"),eventtNm:$(b.formId+" [name=s_event_nm]"),eventCate:$(b.formId+" [name=s_event_cate_cd]"),eventLevel:$(b.formId+" [name=s_event_level]"),currPage:$(b.tableHeadId+" [name=currPage]")},d=function(){e(),f()},e=function(){var d=$.extend({},_SL.serializeMap(c.form),{pagesize:c.tableHead.find("[name=pageRow]").val(),currPage:c.tableHead.find("[name=currPage]").val()});$("body").requestData(b.urlList,d,{callback:function(b,d,e){if(b){_SL.setDataToForm(b,c.form),_SL.setDataToForm(b,c.tableHead),$("#relTotalCnt").text(_SL.formatNumber(b.totalCount)),$("#relSpanTotalPage").text(_SL.formatNumber(b.totalPage)),c.currPage.data("total-page",b.totalPage);var f=b.eventList;a=$.extend({},f);var g=c.tableList;if(g.children().remove(),f.length>0)for(var h in f){var i=$("<tr>"),j=f[h],k=["Low","Middle","High"],l=["label-success","label-attention","label-danger"];i.append($('<td class="align-center">'+(parseInt(h)+1+b.recordstartindex)+"</td>")),i.append($('<td class="align-center">'+_SL.formatDate(j.event_time,"yyyyMMddHHmm","yyyy-MM-dd HH:mm")+"</td>")),i.append($("<td>"+_SL.htmlEscape(j.event_nm)+"</td>")),i.append($('<td class="align-center">'+j.event_cate_nm+"</td>")),i.append($('<td><span class="'+l[j.event_level-1]+'">'+k[j.event_level-1]+"</span></td>"));var m=j.event_dtl_list,n=$("<td>"),o=$('<td class="align-center">');for(var p in m){for(var q=m[p],r=q.dtl_depth,s=q.flt_grp_fld,t=q.rst_grp_fld,u=s.split(","),v=t.split(","),w="",x=0;x<r;x++)w+="&nbsp;";if(w+="└",s)for(var y in u)w+=gFieldJson[u[y]]+":"+_SL.htmlEscape(q.splitFltFldVal[y])+" ";else w+="조건필드:미지정";if(w+=" / ",t)for(var z in v)w+=gFieldJson[v[z]]+":"+_SL.htmlEscape(q.splitRstFldVal[z]+" ");else w+="결과필드:미지정";m.length-1!=p&&(w+="<br>"),n.append(w),"1"==q.ruleset_type?o.append($('<a href="#" class="btn-link" data-idx="'+h+'" data-dtl-idx="'+p+'">'+q.cnt+"/"+q.limit_count+"</a><br>")):o.append($('<a href="#" class="btn-link" data-idx="'+h+'" data-dtl-idx="'+p+'"><span class="'+l[q.cnt-1]+'">'+k[q.cnt-1]+"</span></a><br>")),o.append()}i.append(n),i.append(o),i.appendTo(g)}else g.append($('<tr><td class="list-empty" colspan="7">There is no Search Result</td></tr>'))}}})},f=function(){c.form.find(".form-submit").off().on("click",function(){k()}),c.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var b=function(a,b){var c=a.siblings(".tform-select");c.find(".tform-select-t").text(b).end().find(".tform-select-option[data-value="+b+"]").addClass("selected").end(),a.val(b)},d=_SL.formatDate.addMin(c.form.find("[name=endDay]").val()+c.form.find("[name=endHour]").val()+c.form.find("[name=endMin]").val(),-a);b(c.form.find("[name=startDay]"),d.substring(0,8)),b(c.form.find("[name=startHour]"),d.substring(8,10)),b(c.form.find("[name=startMin]"),d.substring(10,12))}}),c.form.find("[name=startDay],[name=startHour],[name=startMin],[name=endDay],[name=endHour],[name=endMin]").change(function(){var a=c.form.find("[name=timeSet]"),b=a.siblings(".tform-select").find("[data-value=0]").text();a.val(0).siblings(".tform-select").find(".tform-select-t").text(b)}),c.tableHead.find(".btn-prev").off().on("click",function(){g()}),c.tableHead.find(".btn-next").off().on("click",function(){h()}),c.currPage.off().on("keydown",function(){i()}),c.tableHead.find("[name=pageRow]").change(function(){k()}),c.tableList.off().on("click",".btn-link",function(){j($(this).data("idx"),$(this).data("dtl-idx"))})},g=function(){var a=parseInt(c.currPage.val());if(1!=a){if(0==c.currPage.data("total-page"))return void c.currPage.val(1);c.currPage.val(a-1),k()}},h=function(){var a=parseInt(c.currPage.val());if(a!=c.currPage.data("total-page")){if(0==c.currPage.data("total-page"))return void c.currPage.val(1);c.currPage.val(a+1),k()}},i=function(){var a=(event.srcElement||event.target).value,b=parseInt(c.currPage.data("total-page"));if(13==event.keyCode){if(isNaN(a)||parseInt(a)<1||parseInt(a)>b)return;$("#currPage").val(a),k()}},j=function(d,e){var f=a[d],g=f.event_dtl_list[e],h=g.ruleset_type,i=(f.event_time,g.sdt),j=g.ddt,k=c.form.find("[name='logSearchForm']");if(0==k.length&&(k=$('<form name="logSearchForm">'),k.append('<input type="hidden" name="start_time">'),k.append('<input type="hidden" name="end_time">'),k.append('<input type="hidden" name="filter_type"'),k.append('<input type="hidden" name="expert_keyword">'),k.append('<input type="hidden" name="template_id" value="popup">'),k.append('<input type="hidden" name="s_eqp_type_cd"'),k.append('<input type="hidden" name="s_eqp_ip"'),k.append('<input type="hidden" name="log_view_fields"'),c.form.append(k)),2==h){var l=g.eqp_type_cd,m=g.eqp_ip;$("[name=start_time]",k).val(i),$("[name=end_time]",k).val(j),$("[name=s_eqp_type_cd]",k).val(l),$("[name=s_eqp_ip]",k).val(m);var n="SmsEventWin_"+(new Date).getTime();k.attr({target:n,action:b.urlSmsEvent,method:"post"}).submit()}else{var o=i.substring(0,12),p=_SL.formatDate.addMin(j.substring(0,12),1),q=g.search_query;if(q="("+q+")",""!=g.flt_grp_fld){var r=g.splitFltFldVal,s=g.flt_grp_fld.split(",");for(d in s)q+=" AND "+s[d]+":"+_SL.luceneValueEscape(r[d])}if(""!=g.rst_grp_fld){var t=g.splitRstFldVal,u=g.rst_grp_fld.split(",");for(d in u)q+=" AND "+u[d]+":"+_SL.luceneValueEscape(t[d])}$("[name=start_time]",k).val(o),$("[name=end_time]",k).val(p),$("[name=filter_type]",k).val("2"),$("[name=expert_keyword]",k).val(q),a[d].view_field?$("[name=log_view_fields]",k).val(a[d].view_field):$("[name=log_view_fields]",k).val("");var n="logSearchWin_"+(new Date).getTime();k.attr({target:n,action:b.urlLogSearch}).submit()}},k=function(){e()};return{init:d}}(),$(function(){slapp.relEvent.list.init(),$("#btnSettingRelEvent").togglePage(gCONTEXT_PATH+"event2/rel_ruleset_list.html")});