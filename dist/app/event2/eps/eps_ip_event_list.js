"use strict";_SL.nmspc("epsIpEvent").list=function(){var a={urlList:gCONTEXT_PATH+"event2/eps_ip_event_list.json",formId:"#searchEpsIpEventList",gridId:"#gridEpsIpEventList",urlLink:gCONTEXT_PATH+"event2/eps_security_event_list.html"},b={form:$(a.formId),grid:$(a.gridId),sDay:$(a.formId+" [name=startDay]"),sHour:$(a.formId+" [name=startHour]"),sMin:$(a.formId+" [name=startMin]"),eDay:$(a.formId+" [name=endDay]"),eHour:$(a.formId+" [name=endHour]"),eMin:$(a.formId+" [name=endMin]")},c=function(){d(),e()},d=function(){var c=$.extend({},_SL.serializeMap(b.form));$("body").requestData(a.urlList,c,{callback:function(a){var c=a.list,d=a.eventCates,e=b.grid.find("tbody");e.empty();var g=1;for(var h in c){var i=c[h],j=$("<tr>");g%2==1&&j.append($("<td rowspan='2'>"+i.src_ip+"</td>")),j.append($("<td>"+a.tcTypes[i.tc_type]+"</td>"));for(var k in d){var l=i["cate"+k+"_cnt"],m=$("<td>");m.append(l),0!=l&&m.attr("tabindex","1").addClass("color_ec"+k).data({s_src_ip:i.src_ip,s_tc_type:i.tc_type,s_event_cate_cd:k}),m.appendTo(j)}var n="";n+="<td rowspan='2'>"+i.risk_score+"%",n+="&nbsp; <button type='button' class='text-purple icon-download-square toolkitImg' data-ip='"+i.src_ip+"'></button>",n+="</td>",g%2==1&&j.append($(n)),j.appendTo(e),g++}f()}})},e=function(){b.form.find(".form-submit").off().on("click",function(){if(_SL.validate(b.form)){var a=b.sDay.val()+b.sHour.val()+b.sMin.val(),c=b.eDay.val()+b.eHour.val()+b.eMin.val(),d=_SL.formatDate.diff(a,c);$("#s_eqp_ip").val();if(d<=0)return void _alert("시작일이 종료일보다 큽니다.");if(d/6e4>b.form.find("[name=timeSet] option:last-child").val())return void _alert("검색 기간 초과입니다.");b.form.find("[name=currPage]").val(1),h()}}),b.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var c=function(a,b){var c=a.siblings(".tform-select");c.find(".tform-select-t").text(b).end().find(".tform-select-option[data-value="+b+"]").addClass("selected").end(),a.val(b)},d=_SL.formatDate.addMin(b.form.find("[name=endDay]").val()+b.form.find("[name=endHour]").val()+b.form.find("[name=endMin]").val(),-a);c(b.form.find("[name=startDay]"),d.substring(0,8)),c(b.form.find("[name=startHour]"),d.substring(8,10)),c(b.form.find("[name=startMin]"),d.substring(10,12))}}),b.form.find("[name=startDay],[name=startHour],[name=startMin],[name=endDay],[name=endHour],[name=endMin]").change(function(){var a=b.form.find("[name=timeSet]"),c=a.siblings(".tform-select").find("[data-value=0]").text();a.val(0).siblings(".tform-select").find(".tform-select-t").text(c)})},f=function(){b.form.find(".form-submit").off().on("click",function(){h()}),b.grid.find("[class*=color_ec]").off().on("click",function(){var b=$(this);$("#s_src_ip").val(b.data("s_src_ip")),$("#s_tc_type").val(b.data("s_tc_type")),$("#s_event_cate_cd").val(b.data("s_event_cate_cd")),$("[name=searchEpsIpEventList]")[0].action=a.urlLink,$("[name=searchEpsIpEventList]")[0].submit()}),$(".toolkitImg").each(function(){$(this).on("click",function(){g($(this).attr("data-ip"))})})},g=function(a){$("#hiddenIFrame").attr("src","/monitoring/va_toolkit.do?"+$.param({start_time:$("[name=startDay]").val()+$("[name=startHour]").val()+$("[name=startMin]").val(),end_time:$("[name=endDay]").val()+$("[name=endHour]").val()+$("[name=endMin]").val(),expert_keyword:"",src_ip:a,tc_type:1}))},h=function(){d()};return{init:c,fnVAToolkit:g}}(),$(function(){slapp.epsIpEvent.list.init(),$("#btnSettingEpsRulesetList").togglePage(gCONTEXT_PATH+"event2/eps_ruleset_list.html"),$("#btnSettingRiskRuleView").off().on("click",function(){new ModalPopup(gCONTEXT_PATH+"event2/eps_event_risk_rule_view.html",{width:820,height:250})})});