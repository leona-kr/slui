"use strict";_SL.nmspc("epsRuleset").form=function(){var a={formId:"#formEpsRuleset",urlSelect:gCONTEXT_PATH+"event2/eps_ruleset.json",urlDelete:gCONTEXT_PATH+"event2/eps_ruleset_delete.do",urlLogSearch:gCONTEXT_PATH+"monitoring/log_search.html",add:{action:gCONTEXT_PATH+"event2/eps_ruleset_insert.do",message:"등록 하시겠습니까?"},update:{action:gCONTEXT_PATH+"event2/eps_ruleset_update.do",message:"수정 하시겠습니까?"}},b={form:$(a.formId),rulesetId:$(a.formId+" [name=ruleset_id]"),times:$(a.formId+" [name=times]"),timeType:$(a.formId+" [name=time_type]"),fieldSelBox:$(a.formId+" [name=field_sel_box]"),operatorSelBox:$(a.formId+" [name=operator_sel_box]"),searchQuery:$(a.formId+" [name=search_query]")},c={isNew:""==b.rulesetId.val(),mode:""==b.rulesetId.val()?a.add:a.update},d=function(){e(),c.isNew&&b.form.find(".btn-delete").hide(),c.isNew||f()},e=function(){b.form.find(".btn-save").on("click",g),b.form.find(".btn-delete").on("click",h),j(""),b.timeType.on("change",function(){j("")}),b.fieldSelBox.chosen({search_contains:!0,width:"100%"}),b.fieldSelBox.on("change",k),b.operatorSelBox.on("change",l),b.form.find(".btn-case").on("click",m)},f=function(){var c=b.rulesetId.val(),d={ruleset_id:c},e=function(a){_SL.setDataToForm(a,b.form),j(a.times)};$("body").requestData(a.urlSelect,d,{callback:e})},g=function(){var d=$(a.formId+" [name=character_limit]").val(),e=b.searchQuery.val(),f=Number(e.length),g=1==$(this).data("after-close");if(_SL.validate(b.form))return f>=d?void _alert("검색어의 현재입력길이: "+f+"byte\n입력가능길이는: "+d+"byte입니다."):void $("body").requestData(c.mode.action,_SL.serializeMap(b.form),{callback:function(a,b,c){_alert(c,{onAgree:function(){i(g)}})}})},h=function(){var c=1==$(this).data("after-close");_confirm("삭제하시겠습니까?",{onAgree:function(){var d=b.rulesetId.val();$("body").requestData(a.urlDelete,{ruleset_id:d},{callback:function(a,b,d){_alert(d,{onAgree:function(){i(c)}})}})}})},i=function(a){a&&b.form.find("[data-layer-close=true]").click()},j=function(c){var d={1:[1,2,3,5,10,15,30],2:[1,2,3,6,12],3:[1]},e=b.times,f=b.timeType,g=f.val();e.empty()[0];if(""!=g){for(var h in d[g])e.append('<option value="'+d[g][h]+'">'+d[g][h]+"</option>");c&&($("[value="+c+"]",e)[0].selected=!0),setTimeout(function(){slui.attach.setTransformSelect(a.formId)},10)}"1"==g||"2"==g?e.prop("disabled",!1):e.prop("disabled",!0),slui.attach.setTransformSelect(a.formId)},k=function(){var a=b.searchQuery,c=b.fieldSelBox;a.focus();var d=$.trim(a.val()),e=c.val();""!=e&&(d+=""==d?"":"+"==d.charAt(d.length-1)?"":" ",a.val(d+e+":"),c.val(""),a.focus())},l=function(){var a=b.searchQuery,c=b.operatorSelBox;a.focus();var d=$.trim(a.val()),e=c.val();""!=e&&(""!=d&&"AND,OR,NOT,+".indexOf(e)!=-1&&(e=" "+e),a.val(d+e),c.val(""),a.focus())},m=function(){var c=$(a.formId+" [name=character_limit]").val(),d=b.searchQuery.val(),e=Number(d.length);if(e>=c)return void _alert("검색어의 현재입력길이: "+e+"byte\n입력가능길이는: "+c+"byte입니다.");var f=_SL.formatDate(),g=_SL.formatDate.addMin(f,-10),h=b.searchQuery.val();if(""==h)return void _alert("검색어가 없습니다.");var i=b.form.find("[name='logSearchForm']");0==i.length&&(i=$('<form name="logSearchForm">'),i.append('<input type="hidden" name="start_time">'),i.append('<input type="hidden" name="end_time">'),i.append('<input type="hidden" name="filter_type">'),i.append('<input type="hidden" name="expert_keyword">'),i.append('<input type="hidden" name="template_id" value="popup">'),b.form.append(i)),$("[name=start_time]",i).val(g),$("[name=end_time]",i).val(f),$("[name=filter_type]",i).val("2"),$("[name=expert_keyword]",i).val(h);var j="logSearchWin_"+(new Date).getTime();i.attr({target:j,action:a.urlLogSearch}).submit()};return{init:d}}(),$(function(){slapp.epsRuleset.form.init()});