"use strict";_SL.nmspc("top2").list=function(){var a={urlList:gCONTEXT_PATH+"analysis/top2_list.json",urlLogSearch:gCONTEXT_PATH+"monitoring/log_search.html",urlReport:gCONTEXT_PATH+"analysis/top2_report.do",formId:"#searchTop2List",etcFormId:"#top2EtcForm"},b={form:$(a.formId),etcForm:$(a.etcFormId),sDay:$(a.formId+" [name=startDay]"),sHour:$(a.formId+" [name=startHour]"),sMin:$(a.formId+" [name=startMin]"),eDay:$(a.formId+" [name=endDay]"),eHour:$(a.formId+" [name=endHour]"),eMin:$(a.formId+" [name=endMin]"),sLogCate:$(a.formId+" [name=s_log_cate_cd]"),sGrpCd:$(a.formId+" [name=s_group_cd]")},c=function(){d(),f()},d=function(){var c=$.extend({},_SL.serializeMap(b.form),{pageRow:b.etcForm.find("[name=row]").val()});$("body").requestData(a.urlList,c,{callback:function(a,b,c){var d=a.fieldsInfoList,f=a.rsListByFieldNm;for(var g in d){var h=d[g].field_nm,i=f[h];e(d[g],i)}}})},e=function(a,c){var d=a.field_nm,e=a.group_field,f=a.group_field_caption,g=a.cnt_caption,h=b.etcForm.find("[name=row]").val(),i=j,k=[];i.renderAt=d+"ChartContainer",i.dataSource.chart=$.extend({},slui.chart.chartConfig,i.dataSource.chart),i.dataSource.chart.xAxisName=e,i.height=5==h?180:220;for(var l in c){var m=c[l],n={label:m.asset_nm?m.asset_nm:_SL.javascriptEscape(m.field_nm),toolText:m.asset_nm?_SL.javascriptEscape(m.field_nm)+"("+m.asset_nm+"), "+_SL.formatNumber(m.cnt):_SL.javascriptEscape(m.field_nm)+", "+_SL.formatNumber(m.cnt),link:"javascript:slapp.top2.list.goSearchPopup('"+e+"', '"+_SL.javascriptEscape(m.field_nm)+"')",value:m.cnt};k.push(n)}i.dataSource.data=k,new FusionCharts(i).render();var o=$("#"+d+"ListContainer").empty(),p=$("<table class='board-table-group'></table>"),q=$("<thead />").appendTo(p),r=$("<tbody />").appendTo(p),s=$("<tr />"),t=3;if(s.append($('<th width="10%">순번</th>')).append($("<th>"+f+"</th>")),d.indexOf("_ip")>0&&(s.append($('<th width="20%">자산</th>')),t=4),s.append($('<th width="20%">'+g+"</th>")).appendTo(q),0==c.length){var u=$("<tr>");u.append($("<td colspan='"+t+"' class='list-empty'>There is no Search Result</td>")),u.appendTo(p)}else for(var l in c){var u=$("<tr>"),m=c[l];u.append($("<td class='align-center'>"+(parseInt(l)+1)+"</td>")),u.append($("<td><a href='#' onclick='slapp.top2.list.goSearchPopup(\""+e+'","'+_SL.javascriptEscape(m.field_nm)+"\")'>"+m.field_nm+"</a></td>")),d.indexOf("_ip")>0&&u.append($("<td>"+(m.asset_nm?m.asset_nm:"")+"</td>")),u.append($("<td class='align-right'>"+_SL.formatNumber(m.cnt)+"</td>")),u.appendTo(r)}p.appendTo(o)},f=function(){b.form.find(".btn-submit").off().on("click",function(){i()}),b.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var c=function(a,b){var c=a.siblings(".tform-select");c.find(".tform-select-t").text(b).end().find(".tform-select-option[data-value="+b+"]").addClass("selected").end(),a.val(b)},d=_SL.formatDate.addMin(b.form.find("[name=endDay]").val()+b.form.find("[name=endHour]").val()+b.form.find("[name=endMin]").val(),-a);c(b.form.find("[name=startDay]"),d.substring(0,8)),c(b.form.find("[name=startHour]"),d.substring(8,10)),c(b.form.find("[name=startMin]"),d.substring(10,12))}}),b.form.find("[name=startDay],[name=startHour],[name=startMin],[name=endDay],[name=endHour],[name=endMin]").change(function(){var a=b.form.find("[name=timeSet]"),c=a.siblings(".tform-select").find("[data-value=0]").text();a.val(0).siblings(".tform-select").find(".tform-select-t").text(c)}),b.etcForm.find("[name=row]").change(i),b.etcForm.find(".btn-icon").off().on("click",function(){g($(this).data("btn_type"))})},g=function(c){var d=b.sDay.val()+b.sHour.val()+b.sMin.val(),e=b.eDay.val()+b.eHour.val()+b.eMin.val(),f=b.sLogCate.val(),g=b.sGrpCd.val(),h=b.form.find("[name=reportForm]");0==h.length&&(h=$('<form name="reportForm">'),h.append('<input type="hidden" name="format">'),h.append('<input type="hidden" name="start_time">'),h.append('<input type="hidden" name="end_time">'),h.append('<input type="hidden" name="s_log_cate_cd">'),h.append('<input type="hidden" name="s_group_cd">'),b.form.append(h)),$("[name=format]",h).val(c),$("[name=start_time]",h).val(d),$("[name=end_time]",h).val(e),$("[name=s_log_cate_cd]",h).val(f),$("[name=s_group_cd]",h).val(g),h.attr({action:a.urlReport}).submit()},h=function(c,d){var e=([{field_name:c,field_value:_SL.luceneValueEscape(d)}],b.sDay.val()+b.sHour.val()+b.sMin.val()),f=b.eDay.val()+b.eHour.val()+b.eMin.val(),g=c+":"+_SL.luceneValueEscape(d),h=b.form.find("[name='logSearchForm']");0==h.length&&(h=$('<form name="logSearchForm">'),h.append('<input type="hidden" name="start_time">'),h.append('<input type="hidden" name="end_time">'),h.append('<input type="hidden" name="expert_keyword">'),h.append('<input type="hidden" name="template_id" value="popup">'),b.form.append(h)),$("[name=start_time]",h).val(e),$("[name=end_time]",h).val(f),$("[name=expert_keyword]",h).val(g);var i="logSearchWin_"+(new Date).getTime();h.attr({target:i,action:a.urlLogSearch}).submit()},i=function(){d()},j={type:"bar2d",width:"100%",height:"220",dataFormat:"json",dataSource:{chart:{paletteColors:"#89cf43,#dddddd,#dddddd,#dddddd,#dddddd,#dddddd,#dddddd,#dddddd,#dddddd,#dddddd",maxLabelWidthPercent:"20"},data:[]}};return{init:c,goSearchPopup:h}}(),$(function(){slapp.top2.list.init()});