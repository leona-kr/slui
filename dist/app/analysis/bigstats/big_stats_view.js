"use strict";_SL.nmspc("bigStats").view=function(){function a(){this.RChart_Check_Interval=2e3}var b=0,c="",d=[],e={urlView:gCONTEXT_PATH+"analysis/big_stats_view.html",urlList:gCONTEXT_PATH+"analysis/big_stats_list.html",urlLogSearch:gCONTEXT_PATH+"monitoring/log_search.html",containerId:"#searchBigStatsView",formId:"#searchBigStatsViewForm",dummy:0},f={container:$(e.containerId),form:$(e.formId),grid:$(e.gridId),bigCode:$(e.formId+" [name=big_code]"),statsNm:$(e.formId+" [name=stats_nm]"),dummy:0},g=function(){b=f.bigCode.val(),c=f.statsNm.val(),h(),i()},h=function(){var b,c;$(".component_container").each(function(e){b=$(this).attr("id"),c=b.split("_")[1],d[b]=new a,d[b].init(gItemsInfo[c],$(this))}),$(".component_pannel",f.container).sortable({opacity:.5,handle:".component_handler",start:function(){$(".page-config-area").hide()},update:function(a,b){j()}}),$(".dnd_field_pannel>ul",f.container).sortable({opacity:.5,items:"li:not(.ui-state-disabled)",connectWith:".dnd_field_pannel>ul"}),$(".dnd_field_pannel>ul>li",f.container).disableSelection(),"{}"==gItemsInfo[1].config.config_param&&m()},i=function(){var a=function(b){var c=$(b.target);c.parents().hasClass("page-config-area")||c.parents().hasClass("ui-datepicker")||c.parents().hasClass("modal-alert")||$(".page-config-area").fadeOut(200,function(){$(document).off("mousedown",a)})};f.container.find(".btn-list").on("click",function(){f.form.attr({action:e.urlList}).submit()}),f.container.find(".btn-report").on("click",function(){var a=$("#reportForm"),d=$(this).data("format");0==a.size()&&(a=$("<form id=reportForm>").attr({action:gCONTEXT_PATH+"analysis/big_report.do",method:"post"}),a.append($("<input>").attr({type:"hidden",name:"format"}).val(d)),a.append($("<input>").attr({type:"hidden",name:"big_code"}).val(b)),a.append($("<input>").attr({type:"hidden",name:"stats_nm"}).val(c))),a.submit()}),f.container.find(".btn-link").on("click",function(){var a=gDatasetList[$(this).data("idx")],b=(a.client_group_cd,a.sch_start_time),c=a.sch_end_time,d=a.sch_query;if("S"==a.set_type){var f=$("#goLogForm");0==f.size()&&(f=$("<form id=goLogForm>").attr({action:e.urlLogSearch,method:"post"}),f.append($("<input>").attr({type:"hidden",name:"network_join_cd"})),f.append($("<input>").attr({type:"hidden",name:"start_time"})),f.append($("<input>").attr({type:"hidden",name:"end_time"})),f.append($("<input>").attr({type:"hidden",name:"filter_type"}).val("2")),f.append($("<input>").attr({type:"hidden",name:"expert_keyword"})),f.append($("<input>").attr({type:"hidden",name:"template_id"}).val("popup"))),$("[name=start_time]",f).val(b),$("[name=end_time]",f).val(c),$("[name=expert_keyword]",f).val(d);var g="logSearchWin_"+(new Date).getTime();f.attr({target:g}).submit()}}),f.container.on("click",".component_handler .btn-download",function(){var a=$(this).closest(".component_container"),b=a.attr("id");r(d[b])}),f.container.on("click",".component_handler .btn-setting",function(){var b=$(this).closest(".component_container"),c=b.find(".page-config-area"),e=b.attr("id"),f=$(this).parents(".board-head"),g=f.offset().left+f.outerWidth()-c.width(),h=f.position().top+f.height();c.css({left:g+"px",top:h+"px"}).fadeIn(200,function(){slui.attach.init("#"+e),$(document).on("mousedown",a)}),d[e].showConfig?d[e].showConfig():k(d[e])}),f.container.on("click",".area-bottom",function(b){b.preventDefault();var c=$(b.target),e=c.closest(".page-config-area").find("form"),f=$(this).closest(".component_container").attr("id");if(c.hasClass("btn-config-ok")){if(d[f].validateConfig){if(!d[f].validateConfig())return}else if(!_SL.validate(e))return;d[f].beforeSaveConfig?d[f].beforeSaveConfig():l(d[f]),n(f),$(this).closest(".page-config-area").fadeOut(200,function(){$(document).off("mousedown",a)}),$(this).closest(".component_contents").find(".ui-widget-overlay,.dummy-size-control").remove(),d[f].afterSaveConfig?d[f].afterSaveConfig():o(d[f])}else c.hasClass("btn-config-cancel")&&($(this).closest(".page-config-area").fadeOut(200,function(){$(document).off("mousedown",a)}),d[f].cancelConfig?d[f].cancelConfig():p(d[f]));c=e=null})},j=function(){var a,c=[];a=$(".component_pannel").sortable("toArray");for(var d=0;d<a.length;d++)c.push({big_code:b,item_seq:a[d].split("_")[1],view_seq:d+1});$("body").requestData(gCONTEXT_PATH+"analysis/big_stats_view_seq_save.json",{list:c},{callback:function(){console.log("view_seq updated..")}})},k=function(a){var b,c=$("#cid_"+a.item_seq+" .page-config-area form");if(a.config_param)for(var d in a.config_param)a.config_param[d]&&(b=c.find("[name="+d+"]"),b.length>0&&("INPUT"!=b[0].tagName||"radio"!=b[0].type&&"checkbox"!=b[0].type?b.val(a.config_param[d]):b.filter("[value="+a.config_param[d]+"]").prop("checked",!0)));c=b=null,a.isOpenConfig&&(a.isOpenConfig=!0)},l=function(a){var b=$("#cid_"+a.item_seq+" .config-select-area form").serializeArray();a.config_param={};for(var c=0;c<b.length;c++)a.config_param[b[c].name]=b[c].value},m=function(a){for(var a in d)n(a)},n=function(a){var b=[],b={big_code:d[a].big_code,item_seq:d[a].item_seq,config_param:d[a].config_param?JSON.stringify(d[a].config_param):"{}"};$("body").requestData(gCONTEXT_PATH+"analysis/big_stats_item_config_save.json",b,{callback:function(){}})},o=function(a){a.isOpenConfig&&(a.isOpenConfig=!1),a.refresh()},p=function(a){a.isOpenConfig&&(a.isOpenConfig=!1)},q=function(a,b,c){d["cid_"+a]._goLogSearch(b,c)},r=function(a){_confirm("다운로드 하시겠습니까?",{onAgree:function(){var b=$("#downloadForm");0==b.length&&(b=$("<form>").attr({id:"downloadForm",action:"big_stats_export.do",method:"post"}),b.append('<input type="hidden" name="big_code">'),b.append('<input type="hidden" name="item_seq">'),$("body").append(b)),$("[name=big_code]",b).val(a.big_code),$("[name=item_seq]",b).val(a.item_seq),b.submit()}})};return a.options={wsize:1,order_by:"DESC",chart_height:250,list_height:125,series_rows:10,rows:10},a.prototype={init:function(b,c){this.big_code=b.item.big_code,this.item_seq=b.item.item_seq,this.view_type=b.item.view_type,this.fieldList=b.field,this.$element=c,this.bMultiGroup=this.fieldList.length>2,b.config||(b.config={}),this.config_param=$.extend({},a.options,{view_type:this.view_type},JSON.parse(b.config.config_param||"{}")),this._initConfig(),this._time_id=-1,this.load()},_initConfig:function(){var a=this.fieldList,b=a.length,c=this.config_param,d=["start","end"];if("T"==this.view_type&&(c.sub_view_type||(c.sub_view_type="L"),"S"==gDatasetList[a[0].set_seq-1].set_type))for(var e=0;e<d.length;e++)c[d[e]+"_time"]||(c[d[e]+"_time"]=gDatasetList[a[0].set_seq-1]["sch_"+d[e]+"_time"]);c.category_field_index||(c.category_field_index=[],c.category_field_index.push(0)),c.series_field_index||(c.series_field_index=[],"T"!=this.view_type&&this.bMultiGroup&&c.series_field_index.push(1));var f=$(".config-select-area form",this.$element);"T"==this.view_type?($("[name=category_rows]",f).hide(),$("[name=view_type]",f).hide(),$("[name=sub_view_type]",f).show(),$("[name=rows]",f).hide()):($("[name=sub_view_type]",f).hide(),$("[name=view_type] [value=T]",f).remove());for(var g=$(".search-area",f),e=0;e<b;e++)g.append(this._getSearchField$DIV(a[e]));slui.attach.init(".search-area")},_getSearchField$DIV:function(a){if(this.isFuncField(a))return"";if("eqp_dt"==a.field_nm)return this._getSearchTime$DIV(a);var b=$("<div class='ranges-group'>");return b.append($("<div class='range-2'>").append($("<span class='sp-label'>").text("["+a.set_seq+"]"+this.getFieldCaption(a)))),b.append($("<div class='range-2'>").append(this._getSearchOperator(a))),b.append($("<div class='range-5'>").append($("<input type='text' class='form-input'>").attr("name","field_value"+a.field_seq))),b},_getSearchOperator:function(a){var b=$("<select class='form-select' data-size='6' />").attr({name:"field_value"+a.field_seq+"_op",title:"연산자"});return b.append($("<option>").text("=").val("=")),b.append($("<option>").text("!=").val("!=")),b.append($("<option>").text(">").val(">")),b.append($("<option>").text("<").val("<")),b.append($("<option>").text(">=").val(">=")),b.append($("<option>").text("<=").val("<=")),b.append($("<option>").text("starts with").val("SW")),b.append($("<option>").text("ends with").val("EW")),b.append($("<option>").text("like").val("LIKE")),b.append($("<option>").text("not like").val("NOT LIKE")),b.append($("<option>").text("in").val("IN")),b.append($("<option>").text("not in").val("NOT IN")),b},_getSearchTime$DIV:function(a){var b=["start","end"],c=[],d=[],e=[],f=[],g=$("<div class='ranges-group'>");g.append($("<div class='range-2'>").append($("<span class='sp-label'>").text("["+a.set_seq+"]"+this.getFieldCaption(a))));for(var h,i=0;i<2;i++){h=gDatasetList[a.set_seq-1]["sch_"+b[i]+"_time"],h?(e[i]=h.substring(0,8),f[i]=h.substring(8,10)):(e[i]="",f[i]=""),c[i]=$("<input type=text class='form-input align-center' data-datepicker='true' readonly='readonly'>").attr({name:b[i]+"Day"}),d[i]=$("<select class='form-select' data-size='6' />").attr({name:b[i]+"Hour"});for(var j=0;j<24;j++)h=_SL.toFixedWidth(j,2,"0"),d[i].append($("<option/>").val(h).text(h));c[i].val(e[i]),d[i].val(f[i]),g.append($("<div class='range-2'>").append(c[i])).append($("<div class='range-1'>").append(d[i])).append($("<div class='range-1'>").append("시").append(0==i?" ~ ":""))}return g},load:function(){this.refresh()},_getChartId:function(){return"chart_id_"+this.item_seq},refresh:function(a){var b=this.config_param;"2"===b.wsize?this.$element.addClass("item-board-wide"):this.$element.removeClass("item-board-wide");var c,d;if(this._bChangeConfig&&(this._bChangeConfig=!1,this._time_id!=-1&&(clearTimeout(this._time_id),this._time_id=-1),("R1"==b.view_type||"R2"==b.view_type)&&1==b.RChartStatus)){var e=""+(this.config_param.category_field_index.length>0?this.config_param.category_field_index[0]+1:""),f=""+(this.config_param.series_field_index.length>0?this.config_param.series_field_index[0]+1:"");return void $("body").requestData(gCONTEXT_PATH+"analysis/big_stats_rchart_request.do",$.extend({},this.config_param,{big_code:this.big_code,item_seq:this.item_seq,category_field_seq:e,series_field_seq:f}),{callback:$.proxy(this.refresh,this)})}var g=this._getCategoryFieldList(),h=[];"T"==this.config_param.view_type?(h=[].concat(g),this.config_param.series_field_index.length>0&&"S"!=this.config_param.sub_view_type&&(h=h.concat(this._getSeriesFieldList())),c=gCONTEXT_PATH+"analysis/big_stats_rs_timeline.json",d=1):"R1"==this.config_param.view_type||"R2"==this.config_param.view_type?(c=gCONTEXT_PATH+"analysis/big_stats_rs_list.json",d=9):("P"!=this.config_param.view_type&&(h=[].concat(g),this.config_param.series_field_index.length>0&&"S"!=this.config_param.view_type&&(h=h.concat(this._getSeriesFieldList()))),c=gCONTEXT_PATH+"analysis/big_stats_rs_list.json",d=2);this.output;$("body").requestData(c,$.extend({},this.config_param,{big_code:this.big_code,item_seq:this.item_seq,category_field:g,series_field:this._isMultiSeries()?this._getSeriesFieldList():[],category_field_nm:this._getCategoryOrgFieldList(),series_field_nm:this._isMultiSeries()?this._getSeriesOrgFieldList():[],dt_func:this.fieldList[0].func,func:this.fieldList[this.fieldList.length-1].func,total_group_field:h}),{callback:$.proxy(this.output,this,d)})},_getCategoryFieldList:function(){for(var a=[],b=this.config_param.category_field_index,c=0;c<b.length;c++)a.push("field_value"+(b[c]+1));return a},_getCategoryOrgFieldList:function(){for(var a=[],b=this.config_param.category_field_index,c=0;c<b.length;c++)a.push(this.fieldList[b[c]].field_nm);return a},_getSeriesFieldList:function(){for(var a=[],b=this.config_param.series_field_index,c=0;c<b.length;c++)a.push("field_value"+(b[c]+1));return a},_getSeriesOrgFieldList:function(){for(var a=[],b=this.config_param.series_field_index,c=0;c<b.length;c++)a.push(this.fieldList[b[c]].field_nm);return a},_isMultiSeries:function(){return this.config_param.series_field_index.length>0&&"P"!=this.config_param.view_type},output:function(a,b){1==a?(this.dataList=b.list,this.outputTimelineChart(b.list,b.totalAvg),this.outputList(b.list)):2==a?(this.dataList=b.list,this.outputChart(b.list,b.totalAvg),this.outputList(b.list)):9==a&&(this.dataList=b.list,this.outputRChart(b.list,b.totalAvg),this.outputList(b.list))},outputTimelineChart:function(a,b){this.outputChart(a,b)},outputChart:function(a,b){$(".chart_container",this.$element).show(),$(".r_chart_container",this.$element).hide();var c,d={};c="T"==this.view_type?this.config_param.sub_view_type:this.config_param.view_type,this._isMultiSeries()&&(c="M"+c),d=$.extend(this._getChartData(a||[]),{chart:gChartTypes[c].style}),b&&$.extend(d,{trendlines:[{line:[{startvalue:b,endvalue:"",color:"fda813",displayvalue:" ",tooltext:"Average : "+_SL.formatNumber(b),showontop:"1",thickness:"1"}]}]});new FusionCharts({type:gChartTypes[c].type,renderAt:"chart_container_"+this.item_seq,width:"100%",dataFormat:"json",height:this.config_param.chart_height,dataSource:d}).render()},outputRChart:function(){var a,b=this.config_param,c=this;$(".chart_container",this.$element).hide();var d=$(".r_chart_container",this.$element).show();this._time_id==-1&&d.html('<div class="rchart_text" style="text-align:center;line-height:'+this.config_param.chart_height+'px;">creating rchart...</div>');var e=this.config_param.category_field_index,f=this._isMultiSeries()?this.config_param.series_field_index:[],g=e.length>0?e[0]+1:"",h=f.length>0?f[0]+1:"";1==b.RChartStatus?$("body").requestData(gCONTEXT_PATH+"analysis/big_stats_rchart_check.do",$.extend({},this.config_param,{big_code:this.big_code,item_seq:this.item_seq,view_type:this.config_param.view_type,category_field_seq:g,series_field_seq:h}),{callback:function(a,d,e){"SUC_COM_0000"==d?(b.RChartStatus=2,c._time_id=setTimeout($.proxy(c.outputRChart,c),10)):c._time_id=setTimeout($.proxy(c.outputRChart,c),c.RChart_Check_Interval)}}):(this._time_id!=-1&&(this._time_id=-1),d.empty(),a="big_stats_rchart_down.do",a+="?big_code="+this.big_code+"&item_seq="+this.item_seq+"&view_type="+this.config_param.view_type+"&category_field_seq="+g+"&series_field_seq="+h,d.append($("<img>").attr({src:a,width:"100%",height:this.config_param.chart_height})))},_getChartData:function(a){a||(a=[]);for(var b,c=[],d=[],e=0;e<this.config_param.category_field_index.length;e++)c.push(this.fieldList[this.config_param.category_field_index[e]]);var f,g={},h={},i={},j=[];if(this._isMultiSeries()){for(var e=0;e<this.config_param.series_field_index.length;e++)d.push(this.fieldList[this.config_param.series_field_index[e]]);g={categories:[{category:[]}],dataset:[]}}else g={data:[]};b=c.concat(d),f=a.length;for(var k,l,m,n,o,p,q,r,e=0;e<f;e++)if(k=a[e],l={},m=[],n=[],o=[],this._isMultiSeries()){for(var s=0;s<c.length;s++)p=c[s],q=this.getFieldValue(k,p),m.push(q),n.push(this.getFieldFormatValue(q,p,!0)),o.push(this.getFieldFormatValue(q,p));l.value=m.join("/"),l.label=n.join("/"),l.toolText=o.join("/"),n=[],o=[];for(var s=0;s<d.length;s++)p=d[s],q=this.getFieldValue(k,p),n.push(this.getFieldFormatValue(q,p,!0)),o.push(this.getFieldFormatValue(q,p));r=n.join("/"),h[r]||(h[r]=[]),"undefined"==typeof i[l.value]&&(i[l.value]=j.length,j.push({label:l.label,toolText:l.toolText})),h[r][i[l.value]]={value:k.func_value,link:this._getLinkUrl(e,b)}}else{for(var s=0;s<c.length;s++)p=c[s],q=this.getFieldValue(k,p),n.push(this.getFieldFormatValue(q,p,!0)),o.push(this.getFieldFormatValue(q,p));l.label=n.join("/"),o=[o.join("/")],o.push(k.func_value),l.toolText=o.join(", "),l.value=k.func_value,l.link=this._getLinkUrl(e,c),g.data.push(l)}if(this._isMultiSeries()){g.categories=[{category:j}];for(var t in h)g.dataset.push({seriesname:t,data:h[t]})}return g},outputList:function(a){a||(a=[]);for(var b,c=this.config_param,d=this.$element.find(".list_table").empty(),e=this._getViewFieldList(),f=e.length,g=$("<thead>"),h=$("<tbody>"),i=$("<tr>"),j=0;j<f;j++)i.append($("<th>").text(this.getFieldCaption(e[j]))).appendTo(g);if(d.append(g),0==a.length)$("<tr>").append($("<td>").attr("colspan",f+1).text("There is no data.")).appendTo(h).appendTo(d);else{for(var b,k,l,m,n=70*this.config_param.wsize,j=0;j<a.length;j++){b=a[j],i=$("<tr>");for(var o=0;o<f;o++)k=e[o],m=this.getFieldFormatValue(this.getFieldValue(b,k),k),l=$("<span>").attr("title",m),m&&m.length>n?l.text(m.substring(0,n-3)+"..."):l.text(m),i.append($("<td>").append(this._get$Link(j,this.isFuncField(k)?e:k,l)));i.appendTo(h)}h.appendTo(d)}$("#table_container_"+this.item_seq).height(c.list_height+"px")},_getViewFieldList:function(){for(var a=this.config_param.category_field_index,b=[],c=0;c<a.length;c++)b.push(this.fieldList[a[c]]);if(this._isMultiSeries()){a=this.config_param.series_field_index;for(var c=0;c<a.length;c++)b.push(this.fieldList[a[c]])}return b.push(this.fieldList[this.fieldList.length-1]),b},_goLogSearch:function(a,b){var c,d=(this.dataList,this._getViewFieldList());if(b==-1)c=d.slice(0,d.length-1);else for(var e=0;e<d.length;e++)if(d[e].field_seq==b){c=[d[e]];break}if(!c)return void console.log("Error item_seq : %s, dataIdx : %s, fldSeq : %s",this.item_seq,a,b);for(var f,g,h=gDatasetList[c[0].set_seq-1],i=this.dataList[a],j=null,k="("+h.sch_query+")",e=0;e<c.length;e++)f=c[e].field_nm,g=this.getFieldValue(i,c[e]),"eqp_dt"!=f?k+="-"==g?" NOT "+f+":*":" AND "+f+":"+_SL.luceneValueEscape(g):j=this._getSearchPeriod(i,c[e]);null==j&&(j=this._getSearchPeriodFromDataset(c[0].set_seq));var l=(h.client_group_cd,j.start_time),m=j.end_time,n=k,o=$("#goLogForm");0==o.size()&&(o=$("<form id=goLogForm>").attr({action:gCONTEXT_PATH+"monitoring/log_search.html",method:"post"}),o.append($("<input>").attr({type:"hidden",name:"network_join_cd"})),o.append($("<input>").attr({type:"hidden",name:"start_time"})),o.append($("<input>").attr({type:"hidden",name:"end_time"})),o.append($("<input>").attr({type:"hidden",name:"filter_type"}).val("2")),o.append($("<input>").attr({type:"hidden",name:"expert_keyword"})),o.append($("<input>").attr({type:"hidden",name:"template_id"}).val("popup"))),$("[name=start_time]",o).val(l),$("[name=end_time]",o).val(m),$("[name=expert_keyword]",o).val(n);var p="logSearchWin_"+(new Date).getTime();o.attr({target:p}).submit()},_getSearchPeriodFromDataset:function(a){var b=gDatasetList[a-1];return"S"==b.set_type?{start_time:b.sch_start_time,end_time:b.sch_end_time}:(console.log("Error _getSearchPeriodFromDataset > DataSet Type is %s",b.set_type),null)},_getSearchPeriod:function(a,b){var c={start_time:this.getFieldValue(a,b),end_time:""};switch(b.func){case"8":c.start_time+="0000",c.end_time=_SL.formatDate.addDay(c.start_time,1);break;case"10":c.start_time+="00",c.end_time=_SL.formatDate.addHour(c.start_time,1);break;case"11":c.start_time=c.start_time+"0",c.end_time=_SL.formatDate.addMin(c.start_time,10);break;case"12":c.end_time=_SL.formatDate.addMin(c.start_time,1);break;default:return console.log("Error _getSearchPeriod > field_nm : %s, func : %s",b.field_nm,b.func),null}return c},_get$Link:function(a,b,c){var d=this._getLinkUrl(a,b);return null==d?c:$("<a>").attr({href:d}).append(c)},_getLinkUrl:function(a,b){var c=0,d=0,e=!1;$.isArray(b)?d=-1:(d=b.field_seq,b=[b]);for(var f=0;f<b.length;f++)if(!this.isFuncField(b[f]))if(0==c){if(c=b[f].set_seq,"S"!=gDatasetList[c-1].set_type){e=!1;break}e=!0}else if(c!=b[f].set_seq){e=!1;break}return e?"javascript:slapp.bigStats.view._goLogSearch("+this.item_seq+","+a+","+d+")":null},validateConfig:function(){var a=$(".page-config-area form",this.$element);if(_SL.validate(a)){var b=$(".dnd_category>ul",this.$element).sortable("toArray",{attribute:"field_index"}),c=$(".dnd_series>ul",this.$element).sortable("toArray",{attribute:"field_index"});if("T"==this.view_type){if($("[name=startDay]",a).val()+$("[name=startHour]",a).val()>=$("[name=endDay]",a).val()+$("[name=endHour]",a).val())return _alert("검색 시작시간보다 종료시간이 커야 됩니다."),!1}else if(0==b.length)return _alert("항목필드를 선택하세요."),!1;var d=$("[name=view_type]",a).val();if("R1"==d){if(console.log(0),1!=b.length)return _alert("R 차트는 항목필드를 하나만 선택하세요."),!1;if(0!=c.length)return _alert("R Word 차트는 범례필드를 선택할 수 없습니다."),!1}else if("R2"==d){if(1!=b.length)return _alert("R 차트는 항목필드를 하나만 선택하세요."),!1;if(1!=c.length)return _alert("R 방사 차트는 범례필드를 하나 선택하세요."),!1}return!0}},showConfig:function(){var a=this.fieldList,b=(a.length,this.config_param);slapp.bigStats.view.showConfig(this);var c,d,e={};$(".dnd_field_pannel ul",this.$element).empty(),c=$(".dnd_category ul",this.$element);for(var f=0;f<b.category_field_index.length;f++)d=b.category_field_index[f],e["idx_"+d]=d,this._appendDndFieldTo(c,d,"["+a[d].set_seq+"]"+this.getFieldCaption(a[d]));c=$(".dnd_series ul",this.$element);for(var f=0;f<b.series_field_index.length;f++)d=b.series_field_index[f],e["idx_"+d]=d,this._appendDndFieldTo(c,d,"["+a[d].set_seq+"]"+this.getFieldCaption(a[d]));c=$(".dnd_selectable ul",this.$element);for(var f=0;f<a.length;f++)"undefined"!=typeof e["idx_"+f]||this.isFuncField(a[f])||this._appendDndFieldTo(c,f,"["+a[f].set_seq+"]"+this.getFieldCaption(a[f]))},_appendDndFieldTo:function(a,b,c){a.append($("<li>").attr({field_index:b,title:c}).addClass("dnd_field ui-state-default"+(0==b&&"T"==this.view_type?" ui-state-disabled":"")).text(c))},beforeSaveConfig:function(){var a=$.extend({},this.config_param);slapp.bigStats.view.beforeSaveConfig(this);var b=this.fieldList,c=(b.length,this.config_param),d=$(".dnd_category>ul",this.$element).sortable("toArray",{attribute:"field_index"}),e=$(".dnd_series>ul",this.$element).sortable("toArray",{attribute:"field_index"});c.category_field_index=[],"T"==this.view_type&&c.category_field_index.push(0);for(var f=0;f<d.length;f++)c.category_field_index.push(parseInt(d[f]));c.series_field_index=[];for(var f=0;f<e.length;f++)c.series_field_index.push(parseInt(e[f]));var g=$("[name=startDay]",this.$element).val();g&&""!=g&&(c.start_time=$("[name=startDay]",this.$element).val()+$("[name=startHour]",this.$element).val(),c.end_time=$("[name=endDay]",this.$element).val()+$("[name=endHour]",this.$element).val()),"R1"!=c.view_type&&"R2"!=c.view_type||a.view_type==c.view_type&&this.isSameArrayValue(a.category_field_index,c.category_field_index)&&this.isSameArrayValue(a.series_field_index,c.series_field_index)||(c.RChartStatus=1),this._bChangeConfig=!0},isSameArrayValue:function(a,b){if(!a||0==a.length)return!b||0==b.length;if(!b||a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0},isFuncField:function(a){return a.func&&/^\D/.test(a.func)},getFieldCaption:function(a){var b=gFieldCaptions[a.field_nm]||a.field_nm;return this.isFuncField(a)&&(b=(gFieldCaptions[a.func]||a.func)+("*"!=a.field_nm?"["+b+"]":"")),b},getFieldFormatValue:function(a,b,c){var d,e=(b.field_seq,c?"":"yyyy-MM-dd");if(b.func)switch(b.func){case"8":d=_SL.formatDate(a,"yyyyMMdd","yyyy-MM-dd");break;case"10":d=_SL.formatDate(a,"yyyyMMddHH",e+" HH:mm");break;case"11":d=_SL.formatDate(a+"0","yyyyMMddHHmm",e+" HH:mm");break;case"12":d=_SL.formatDate(a,"yyyyMMddHHmm",e+" HH:mm");break;default:d=_SL.formatNumber(a)}else d=a,gFldToCodes[b.field_nm]&&gFldToCodes[b.field_nm][a]&&(d="["+a+"]"+gFldToCodes[b.field_nm][a]);return d},getFieldValue:function(a,b){var c=b.field_seq;if(!b.func)return a["field_value"+c];switch(b.func){case"8":case"10":case"11":case"12":return a["field_value"+c];default:return a.func_value}}},{init:g,showConfig:k,beforeSaveConfig:l,_goLogSearch:q}}(),$(function(){slapp.bigStats.view.init()});