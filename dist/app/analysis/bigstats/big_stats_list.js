"use strict";_SL.nmspc("bigStats").list=function(){var a=[],b={urlView:gCONTEXT_PATH+"analysis/big_stats_view.html",urlList:gCONTEXT_PATH+"analysis/big_stats_list.json",urlProcPct:gCONTEXT_PATH+"analysis/big_stats_prcs_pct.json",formId:"#searchBigStatsList",gridId:"#gridBigStatsList"},c={form:$(b.formId),grid:$(b.gridId),bigCode:$(b.formId+" [name=big_code]")},d=function(){e(c.grid),f(),setInterval(i,1e4)},e=function(c){var d={datatype:"json",datafields:[{name:"proc_dt",type:"string"},{name:"big_code",type:"string"},{name:"stats_nm",type:"string"},{name:"proc_start_dt",type:"string"},{name:"proc_end_dt",type:"string"},{name:"elapsed_time",type:"string"},{name:"proc_id",type:"string"},{name:"user_nm",type:"string"},{name:"proc_pct",type:"string"},{name:"status",type:"string"},{name:"status_nm",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(d.totalrecords=a.totalRows)},cache:!1,url:b.urlList},e=new $.jqx.dataAdapter(d,{beforeLoadComplete:function(b){for(var c in b)b[c].org_proc_dt=b[c].proc_dt,b[c].proc_dt=_SL.formatDate(b[c].proc_dt,"yyyyMMddHHmmss","yyyy-MM-dd HH:mm:ss"),a.push(b[c].big_code);return b},formatData:function(a){var c,d={},e=$(b.formId).serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(a,d),a},loadError:function(a,b,c){alert(c)}});c.jqxGrid({source:e,sortable:!1,width:"100%",virtualmode:!0,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"등록시간",datafield:"proc_dt",cellsalign:"center",width:"15%"},{text:"분석명",datafield:"stats_nm",cellsrenderer:function(a,b,c,d,e,f){return $(d).html('<button type="button" class="btn-link">'+c+"</button>")[0].outerHTML}},{text:"소요시간",datafield:"elapsed_time",cellsalign:"center",width:"10%",cellsrenderer:function(a,b,c,d,e,f){var g=f.big_code,i='<span class="'+g+'_elap_time">'+h(c)+"</span>";return $(d).html(i)[0].outerHTML}},{text:"등록자",datafield:"proc_id",cellsalign:"center",width:"10%",cellsrenderer:function(a,b,c,d,e,f){return $(d).html(c+"("+f.user_nm+")")[0].outerHTML}},{text:"진행상태",datafield:"proc_pct",cellsalign:"center",width:150,cellsrenderer:function(a,b,c,d,e,f){var g=f.big_code,h=f.org_proc_dt,i='<div id="list_'+g+'" data-proc-dt="'+h+'" style="position:relative;width:100px;height:16px;margin:5px auto;border:1px solid #000;background:#fff;"><div class="prcsPctB" style="position:absolute;left:0;top:0;bottom:0;width:'+c+'%;background-color:#89cf43;"></div><div class="prcsPctT" style="position:absolute;width:100%;height:100%;text-align:center;color:#000;">'+c+"%</div></div>";return i}},{text:"상태",datafield:"status_nm",cellsalign:"center",width:"10%",cellsrenderer:function(a,b,c,d,e,f){var g=f.big_code,h='<span class="'+g+'_status">'+c+"</span>";return $(d).html(h)[0].outerHTML}}]}),c.on("cellclick",function(a){if("stats_nm"===a.args.datafield){var b=a.args.row.bounddata.big_code;k(b)}})},f=function(){c.form.find(".form-submit").off().on("click",function(){j()}),c.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var b=_SL.formatDate.addMin(c.form.find("[name=endDay]").val()+c.form.find("[name=endHour]").val()+c.form.find("[name=endMin]").val(),-a);g(c.form.find("[name=startDay]"),b.substring(0,8)),g(c.form.find("[name=startHour]"),b.substring(8,10)),g(c.form.find("[name=startMin]"),b.substring(10,12))}}),c.form.find("[name=startDay],[name=startHour],[name=startMin],[name=endDay],[name=endHour],[name=endMin]").change(function(){var a=c.form.find("[name=timeSet]"),b=a.siblings(".tform-select").find("[data-value=0]").text();a.val(0).siblings(".tform-select").find(".tform-select-t").text(b)}),$("body").on("comMng.changeSearchTime",function(a){var b=_SL.formatDate.addMin(comGetServerTime(),2);g(c.form.find("[name=endDay]"),b.substring(0,8)),g(c.form.find("[name=endHour]"),b.substring(8,10)),g(c.form.find("[name=endMin]"),b.substring(10,12)),j()})},g=function(a,b){var c=a.siblings(".tform-select");c.find(".tform-select-t").text(b).end().find(".tform-select-option[data-value="+b+"]").addClass("selected").end(),a.val(b)},h=function(a){var b,c,d,e,f="";return b=parseInt(a/86400),c=parseInt(a%86400/3600),d=parseInt((a%86400-3600*c)/60),e=parseInt((a%86400-3600*c)%60),0!=b&&(f+=b+"일 "),0==b&&0==c||(f+=c+"시간 "),0==b&&0==c&&0==d||(f+=d+"분"),0==b&&0==c&&0==d&&0==e||(f+=e+"초"),""==f&&(f="-"),f},i=function(){if(!(a.length<1)){var d={big_code_arr:a},e=function(a){for(var b in a){var d=a[b],e=d.big_code,f=d.proc_pct,g=$("#list_"+e),i=g.data("proc-dt"),j=d.proc_dt;if(i==j&&f+"%"!=g.find(".prcsPctT").text()){d.status;if($("."+e+"_status").text(d.status_nm),g.find(".prcsPctB").width(f+"%"),g.find(".prcsPctT").text(f+"%"),"100"==f){var k=d.elapsed_time,l=h(k),m=d.proc_start_dt,n=d.proc_end_dt;_SL.formatDate(m,"yyyyMMddHHmmss","yyyy-MM-dd HH:mm:ss"),_SL.formatDate(n,"yyyyMMddHHmmss","yyyy-MM-dd HH:mm:ss");c.grid.find("."+e+"_elap_time").text(l)}}}};$("body").requestData(b.urlProcPct,d,{callback:e})}},j=function(){c.grid.jqxGrid("updatebounddata")},k=function(a){c.form.attr("action",b.urlView),c.bigCode.val(a),c.form.submit()};return{init:d}}(),$(function(){slapp.bigStats.list.init(),$("#btnSettingBigStats").togglePage(gCONTEXT_PATH+"analysis/big_stats_manager_list.html"),$("#btnSettingBigFile").togglePage(gCONTEXT_PATH+"analysis/big_file_data_list.html")});