"use strict";_SL.nmspc("comdb").form=function(){var a={formId:"#formComDb",urlSelect:gCONTEXT_PATH+"sysdata/com_db_form.json",urlSelectSample:gCONTEXT_PATH+"sysdata/get_com_db_sample.json",urlSelectEncrypt:gCONTEXT_PATH+"sysdata/get_com_db_text_encrypt.json",urlComCodeForm:gCONTEXT_PATH+"sysdata/comcode_form.html",urlExist:gCONTEXT_PATH+"sysdata/com_db_id_exist.json",urlDelete:gCONTEXT_PATH+"sysdata/com_db_delete.do",add:{action:gCONTEXT_PATH+"sysdata/com_db_add.do",message:"등록 하시겠습니까?"},update:{action:gCONTEXT_PATH+"sysdata/com_db_update.do",message:"수정 하시겠습니까?"}},b={form:$(a.formId),jdbcId:$(a.formId+" [name=jdbc_id]"),typeCodeType:$(a.formId+" .btn-register-type").data("value")},c={isNew:""==b.jdbcId.val(),mode:""==b.jdbcId.val()?a.add:a.update},d=function(){e(),c.isNew?b.form.find(".btn-delete").hide():b.jdbcId.addClass("form-text").prop("readonly",!0),c.isNew||f()},e=function(){b.form.find(".btn-save").on("click",g),b.form.find(".btn-delete").on("click",h),b.form.find("[name=jdbc_type]").change(function(){""!=$(this).val()&&$("body").requestData(a.urlSelectSample,{code_id:$(this).val()},{callback:function(a,c,d){b.form.find("[name=jdbc_prop]").val(a)}})}),b.form.find(".btn-register-type").exModalPopup(a.urlComCodeForm+"?code_type="+b.typeCodeType,{width:550,height:450,onClose:function(){j(b.form.find("[name=jdbc_type]"))}}),b.form.find(".btn-convert").on("click",function(){var c=b.form.find("[name=encrypt_text]").val();""!=c&&$("body").requestData(a.urlSelectEncrypt,{text_str:c},{callback:function(a,c,d){b.form.find("[name=encrypt_text]").val(a)}})})},f=function(){var c=b.jdbcId.val(),d={jdbc_id:c},e=function(c){_SL.setDataToForm(c,b.form,{}),slui.attach.setTransformSelect(a.formId)};$("body").requestData(a.urlSelect,d,{callback:e})},g=function(){if(_SL.validate(b.form)){var d=/^[_|a-z|A-Z|0-9|\*]+$/,e=b.jdbcId.val();if(!d.test(e))return void _alert("ID는 영문, 숫자, _ 만 사용 할 수 있습니다.");var f=1==$(this).data("after-close"),g=function(){$("body").requestData(c.mode.action,_SL.serializeMap(b.form),{callback:function(a,b,c){_alert(c,{onAgree:function(){i(f)}})}})};c.isNew?$("body").requestData(a.urlExist,{jdbc_id:e},{callback:function(a){1==a?g():_alert("사용중인 JDBC ID가 있어 저장 할 수 없습니다.")}}):g()}},h=function(){var c=1==$(this).data("after-close");_confirm("삭제하시겠습니까?",{onAgree:function(){$("body").requestData(a.urlDelete,_SL.serializeMap(b.form),{callback:function(a,b,d){_alert(d,{onAgree:function(){i(c)}})}})}})},i=function(a){a&&b.form.find("[data-layer-close=true]").click()},j=function(b){var c=slapp.comcode.form.getCode();b.append('<option value="'+c.code_id+'">'+c.code_name+"</option>"),b.val(c.code_id),slui.attach.setTransformSelect(a.formId),b.trigger("change")};return{init:d}}(),$(function(){slapp.comdb.form.init()});