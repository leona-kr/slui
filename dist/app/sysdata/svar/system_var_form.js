"use strict";_SL.nmspc("svar").form=function(){var a={formId:"#formSystemVar",urlSelect:gCONTEXT_PATH+"sysdata/system_var.json",urlExist:gCONTEXT_PATH+"sysdata/var_nm_check.json",urlChkDelete:gCONTEXT_PATH+"sysdata/rel_sys_check.json",urlDelete:gCONTEXT_PATH+"sysdata/system_var_delete.do",add:{action:gCONTEXT_PATH+"sysdata/system_var_insert.do",message:"등록 하시겠습니까?"},update:{action:gCONTEXT_PATH+"sysdata/system_var_update.do",message:"수정 하시겠습니까?"}},b={form:$(a.formId),varNm:$(a.formId+" [name=var_nm]"),dupCheck:$(a.formId+" #dup_check")},c={isNew:""==b.varNm.val(),mode:""==b.varNm.val()?a.add:a.update},d=function(){e(),c.isNew?b.form.find(".btn-delete").hide():b.varNm.addClass("form-text").prop("readonly",!0),c.isNew||i()},e=function(){b.form.find(".btn-save").on("click",j),b.form.find(".btn-delete").on("click",k),b.form.find("[name=fldAddSelBox]").change(f),b.form.find("[name=fldAddSelBox]").chosen({search_contains:!0,width:"100%"}),b.form.find("[name=operatorSelBox]").change(g),b.varNm.keyup(h)},f=function(){var a=b.form.find("[name=var_val]"),c=b.form.find("[name=fldAddSelBox]"),d=$.trim(a.val()),e=$(this).val();a.focus(),""!=e&&(d+=""==d?"":"+"==d.charAt(d.length-1)?"":" ",a.val(d+e+":"),c.val(""),a.focus())},g=function(){var a=b.form.find("[name=var_val]"),c=b.form.find("[name=operatorSelBox]"),d=$.trim(a.val()),e=c.val();a.focus(),""!=e&&(""!=d&&"AND,OR,NOT,+".indexOf(e)!=-1&&(e=" "+e),a.val(d+e),c.val(""),a.focus())},h=function(){if(!b.varNm.prop("readonly")){var c=/\s/,d=/[~!@\#$%<>^&*\()\-=+\']/gi;return c.exec(b.varNm.val())&&_alert("시스템변수는 공백을 사용할 수 없습니다.",{onAgree:function(){b.varNm.focus(),b.varNm.val(b.varNm.val().replace(/ /gi,""))}}),d.test(b.varNm.val())?(_alert("시스템변수에서는 언더 바(_)를 제외한 특수문자를 사용 할 수 없습니다.",{onAgree:function(){b.varNm.addClass("text-danger"),b.varNm.focus(),b.dupCheck.text("언더 바(_)를 제외한 특수문자를 사용할 수 없습니다."),b.dupCheck.addClass("text-danger form-label"),b.varNm.val(b.varNm.val().replace(/ /gi,""))}}),!1):void $("body").requestData(a.urlExist,_SL.serializeMap(b.form),{callback:function(a,c,d){"OK"==a?(b.dupCheck.text("이미 사용중 입니다. 다시 입력해주세요."),b.varNm.addClass("text-danger")):(""==b.varNm.val()?b.dupCheck.text(""):b.dupCheck.text("사용가능").addClass("text-danger form-label"),b.varNm.removeClass("text-danger"))}})}},i=function(){var c=b.varNm.val(),d={var_nm:c},e=function(a){_SL.setDataToForm(a,b.form,{})};$("body").requestData(a.urlSelect,d,{callback:e})},j=function(){if(_SL.validate(b.form)){var d=/[~!@\#$%<>^&*\()\-=+\']/gi;if(d.test(b.varNm.val()))return _alert("시스템변수에서는 언더 바(_)를 제외한 특수문자를 사용 할 수 없습니다.",{onAgree:function(){b.varNm.addClass("text-danger"),b.dupCheck.text("언더 바(_)를 제외한 특수문자를 사용할 수 없습니다."),b.dupCheck.addClass("text-danger form-label"),b.varNm.focus()}}),!1;var e=1==$(this).data("after-close"),f=function(){$("body").requestData(c.mode.action,_SL.serializeMap(b.form),{callback:function(a,b,c){_alert(c,{onAgree:function(){l(e)}})}})};c.isNew?$("body").requestData(a.urlExist,_SL.serializeMap(b.form),{callback:function(a,b,c){"OK"==a?_alert("이미 사용중인 시스템변수명이 있습니다.<br>다시 작성해주세요."):f()}}):f()}},k=function(){var c=b.varNm.val(),d=1==$(this).data("after-close"),e=function(){_confirm("삭제하시겠습니까?",{onAgree:function(){$("body").requestData(a.urlDelete,{var_nm:c},{callback:function(a,b,c){_alert(c,{onAgree:function(){l(d)}})}})}})};$("body").requestData(a.urlChkDelete,{var_nm:c},{callback:function(a,b,c){a.length>0?_alert("현재 사용중인 이벤트가 있습니다.<br>이벤트를 삭제 후 다시 시도해 주십시오."):e()}})},l=function(a){a&&b.form.find("[data-layer-close=true]").click()};return{init:d}}(),$(function(){slapp.svar.form.init()});