"use strict";_SL.nmspc("codebook").form=function(){var a={formId:"#formCodeBookForm",urlComCodeTypeForm:gCONTEXT_PATH+"sysdata/comcode_type_form.html",urlFieldExist:gCONTEXT_PATH+"sysdata/code_book_field_exist.json",urlSave:gCONTEXT_PATH+"sysdata/code_field_insert.do",urlDelete:gCONTEXT_PATH+"sysdata/code_field_del.do"},b={form:$(a.formId),codeId:$(a.formId+" [name=code_id]"),codeType:$(a.formId+" [name=s_code_type]"),codeIdSel:$(a.formId+" [name=code_id_sel]")},c={isNew:""==b.codeId.val()},d=function(){e(),b.form.find("[name=log_field_sel]").chosen({search_contains:!0,width:"100%"}),c.isNew?b.form.find(".btn-delete").hide():b.form.find(".btn-register-code").hide(),c.isNew||g()},e=function(){b.form.find(".btn-save").on("click",h),b.form.find(".btn-delete").on("click",i),b.form.find(".btn-register-code").exModalPopup(a.urlComCodeTypeForm,{width:550,height:300,onClose:function(){k(b.codeIdSel)}}),f(),b.form.find("#cust_add").click(function(){var c=b.form.find("[name=code_id_sel] option:selected").val(),d=b.form.find("[name=log_field_sel] option:selected").val(),e=b.form.find("[name=log_field_sel] option:selected").text();return""==c?void _alert("코드종류를 선택하세요."):""==d?void _alert("로그필드를 선택하세요."):b.form.find("[name=add_field_list] option").is(function(){return this.value==d})?void _alert("이미 추가한 필드입니다."):void $("body").requestData(a.urlFieldExist,{code_id:c,field_name:d},{callback:function(a,c,f){"OK"==a?b.form.find("[name=add_field_list]").append("<option value='"+d+"'>"+e+"</option>"):"EXIST"==a?_alert("이미 다른 코드종류에서 사용중입니다."):_alert("저장 중 에러가 발생했습니다.<br>다시 실행하세요.")}})}),b.form.find("#cust_del").click(function(){b.form.find("[name=add_field_list] :selected").remove()})},f=function(){b.codeIdSel.change(function(){if(b.form.find("[name=add_field_list] option").each(function(){""!=this.value&&$(this).remove()}),null!=gComCodeFieldToCode[$(this).val()]){var a=gComCodeFieldToCode[$(this).val()].split(",");for(var c in a){var d=a[c];b.form.find("[name=add_field_list]").append("<option value='"+d+"'>"+gFieldCaptions[d]+"["+d+"]</option>")}}})},g=function(){var a=b.form.find("[name=field_name_list]").val().split(",");for(var c in a){var d=a[c];b.form.find("[name=add_field_list]").append("<option value='"+d+"'>"+gFieldCaptions[d]+"["+d+"]</option>")}b.form.find("[name=code_id_sel]").val(b.codeId.val()),b.form.find("[name=code_id_sel]").prop("disabled",!0)},h=function(){c.isNew||b.form.find("[name=code_id_sel]").prop("disabled",!1);b.form.find("[name=code_id_sel] option:selected").val();if(b.form.find("[name=add_field_list] option").each(function(){this.selected=!0}),0==b.form.find("[name=add_field_list] option:selected").length)return void _alert("로그필드를 추가하세요.");var d=1==$(this).data("after-close");$("body").requestData(a.urlSave,_SL.serializeMap(b.form),{callback:function(a,b,c){_alert(c,{onAgree:function(){j(d)}})}})},i=function(d){c.isNew||b.form.find("[name=code_id_sel]").prop("disabled",!1);var d=1==$(this).data("after-close"),e=b.form.find("[name=code_id_sel] option:selected").val();_confirm("삭제하시겠습니까?",{onAgree:function(){$("body").requestData(a.urlDelete,{code_id_sel:e},{callback:function(a,b,c){_alert(c,{onAgree:function(){j(d)}})}})}})},j=function(a){a&&b.form.find("[data-layer-close=true]").click()},k=function(b){var c=slapp.comcode.typeform.getCodeType();b.append('<option value="'+c.code_id+'">'+c.code_name+"</option>"),b.val(c.code_id),slui.attach.setTransformSelect(a.formId)};return{init:d}}(),$(function(){slapp.codebook.form.init()});