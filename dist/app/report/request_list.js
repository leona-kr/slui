"use strict";_SL.nmspc("report").list=function(){var a={urlList:gCONTEXT_PATH+"report/request_list.json",urlDelete:gCONTEXT_PATH+"report/request_delete.do",urlDownload:gCONTEXT_PATH+"report/report_download.do",formId:"#searchReportList",gridId:"#gridReportList"},b={form:$(a.formId),grid:$(a.gridId)},c=function(){d(b.grid),e()},d=function(c){var d={datatype:"json",datafields:[{name:"report_nm",type:"string"},{name:"sch_start_time",type:"string"},{name:"sch_end_time",type:"string"},{name:"gen_day",type:"string"},{name:"gen_cycle_nm",type:"string"},{name:"proc_stat_nm",type:"string"},{name:"gen_format_list",type:"string"},{name:"gen_path",type:"string"},{name:"report_file_nm",type:"string"},{name:"gen_req_id",type:"string"},{name:"req_start_time",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(d.totalrecords=a.totalRows)},cache:!1,url:a.urlList},e=new $.jqx.dataAdapter(d,{beforeLoadComplete:function(a){for(var b in a)a[b].sch_start_time=_SL.formatDate(a[b].sch_start_time,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),a[b].sch_end_time=_SL.formatDate(a[b].sch_end_time,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),a[b].req_start_time=_SL.formatDate(a[b].req_start_time,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),a[b].sch_time=a[b].sch_start_time+" ~ "+a[b].sch_end_time,a[b].gen_cycle=a[b].gen_cycle_nm+a[b].gen_day;return a},formatData:function(b){var c,d={},e=$(a.formId).serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(b,d),b},loadError:function(a,b,c){alert(c)}});c.jqxGrid({source:e,sortable:!0,width:"100%",virtualmode:!0,selectionmode:"checkbox",enablehover:!1,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"보고서명",datafield:"report_nm",cellsalign:"center"},{text:"검색기간",datafield:"sch_time",width:"20%",cellsalign:"center"},{text:"생성주기",datafield:"gen_cycle",width:"10%",cellsalign:"center"},{text:"진행상태",datafield:"proc_stat_nm",width:"10%",cellsalign:"center"},{text:"생성파일",datafield:"gen_format_list",width:"12%",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g="",h={};f.report_file_nm,f.gen_req_id,f.gen_path;h=c.split(",");for(var i=0;i<h.length;i++){switch(h[i]){case"docx":h[i]="word";break;case"xlsx":h[i]="xls";break;case"pptx":h[i]="ppt"}g+=" <button type='button' class='btn-link'><i class='icon-"+h[i]+"'></i></button> "}return $(d).html(g)[0].outerHTML}},{text:"생성(예정)시간",datafield:"req_start_time",width:"15%",cellsalign:"center"}]}),c.on("cellclick",function(a){if("gen_format_list"===a.args.datafield){var c=a.args.originalEvent.toElement.className,d=c.split("-");switch(d[1]){case"word":d[1]="docx";break;case"xls":d[1]="xlsx";break;case"ppt":d[1]="pptx"}var e=a.args.row.bounddata,f=e.gen_path,g=e.report_file_nm+"_"+e.gen_req_id+"."+d[1];b.form.find("[name=filePath]").val(f),b.form.find("[name=fileName]").val(g),"grid"!=d[1]&&h()}})},e=function(){var a=b.grid.parent().siblings(".grid-bottom").find(".btn-delete");b.form.find(".form-submit").off().on("click",function(){f()}),a.off().on("click",function(){var a=[],c=b.grid.jqxGrid("selectedrowindexes"),d=b.grid.jqxGrid("getdisplayrows"),e=[];for(var f in d)for(var h=0,i=c.length;h<i;h++)c[h]==d[f].boundindex&&e.push(d[f].boundindex);if(e.length>0){for(var h in e){var j=b.grid.jqxGrid("getrowdata",e[h]);if(!j)break;a.push(j.gen_req_id)}g(a)}else _alert("선택한 보고서가 없습니다.")})},f=function(){b.grid.jqxGrid("updatebounddata"),b.grid.jqxGrid("clearselection")},g=function(b){_confirm("선택한 보고서를 삭제하시겠습니까?",{onAgree:function(){$("body").requestData(a.urlDelete,{remove_gen_req_id:b},{callback:function(a){f()}})}})},h=function(){b.form.attr({action:a.urlDownload}).submit()};return{init:c}}(),$(function(){slapp.report.list.init(),$("#btnScheduleMng").togglePage(gCONTEXT_PATH+"report/schedule_list.html")});