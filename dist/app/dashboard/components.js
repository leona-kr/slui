"use strict";_SL.nmspc("component").big_stats=function(a,b,c){var d=a,e=gCONTEXT_PATH+"component/last_complete_big_code.json",f=gCONTEXT_PATH+"component/big_stats_item_info.json",g=gCONTEXT_PATH+"component/big_stats_item_list.json",h=gCONTEXT_PATH+"component/big_stats_field_list.json",i=gCONTEXT_PATH+"analysis/big_stats_rs_timeline.json",j=gCONTEXT_PATH+"analysis/big_stats_rs_list.json",k=gCONTEXT_PATH+"monitoring/log_search.html",l=b,m=c,n=!1,o=!1,p={view_type:"L",chart_height:180,list_height:150,order_by:"DESC",series_rows:10,rows:10},q={body:$("#componentbody_"+d),chart:$("#chart_"+d),logTable:$("#list_table_"+d),config:$("#config_"+d),form:$("#config_"+d+" form")},r={oChart:null,DatasetList:[],dataList:[],FieldList:[],lastBigCode:0,bMultiGroup:!1,bChangeConfig:!1,bInitItemInfo:!1,bUserOnChange:!1},s=_SL.nmspc("CONTEXT_DATA"),t={A:{type:"area2d",height:180},MA:{type:"msarea",height:180},B:{type:"bar2d",height:180},MB:{type:"msbar2d",height:180},C:{type:"column2d",height:180},MC:{type:"mscolumn2d",height:180},L:{type:"line",height:180},ML:{type:"msline",height:180},S:{type:"column2d",height:180},MS:{type:"stackedcolumn2d",height:180},P:{type:"pie3d",height:180}},u=function(){gDFD.fldToCodes.ready(),this.config_param=l=$.extend({},p,l),ka=$.extend(this.chartstyles,ka),z(t.MA.type),$(".dnd_field_pannel>ul",q.form).sortable({opacity:.5,items:"li:not(.ui-state-disabled)",connectWith:".dnd_field_pannel>ul"}),$(".dnd_field_pannel>ul>li",q.form).disableSelection(),$("[name=item_key]",q.form).off("change").on("change",function(a){W($(":selected",this).text(),$(this).val())}),v()},v=function(){if(!n&&!o&&l.schedule_id){var a=$.Deferred();!r.bInitItemInfo&&l.schedule_id&&l.item_seq?a=w(l.schedule_id,l.item_seq):a.resolve(l.schedule_id),a.done(function(){x().done(A)})}},w=function(a,b){var c=$.Deferred();return $("body").requestData(f,{schedule_id:a,item_seq:b},{callback:function(a){if(a){if(r.bInitItemInfo=!0,!a.DatasetList)return;r.DatasetList=a.DatasetList,r.FieldList=a.FieldList,y(),c.resolve(a)}}}),c},x=function(){var a=$.Deferred();return $("body").requestData(e,{schedule_id:l.schedule_id},{callback:function(b){a.resolve(b)}}),a},y=function(a){var b=l,c=r.FieldList,d=c.length,e=["start","end"];if("T"==b.view_type&&(b.sub_view_type||(b.sub_view_type="L"),"S"==c[0].set_type))for(var f;f<e.length;f++)b[e[f]+"_time"]||(b[e[f]+"_time"]=c[0]["sch_"+e[f]+"_time"]);b.category_field_index||(b.category_field_index=[],b.category_field_index.push(0)),b.series_field_index||(b.series_field_index=[],d>2&&b.series_field_index.push(1)),z(t[J()].type)},z=function(a){"string"==typeof a&&a.indexOf("area")!=-1&&(ka.plotfillalpha="60");var b=r.oChart;b?(b.chartType(a),b.resizeTo("100%",l.chart_height)):FusionCharts.ready(function(){$.Dashboard.chartInstance[d]=r.oChart=new FusionCharts({type:a,renderAt:"chart_"+d,width:"100%",height:l.chart_height,dataFormat:"json",dataSource:{chart:ka,data:[]}}).render()})},A=function(a){var b,c,d=l,e=r.FieldList;if(a&&0!=r.DatasetList.length&&(r.last_big_code!=a||0!=r.bChangeConfig)){r.last_big_code=d.big_code=a,r.bChangeConfig&&(z(t[J()].type),r.bChangeConfig=!1);var f=B(),g=[];"T"==d.view_type?(g=[].concat(f),d.series_field_index.length>0&&"S"!=d.sub_view_type&&(g=g.concat(D())),b=i,c=1):("P"!=d.view_type&&(g=[].concat(f),d.series_field_index.length>0&&"S"!=d.view_type&&(g=g.concat(D()))),b=j,c=2);var h=$.extend({},l,{schedule_id:l.schedule_id,item_seq:l.item_seq,category_field:f,series_field:F()?D():[],category_field_nm:C(),series_field_nm:F()?E():[],dt_func:e[0].func,func:e[e.length-1].func,total_group_field:g});$("body").requestData(b,h,{callback:function(a,b,d){G(c,a)}})}},B=function(){for(var a=[],b=l.category_field_index,c=0;c<b.length;c++)a.push("field_value"+(b[c]+1));return a},C=function(){for(var a=[],b=l.category_field_index,c=0;c<b.length;c++)a.push(r.FieldList[b[c]].field_nm);return a},D=function(){for(var a=[],b=l.series_field_index,c=0;c<b.length;c++)a.push("field_value"+(b[c]+1));return a},E=function(){for(var a=[],b=l.series_field_index,c=0;c<b.length;c++)a.push(r.FieldList[b[c]].field_nm);return a},F=function(){return l.series_field_index.length>0&&"P"!=l.view_type},G=function(a,b){$("h5",q.body).text(l.item_nm),1==a?(r.dataList=b.list,H(b.list,b.totalAvg),L(b.list)):2==a&&(r.dataList=b.list,I(b.list,b.totalAvg),L(b.list))},H=function(a,b){I(a,b)},I=function(a,b){q.chart.show();var c=$.extend(K(a||[]),{chart:ka});b&&$.extend(c,{trendlines:[{line:[{startvalue:b,endvalue:"",color:"fda813",displayvalue:" ",tooltext:"Average : "+_SL.formatNumber(b),showontop:"1",thickness:"1"}]}]}),r.oChart&&r.oChart.setChartData(c,"json")},J=function(){var a="T"==l.view_type?l.sub_view_type:l.view_type;return F()&&(a="M"+a),a},K=function(a){a||(a=[]);for(var b,c=[],d=[],e=0;e<l.category_field_index.length;e++)c.push(r.FieldList[l.category_field_index[e]]);var f,g={},h={},i={},j=[];if(F()){for(var e=0;e<l.series_field_index.length;e++)d.push(r.FieldList[l.series_field_index[e]]);g={categories:[{category:[]}],dataset:[]}}else g={data:[]};b=c.concat(d),f=a.length;for(var k,m,n,o,p,q,s,t,e=0;e<f;e++)if(k=a[e],m={},n=[],o=[],p=[],F()){for(var u=0;u<c.length;u++)q=c[u],s=ja(k,q),n.push(s),o.push(ia(s,q,!0)),p.push(ia(s,q));m.value=n.join("/"),m.label=o.join("/"),m.toolText=p.join("/"),o=[],p=[];for(var u=0;u<d.length;u++)q=d[u],s=ja(k,q),o.push(ia(s,q,!0)),p.push(ia(s,q));t=o.join("/"),h[t]||(h[t]=[]),"undefined"==typeof i[m.value]&&(i[m.value]=j.length,j.push({label:m.label,toolText:m.toolText})),h[t][i[m.value]]={value:k.func_value,link:O(e,b)}}else{for(var u=0;u<c.length;u++)q=c[u],s=ja(k,q),o.push(ia(s,q,!0)),p.push(ia(s,q));m.label=o.join("/"),p=[p.join("/")],p.push(_SL.toComma(k.func_value)),m.toolText=p.join(", "),m.value=k.func_value,m.link=O(e,c),g.data.push(m)}if(F()){g.categories=[{category:j}];for(var v in h)g.dataset.push({seriesname:v,data:h[v]})}return g},L=function(a){var b,c,d,e=q.logTable.find("thead").empty(),f=q.logTable.find("tbody").empty();a||(a=[]),c=M(),d=c.length,b=$("<tr>");for(var g=0;g<d;g++)b.append("<th>"+ha(c[g])+"</th>");if(b.appendTo(e),0==a.length)f.append('<tr><td colspan="'+d+'1">There is no data.</td></tr>');else for(var h,i,j,k,m=70*l.wsize,g=0;g<a.length;g++){h=a[g],b=$("<tr>");for(var n=0;n<d;n++)i=c[n],k=ia(ja(h,i),i),j=$("<span>").attr("title",k),k&&k.length>m?j.text(k.substring(0,m-3)+"..."):j.text(k),b.append($("<td>").append(N(g,ga(i)?c:i,j)));b.appendTo(f)}},M=function(){for(var a=l.category_field_index,b=r.FieldList,c=[],d=0;d<a.length;d++)c.push(b[a[d]]);if(F()){a=l.series_field_index;for(var d=0;d<a.length;d++)c.push(b[a[d]])}return c.push(b[b.length-1]),c},N=function(a,b,c){var d=O(a,b);return null==d?c:$("<a>").attr("href",d).append(c)},O=function(a,b){var c=0,e=0,f=!1;$.isArray(b)?e=-1:(e=b.field_seq,b=[b]);for(var g=0;g<b.length;g++)if(!ga(b[g]))if(0==c){if(c=b[g].set_seq,"S"!=r.DatasetList[c-1].set_type){f=!1;break}f=!0}else if(c!=b[g].set_seq){f=!1;break}return f?"javascript:$.Dashboard.componentInstance['"+d+"'].goLogSearch("+a+","+e+")":null},P=function(a,b){var c,d=(r.dataList,M());if(b==-1)c=d.slice(0,d.length-1);else for(var e=0;e<d.length;e++)if(d[e].field_seq==b){c=[d[e]];break}if(!c)return void console.log("Error item_seq : %s, dataIdx : %s, fldSeq : %s",this.item_seq,a,b);for(var f,g,h=r.DatasetList[c[0].set_seq-1],i=r.dataList[a],j=null,l="("+h.sch_query+")",e=0;e<c.length;e++)f=c[e].field_nm,g=ja(i,c[e]),"eqp_dt"!=f?l+="-"==g?" NOT "+f+":*":" AND "+f+":"+_SL.luceneValueEscape(g):j=R(i,c[e]);null==j&&(j=Q(c[0].set_seq)),i.netJoinCd;var m=$("<form>").attr({target:"logSearchWin_"+(new Date).getTime(),action:k,method:"post"});m.append($("<input type='hidden' name='start_time'>").val(j.start_time)).append($("<input type='hidden' name='end_time'>").val(j.end_time)).append($("<input type='hidden' name='expert_keyword'>").val(l)).append($("<input type='hidden' name='template_id'>").val("popup")).appendTo("body").submit().remove()},Q=function(a){var b=r.DatasetList[a-1];return"S"==b.set_type?{start_time:b.sch_start_time+"00",end_time:b.sch_end_time+"00"}:(console.log("Error _getSearchPeriodFromDataset > DataSet Type is %s",b.set_type),null)},R=function(a,b){var c={start_time:ja(a,b),end_time:""};switch(b.func){case"8":c.start_time+="0000",c.end_time=_SL.formatDate.addDay(c.start_time,1);break;case"10":c.start_time+="00",c.end_time=_SL.formatDate.addHour(c.start_time,1);break;case"11":c.start_time=c.start_time+"0",c.end_time=_SL.formatDate.addMin(c.start_time,10);break;case"12":c.end_time=_SL.formatDate.addMin(c.start_time,1);break;default:return null}return c},S=function(){r.bUserOnChange=!1,_SL.setDataToForm(l,q.form),V()},T=function(){if(_SL.validate(q.form)){var a=$(".search-fieldset",q.form),b=$(".dnd_category>ul",q.form).sortable("toArray",{attribute:"field_index"}),c=($(".dnd_series>ul",q.form).sortable("toArray",{attribute:"field_index"}),$("[name=view_type]",q.form).val());if("T"==c){if($("[name=startDay]",a).val()+$("[name=startHour]",a).val()>=$("[name=endDay]",a).val()+$("[name=endHour]",a).val())return _alert("검색 시작시간이 종료시간보다 커야 합니다.",{onAgree:function(){$("[name=endHour]",a).focus()}}),!1}else if(0==b.length)return _alert("항목필드를 선택하세요."),!1;return!0}},U=function(){var a=_SL.serializeMap(q.form),b=r.FieldList,c=(b.length,a.item_key.split("_"));a.schedule_id=parseInt(c[0]),a.item_seq=parseInt(c[1]);var d=$(".dnd_category>ul",q.form).sortable("toArray",{attribute:"field_index"}),e=$(".dnd_series>ul",q.form).sortable("toArray",{attribute:"field_index"});a.category_field_index=[],"T"==a.view_type&&a.category_field_index.push(0);for(var f=0;f<d.length;f++)a.category_field_index.push(parseInt(d[f]));a.series_field_index=[];for(var f=0;f<e.length;f++)a.series_field_index.push(parseInt(e[f]));var g=$("[name=startDay]",q.form).val();g&&""!=g&&(a.start_time=$("[name=startDay]",q.form).val()+$("[name=startHour]",q.form).val(),a.end_time=$("[name=endDay]",q.form).val()+$("[name=endHour]",q.form).val()),l.item_key!=a.item_key&&(r.bInitItemInfo=!1),r.bChangeConfig=!0,this.config_param=l=a},V=function(){var a=l,b=a.schedule_id?a.schedule_id+"_"+a.item_seq:"",c=function(){var a,c,d,e,f,g=s.BigStatsItemData,h=q.form.find("[name=item_key]");h.empty().append($("<option>").text("[선택하세요]").val(""));for(var i in g)a=g[i],e=a.schedule_id+"_"+a.item_seq,null!=a&&a.schedule_id==d||(c=a.stats_nm,d=a.schedule_id,f=$("<optgroup>").attr("label",c),h.append(f)),f.append($("<option>").text(a.item_nm).val(e));h.val(b),h.trigger("change")};s.BigStatsItemData?c():$("body").requestData(g,{},{callback:function(a){s.BigStatsItemData=a,c()}})},W=function(a,b){var c=l,d=c.schedule_id+"_"+c.item_seq,e=X(b);if(!e)return _("",[]),void ba([]);if(d==b)Z(c.item_nm,c.view_type,r.FieldList,c.category_field_index,c.series_field_index);else{var f=Y(e);f.done(function(a){var b=[],c=[];b.push(0),a.length>2&&c.push(1),Z(e.stats_nm+"["+e.item_nm+"]",e.view_type,e.fieldList,b,c)})}},X=function(a){for(var b=s.BigStatsItemData,c=b.length,d=null,e=0;e<c;e++)if(a==b[e].schedule_id+"_"+b[e].item_seq){d=b[e];break}return d},Y=function(a){var b=$.Deferred();if(a)if(a.fieldList)b.resolve(a.fieldList);else{var c={schedule_id:a.schedule_id,item_seq:a.item_seq};$("body").requestData(h,c,{callback:function(c){a.fieldList=c,b.resolve(a.fieldList)}})}else b.resolve([]);return b},Z=function(a,b,c,d,e){var f=l;c.length;$("[name=item_nm]",q.form).val(a),"T"==b?(0==$("[name=view_type] [value=T]",q.form).length&&$("[name=view_type]",q.form).append($("<option value=T>Timeline</option>")),$("[name=view_type]",q.form).val("T"),$("[name=category_rows]",q.form).hide(),$("[name=view_type]",q.form).hide(),$("[name=sub_view_type]",q.form).show(),$("[name=rows]",q.form).hide()):($("[name=view_type] [value=T]",q.form).remove(),$("[name=category_rows]",q.form).show(),$("[name=view_type]",q.form).show(),$("[name=sub_view_type]",q.form).hide(),$("[name=rows]",q.form).show()),ba(c),0==r.bUserOnChange&&f.category_field_index?(_(f.view_type,c,f.category_field_index,f.series_field_index),_SL.setDataToForm(l,q.form),r.bUserOnChange=!0):_(b,c,d,e)},_=function(a,b,c,d){var e,f,g={};if($(".dnd_field_pannel>ul",q.form).empty(),b&&0!=b.length){e=$(".dnd_category>ul",q.form);for(var h=0;h<c.length;h++)f=c[h],g["idx_"+f]=f,aa(a,e,f,"["+b[f].set_seq+"]"+ha(b[f]));e=$(".dnd_series>ul",q.form);for(var h=0;h<d.length;h++)f=d[h],g["idx_"+f]=f,aa(a,e,f,"["+b[f].set_seq+"]"+ha(b[f]));e=$(".dnd_selectable>ul",q.form);for(var h=0;h<b.length;h++)"undefined"!=typeof g["idx_"+h]||ga(b[h])||aa(a,e,h,"["+b[h].set_seq+"]"+ha(b[h]))}},aa=function(a,b,c,d){b.append($("<li>").attr({field_index:c,title:d}).addClass("dnd_field ui-state-default"+(0==c&&"T"==a?" ui-state-disabled":"")).text(d))},ba=function(a){var b=a.length,c=$(".search-fieldset",q.form);$("div",c).remove();for(var d=0;d<b;d++)c.append(ca(a[d]));slui.attach.setTransformSelect(".page-config-area")},ca=function(a){return ga(a)?"":"eqp_dt"==a.field_nm?fa(a):da(a)},da=function(a){var b="base-search-field",c=q.config.find(".bigstats-tpl-search ."+b).clone().removeClass(b);return $(".sp-label",c).text("["+a.set_seq+"]"+ha(a)),ea($("select",c),a),$("input[type=text]",c).attr("name","field_value"+a.field_seq),c},ea=function(a,b){return a.attr({name:"field_value"+b.field_seq+"_op",title:"연산자"}),a.append($("<option>").text("=").val("=")),a.append($("<option>").text("!=").val("!=")),a.append($("<option>").text(">").val(">")),a.append($("<option>").text("<").val(">")),a.append($("<option>").text(">=").val(">=")),a.append($("<option>").text("<=").val("<=")),a.append($("<option>").text("starts with").val("SW")),a.append($("<option>").text("ends with").val("EW")),a.append($("<option>").text("like").val("LIKE")),a.append($("<option>").text("not like").val("NOT LIKE")),a.append($("<option>").text("in").val("IN")),a.append($("<option>").text("not in").val("NOT IN")),a},fa=function(a){var b=["start","end"],c=[],d=[],e=[],f=[],g="base-time-field",h=q.config.find(".bigstats-tpl-search ."+g).clone().removeClass(g);$(".sp-label",h).text("["+a.set_seq+"]"+ha(a));for(var i,j=0;j<2;j++){i=a["sch_"+b[j]+"_time"],i?(e[j]=i.substring(0,8),f[j]=i.substring(8,10)):(e[j]="",f[j]=""),c[j]=$("input[name="+b[j]+"Day]",h),d[j]=$("select[name="+b[j]+"Hour]",h);for(var k=0;k<24;k++)i=_SL.toFixedWidth(k,2,"0"),d[j].append($("<option/>").val(i).text(i));c[j].val(e[j]),d[j].val(f[j]),c[j].datepicker({dateFormat:"yymmdd",changeMonth:!0,changeYear:!0,showAnim:"fadeIn"})}return h},ga=function(a){return a.func&&/^\D/.test(a.func)},ha=function(a){var b=LogCaptionInfo[a.field_nm]||a.field_nm;return ga(a)&&(b=(LogCaptionInfo[a.func]||a.func)+("*"!=a.field_nm?"["+b+"]":"")),b},ia=function(a,b,c){var d,e=(b.field_seq,c?"":"yyyy-MM-dd");if(b.func)switch(b.func){case"8":d=_SL.formatDate(a,"yyyyMMdd","yyyy-MM-dd");break;case"10":d=_SL.formatDate(a,"yyyyMMddHH",e+" HH:mm");break;case"11":d=_SL.formatDate(a+"0","yyyyMMddHHmm",e+" HH:mm");break;case"12":d=_SL.formatDate(a,"yyyyMMddHHmm",e+" HH:mm");break;default:d=_SL.formatNumber(a)}else d=a,gDFD.fldToCodes.data[b.field_nm]&&gDFD.fldToCodes.data[b.field_nm][a]&&(d="["+a+"]"+gDFD.fldToCodes.data[b.field_nm][a]);return d},ja=function(a,b){var c=b.field_seq;if(!b.func)return a["field_value"+c];switch(b.func){case"8":case"10":case"11":case"12":return a["field_value"+c];default:return a.func_value}},ka={paletteColors:"89cf43,0099ff,ced2ff,9fa7ff,6dd0f7,dfbcfe,7dcbff,c07cfe,669933,dddddd",showValues:"0"};return{config_param:l,component_title:m,isOpenConfig:n,load:u,refresh:v,showConfig:S,validateConfig:T,beforeSaveConfig:U,goLogSearch:P}},_SL.nmspc("slapp.component").blacklist_event=function(a,b,c){var d=a,e=$("#componentbody_"+d),f=$("#config_"+d+" form"),g=($("#config_"+d+" .btn-apply"),e.find("#"+d+"_table thead"),e.find(".grid-table-group")),h=(e.find(".goLogSearchView"),f.find("[name=last_period]")),i=f.find("[name=s_type]"),j=f.find("[name=ip_view_opt]"),k=f.find("[name=rows]"),l=(f.find("input:radio[name='pie']"),f.find("input:radio[name='area']"),f.find("input:radio[name='list']"),d+"_pie_chart_container"),m=d+"_area_chart_container",n="subPieChartContainer",o="subAreaChartContainer",p=gCONTEXT_PATH+"sysdata/comcode_map.json",q=gCONTEXT_PATH+"component/blacklist_event_list.json",r=gCONTEXT_PATH+"event/blacklist_event_main_chart_data.json",s=gCONTEXT_PATH+"event/blacklist_event_sub_chart_form.html",t=gCONTEXT_PATH+"event/blacklist_event_sub_chart_data.json",u=gCONTEXT_PATH+"monitoring/log_search.html",v=(gCONTEXT_PATH+"event/blacklist_event_update.json",{last_period:"10",list:"on"}),w=b,x=c,y=function(){this.title=x,this.config_param=w=$.extend({},v,w),$.Dashboard.chartInstance[d]=[],z(),P.dataSource.chart=$.extend(L,this.chartstyles),Q.dataSource.chart=$.extend(M,this.chartstyles),Q.dataSource.chart.labelDisplay="stagger",e.on("click",".goLogSearchView_"+d,function(){var a=$(this).attr("data-key").split(","),b=a[0],c=a[1],d=a[2];return J(b,c,d),!1}),FusionCharts&&(FusionCharts.items[d+"_pie_chart_id"]=null,delete FusionCharts.items[d+"_pie_chart_id"],FusionCharts.items[d+"_area_chart_id"]=null,delete FusionCharts.items[d+"_area_chart_id"],FusionCharts.items.subPieChartContainer=null,delete FusionCharts.items.subPieChartContainer,FusionCharts.items.subPreaChartContainer=null,delete FusionCharts.items.subPreaChartContainer),E()},z=function(){ComCodes.CS0021?I():$("body").requestData(p,{code_type:"CS0021"},{callback:function(a,b,c){ComCodes.CS0021=a,I()}}),F()},A=function(){h.val(w.last_period),i.val(w.s_type),j.val(w.ip_view_opt),k.val(w.rows)},B=function(){w.last_period=h.val(),w.s_type=i.val(),w.ip_view_opt=j.val(),w.rows=k.val(),w.pie=f.find("[name=pie]:checked").val(),w.area=f.find("[name=area]:checked").val(),w.list=void 0==f.find("[name=list]:checked").val()?"":f.find("[name=list]:checked").val()},C=function(){E()},D=function(a,b,c){new ModalPopup(s,{width:1e3,height:350,onOpen:R(a,b,c)})},E=function(a){var b,c=[],e=w&&"ASSET"==w.ip_view_opt,f=g.find("tbody"),h=w.last_period?w.last_period:v.last_period;w.end_time=_SL.formatDate(),w.start_time=_SL.formatDate.addMin(w.end_time,-h),"on"==w.list?(g.show(),$("body").requestData(q,w,{callback:function(a){f.children().remove();var g=a&&a.rsList?a.rsList:[];if(g&&0!=g.length)for(var h=0;h<g.length;h++){b=!!e&&""!=g[h].asset_name;var i="";i=0==h?"no1":"",i=h%2?"bg":"";var j="";j=b?g[h].asset_name+"("+g[h].blacklist_ip+")":g[h].blacklist_ip,""==g[h].domain&&(g[h].domain="-"),""==g[h].nation&&(g[h].nation="-"),""==g[h].type_nm&&(g[h].type_nm="-"),c[h]+="<tr class='"+i+"'><td>"+(h+1)+"</td>",c[h]+="<td><a href='#' class='goLogSearchView_"+d+"' aria-value='"+h+"' title='"+j+"' data-key='"+g[h].blacklist_ip+","+g[h].event_time+","+g[h].ip_type+"'>"+j+"</a></td>",c[h]+="<td>"+g[h].domain+"</td>",c[h]+="<td>"+g[h].nation+"</td>",c[h]+="<td>"+g[h].type_nm+"</td>",c[h]+="<td title='"+_SL.formatDate(g[h].event_time,"MM-dd HH:mm")+"'>"+_SL.formatDate(g[h].event_time,"MM-dd HH:mm")+"</td></tr>"}else f.append('<tr><td class="list-empty" colspan="6">There is no Search Result</td></tr>');f.append(""+c.join(",")),c=[]}})):g.hide(),w.area||w.pie?H(a):($("#"+d+"_pie_chart_container").hide(),$("#"+d+"_area_chart_container").hide()),G()},F=function(){w.last_period&&$("#config_"+d+" [name=last_period] option").each(function(){$(this).val()==w.last_period&&$(this).prop("selected",!0)}),w.ip_view_opt&&$("#config_"+d+" [name=ip_view_opt] option").each(function(){$(this).val()==w.ip_view_opt&&$(this).prop("selected",!0)}),I(),w.rows&&$("#config_"+d+" [name=rows] option").each(function(){$(this).val()==w.rows&&$(this).prop("selected",!0)}),w.pie&&$("#config_"+d+" #pie").prop("checked",!0),w.area&&$("#config_"+d+" #area").prop("checked",!0),w.list&&$("#config_"+d+" #list").prop("checked",!0)},G=function(){var a="",b=0;for(var c in w)""!=w[c]&&"s_type"==c&&(a+="IP유형 : ",ComCodes.CS0021?a+=ComCodes.CS0021[w[c]]:$("body").requestData(p,{code_type:"CS0021"},{callback:function(b,d,e){ComCodes.CS0021=b,a+=ComCodes.CS0021[w[c]]}}),b++);var e=0==b?"전체":a;$("#componentbody_"+d+" .sp-title h5").text(e)},H=function(a){var b,c,e=w.last_period?w.last_period:v.last_period;c=_SL.formatDate(),b=_SL.formatDate.addMin(c,-e),w.pie||$("#"+d+"_pie_chart_container").hide(),w.area||$("#"+d+"_area_chart_container").hide(),$.getJSON(r,{start_time:b,end_time:c,s_type:w.s_type},function(b){S.groupByPeriod=b.groupByPeriod;var c=b.labels,e=b.pieChartDataList,f=b.areaChartDataList,g=b.categorys;""!=w.s_type&&(c=[ComCodes.CS0021[w.s_type]]);var h=P,i=Q;h.renderAt=l,i.renderAt=m,h.dataSource.chart.caption="유형별 현황",i.dataSource.chart.caption="유형별 시간대별 현황",h.dataSource.data=[],i.dataSource.categories=[],i.dataSource.dataset=[],i.dataSource.categories.push({category:g});for(var j in c)if(w.pie&&(h.dataSource.data.push(S.getData(c[j],e,!1)),$("#"+d+"_pie_chart_container").show()),w.area){i.dataSource.dataset.push({seriesname:c[j],data:[]});for(var k in g)i.dataSource.dataset[j].data.push(S.getDataset(c[j],g[k].label,f,!1));$("#"+d+"_area_chart_container").show()}setTimeout(function(){1!=a&&void 0==$.Dashboard.chartInstance[d]|void 0==$.Dashboard.chartInstance[d][0]?FusionCharts.ready(function(){$.Dashboard.chartInstance[d][0]=new FusionCharts(h).render()}):$.Dashboard.chartInstance[d][0].setJSONData(h.dataSource),1!=a&&void 0==$.Dashboard.chartInstance[d][1]?FusionCharts.ready(function(){$.Dashboard.chartInstance[d][1]=new FusionCharts(i).render()}):$.Dashboard.chartInstance[d][1].setJSONData(i.dataSource)},1e3)})},I=function(){i.empty(),i.append(new Option("[선택하세요]",""));for(var a in ComCodes.CS0021){var b=new Option(ComCodes.CS0021[a],a);w.s_type==a&&(b.selected=!0),i.append(b)}},J=function(a,b,c){var d=b,e=_SL.formatDate.addMin(d,1),g="1"==c?"src_ip":"dstn_ip",h=f.find("[name='logSearchForm']");0==h.length&&(h=$('<form name="logSearchForm">'),h.append('<input type="hidden" name="start_time">'),h.append('<input type="hidden" name="end_time">'),h.append('<input type="hidden" name="filter_type"'),h.append('<input type="hidden" name="expert_keyword">'),h.append('<input type="hidden" name="template_id" value="popup">'),f.append(h)),$("[name=start_time]",h).val(d),$("[name=end_time]",h).val(e),$("[name=filter_type]",h).val("2"),$("[name=expert_keyword]",h).val(g+":"+a);var i="logSearchWin_"+(new Date).getTime();h.attr({target:i,action:u}).submit()},K=function(a,b){b=b.replace(/\D/gi,"");var c,d,e=w.last_period?w.last_period:v.last_period;d=_SL.formatDate(),c=_SL.formatDate.addMin(d,-e),""!=b&&(d=_SL.formatDate.addMin(b,S.groupByPeriod),c=b);var g=f.find("[name='logSearchForm']");0==g.length&&(g=$('<form name="logSearchForm">'),g.append('<input type="hidden" name="start_time">'),g.append('<input type="hidden" name="end_time">'),g.append('<input type="hidden" name="filter_type"'),g.append('<input type="hidden" name="expert_keyword">'),g.append('<input type="hidden" name="template_id" value="popup">'),f.append(g)),$("[name=start_time]",g).val(c),$("[name=end_time]",g).val(d),$("[name=filter_type]",g).val("2"),$("[name=expert_keyword]",g).val("src_ip:"+a+" OR dstn_ip:"+a);var h="logSearchWin_"+(new Date).getTime();g.attr({target:h,action:u}).submit()},L={caption:"유형별 현황",pieRadius:"130",showpercentintooltip:"0",startingangle:"125"},M={caption:"유형별 시간대별 현황",numvdivlines:"10",showlabels:"0",showvalues:"0"},N={caption:"유형별 현황",pieRadius:"130",showpercentintooltip:"0",startingangle:"125"},O={caption:"유형별 시간대별 현황",numvdivlines:"10",showlabels:"0",showvalues:"0"},P={type:"pie3d",renderAt:l,width:"100%",height:"240",dataFormat:"json",dataSource:{chart:L,data:[]}},Q={type:"msline",renderAt:m,width:"100%",height:"240",dataFormat:"json",dataSource:{chart:M,categories:[],dataset:[]}},R=function(a,b,c){a=a.replace(/\D/gi,""),S.ip_type=b;var e=$.extend(!0,{},P),f=$.extend(!0,{},Q);e.dataSource.chart.showBorder="1",f.dataSource.chart.showBorder="1",e.renderAt=n,f.renderAt=o,e.height="300",f.height="300",e.dataSource.chart=$.extend(N,slui.chart.chartConfig),f.dataSource.chart=$.extend(O,slui.chart.chartConfig),e.dataSource.chart.showBorder="1",f.dataSource.chart.showBorder="1",e.dataSource.chart.caption="["+decodeURIComponent(c)+"]TOP "+S.top_limit+" 현황",f.dataSource.chart.caption="["+decodeURIComponent(c)+"]시간대별 TOP "+S.top_limit+" 현황";var g,h,i=w.last_period?w.last_period:v.last_period;h=_SL.formatDate(),g=_SL.formatDate.addMin(h,-i),""!=a&&(h=_SL.formatDate.addMin(a,S.groupByPeriod),g=a),$.getJSON(t,{top_limit:S.top_limit,start_time:g,end_time:h,s_type:b,s_blacklist_ip:$("input[name=s_blacklist_ip]").val(),s_domain:$("input[name=s_domain]").val(),s_nation:$("input[name=s_nation]").val()},function(a){S.groupByPeriod=a.groupByPeriod;var b=a.labels,c=a.pieChartDataList,g=a.areaChartDataList,h=a.categorys;e.dataSource.data=[],f.dataSource.categories=[],f.dataSource.dataset=[],f.dataSource.categories.push({category:h});for(var i in b){e.dataSource.data.push(S.getData(b[i],c,!0)),f.dataSource.dataset.push({seriesname:b[i],data:[]});for(var j in h)f.dataSource.dataset[i].data.push(S.getDataset(b[i],h[j].label,g,!0))}$.Dashboard.chartInstance[d].length>2&&($.Dashboard.chartInstance[d][2].dispose(),$.Dashboard.chartInstance[d][3].dispose()),setTimeout(function(){FusionCharts.ready(function(){$.Dashboard.chartInstance[d][2]=new FusionCharts(e).render()}),FusionCharts.ready(function(){$.Dashboard.chartInstance[d][3]=new FusionCharts(f).render()})},1e3)})},S={top_limit:10,groupByPeriod:1,getDataset:function(a,b,c,e){var f={value:0};for(var g in c)if(a==c[g].label&&b==c[g].category){f=e?{value:c[g].value,link:'javascript:$.Dashboard.componentInstance["'+d+'"].goSearchPopup("'+c[g].label+'", "'+c[g].category+'")'}:{value:c[g].value,link:'javascript:$.Dashboard.componentInstance["'+d+'"].subChartInit("'+c[g].category+'", "'+c[g].type+'", "'+_SL.htmlEscape(c[g].label)+'")'};break}return f},getData:function(a,b,c){var e={label:a,value:0};for(var f in b)if(a==b[f].label){e=c?{label:b[f].label,value:b[f].value,link:'javascript:$.Dashboard.componentInstance["'+d+'"].goSearchPopup("'+b[f].label+'", "")'}:{label:b[f].label,value:b[f].value,link:'javascript:$.Dashboard.componentInstance["'+d+'"].subChartInit("", "'+b[f].type+'", "'+_SL.htmlEscape(b[f].label)+'")'};break}return e}};return{config_param:w,component_title:x,load:y,refresh:E,subChartInit:D,goSearchPopup:K,showConfig:A,beforeSaveConfig:B,afterSaveConfig:C}};var goCollectView=function(a,b){var c=gCONTEXT_PATH+"monitoring/collect_info_view.html?&s_eqp_ip="+a+"&period="+b;window.open(c,"collectView"+(new Date).getTime())};_SL.nmspc("slapp.component").collect_status=function(a,b,c){var d=a,e=b,f=c,g="chart-inner-container-"+d,h=gCONTEXT_PATH+"component/collect_status.json",i=$("#chart-container-"+d),j=(i.find("#chart-inner-container-"+d),$("#config_"+d+" form")),k=j.find("[name=eqp_ip]"),l=j.find("[name=eqp_ip_list]"),m=j.find("[name=log_cate_cd]"),n=j.find("[name=chart_type]"),o=j.find("[name=last_period]"),p=(j.find("[name="+d+"_eqp_ip]"),j.find("[name="+d+"_eqp_ip_list]"),j.find("[name="+d+"_log_cate_cd]"),j.find("[name="+d+"_chart_type]"),j.find("[name="+d+"_last_period]"),{last_period:"30",col_opt:"equip",agent_ip:"",eqp_ip_list:"",log_cate_cd:"",chart_type:"A"}),q=function(a){a===!0?r(a):(this.title=f,this.config_param=e=$.extend({},p,e),s.dataSource.chart=$.extend(this.chartstyles,t),j.on("click",".btn-add",function(){var a=k.find(":selected").val(),b=k.find(":selected").text();return l.find("option").size()>10?void _alert("최대 10개까지만 선택가능합니다."):""==a?void _alert("장비를 선택하세요."):l.find("option").is(function(){return this.value==a})?void _alert("동일한 장비가 존재합니다."):void l.append(new Option(b,a))}).on("click",".btn-del",function(){l.find(":selected").remove()}),FusionCharts&&(FusionCharts.items[d+"_id"]=null,delete FusionCharts.items[d+"_id"]),k.chosen({search_contains:!0,width:"100%",max_selected_options:10}),r())},r=function(a){var b=e.eqp_ip_list.split(",");if(""!=e.eqp_ip_list&&b.length>0){var c,f=function(){var a=e.last_period,b=[];for(a;a>0;a--)c=_SL.formatDate.addMin(g,a*-1),b.push(_SL.formatDate(c,"MM-dd HH:mm"));var d=[],f=[];for(var h in b)d.push({label:b[h]}),f.push({value:0});s.dataSource.categories=[],s.dataSource.categories.push({category:d})},g=_SL.formatDate(),i=u[e.chart_type],j=$.extend({curDate:(new Date).getTime()},e),k=function(c){var g,h=[],j=e.last_period;f();for(var k in b){var l=[];g=b[k];var m=c[g];if(null!=m)for(var n in m)l.push({value:m[n].value,link:'javascript:goCollectView("'+g+'","'+j+'")'});else for(var n=0;n<j;n++)l.push({value:0,link:'javascript:goCollectView("'+g+'","'+j+'")'});h.push({seriesname:g,data:l})}s.dataSource.dataset=h,a===!0&&void 0!=$.Dashboard.chartInstance[d]?($.Dashboard.chartInstance[d].chartType(i),$.Dashboard.chartInstance[d].setJSONData(s.dataSource)):FusionCharts.ready(function(){$.Dashboard.chartInstance[d]=new FusionCharts(s).render()})};s.type=i,"msarea"==s.type&&(s.dataSource.chart.plotfillalpha="60"),f(),$("body").requestData(h,j,{callback:k})}else{var l=[];s.dataSource.categories=[],s.dataSource.dataset=[],s.dataSource.categories.push({category:l}),a===!0&&void 0!=$.Dashboard.chartInstance[d]?$.Dashboard.chartInstance[d].setJSONData(s.dataSource):FusionCharts.ready(function(){$.Dashboard.chartInstance[d]=new FusionCharts(s).render()})}},s={type:"msarea",renderAt:g,width:"100%",height:"200",dataFormat:"json",dataSource:{chart:t,categories:[],dataset:[]}},t={caption:"",subCaption:"",xAxisName:"",yAxisName:"",numberPrefix:"",showValues:"0"},u={A:"msarea",L:"msline",C:"mscolumn2d",S:"stackedcolumn2d"},v=function(){k.html('<option value="">[선택하세요]</option>'),l.empty();var a=e.eqp_ip_list,b=a.split(",");for(var c in EquipList){var d=EquipList[c];k.append('<option value="'+d.eqp_ip+'">'+d.eqp_nm+"["+d.eqp_ip+"]</option>");for(var c in b){var f=b[c];f==d.eqp_ip&&l.append('<option value="'+d.eqp_ip+'">'+d.eqp_nm+"["+d.eqp_ip+"]</option>")}}k.trigger("chosen:updated"),m.html('<option value="">[전체]</option>');for(var c in LogCategoryList){var g=LogCategoryList[c];m.append('<option value="'+g.code_id+'">'+g.code_name+"</option>")}m.val(e.log_cate_cd),n.val(e.chart_type),o.val(e.last_period)},w=function(){return""!=n.val()||(_alert("차트를 선택하세요."),!1)},x=function(){var a=$.map(l.find("option"),function(a,b){return a.value}),b=m.val(),c=n.val(),d=o.val();e.eqp_ip_list=a.join(","),e.log_cate_cd=b,e.chart_type=c,e.last_period=d},y=function(){r(!0)};return{containerId:d,config_param:e,component_title:f,load:q,refresh:r,showConfig:v,validateConfig:w,beforeSaveConfig:x,afterSaveConfig:y}},_SL.nmspc("slapp.component").eps_security_event=function(a,b,c){var d=a,e=($("#"+d+"_inner_container"),$("#componentbody_"+d)),f=$("#config_"+d+" form"),g=gCONTEXT_PATH+"component/eps_security_event_list.do",h=gCONTEXT_PATH+"event2/eps_ip_event_list.html",i={},j=$("#config_"+d+" .btn-apply"),k=b,l=c,m=function(){this.title=l,this.config_param=k=$.extend({},i,k),o()},n=function(){e.on("click",".goSmsView_"+d,function(){var a=$(this).attr("key").split(","),b=a[2],c=a[1],d=_SL.formatDate.addMin(a[3],1),e=_SL.formatDate.addMin(d,-30);q(urlPerformanceViewList+"?s_eqp_type_cd="+c+"&s_eqp_ip="+b+"&start_time="+e+"&end_time="+d)}),f.on("click",j,function(){k=$.extend({},_SL.serializeMap(f)),o(),_setTitle(),_setParam()}),e.find(".grid-table-group [class*=color_ec]").off().on("click",function(){var a=$(this),b=a.data("tc_type"),c=a.data("event_cate_cd"),d=a.data("count"),f=a.data("start_time"),g=a.data("end_time"),i=e.find("[name=epsSecurityEventForm]");i.find("[name=start_time]").val(f),i.find("[name=end_time]").val(g),i.find("[name=count]").val(d),i.find("[name=event_cate_cd]").val(c),i.find("[name=tc_type]").val(b);var j="epsSecurityEventWin_"+(new Date).getTime();i.attr({action:h,target:j,method:"post"}).submit()})},o=function(){var a=e.find(".grid-table-group tbody").empty(),b=e.find(".grid-table-group thead").empty(),c=function(c){var d=c.rsList,e=c.eventCates;b.append("<th scope='col'>구분</th>");for(var f in e)b.append("<th scope='col'><span>"+f+"단계</span><br>("+e[f]+")</th>");0==d.length&&a.append("<tr><td colspan='9' class='list-empty'> 검색 결과가 없습니다. </td></tr>");
for(var f in d){var g=d[f],h=$("<tr>"),i="";i="1"==g.tc_type?"Trigger":"Trace",h.append("<td>"+i+"</td>");for(var j in e){var k=g["cate"+j+"_cnt"],l=$("<td>");l.append(k),0!=k&&l.attr("tabindex","1").addClass("color_ec"+j).data({tc_type:g.tc_type,event_cate_cd:j,count:k,start_time:c.start_time,end_time:c.end_time}),l.appendTo(h)}h.appendTo(a)}n()};k=$.extend({},i,k),$("body").requestData(g,k,{callback:c})},p=function(){o()},q=function(a){new ModalPopup(a,{width:1e3,height:900,onClose:function(){p()}})};return{config_param:k,component_title:l,load:m,refresh:p}},_SL.nmspc("slapp.component").eps_security_risk=function(a,b,c,d){var e=a,f=$("#chart-container_"+e),g=($("#result-container_"+e),gCONTEXT_PATH+"component/eps_security_risk_chart.json"),h={curDate:(new Date).getTime()},i=b,j=function(){l.style.fill=this.chartstyles.bgColor,this.config_param=i=$.extend({},h,i),k()},k=function(){$("body").requestData(g,i,{callback:function(a){switch(a.RISK_LEVEL){case 1:l.colorScheme="scheme01";break;case 2:l.colorScheme="scheme02";break;case 3:l.colorScheme="scheme03";break;case 4:l.colorScheme="scheme07";break;case 5:l.colorScheme="scheme04"}f.jqxGauge(l),f.jqxGauge("setValue",20*a.RISK_LEVEL-10)}})},l={ranges:[{startValue:0,endValue:20,style:{fill:"#0099ff",stroke:"#0099ff"},startDistance:"5%",endDistance:"5%",endWidth:13,startWidth:13},{startValue:20,endValue:40,style:{fill:"#89cf43",stroke:"#89cf43"},startDistance:"5%",endDistance:"5%",endWidth:13,startWidth:13},{startValue:40,endValue:60,style:{fill:" #ffc000",stroke:" #ffc000"},startDistance:"5%",endDistance:"5%",endWidth:13,startWidth:13},{startValue:60,endValue:80,style:{fill:"#ff8400",stroke:"#ff8400"},startDistance:"5%",endDistance:"5%",endWidth:13,startWidth:13},{startValue:80,endValue:100,style:{fill:"#ff0000",stroke:"#ff0000"},startDistance:"5%",endDistance:"5%",endWidth:13,startWidth:13}],caption:{visible:!1},max:100,endAngle:180,startAngle:0,value:0,style:{"stroke-width":"0"},animationDuration:1500,colorScheme:"scheme05",labels:{visible:!0,position:"outside",interval:10,formatValue:function(a){var b="";switch(a){case 10:b="정상";break;case 30:b="관심";break;case 50:b="주의";break;case 70:b="경계";break;case 90:b="심각"}return b}},ticksDistance:"10%",ticksMinor:{visible:!1},ticksMajor:{visible:!1},border:{visible:!1}};return{config_param:i,load:j,refresh:k}},_SL.nmspc("slapp.component").interlock_status=function(a,b,c){var d=a,e=$("#componentbody_"+d),f=$("#config_"+d+" form"),g=e.find("[name=searchForm]"),h=f.find("[name=group_cd]"),i=f.find("[name=group_list]"),j=(gCONTEXT_PATH+"management/equip_stat_list.html",gCONTEXT_PATH+"sysdata/comcode_map.json"),k=(gCONTEXT_PATH+"component/urlCustInfo.json",gCONTEXT_PATH+"component/interlock_status_eqp.json"),l=gCONTEXT_PATH+"management/equip_stat_list.html",m={group_cd:""},n=b,o=c,p=function(){this.title=o,this.config_param=n=$.extend({},m,n),ComCodes.CS0011||$("body").requestData(j,{code_type:"CS0011"},{callback:function(a,b,c){ComCodes.CS0011=a}}),e.on("click",".eqp-stat,.eqp-col,.eqp-total",function(){var a="equipWin_"+(new Date).getTime();g.attr({action:l,target:a,method:"post"}).submit()}),f.on("click",".btn-add",function(){var a=h.find("option:selected").val(),b=h.find("option:selected").text();return""==a?void _alert("기관을 선택하세요."):i.find("option").is(function(){return this.value==a})?void _alert("동일한 기관이 존재합니다."):void i.append($("<option>").val(a).text(b))}).on("click",".btn-del",function(){i.find(":selected").remove()}),q()},q=function(){$("body").requestData(k,n,{callback:function(a){e.find(".eqp-stat").text(a.result.succ_cnt).hide().fadeIn(1500),e.find(".eqp-col").text(a.result.collect_succ_cnt).hide().fadeIn(1500),e.find(".eqp-total").text(a.result.eqp_cnt).hide().fadeIn(1500),u(a.group_cd_list.group_cd_list)}})},r=function(){var a=n?n.group_cd:[];i.empty();var b=a.split(",");for(var c in b){var d=b[c];null!=d&&""!=d&&i.append($("<option>").val(d).text(ComCodes.CS0011[d]))}},s=function(){for(var a=[],b=i.find("option"),c=0,d=b.length;c<d;c++)a.push(b.eq(c).val());n.group_cd=a.join(",")},t=function(){q()},u=function(a){h.html('<option value="">[선택하세요]</option>');for(var b in a)h.append($("<option>").val(b).text(a[b]))};return{config_param:n,component_title:o,load:p,refresh:q,beforeSaveConfig:s,afterSaveConfig:t,showConfig:r}},_SL.nmspc("component").my_group_log_search=function(a,b,c){var d=a,e=gCONTEXT_PATH+"monitoring/myfilter_list.json",f=gCONTEXT_PATH+"monitoring/myfilter_keywords.json",g=gCONTEXT_PATH+"component/my_group_log_search.json",i=gCONTEXT_PATH+"monitoring/log_search.html",j=b,k=j.component_nm?j.component_nm:c,l=!1,m={ok:"highlight-success",low:"highlight-attention",middle:"highlight-warning",high:"highlight-danger"},n={limit_period_min:_SL.ifNull(slapp.component.my_group_log_search.admin_config.limit_period_min,60),limit_row:_SL.ifNull(slapp.component.my_group_log_search.admin_config.limit_row,1e4),limit_chart_row:_SL.ifNull(slapp.component.my_group_log_search.admin_config.limit_chart_row,10)},o={component_nm:c,myFilterName:"",viewFields:["src_ip","dstn_ip","dstn_port"],searchRows:10,strQuery:"",limitRow:n.limit_row,limitMin:30,chart_yn:"N",chart_type:"msline",low:0,middle:0,high:0,delay:1},p={},q={tit:$("#componentcontainer_"+d+" .area-title"),body:$("#componentbody_"+d),chart:$("#chart_"+d),listTable:$("#list_table_"+d),form:$("#config_"+d+" form")},r={oChart:null},s=function(){if(H=$.extend(this.chartstyles,H),$.extend(p,o),q.form.find("[name=limitMin] option").each(function(){parseInt(this.value)>n.limit_period_min&&$(this).remove()}),q.listTable.find(".mylogdata-td").off("click").on("click",function(a){a.preventDefault()}),j?$.extend(p,j):this.config_param=j={},t(p.chart_type),p.myfilter_type){if("1"==p.myfilter_type)return void console.log("미지원 myfilter_type[1]!!!");var a=this;return void $("body").requestData(f,{myfilter_id:p.myfilter_id},{callback:function(b){return"1"==p.myfilter_type?void console.log("미지원 myfilter_type[1]!!!"):(b.keywords&&(p.strQuery=b.keywords,p.myFilterName=j.myfilter_name,b.view_fields&&(p.viewFields=b.view_fields.replace(",eqp_dt","").replace("eqp_dt,","").split(","),j.viewFields||(a.config_param.viewFields=j.viewFields=p.viewFields))),z(),u(),void v())}})}z(),u(),v()},t=function(a){"Y"==j.chart_yn&&(r.oChart?r.oChart.chartType(a):(q.chart.show(),FusionCharts.ready(function(){$.Dashboard.chartInstance[d]=r.oChart=new FusionCharts({renderAt:"chart_"+d,type:a,width:"100%",height:180,dataFormat:"json",dataSource:{chart:H,categories:[{category:[]}],dataset:[]}}).render(),r.oChart.setTransparent(!0)})))},u=function(){var a=1,b=p.limitMin,c=Math.min(b,360);b>60&&(a=b<360?b/60:360==b?5:10),p.periodUnit=a;var d=_SL.formatDate.addMin(gGetServerTime(),-p.delay),e=parseInt(d.substring(10,12),10)%a;0!=e&&(d=_SL.formatDate.addMin(d,a-e)),p.schEndTime=d,p.schStartTime=_SL.formatDate.addMin(d,-c)},v=function(a){if((p.component_nm||""==p.component_nm)&&q.tit.text(p.component_nm),!l)if(""==p.myFilterName||""==p.strQuery)A({});else{p.schEndTime<_SL.formatDate.addMin(gGetServerTime(),-p.delay)&&(p.schEndTime=_SL.formatDate.addMin(p.schEndTime,p.periodUnit),p.schStartTime<=_SL.formatDate.addMin(p.schEndTime,-p.limitMin)&&(p.schStartTime=_SL.formatDate.addMin(p.schStartTime,p.periodUnit)));var b={query:p.strQuery,pageRow:p.searchRows,limitMin:p.limitMin,chartYn:p.chart_yn,schStartTime:p.schStartTime,schEndTime:p.schEndTime,periodUnit:p.periodUnit,delay:p.delay,viewFields:p.viewFields.join(",")};$("body").requestData(g,b,{callback:function(a){p.limitMin=a.limit_min,p.limitRow=a.limit_row;var b=q.body.find(".sp-title h5"),c="["+_SL.formatDate(p.schStartTime,"yyyyMMddHHmm","MM-dd HH:mm");c+=" ~ ",c+=_SL.formatDate(p.schEndTime,"yyyyMMddHHmm","MM-dd HH:mm")+"]",q.body.find(".list_row").html(_SL.toComma(p.limitRow)),""==p.myFilterName&&(p.myFilterName="검색조건 없음"),b.html(p.myFilterName+" - "+c).attr("data-ui","tooltip").data("text","검색조건 : "+p.strQuery),A(a),"Y"==p.chart_yn?(q.chart.show(),C(a)):q.chart.hide(),slui.attach.tooltip("#componentcontainer_"+d)}})}},w=function(){this.isOpenConfig=l=!0;var a=j.myfilter_id;q.form.find("[name=component_nm]").val(p.component_nm),q.form.find("[name=limitMin]").val(p.limitMin),q.form.find("[name=searchRows]").val(p.searchRows),q.form.find("[name=low]").val(p.low),q.form.find("[name=middle]").val(p.middle),q.form.find("[name=high]").val(p.high),q.form.find("[name=chart_yn]:input[value="+p.chart_yn+"]").prop("checked",!0),q.form.find("[name=chart_type]:input[value="+p.chart_type+"]").prop("checked",!0),$("body").requestData(e,{},{callback:function(b){for(var c=q.form.find("[name=myFilterInfo]").html("<option value=''>[선택하세요]</option>"),d=0,e=b.length;d<e;d++)$("<option />").attr(a==b[d].myfilter_id?{selected:!0}:{}).val(JSON.stringify(b[d])).text(b[d].myfilter_name).appendTo(c)}}),(p.component_nm||""==p.component_nm)&&$("#config_"+d).find("h4").text(p.component_nm)},x=function(){var a,b;j.component_nm=q.form.find("[name=component_nm]").val(),j.limitMin=q.form.find("[name=limitMin]").val(),j.searchRows=q.form.find("[name=searchRows]").val(),j.low=q.form.find("[name=low]").val(),j.middle=q.form.find("[name=middle]").val(),j.high=q.form.find("[name=high]").val(),j.chart_yn=q.form.find("[name=chart_yn]:checked").val(),j.chart_type=q.form.find("[name=chart_type]:checked").val(),a=q.form.find("[name=myFilterInfo]").val(),""==a||null==a?(delete j.myfilter_id,delete j.myfilter_type,delete j.myfilter_name):""!=a&&(b=$.parseJSON(a),j.myfilter_id=b.myfilter_id,j.myfilter_type=b.myfilter_type,j.myfilter_name=b.myfilter_name),this.config_param=j},y=function(){this.isOpenConfig=l=!1,this.load()},z=function(){var a=(q.body.find(".sp_title"),q.listTable),b="";""==p.myFilterName&&(p.myFilterName="검색조건 없음"),p.schStartTime&&(b+=" - [",b+=_SL.formatDate(p.schStartTime,"yyyyMMddHHmm","yyyy-MM-dd HH:mm")+" ~ "+_SL.formatDate(p.schEndTime,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),b+="]");var c=j.viewFields?j.viewFields.join(","):"",d=p.viewFields?p.viewFields.join(","):"",e=a.find("thead"),f=a.find("tbody");if(c!=d&&(j.viewFields=p.viewFields,e.empty(),f.empty()),0==e.find("th").length){var g=$("<tr>").append("<th width='40'>번호</th>").append("<th width='60'>위험도</th>").append("<th>최근발생시간</th>");for(var h in p.viewFields)"eqp_dt"!=p.viewFields[h]&&g.append("<th>"+_SL.ifNull(LogCaptionInfo[p.viewFields[h]],p.viewFields[h])+"</th>");g.append("<th>건수</th>"),e.append(g)}0==f.find("td").length&&f.append('<tr><td colspan="'+p.viewFields.length+'4">검색중입니다...</td></tr>')},A=function(a){var b,c,d,e,f,g,i,j,k=_SL.ifNull(a.rsList,{}),l=_SL.ifNull(a.assetMap,{}),n=q.listTable,o=n.find("tbody").empty();if(k&&k.length>0){for(var r in k){b=k[r],i=b.group_by_count,f=$("<tr>").addClass("row-link"),f.append("<td class='mylogdata-td'>"+parseInt(r)+"1</td>"),j=B(i),f.append("<td class='mylogdata-td '"+m[j]+">"+j+"</td>"),g=$("<td>").addClass("mylogdata-td"),d=b.max_eqp_dt+"",e=_SL.formatDate(d,"yyyyMMddHHmm"),d=_SL.formatDate(d,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),g.attr("title",d).attr("data-value",e).append(d).appendTo(f);for(var s=0,t=p.viewFields.length;s<t;s++)if(c=p.viewFields[s],d=b[c]+"",g=$("<td class='mylogdata-td'>"),"eqp_dt"!=c){if(c.indexOf("ip")>-1&&"-"!=d){var u="* 자산정보",v=l[d];v?(u+="<br> - 자산명 : "+v.asset_nm,u+="<br> - 아이피 : "+v.sip+"~"+v.eip,u+="<br> - 직급 : "+_SL.ifNull(v.grade,""),u+="<br> - 본부 : "+_SL.ifNull(v.division,""),u+="<br> - 부서 : "+_SL.ifNull(v.department,""),u+="<br> - 관리자 : "+_SL.ifNull(v.manager,"")):u+="가 없습니다.",g.attr({"data-value2":d,"data-ui":"tooltip"}).data("text",u).append(d)}else if("recv_time"==c)g.attr("data-value2",d).append(_SL.formatDate(d,"yyyyMMddHHmmss","yyyy-MM-dd HH:mm:ss"));else if("dstn_country_code"==c||"src_country_code"==c){g.attr("data-value2",d);var w=c.matc;h(/^[^_]+_/);var x=b[w+"country_code"];x&&("PRN"==x?x="PR-N":"N/A"==b[w+"country_name"]&&(x="N-A"),g.append("<img src='/resources/images/flag/"+x+".png' style='margin-right:5px;'>")),g.append(d)}else g.attr("data-value2",d),d.length>55&&(g.attr("title",d),d=_SL.htmlEscape(d),d=d.substring(0,55)+"..."),g.append(d);f.append(g)}f.append("<td class='mylogdata-td'>"+_SL.toComma(i)+"</td>").appendTo(o).hide().fadeIn(1500)}}else f=$("<tr>").append("<td colspan='"+p.viewFields.length+"4'>검색 결과가 없습니다.</td>").appendTo(o).hide().fadeIn(1500)},B=function(a){var b=p.low,c=p.middle,d=p.high;return 0==b&&(b=a+1),0==c&&(c=a+1),0==d&&(d=a+1),a>=b&&a<c?"low":a>=c&&a<d?"middle":a>=d?"high":"ok"},C=function(a){for(var b=((new Date).getTime(),a.chartDataMap?a.chartDataMap:{}),c={chart:H,categories:[],dataset:[]},d=[],e=p.schStartTime,f=p.schEndTime,g=e;g<f;g=_SL.formatDate.addMin(g,p.periodUnit))d.push(_SL.formatDate(g,"MM-dd HH:mm"));var h,i,j,k,l,m=[],n=[],o={};for(var q in d)n.push({label:d[q]});for(var q in b){h=b[q],i=[],k=JSON.parse(q),j=h.length,o={};for(var s=0;s<j;s++)o[_SL.formatDate(h[s].eqp_dt,"MM-dd HH:mm")]=h[s];for(var t in d)l=D(o,d[t],k),i.push(l);m.push({seriesname:E(k),data:i})}m.sort(function(a,b){var c=parseInt(a.seriesname.split(" ")[0]),d=parseInt(b.seriesname.split(" ")[0]);return c==d?0:c>d?1:-1}),c.categories.push({category:n}),c.dataset=m,r.oChart.setChartData(c,"json")},D=function(a,b,c){var e={value:0},f=a[b];return f&&(e.link="JavaScript:$.Dashboard.componentInstance['"+d+"'].goLogSearchChart("+c.rank+",'"+f.eqp_dt+"')",e.value=f.group_by_count),e},E=function(a){return a.rank+" 순위"},F=function(a,b){var c=q.listTable.find("tbody tr:eq("+a+")"),d=_SL.formatDate.addMin(b,p.periodUnit);G(c,b,d)},G=function(a,b,c){var d,e,f,g=p.viewFields,h=[],j=[],k="("+p.strQuery+")",l=a.find("td");for(var m in g)e=parseInt(m),f=g[e],d=$.trim(l.eq(e+3).attr("data-value2")),"eqp_dt"!=f&&("-"==d||""==d?j.push(f+":*"):h.push(f+":"+_SL.luceneValueEscape(d)));k+=" AND "+h.join(" AND "),j.length>0&&(k+=" NOT "+j.join(" NOT ")),$("<form>").attr({target:"MyGrouplogSearchWin_"+(new Date).getTime(),action:i,method:"post"}).append($("<input type='hidden' name='start_time'>").val(_SL.ifNull(b,p.schStartTime))).append($("<input type='hidden' name='end_time'>").val(_SL.ifNull(c,p.schEndTime))).append($("<input type='hidden' name='expert_keyword'>").val(k)).append($("<input type='hidden' name='template_id'>").val("popup")).appendTo("body").submit().remove()},H={paletteColors:"89cf43,0099ff,ced2ff,9fa7ff,6dd0f7,dfbcfe,7dcbff,c07cfe,669933,dddddd",showValues:"0"};return{config_param:j,component_title:k,isOpenConfig:l,load:s,refresh:v,showConfig:w,beforeSaveConfig:x,afterSaveConfig:y,goLogSearchChart:F}},_SL.nmspc("slapp.component").my_log_search_count=function(a,b,c){var d=a,e=gCONTEXT_PATH+"monitoring/myfilter_list.json",f=gCONTEXT_PATH+"monitoring/myfilter_keywords.json",g=gCONTEXT_PATH+"monitoring/log_search_list.json",h=gCONTEXT_PATH+"monitoring/log_search.html",i={ok:"text-success",low:"text-attention",middle:"text-warning",high:"text-danger"},j=b,k=j.component_nm?j.component_nm:c,l={max_period_min:_SL.ifNull(1*slapp.component.my_log_search_count.admin_config.max_period_min,60)},m={component_nm:c,myfilter_name:"검색조건 : 없음",strQuery:"",searchPeriod:5,normal:0,low:0,middle:0,high:0,font_size:""},n={delay:1},o={tit:$("#componentheader_"+d+" .area-title"),body:$("#componentbody_"+d),form:$("#config_"+d+" form"),chtCntnr:$("#count-container_"+d)},p=function(){$("[name=searchPeriod] option",o.form).each(function(){this.value>l.max_period_min&&$(this).remove()}),$.extend(n,m,j),v(n.myfilter_id,n.myfilter_type,function(a){a.myfilter_id&&(n.strQuery=j.strQuery=a.strQuery),w(),q()}),o.chtCntnr.off("click").on("click",B)},q=function(){(j.component_nm||""==j.component_nm)&&o.tit.text(j.component_nm);var a=n.end_time=x(),b=n.start_time=_SL.formatDate.addMin(a,-n.searchPeriod),c={start_time:b,end_time:a,query:n.strQuery,search_type:"onlyCount"};z(),n.font_size?o.chtCntnr.css("font-size",n.font_size+"px"):o.chtCntnr.css("font-size",""),""!=n.strQuery&&$("body").requestData(g,c,{callback:function(a){A(a)}})},r=function(){var a=j.myfilter_id;o.form.find("[name=component_nm]").val(n.component_nm),o.form.find("[name=searchPeriod]").val(n.searchPeriod),o.form.find("[name=low]").val(n.low),o.form.find("[name=middle]").val(n.middle),o.form.find("[name=high]").val(n.high),o.form.find("[name=font_size]").val(n.font_size),$("body").requestData(e,{},{callback:function(b,c,e){var f=o.form.find("[name=myfilterInfo]");f.html('<option value="0">[선택하세요]</option>');for(var g=0,h=b.length;g<h;g++)$("<option>").attr(a==b[g].myfilter_id?{selected:!0}:{}).val(JSON.stringify(b[g])).text(b[g].myfilter_name).appendTo(f);slui.attach.setTransformSelect("#config_"+d+" form"),f.trigger("change")}}),(n.component_nm||""==n.component_nm)&&$("#config_"+d).find("h4").text(n.component_nm)},s=function(){return!!_SL.validate(o.form)},t=function(){for(var a,b=o.form.serializeArray(),c={},d=0;d<b.length;d++)c[b[d].name]=b[d].value;""!=c.myfilterInfo?(a=$.parseJSON(c.myfilterInfo),c.myfilter_id=a.myfilter_id,c.myfilter_type=a.myfilter_type,c.myfilter_name=a.myfilter_name):(c.myfilter_id="",c.myfilter_type="",c.myfilter_name=m.myfilter_name),delete c.myfilterInfo,this.config_param=j=c},u=function(){v(j.myfilter_id,j.myfilter_type,function(a){j.strQuery=a.strQuery,w(),q()})},v=function(a,b,c){var d={myfilter_id:"",myfilter_type:"",strQuery:""};a?$("body").requestData(f,{myfilter_id:a},{callback:function(e){e.view_fields&&$.extend(d,{myfilter_id:a,myfilter_type:b,viewFeidls:e.view_fields.split(",")}),d.strQuery=e.keywords,c(d)}}):c(d)},w=function(){$.extend(n,j);var a=x(),b=_SL.formatDate.addMin(a,-n.searchPeriod);n.start_time=b,n.end_time=a,y()},x=function(){return _SL.formatDate.addMin(gGetServerTime(),-n.delay)},y=function(){var a=o.body.find(".filter-detail h5"),b=n.myfilter_name,c=""==n.strQuery?"없음":n.strQuery;a.attr("data-ui","tooltip").data("text","검색조건 : "+c).html(b),z(),slui.attach.tooltip("#componentcontainer_"+d)},z=function(){var a=n.start_time,b=n.end_time;""!=n.strQuery?o.body.find(".rows-detail").text("["+_SL.formatDate(a,"HH:mm")+"~"+_SL.formatDate(b,"HH:mm")+"]"):o.body.find(".rows-detail").hide()},A=function(a){var b,c=j.low,d=j.middle,e=j.high,f=a.total;b=f<c?i.ok:f<d?i.low:f<e?i.middle:i.high,o.chtCntnr.removeClass().addClass(b).html(f)},B=function(){var a=n.strQuery,b=n.start_time,c=n.end_time,d=$("<form>").attr({target:"logSearchWin_"+(new Date).getTime(),action:h,method:"post"});d.append($("<input type='hidden' name='start_time'>").val(b)).append($("<input type='hidden' name='end_time'>").val(c)).append($("<input type='hidden' name='myfilter_id'>").val(j.myfilter_id)).append($("<input type='hidden' name='expert_keyword'>").val(a)).append($("<input type='hidden' name='template_id'>").val("popup")).appendTo("body").submit().remove()};return{config_param:j,component_title:k,load:p,refresh:q,beforeSaveConfig:t,validateConfig:s,afterSaveConfig:u,showConfig:r}},_SL.nmspc("component").my_log_search_event_ticker=function(a,b,c){var d=a,e=gCONTEXT_PATH+"component/my_log_search_event_ticker.json",f=gCONTEXT_PATH+"monitoring/myfilter_list.json",g=gCONTEXT_PATH+"monitoring/myfilter_keywords.json",h=gCONTEXT_PATH+"monitoring/log_search.html",i={ok:"highlight-success",low:"highlight-attention",middle:"highlight-warning",high:"highlight-danger"},j=b,k=j.component_nm?j.component_nm:c,l=!1,m={limit_period_min:_SL.ifNull(slapp.component.my_log_search_event_ticker.admin_config.limit_period_min,60),limit_row:_SL.ifNull(slapp.component.my_log_search_event_ticker.admin_config.limit_row,1e4)},n={isFirst:!0},o={component_nm:c,myFilterName:"",viewFields:["src_ip","dstn_ip","dstn_port"],searchRows:10,strQuery:"",limitRow:m.limit_row,limitMin:30,low:0,middle:0,high:0,delay:1},p={},q={tit:$("#componentheader_"+d+" .area-title"),body:$("#componentbody_"+d),listTable:$("#list_table_"+d),form:$("#config_"+d+" form")},r=function(){if($.extend(p,o),n.isFirst&&(q.form.find("[name=limitMin] option").each(function(){parseInt(this.value)>m.limit_period_min&&$(this).remove()}),q.form.find(".list_row").text(_SL.toComma(p.limitRow)),n.isFirst=!1),q.listTable.off("click").on("click",".mylogdata-td",function(a){a.preventDefault(),A($(this).parent())}),j){if($.extend(p,j),j.myfilter_type)return"1"==j.myfilter_type?void console.log("미지원 myfilter_type[1]!!!"):void $("body").requestData(g,{myfilter_id:p.myfilter_id},{callback:function(a){p.strQuery=a.keywords,p.myFilterName=j.myfilter_name,a.view_fields&&(p.viewFields=a.view_fields.replace(",eqp_dt","").replace("eqp_dt,","").split(","),j.viewFields||(that.config_param.viewFields=j.viewFields=p.viewFields)),x(),s(),t()}})}else this.config_param=j={};x(),s(),t()},s=function(){var a=1,b=p.limitMin,c=Math.min(b,360);p.periodUnit=a;var d=_SL.formatDate.addMin(gGetServerTime(),-p.delay),e=parseInt(d.substring(10,12),10)%a;0!=e&&(d=_SL.formatDate.addMin(d,a-e)),p.schEndTime=d,p.schStartTime=_SL.formatDate.addMin(d,-c)},t=function(){if((j.component_nm||""==j.component_nm)&&q.tit.text(j.component_nm),!l)if(""==p.myFilterName||""==p.strQuery)y({});else{p.schEndTime<_SL.formatDate.addMin(gGetServerTime(),-p.delay)&&(p.schEndTime=_SL.formatDate.addMin(p.schEndTime,p.periodUnit),p.schStartTime<=_SL.formatDate.addMin(p.schEndTime,-p.limitMin)&&(p.schStartTime=_SL.formatDate.addMin(p.schStartTime,p.periodUnit)));var a={query:p.strQuery,pageRow:p.searchRows,limitMin:p.limitMin,schStartTime:p.schStartTime,schEndTime:p.schEndTime,periodUnit:p.periodUnit,delay:p.delay,viewFields:p.viewFields.join(",")};$("body").requestData(e,a,{callback:function(a){p.limitMin=a.limit_min,p.limitRow=a.limit_row;var b=q.body.find(".sp-title h5");q.body.find(".list_row").html(_SL.toComma(p.limitRow));var c="["+_SL.formatDate(p.schStartTime,"yyyyMMddHHmm","MM-dd HH:mm");c+=" ~ ",c+=_SL.formatDate(p.schEndTime,"yyyyMMddHHmm","MM-dd HH:mm")+"]",""==p.myFilterName&&(p.myFilterName="검색조건 없음"),b.html(p.myFilterName+" - "+c).attr("data-ui","tooltip").data("text","검색조건 : "+p.strQuery),y(a)}})}},u=function(){this.isOpenConfig=l=!0;var a=j.myfilter_id;q.form.find("[name=component_nm]").val(p.component_nm),q.form.find("[name=limitMin]").val(p.limitMin),q.form.find("[name=searchRows]").val(p.searchRows),q.form.find("[name=low]").val(p.low),q.form.find("[name=middle]").val(p.middle),q.form.find("[name=high]").val(p.high),$("body").requestData(f,{},{callback:function(b){for(var c=q.form.find("[name=myFilterInfo]").html('<option value="">[선택하세요]</option>'),d=0,e=b.length;d<e;d++)$("<option />").attr(a==b[d].myfilter_id?{selected:!0}:{}).val(JSON.stringify(b[d])).text(b[d].myfilter_name).appendTo(c)}}),(p.component_nm||""==p.component_nm)&&$("#config_"+d+" h4").text(p.component_nm)},v=function(){var a,b;j.component_nm=q.form.find("[name=component_nm]").val(),j.limitMin=q.form.find("[name=limitMin]").val(),j.searchRows=q.form.find("[name=searchRows]").val(),j.low=q.form.find("[name=low]").val(),j.middle=q.form.find("[name=middle]").val(),j.high=q.form.find("[name=high]").val(),a=q.form.find("[name=myFilterInfo]").val(),""==a||null==a?(delete j.myfilter_id,delete j.myfilter_type,delete j.myfilter_name):""!=a&&(b=$.parseJSON(a),j.myfilter_id=b.myfilter_id,j.myfilter_type=b.myfilter_type,j.myfilter_name=b.myfilter_name),this.config_param=j},w=function(){this.isOpenConfig=l=!1,this.load()},x=function(){var a,b=(q.body.find(".sp_title"),q.listTable),c="";""==p.myFilterName&&(p.myFilterName="검색조건 없음"),p.schStartTime&&(c+=" - [",c+=_SL.formatDate(p.schStartTime,"yyyyMMddHHmm","yyyy-MM-dd HH:mm")+" ~ "+_SL.formatDate(p.schEndTime,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),c+="]");var d=j.viewFields?j.viewFields.join(","):"",e=p.viewFields?p.viewFields.join(","):"",f=b.find("thead"),g=b.find("tbody");if(d!=e&&(j.viewFields=p.viewFields,f.empty(),g.empty()),0==f.find("th").length){var a=$("<tr>").append("<th>번호</th>").append("<th>위험도</th>").append("<th>최근발생시간</th>");for(var h in p.viewFields)"eqp_dt"!=p.viewFields[h]&&a.append("<th>"+_SL.ifNull(LogCaptionInfo[p.viewFields[h]],p.viewFields[h])+"</th>");a.append("<th>건수</th>"),f.append(a)}0==g.find("td").length&&g.append('<tr><td colspan="'+p.viewFields.length+'4">검색중입니다...</td></tr>')},y=function(a){var b,c,e,f,g,h,j,k,l,m=_SL.ifNull(a.rsList,{}),n=_SL.ifNull(a.assetMap,{}),o=q.listTable,r=o.find("tbody").empty();if(m&&m.length>0){for(var s in m){b=m[s],j=b.group_by_count,g=$("<tr>"),k=parseInt(s)+1,g.append("<td class='mylogdata-td'>"+k+"</td>"),l=z(j),g.append("<td class='mylogdata-td '"+i[l]+">"+l+"</td>"),g.addClass("row-link"),h=$("<td>"),e=b.max_eqp_dt+"",f=_SL.formatDate(e,"yyyyMMddHHmm"),e=_SL.formatDate(e,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),h.attr("title",e).attr("data-value",f).append(e).appendTo(g);for(var t in p.viewFields)if(c=p.viewFields[t],e=b[c]+"",h=$("<td class='mylogdata-td'>"),"eqp_dt"!=c){if(c.indexOf("ip")>-1&&"-"!=e){var u="* 자산정보",v=n[e];v?(u+="<br> - 자산명 : "+v.asset_nm,u+="<br> - 아이피 : "+v.sip+"~"+v.eip,u+="<br> - 직급 : "+_SL.ifNull(v.grade,""),u+="<br> - 본부 : "+_SL.ifNull(v.division,""),u+="<br> - 부서 : "+_SL.ifNull(v.department,""),u+="<br> - 관리자 : "+_SL.ifNull(v.manager,"")):u+="가 없습니다.",h.attr({"data-value2":e,"data-ui":"tooltip"}).data("text",u).append(e)}else"recv_time"==c?(h.attr("data-value2",e),e=_SL.formatDate(e,"yyyyMMddHHmmss","yyyy-MM-dd HH:mm:ss"),h.append(e)):"dstn_country_code"==c||"src_country_code"==c?(h.attr("aria-value2",e),prefix=c.match(/^[^_]+_/),flagCode=b[prefix+"country_code"],flagCode&&("PRN"==flagCode?flagCode="PR-N":"N/A"==b[prefix+"country_name"]&&(flagCode="N-A"),h.append("<img src='/resources/images/flag/"+flagCode+".png' style='margin-right:5px;'>")),h.append(e)):(h.attr("data-value2",e),e.length>55&&(h.attr("title",e),e=_SL.htmlEscape(e),e=e.substring(0,55)+"..."),h.append(e));g.append(h)}g.append("<td class='mylogdata-td'>"+_SL.toComma(j)+"</td>").appendTo(r).hide().fadeIn(1500)}}else g=$("<tr height=25>").append("<td colspan='"+p.viewFields.length+"4'>검색 결과가 없습니다.</td>").appendTo(r).hide().fadeIn(1500);slui.attach.tooltip("#componentcontainer_"+d)},z=function(a){var b=p.low,c=p.middle,d=p.high;return 0==b&&(b=a+1),0==c&&(c=a+1),0==d&&(d=a+1),a>=b&&a<c?"low":a>=c&&a<d?"middle":a>=d?"high":"ok"},A=function(a){var b,c,d,e=p.viewFields,f=[],g=[],i="("+p.strQuery+")",j=a.find("td");for(var k in e)c=parseInt(k),d=e[c],b=$.trim(j.eq(c+3).attr("data-value2")),"eqp_dt"!=d&&("-"==b||""==b?g.push(d+":*"):f.push(d+":"+_SL.luceneValueEscape(b)));i+=" AND "+f.join(" AND "),g.length>0&&(i+=" NOT "+g.join(" NOT ")),$("<form>").attr({target:"MyLogSearchTickerWin_"+(new Date).getTime(),action:h,method:"post"}).append($("<input type='hidden' name='start_time'>").val(p.schStartTime)).append($("<input type='hidden' name='end_time'>").val(p.schEndTime)).append($("<input type='hidden' name='expert_keyword'>").val(i)).append($("<input type='hidden' name='template_id'>").val("popup")).appendTo("body").submit().remove()};return{config_param:j,component_title:k,isOpenConfig:l,load:r,refresh:t,showConfig:u,beforeSaveConfig:v,afterSaveConfig:w,goLogSearch:A}},_SL.nmspc("component").my_log_search=function(a,b,c){var d=a,e=gCONTEXT_PATH+"monitoring/myfilter_list.json",f=gCONTEXT_PATH+"monitoring/myfilter_keywords.json",g=gCONTEXT_PATH+"monitoring/log_search_list.json",h=gCONTEXT_PATH+"component/my_log_search_chart.json",i=gCONTEXT_PATH+"monitoring/log_search.html",j=b,k=j.component_nm?j.component_nm:c,l=!1,m={max_stats_row:_SL.ifNull(1*slapp.component.my_log_search.admin_config.max_stats_row,1e4),max_period_min:_SL.ifNull(1*slapp.component.my_log_search.admin_config.max_period_min,60)},n={component_nm:c,myfilter_name:"검색조건 없음",viewFields:["eqp_dt","src_ip","dstn_ip","dstn_port","eqp_ip"],chart_yn:"N",list_yn:"Y",strQuery:"",searchPeriod:5,searchRows:5,viewRows:20,scroll_size:180,series_field:"",series_vals:[],series_val_etc:"N",stats_func:"count",stats_field:"",chart_type:"stackedcolumn2d"},o={rowsPerOut:250,intervalPerReq:200,intervalPerOut:20,delay:1,cycle:1,chartPeriod:1},p={tit:$("#componentheader_"+d+" .area-title"),body:$("#componentbody_"+d),chart:$("#chart_"+d),logTable:$("#log_table_"+d),form:$("#config_"+d+" form")},q={oChart:null},r={chartInfo:[]},s={searchParam:[],request:[],response:[],curResponse:null,appendTo:{},buffers:[],groupSearchParam:[]},t={initMode:{load:0,config:1},flagFields:{src_country_name:1,src_country_code:1,dstn_country_name:1,dstn_country_code:1},overLengthSuffix:"@@OverLength",reOverLengthSuffix:new RegExp("@@OverLength$"),alignCenterFieldRegExp:/.+_(dt|ip|port|prtc)$/},u={configMode:0,proc_idx:0,reqTimerId:0,outTimerId:0,curViewRowCnt:0};gDFD.fldToCodes.ready();var v=function(){$("[name=searchPeriod] option",p.form).each(function(){this.value>m.max_period_min&&$(this).remove()}),oa=$.extend(this.chartstyles,oa),p.logTable.off("click").on("click",".mylogdata-td",ka),p.form.on("change","[name=myfilterInfo]",ca).on("change","[name=stats_func]",ga).on("change","[name=series_field]",fa).on("click","[name=list_yn]",ha).on("click","[name=chart_yn]",ha).on("click",".btn-series-add",ia).on("click",".btn-series-del",ja),$.extend(o,n,j),B(o.myfilter_id,o.myfilter_type,function(a){a.myfilter_id&&(o.viewFields=j.viewFields=a.viewFields,o.strQuery=j.strQuery=a.strQuery),C(!0,!0),w()})},w=function(){(j.component_nm||""==j.component_nm)&&p.tit.text(j.component_nm);var a;_SL.isEmpty(o.strQuery)||("Y"==o.list_yn&&(0==s.schTime.length&&s.schTime.push({schStartTime:I(),schEndTime:H()}),L()),"Y"==o.chart_yn&&(0==s.groupSchTime.length&&(a=E(I()),s.groupSchTime.push({schStartTime:a,schEndTime:_SL.formatDate.addMin(a,o.chartPeriod)})),M()))},x=function(){this.isOpenConfig=l=!0;var a=j.myfilter_id;if(p.form.find("[name=component_nm]").val(o.component_nm),p.form.find("[name=list_yn]").each(function(){$(this).removeClass("selected"),this.value==o.list_yn&&$(this).addClass("selected")}),p.form.find("[name=searchPeriod]").val(o.searchPeriod),p.form.find("[name=searchRows]").val(o.searchRows),p.form.find("[name=viewRows]").val(o.viewRows),p.form.find("[name=scroll_size]").val(o.scroll_size),p.form.find("[name=chart_yn]").each(function(){$(this).removeClass("selected"),this.value==o.chart_yn&&$(this).addClass("selected")}),p.form.find("[name=stats_func]").val(o.stats_func).trigger("change"),p.form.find("[name=series_field]").val(o.series_field).trigger("change"),o.series_vals){var b=p.form.find("[name=series_vals]");b.empty();for(var c=0;c<o.series_vals.length;c++)b.append(new Option(o.series_vals[c],o.series_vals[c]))}p.form.find("[name=series_val_etc]")["Y"==o.series_val_etc?0:1].checked=!0,p.form.find("[name=chart_type]").val(o.chart_type),$("body").requestData(e,{},{callback:function(b,c,d){var e=p.form.find("[name=myfilterInfo]");e.empty().append(new Option("[선택하세요]",""));for(var f=0,g=b.length;f<g;f++)$("<option>").attr(a==b[f].myfilter_id?{selected:!0}:{}).val(JSON.stringify(b[f])).text(b[f].myfilter_name).appendTo(e);e.trigger("change")}}),(o.component_nm||""==o.component_nm)&&$("#config_"+d).find("h4").text(o.component_nm)},y=function(){if(_SL.validate(p.form)){var a=parseInt(p.form.find("[name=searchRows]").val()),b=parseInt(p.form.find("[name=viewRows]").val()),c=p.form.find("[name=list_yn].selected").val(),d=p.form.find("[name=chart_yn].selected").val(),e=p.form.find("[name=stats_func]").val(),f=p.form.find("[name=stats_field]").val(),g=p.form.find("[name=series_field]").val();p.form.find("[name=series_vals]").val();if("Y"!=c&&"Y"!=d)return _alert("목록 또는 차트중 하나는 표시해야 합니다."),!1;if("Y"==c&&a>b)return _alert("표시 건수가 건수/분 보다 커야 합니다.",{onAgree:function(){p.form.find("[name=viewRows]").focus()}}),!1;if("Y"==d&&"count"!=e&&""==f)return _alert("통계값 필드를 선택하세요."),!1;if(""==g)p.form.find("[name=series_vals] option").remove();else if(0==p.form.find("[name=series_vals] option").length)return _alert("범례 항목을 입력하세요."),!1;return!0}},z=function(){var a;p.form.find("[name=series_vals] option").prop("selected",!0);for(var b=p.form.serializeArray(),c={},d=0;d<b.length;d++)"series_vals"==b[d].name?(c[b[d].name]||(c[b[d].name]=[]),c[b[d].name].push(b[d].value)):c[b[d].name]=b[d].value;""!=c.myfilterInfo?(a=$.parseJSON(c.myfilterInfo),c.myfilter_id=a.myfilter_id,c.myfilter_type=a.myfilter_type,c.myfilter_name=a.myfilter_name):(c.myfilter_id="",
c.myfilter_type="",c.myfilter_name=n.myfilter_name),c.list_yn=p.form.find("[name=list_yn].selected").val(),c.chart_yn=p.form.find("[name=chart_yn].selected").val(),delete c.myfilterInfo,this.config_param=j=c},A=function(){this.isOpenConfig=l=!1;var a=W(o,j,["myfilter_id"]),b=!1,c=!1;a?(b=!0,c=!0):(b=W(o,j,["stats_func","stats_field","series_field","series_vals"]),0!=b||o.searchPeriod==j.searchPeriod||parseInt(o.searchPeriod)>parseInt(j.searchPeriod)&&parseInt(o.searchPeriod)<=60||(b=!0)),B(j.myfilter_id,j.myfilter_type,function(a){j.viewFields=a.viewFields,j.strQuery=a.strQuery,C(c,b),w()})},B=function(a,b,c){var d={myfilter_id:"",myfilter_type:"",strQuery:"",viewFields:n.viewFields};a?$("body").requestData(f,{myfilter_id:a},{callback:function(e){e.view_fields&&$.extend(d,{myfilter_id:a,myfilter_type:b,viewFeidls:e.view_fields.split(",")}),"1"==b||"2"==b&&(d.strQuery=e.keywords),c(d)}}):c(d)},C=function(a,b){$.extend(o,j);var c=H(),d=_SL.formatDate.addMin(c,-o.searchPeriod);if(a&&(s.schTime=[],s.request=[],s.response=[],s.last_end_time=null,s.curResponse=null,s.appendTo={},s.buffers=[],u.proc_idx=0,u.outTimerId=0,u.reqTimerId=0,u.curViewRowCnt=0,J(),s.schTime.push({schStartTime:d,schEndTime:c})),b){s.groupSchTime=[],r.chartInfo=[],D();var e=o.searchPeriod;d=E(d,!0),e>360&&(e=360,d=_SL.formatDate.addMin(d,o.searchPeriod-e));for(var f=0;f<e;f+=o.chartPeriod)c=_SL.formatDate.addMin(d,o.chartPeriod),s.groupSchTime.push({schStartTime:d,schEndTime:c}),d=c;Z({})}F()},D=function(){var a=1;o.searchPeriod>60&&(a=o.searchPeriod<360?o.searchPeriod/60:360==o.searchPeriod?5:10),o.chartPeriod=a},E=function(a,b){var c=parseInt(a.substring(10,12),10)%o.chartPeriod;return 0!=c&&(a=_SL.formatDate.addMin(a,(b?o.chartPeriod:0)-c)),a},F=function(){var a=p.body.find(".filter-detail h5"),b=o.myfilter_name;a.attr("data-ui","tooltip").data("text","검색조건 : "+o.strQuery),"Y"==o.chart_yn?(b+=" - ["+o.stats_func.toUpperCase()+(""==o.stats_field?"":"("+V(o.stats_field)+")")+"]",G(o.chart_type),p.chart.show()):(r.chartInfo=[],p.chart.hide()),a.html(b),"Y"==o.list_yn?(p.logTable.show(),$(".rows-detail",p.body).text(""),$(".rows-detail",p.body).show(),K()):($(".rows-detail",p.body).hide(),p.logTable.hide()),slui.attach.tooltip("#componentcontainer_"+d)},G=function(a){var b=q.oChart;b?b.chartType(a):FusionCharts.ready(function(){$.Dashboard.chartInstance[d]=q.oChart=new FusionCharts({type:a,renderAt:"chart_"+d,width:"100%",height:180,dataFormat:"json",dataSource:{chart:oa,categories:[{category:[]}],dataset:[]}}).render()})},H=function(){return _SL.formatDate.addMin(gGetServerTime(),-o.delay)},I=function(){return _SL.formatDate.addMin(H(),-o.cycle)},J=function(){o.searchPeriod<5&&(o.searchPeriod=5);var a,b;p.logTable.empty();var b=$("<tr></tr>");for(var c in o.viewFields)a=a?" width="+a:"",b.append("<th"+a+" scope='col'>"+V(o.viewFields[c])+"</th>");p.logTable.append($("<thead>").append(b)),b=$("<tr height=25></tr>"),$("<td style='cursor:default'>검색 결과가 없습니다.</td>").attr({colspan:o.viewFields.length}).appendTo(b),p.logTable.append($("<tbody tabindex='1' style='cursor:pointer'>").append(b))},K=function(){},L=function(){var a=s.schTime.shift();$.when(gDFD.fldToCodes,N(a.schStartTime,a.schEndTime,0))},M=function(){var a=s.groupSchTime.shift();if(a){var b={start_time:a.schStartTime,end_time:a.schEndTime,query:o.strQuery,stats_func:o.stats_func,stats_field:o.stats_field,series_field:o.series_field,series_vals:o.series_vals||[],nocache:"N"};a.schEndTime>H()&&(b.nocache="Y"),$("body").requestData(h,b,{callback:function(a){X(b.start_time,a),s.groupSchTime.length>0&&M()}})}},N=function(a,b,c,d){var e=++u.proc_idx+"",f=o.searchRows;0==c&&_SL.formatDate.diff(a,b)>6e4&&(f=o.viewRows),s.request.push({proc_idx:e,start_time:a,end_time:b,query:o.strQuery,pageRow:f,startIndex:c,sort_by_field_name:"eqp_dt",sort_by_order:"desc"}),s.appendTo[e]=d,0==u.reqTimerId&&O()},O=function(){$("body").requestData(g,s.request.shift(),{callback:function(a){s.response.push(a),P(),s.request.length>0?u.reqTimerId=setTimeout(L,o.intervalPerReq):u.reqTimerId=0}})},P=function(){s.response.length&&!s.curResponse&&(u.outTimerId=setTimeout(Q,30))},Q=function(){var a=s.response.shift();a&&(s.curResponse={proc_idx:a.proc_idx,start_time:a.start_time,end_time:a.end_time,startIndex:a.startIndex,rows:a.rsList.length,total:a.total},!s.last_end_time||s.last_end_time<a.end_time?s.last_end_time=a.end_time:s.last_end_time==a.end_time&&0==a.startIndex&&R(),u.curTotal=a.total,u.curRows=a.rsList.length,0==u.curViewRowCnt&&U(1),s.buffers=a.rsList,p.logTable.find("tr.no1").removeClass("no1"),S())},R=function(){var a,b=s.curResponse;b&&(a=s.appendTo[b.proc_idx],a&&(s.appendTo[b.proc_idx]=null,delete s.appendTo[b.proc_idx]),s.curResponse=null)},S=function(){var a,b,c,d=((new Date).getTime(),s.curResponse);if(d){var e=d.proc_idx,f=s.appendTo[e],g=!0;if(_SL.formatDate.diff(d.start_time,d.end_time)>6e4&&(g=!1),f){if(!f.parent().length)return R(),void P();f.hasClass("mylogdata-more")?(f=f.prev(),s.appendTo[e].remove(),s.appendTo[e]=f):console.log("Don't have 'mylogdata-more' Class")}else $(".rows-detail",p.body).text("["+_SL.formatDate(d.start_time,"HH:mm")+(g?"":"~"+_SL.formatDate(d.end_time,"HH:mm"))+" - "+_SL.toComma(d.total)+" Rows]");g&&s.buffers.length==d.rows&&d.startIndex+d.rows<d.total&&(b=$("<tr class='mylogdata-more no1'>").append($("<td class='mylogdata-td mylogdata-more'>").text("["+_SL.formatDate(d.start_time,"HH:mm")+"] More "+_SL.toComma(d.total-d.startIndex-d.rows)+" Rows...").attr({valign:"middle",colspan:o.viewFields.length}).data("response",d)),f?f.after(b):p.logTable.find("tbody").prepend(b));var h=Math.min(o.rowsPerOut,s.buffers.length),i=s.buffers.splice(s.buffers.length-h,h),j=o.viewFields,k=j.length;if(i&&i.length>0){for(var l=document.createDocumentFragment(),m=document.createDocumentFragment(),n=0;n<i.length;n++){a=i[n],b=document.createElement("tr"),b.className="no1",b.setAttribute("aria-value",a.eqp_dt);for(var q=0;q<k;q++)c=document.createElement("td"),T(c,a,j[q],a[j[q]]||""),m.appendChild(c);l.appendChild(b),b.appendChild(m)}f?f.after(l):p.logTable.find("tbody").prepend(l),u.curViewRowCnt+=i.length;var r=u.curViewRowCnt-o.viewRows;if(r>0&&(U(r),u.curViewRowCnt-=r),s.buffers.length>0)return void(u.outTimerId=setTimeout(S,o.intervalPerOut))}else 0==u.curViewRowCnt&&(b=$("<tr></tr>"),$("<td>검색 결과가 없습니다.</td>").attr({valign:"middle",colspan:k}).appendTo(b),b.appendTo(p.logTable.find("tbody")));R(),P()}},T=function(a,b,c,d){var e,f;a.className="mylogdata-td",a.setAttribute("aria-value",d),"eqp_dt"==c||"recv_time"==c?(d=_SL.formatDate(d,"yyyyMMddHHmmss","yyyy-MM-dd HH:mm:ss"),a.setAttribute("title",d),d=d.substring(11)):"src_ip"==c||"dstn_ip"==c||(t.flagFields[c]?(f=c.match(/^[^_]+_/),e=b[f+"country_code"],e&&("PRN"==e?e="PR-N":"N/A"==b[f+"country_name"]&&(e="N-A"),a.appendChild($("<img src='"+gCONTEXT_PATH+"resources/images/flag/"+e+".png' style='margin-right:5px;'/>")[0]))):(gDFD.fldToCodes.data[c]&&gDFD.fldToCodes.data[c][d]&&(d=gDFD.fldToCodes.data[c][d]+"["+d+"]"),t.reOverLengthSuffix.test(d)&&(d=d.replace(t.overLengthSuffix,"")),d.length>55&&a.setAttribute("title",d),t.alignCenterFieldRegExp.test(c)||(a.className+=" align_left"))),a.appendChild(document.createTextNode(d))},U=function(a){for(var b,c=(new Date).getTime(),d=p.logTable[0],e=document.createDocumentFragment(),f=d.rows.length,g=1;g<=a;g++)b=d.rows[f-g],b.className.indexOf("mylogdata-more")!=-1&&a++,e.appendChild(b);$(e).remove(),e=null,c=(new Date).getTime()-c},V=function(a){return LogCaptionInfo[a]||a},W=function(a,b,c){for(var d=!1,e=0;e<c.length;e++){if((a[c[e]]||"")!=(b[c[e]]||""))if($.isArray(a[c[e]])&&$.isArray(b[c[e]])&&a[c[e]].length==b[c[e]].length){for(var f=0;f<a[c[e]].length;f++)if((a[c[e]][f]||"")!=(b[c[e]][f]||"")){d=!0;break}}else d=!0;if(d)break}return d},X=function(a,b){var c,d=r.chartInfo,e={};c=0==d.length?{}:d[d.length-1],c.start_time==a?c.rsList=b:d.push({start_time:a,rsList:b});for(var f=o.searchPeriod/o.chartPeriod;d.length>f;)c=d.shift(0,1);0==s.groupSchTime.length&&(e=Y(d),e.chart=oa,Z(e))},Y=function(a){a||(a=[]);var b,c="start_time",d="",e={},f={},g={},h=[];e={categories:[{category:[]}],dataset:[]},_()&&(d=o.series_field),b=a.length;var i,j,k,l,m,n;n="count"==o.stats_func&&""==d?"total":"func_value";for(var p=0;p<b;p++){i=a[p],i.rsList||(i.rsList=[]),j={},l=i[c],j.value=l,j.label=ba(l,c,!0),j.toolText=ba(l,c);for(var q=0;q<i.rsList.length;q++){if(k=i.rsList[q],m="",""==d)l="[전체]";else if(m=l=k[d],"_etc"==l){if("Y"!=o.series_val_etc)continue;l="[기타]"}else l=ba(l,d);f[l]||(f[l]=[]),"undefined"==typeof g[j.value]&&(g[j.value]=h.length,h.push({label:j.label,toolText:j.toolText})),f[l][g[j.value]]={value:k[n],link:aa(j.value,d,m)}}}e.categories=[{category:h}];for(var r in f)e.dataset.push({seriesname:r,data:f[r]});return e},Z=function(a){var b=q.oChart;b&&b.setChartData(a,"json")},_=function(){return o.series_field&&""!=o.series_field&&o.series_vals&&o.series_vals.length>0},aa=function(a,b,c){var e="javascript:$.Dashboard.componentInstance['"+d+"'].goLogSearch('"+a+"'";return""!=b&&(e+=",'"+b+"','"+_SL.javascriptEscape(c)+"'"),e+=")"},ba=function(a,b,c){var d,e=c?"":"yyyy-MM-dd";return"start_time"==b?d=_SL.formatDate(a,"yyyyMMddHHmm",e+" HH:mm"):"total"==b||"func_value"==b?d=_SL.toComma(a):(d=a,gDFD.fldToCodes.data[b]&&gDFD.fldToCodes.data[b][a]&&(pFldVal=gDFD.fldToCodes.data[b][a]+"["+a+"]")),d},ca=function(a){var b=$(a.target).val(),c={};""==b?(c.myfilter_id="",c.myfilter_type="",c.myfilter_name=""):c=$.parseJSON(b),B(c.myfilter_id,c.myfilter_type,function(a){da(a.viewFields,o.stats_field),ea(a.viewFields,o.series_field)})},da=function(a,b){var c=p.form.find("[name=stats_field]");c.empty().append($("<option/>").val("").text("[필드 선택]"));for(var d=0;d<a.length;d++)$("<option />").attr("selected",b==a[d]).val(a[d]).text(V(a[d])).appendTo(c)},ea=function(a,b){var c=p.form.find("[name=series_field]");c.empty().append($("<option/>").val("").text("[미지정]"));for(var d=0;d<a.length;d++)$("<option />").attr("selected",b==a[d]).val(a[d]).text(V(a[d])).appendTo(c)},fa=function(a){var b=$(a.target).val(),c=p.body.find(".area-series-val");""==b?c.hide():c.show()},ga=function(a){var b=$(a.target).val(),c=p.form.find("[name=stats_field]");"count"==b?c.hide():c.show()},ha=function(a){var b=$(a.target).val();p.form.find("[name="+a.target.name+"]").each(function(){$(this).removeClass("selected"),this.value==b&&$(this).addClass("selected")})},ia=function(a){var b=p.form.find("[name=t_inp_val]"),c=p.form.find("[name=series_vals]"),d=b.val(),e=c.find("option");if(""==d)return void _alert("범례 항목에 추가할 값을 입력하세요.");for(var f=0;f<e.length;f++)if(e.eq(f).val()==d)return void _alert("중복된 값이 존재합니다.");c.append($("<option>").val(d).text(d)),b.val(""),b.focus()},ja=function(a){p.form.find("[name=series_vals] option:selected").remove()},ka=function(a){$(a.target).hasClass("mylogdata-more")?la(a):ma(a)},la=function(a){var b=$(a.target).data("response"),c=_SL.formatDate.addMin(b.start_time,o.cycle);N(b.start_time,c,b.startIndex+b.rows,$(a.target).closest("tr"))},ma=function(a){var b=$(a.target),c=o.viewFields[b.index()],d=b.attr("aria-value"),e=b.closest("tr").attr("aria-value").substring(0,12);na(e,c,d,1)},na=function(a,b,c,d){var e=o.strQuery;c&&("-"==c?(""!=e&&(e="("+e+") AND "),e+=b+":*"):"_etc"==c?(e=(""==e?"*:*":"("+e+")")+" NOT ",e+=b+":("+o.series_vals.join(" ")+")"):(""!=e&&(e="("+e+") AND "),e+=b+":"+_SL.luceneValueEscape(c)));var f=$("<form>").attr({target:"logSearchWin_"+(new Date).getTime(),action:i,method:"post"});f.append($("<input type='hidden' name='start_time'>").val(a)).append($("<input type='hidden' name='end_time'>").val(_SL.formatDate.addMin(a,d?d:o.chartPeriod))).append($("<input type='hidden' name='myfilter_id'>").val(j.myfilter_id)).append($("<input type='hidden' name='expert_keyword'>").val(e)).append($("<input type='hidden' name='template_id'>").val("popup")).appendTo("body").submit().remove()},oa={paletteColors:"89cf43,0099ff,ced2ff,9fa7ff,6dd0f7,dfbcfe,7dcbff,c07cfe,669933,dddddd",showValues:"0"};return{config_param:j,component_title:k,isOpenConfig:l,load:v,refresh:w,showConfig:x,validateConfig:y,beforeSaveConfig:z,afterSaveConfig:A,goLogSearch:na}},_SL.nmspc("slapp.component").performance_event=function(a,b,c){var d=a,e=$("#componentbody_"+d),f=$("#config_"+d+" form"),g=e.find(".grid-table-group"),h=(e.find(".goSmsView"),f.find(".btn-apply"),f.find("[name=sms_type]")),i=f.find("[name=event_level]"),j=f.find("[name=rows]"),k=gCONTEXT_PATH+"monitoring/performance_view.html",l=gCONTEXT_PATH+"sysdata/comcode_map.json",m=gCONTEXT_PATH+"sysdata/comcode_map.json",n=gCONTEXT_PATH+"component/performance_event.json",o={},p=b,q=c,r=function(){this.title=q,this.config_param=p=$.extend({},o,p),v(),e.off().on("click","[class^=goSmsView_]",function(){var a=$(this).attr("data-key").split(","),b=a[2],c=a[1],d=_SL.formatDate.addMin(a[3],1),e=_SL.formatDate.addMin(d,-30);B(k+"?s_eqp_type_cd="+c+"&s_eqp_ip="+b+"&start_time="+e+"&end_time="+d)}),w()},s=function(){h.val(p.sms_type),i.val(p.event_level),j.val(p.rows)},t=function(){p.sms_type=h.val(),p.event_level=i.val(),p.rows=j.val()},u=function(){w()},v=function(){ComCodes.CS0003?z():$("body").requestData(l,{code_type:"CS0003"},{callback:function(a,b,c){ComCodes.CS0003=a,z(),y()}}),ComCodes.CS0005?A():$("body").requestData(m,{code_type:"CS0005"},{callback:function(a,b,c){ComCodes.CS0005=a,A(),y()}}),x()},w=function(){var a=g.find("tbody");$("body").requestData(n,p,{callback:function(b){a.empty();var c=b?b.length:0;if(c>0)for(var e,f=0;f<c;f++){var g=b[f].eqp_ip,h=b[f].curr_val,i=_SL.formatNumber(h),j=b[f].limit_val,k=_SL.formatNumber(j),l=_SL.formatDate(b[f].eqp_time,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),m=(b[f].event_level,b[f].eqp_type_cd);e=$("<tr />").append("<td>"+(f+1)+"</td>").append("<td><a class='goSmsView_"+d+"' tabindex='1' style='cursor:pointer;' data-key='"+d+","+m+","+g+","+b[f].eqp_time+"'>"+b[f].eqp_nm+"("+g+")</a></td>").append("<td>"+b[f].sms_type_nm+"</td>"),"1"==b[f].event_level?e.append("<td><span class='label-success'>Low</span></td>"):"2"==b[f].event_level?e.append("<td><span class='label-attention'>Middle</span></td>"):"3"==b[f].event_level&&e.append("<td><span class='label-danger'>High</span></td>"),"1"==b[f].sms_type||"2"==b[f].sms_type?e.append("<td>"+h+"% / "+j+"%</td>"):e.append("<td><span>"+i+"</span>/<span>"+k+"</span></td>"),e.append("<td>"+l+"</td>"),e.appendTo(a).hide().fadeIn(1500)}else a.append('<tr><td scope="col" colspan="6">There is no Search Result</td></tr>')}}),y()},x=function(){A(),z(),p.rows&&$("#config_"+d+" [name=rows] option").each(function(){$(this).val()==p.rows&&$(this).prop("selected",!0)})},y=function(){var a="",b=0;for(var c in p)""!=p[c]&&("sms_type"==c?(a+=b>0?" , ":"",a+="구분 : ",ComCodes.CS0003?a+=ComCodes.CS0003[p[c]]:$("body").requestData(l,{code_type:"CS0003"},{callback:function(b,d,e){ComCodes.CS0003=b,a+=ComCodes.CS0003[p[c]]}}),b++):"event_level"==c&&(a+=b>0?" , ":"",a+="등급 : ",ComCodes.CS0005?a+=ComCodes.CS0005[p[c]]:$("body").requestData(m,{code_type:"CS0005"},{callback:function(b,d,e){ComCodes.CS0005=b,a+=ComCodes.CS0005[p[c]]}}),b++));0==b?$("#"+d+"_inner_container .sp-title h5").text("전체"):$("#"+d+"_inner_container .sp-title h5").text(a)},z=function(){h.html('<option value="">[선택하세요]</option>');for(var a in ComCodes.CS0003){var b=$("<option>").val(a).text(ComCodes.CS0003[a]);p.sms_type==a&&b.prop("selected",!0),h.append(b)}},A=function(){i.html('<option value="">[선택하세요]</option>');for(var a in ComCodes.CS0005){var b=$("<option>").val(a).text(ComCodes.CS0005[a]);p.event_level==a&&b.prop("selected",!0),i.append(b)}},B=function(a){window.open(a,"performView"+(new Date).getTime())};return{config_param:p,component_title:q,load:r,refresh:w,showConfig:s,beforeSaveConfig:t,afterSaveConfig:u}},_SL.nmspc("slapp.component").rel_event=function(a,b,c){var d,e=a,f=$("#componentheader_"+e),g=$("#componentbody_"+e),h=$("#config_"+e+" form"),i=g.find(".grid-table-group"),j=g.find(".chart-group"),k=f.find(".area-title"),l=h.find("[name=ruleset_id]"),m=h.find("[name=ruleset_id_list]"),n=h.find("[name=event_cate_cd]"),o=h.find("[name=event_level]"),p=h.find("[name=group_field]"),q=h.find("[name=last_period]"),r=h.find("[name=rows]"),s=(h.find("[name=chart_yn]"),gCONTEXT_PATH+"sysdata/comcode_map.json"),t=gCONTEXT_PATH+"component/rel_event_config.json",u=gCONTEXT_PATH+"component/rel_event_list.json",v=gCONTEXT_PATH+"event2/rel_event_list.html",w={ruleset_id:"",event_cate_cd:"",event_level:"",last_period:"60",rows:"5",chart_yn:"N"},x=b,y=c,z=null,A={grpFields:["ruleset_id"],timeField:"event_time",sumField:"cnt",maxBuffers:1e4,period:60},B=function(){this.config_param=x=$.extend({},w,x),L=$.extend(this.chartstyles,L),L.paletteColors="#89cf43,#ffc000,#ff0000",G(),h.on("click",".btn-add",function(){var a=l.find("option:selected").val(),b=l.find("option:selected").text();return""==a?void _alert("이벤트를 선택하세요."):m.find("option").is(function(){return this.value==a})?void _alert("동일한 이벤트가 존재합니다."):void m.append($("<option>").val(a).text(b))}).on("click",".btn-del",function(){m.find(":selected").remove()}),i.on("click","a[name=rel_event_search]",function(a){M($(a.target))}),A.period=x.last_period,z=_SL.getDataTicker(A),z.setBaseTime(_SL.formatDate.addMin(gGetServerTime(),-A.period)),x.event_seq="",C()},C=function(a){$("body").requestData(u,x,{callback:function(b){var c=b&&b.rsList?b.rsList:[],d=b.isInit;if(!(c.length<1)||d){var e=ComCodes.CS0051[x.event_cate_cd],f=ComCodes.CS0005[x.event_level],g="상관분석 이벤트";if(""!=x.event_cate_cd&&(g=g+"/"+e),""!=x.event_level&&(g=g+"/"+f),k.text(g),"Y"==x.chart_yn){z.addChartList(c);var h=z.getChartList();j.is(":hidden")?(K(b,h),j.show()):K(b,h,a)}else j.hide();var l=x.event_seq;c.length>0&&(l=c[0].event_seq),z.addList(c);var m=z.getList();m.sort(function(a,b){return a.event_time>b.event_time?-1:a.event_time<b.event_time?1:z.getEventCount(a.key)>z.getEventCount(b.key)?-1:z.getEventCount(a.key)<z.getEventCount(b.key)?1:0});var n=i.find("tbody").empty(),o=m.length;if(o>x.rows&&(o=x.rows),o&&0!=o.length)for(var p=["Low","Middle","High"],q=["label-success","label-attention","label-danger"],r=0;r<o;r++){var s=m[r],t=$("<tr></tr>"),u=($("<td></td>").text(r+1).appendTo(t),$("<td></td>").appendTo(t)),v=($("<a></a>").attr({name:"rel_event_search",tabindex:"1"}).css("cursor","pointer").text(s.event_nm).data({event_nm:s.event_nm,event_time:s.event_time,s_event_time:s.s_event_time,ruleset_id:s.ruleset_id,event_cate_cd:s.event_cate_cd,event_level:s.event_level}).appendTo(u),$("<td></td>").text(ComCodes.CS0051[s.event_cate_cd]).appendTo(t),$("<td></td>").appendTo(t));$("<td></td>").text(_SL.toComma(z.getEventCount(s.key)+"건")).appendTo(t),$("<td></td>").text(_SL.formatDate(s.s_event_time,"MM-dd HH:mm")+"~"+_SL.formatDate(s.event_time,"MM-dd HH:mm")).attr("title",_SL.formatDate(s.s_event_time,"yyyy-MM-dd HH:mm")+" ~ "+_SL.formatDate(s.event_time,"yyyy-MM-dd HH:mm")).appendTo(t);0==s.event_level_nm?v.append("-"):v.append('<span class="'+q[s.event_level-1]+'">'+p[s.event_level-1]+"</span>"),t.appendTo(n).hide().fadeIn(1500)}else n.append('<tr><td colspan="6">There is no Result.</td></tr>');x.event_seq=l}}})},D=function(){var a=x?x.ruleset_id:"";l.val(""),n.val(x.event_cate_cd),o.val(x.event_level),p.val(x.group_field),q.val(x.last_period),r.val(x.rows),h.find("[name=chart_yn]:input[value="+x.chart_yn+"]").prop("checked",!0),m.empty();var b=a.split(",");for(var c in b){var e=b[c];null!=e&&""!=e&&m.append(new Option(d[e],e))}},E=function(){for(var a=[],b=m.find("option"),c=0;c<b.length;c++)a.push(b.eq(c).val());x.ruleset_id=a.join(","),x.event_cate_cd=n.val(),x.event_level=o.val(),x.group_field=p.val(),x.last_period=q.val(),x.rows=r.val(),x.chart_yn=h.find("[name=chart_yn]:checked").val(),A.period=x.last_period,z=_SL.getDataTicker(A),z.setBaseTime(_SL.formatDate.addMin(gGetServerTime(),-A.period)),x.event_seq=""},F=function(){C(!0)},G=function(){ComCodes.CS0051?H():$("body").requestData(s,{code_type:"CS0051"},{callback:function(a,b,c){ComCodes.CS0051=a,H()}}),ComCodes.CS0005?I():$("body").requestData(s,{code_type:"CS0005"},{callback:function(a,b,c){ComCodes.CS0005=a,I()}}),$("body").requestData(t,{},{callback:function(a,b,c){d=a.eventNames,J(d)}})},H=function(){n.html('<option value="">[선택하세요]</option>');for(var a in ComCodes.CS0051)n.append($("<option>").val(a).text(ComCodes.CS0051[a]))},I=function(){o.html('<option value="">[선택하세요]</option>');for(var a in ComCodes.CS0005)o.append($("<option>").val(a).text(ComCodes.CS0005[a]))},J=function(a){l.html('<option value="">[선택하세요]</option>');for(var b in a)l.append($("<option>").val(b).text(a[b]))},K=function(a,b,c){var d=b,f={chart:L,categories:[],dataset:[]},g=[],h=[],i=ComCodes.CS0005,j=a.groupByPeriod,k=a.categorys,l="";for(var m in k)h.push({label:_SL.formatDate(k[m].event_time,"MM-dd HH:mm")});var n,o,p={},q={};for(var r in i){var s=i[r];q[s]=0}if(j>1){for(var m in k){var q={};for(var r in i){var s=i[r];q[s]=0}n=k[m].event_time,o=_SL.formatDate.addMin(n,j),p[n]=q;for(var r=0;r<j;r++){var t;if(t=0==r?n:_SL.formatDate.addMin(n,r),d[t])for(var u in i){var s=i[u];d[t][s]&&(p[n][s]+=d[t][s])}}}d=p}for(var r in i){var s=i[r],v={seriesname:s,data:[]};for(var u in k){l=k[u].event_time;var w=0,x=k[u].event_time,y=_SL.formatDate.addMin(x,j),z='javascript:$.Dashboard.componentInstance["'+e+'"].chartRelEvent("'+r+'","'+x+'","'+y+'")';d[l]&&d[l][s]&&(w=d[l][s]),v.data.push({value:w,link:z})}g.push(v)}f.categories.push({category:h}),f.dataset=g,c===!0&&void 0!=$.Dashboard.chartInstance[e]?$.Dashboard.chartInstance[e].setJSONData(f):FusionCharts.ready(function(){$.Dashboard.chartInstance[e]=new FusionCharts({type:"stackedcolumn2d",renderAt:"chart-container_"+e,width:"100%",height:"240",dataFormat:"json",dataSource:f}).render()})},L={caption:"",subCaption:"",numberPrefix:"",showValues:"0"},M=function(a){var b=g.find("[name=listForm]"),c=a.data("s_event_time"),d=_SL.formatDate.addMin(a.data("event_time"),1);$("[name=start_time]",b).val(c),$("[name=end_time]",b).val(d),$("[name=s_event_seq]",b).val(a.data("event_seq")),$("[name=s_event_cate_cd]",b).val(a.data("event_cate_cd")),$("[name=s_event_nm]",b).val(a.data("event_nm")),$("[name=s_event_level]",b).val(a.data("event_level"));var e="relEventSearchWin_"+(new Date).getTime();b.attr({action:v,target:e,method:"post"}).submit()},N=function(a,b,c){var d=g.find("[name=listForm]");$("input[type=hidden]",d).val(""),$("[name=start_time]",d).val(b),$("[name=end_time]",d).val(c),$("[name=s_event_level]",d).val(a);var e="relEventSearchWin_"+(new Date).getTime();d.attr({action:v,target:e,method:"post"}).submit()};return{config_param:x,component_title:y,load:B,refresh:C,showConfig:D,beforeSaveConfig:E,afterSaveConfig:F,chartRelEvent:N}},_SL.nmspc("slapp.component").search_event=function(a,b,c){var d,e,f,g=a,h=$("#componentheader_"+g),i=$("#componentbody_"+g),j=$("#config_"+g+" form"),k=i.find(".grid-table-group"),l=i.find(".chart-group"),m=h.find(".area-title"),n=j.find("[name=ruleset_id]"),o=j.find("[name=ruleset_id_list]"),p=j.find("[name=group_cd]"),q=j.find("[name=event_cate_cd]"),r=j.find("[name=event_level]"),s=j.find("[name=group_field]"),t=j.find("[name=last_period]"),u=j.find("[name=view_field]"),v=j.find("[name=rows]"),w=(j.find("[name=chart_yn]"),gCONTEXT_PATH+"sysdata/comcode_map.json"),x=gCONTEXT_PATH+"component/search_event_config.json",y=gCONTEXT_PATH+"component/search_event_list.json",z=gCONTEXT_PATH+"event/search_event_list.html",A={ruleset_id:"",group_cd:"",event_cate_cd:"",event_level:"",group_field:"",event_seq:"",last_period:"60",rows:"5",chart_yn:"N",view_fields:["event_nm","group_field","event_cate_cd","event_level","cnt","event_time"]},B=b,C=c,D=1,E=null,F={grpFields:["ruleset_id","open_time","group_field","field_val"],timeField:"event_time",sumField:"cnt",sumFieldList:["distinct_cnt"],maxBuffers:1e4,period:60},G=function(){this.config_param=B=$.extend({},A,B),U=$.extend(this.chartstyles,U),U.paletteColors="#89cf43,#ffc000,#ff0000",L(),j.on("click",".btn-add",function(){var a=n.find("option:selected").val(),b=n.find("option:selected").text();return""==a?void _alert("이벤트를 선택하세요."):o.find("option").is(function(){return this.value==a})?void _alert("동일한 이벤트가 존재합니다."):void o.append(new Option(b,a))}).on("click",".btn-del",function(){o.find(":selected").remove()}),k.on("click","a[name=search_event]",function(a){return V($(a.target)),!1}),S(),F.period=B.last_period,E=_SL.getDataTicker(F),E.setBaseTime(_SL.formatDate.addMin(gGetServerTime(),-F.period)),B.event_seq="",H()},H=function(a){var b=function(b){var c=b&&b.rsList?b.rsList:[],d=b.isInit;if(!(c.length<1)||d){var e=GroupCaptionInfo[B.group_cd],f=ComCodes.CS0051[B.event_cate_cd],g=ComCodes.CS0005[B.event_level],h=LogCaptionInfo[B.group_field],i="일반 이벤트";if(""!=B.group_cd&&(i=i+"/"+e),""!=B.event_cate_cd&&(i=i+"/"+f),""!=B.event_level&&(i=i+"/"+g),""!=B.group_field&&(i=i+"/"+h),m.text(i),"Y"==B.chart_yn){E.addChartList(c);var j=E.getChartList();l.is(":hidden")?(T(b,j),l.show()):T(b,j,a)}else l.hide();var n=B.event_seq;c.length>0&&(n=c[0].event_seq),E.addList(c);var o=E.getList(),p=k.find("tbody").empty(),q=o.length;if(q>B.rows&&(q=B.rows),q&&0!=q.length)for(var r,s,t,u,v=B.view_fields,w=["Low","Middle","High"],x=["label-success","label-attention","label-danger"],y=["src_country_name","src_country_code","dstn_country_name","dstn_country_code"],z=0;z<q;z++){t=o[z],r=$("<tr>").append($("<td>").text(z+1));for(var A in v){s=$("<td>");var C=v[A];switch(u=t[C],C){case"event_nm":$("<a />").attr({href:"#",name:"search_event"}).text(u).data({event_nm:u,event_time:t.event_time,s_event_time:t.s_event_time,ruleset_id:o[z].ruleset_id,event_cate_cd:o[z].event_cate_cd,event_level:o[z].event_level,group_cd:o[z].group_cd}).appendTo(s);break;case"group_field":if(u){var F,G=u.split(","),H=(t.field_val.split(","),"");for(var A in G)y.indexOf(G[A])>-1&&(F=t.flag_code?t.flag_code:t[G[A]],"N/A"==t[G[A]]&&(F="N-A"),H="PRN"!=F?'<img src="/resources/images/flag/'+F+'.png" alt="'+F+'" width="16" height="11">':'<i class="icon-lock"></i>'),A==G.length-1?s.append(LogCaptionInfo[G[A]]+" : "+H+t[G[A]]):(s.append(LogCaptionInfo[G[A]]+" : "+H+t[G[A]]+"\n"),s.append($("<br>")))}else s.append("전체");break;case"event_cate_cd":s.append(t.event_cate_cd_nm);break;case"event_level":0==u?s.append("-"):s.append('<span class="'+x[u-1]+'">'+w[u-1]+"</span>");break;case"event_time":s.text(_SL.formatDate(t.s_event_time,"MM-dd HH:mm")+"~"+_SL.formatDate(t.event_time,"MM-dd HH:mm")),s.attr("title",_SL.formatDate(t.s_event_time,"yyyy-MM-dd HH:mm")+" ~ "+_SL.formatDate(t.event_time,"yyyy-MM-dd HH:mm"));break;case"handling_type_cd":t.handling_type_cd_nm?s.append(t.handling_type_cd_nm):s.append("-");break;case"group_cd":s.append(t.group_cd_nm);break;case"cnt":s.append(_SL.toComma(u+"/"+E.getEventCount(t.key)+"건"));break;case"distinct_cnt":case"limit_distinct_count":case"limit_count":u=_SL.formatNumber(u),s.append(u);break;default:s.append(u)}r.append(s)}r.appendTo(p)}else p.append("<tr><td colspan="+D+">There is no Event.</td></tr>");B.event_seq=n}};$("body").requestData(y,B,{callback:b})},I=function(){var a=B?B.ruleset_id:"",b=B?B.view_fields:[];n.val(""),p.val(B.group_cd),q.val(B.event_cate_cd),r.val(B.event_level),s.val(B.group_field),t.val(B.last_period),v.val(B.rows),j.find("[name=chart_yn]:input[value="+B.chart_yn+"]").prop("checked",!0),o.empty();var c=a.split(",");for(var e in c){var f=c[e];null!=f&&""!=f&&o.append('<option value="'+f+'">'+d[f]+"</option>")}u.setSelectionOrder(b,!0)},J=function(){for(var a=[],b=o.find("option"),c=0;c<b.length;c++)a.push(b.eq(c).val());B.ruleset_id=a.join(","),B.group_cd=p.val(),B.event_cate_cd=q.val(),B.event_level=r.val(),B.group_field=s.val(),B.last_period=t.val(),B.rows=v.val(),B.chart_yn=j.find("[name=chart_yn]:checked").val(),B.view_fields=u.getSelectionOrder(),F.period=B.last_period,E=_SL.getDataTicker(F),E.setBaseTime(_SL.formatDate.addMin(gGetServerTime(),-F.period)),B.event_seq=""},K=function(){S(),H(!0)},L=function(){var a=function(a,b,c){ComCodes.CS0051=a,M()},b=function(a,b,c){ComCodes.CS0005=a,N()},c=function(a,b,c){d=a.eventNames,e=a.groups,f=a.groupFields,P(d),O(e),Q(f),R(f)};ComCodes.CS0051?M():$("body").requestData(w,{code_type:"CS0051"},{callback:a}),ComCodes.CS0005?N():$("body").requestData(w,{code_type:"CS0005"},{callback:b}),$("body").requestData(x,{},{callback:c})},M=function(){q.html('<option value="">[선택하세요]</option>');for(var a in ComCodes.CS0051)q.append('<option value="'+a+'">'+ComCodes.CS0051[a]+"</option>")},N=function(){r.html('<option value="">[선택하세요]</option>');for(var a in ComCodes.CS0005)r.append('<option value="'+a+'">'+ComCodes.CS0005[a]+"</option>")},O=function(a){p.html('<option value="">[선택하세요]</option>');for(var b in a)p.append('<option value="'+b+'">'+a[b]+"</option>")},P=function(a){n.html('<option value="">[선택하세요]</option>');for(var b in a)n.append('<option value="'+b+'">'+a[b]+"</option>")},Q=function(a){s.html('<option value="">[선택하세요]</option>');for(var b in a){var c=a[b];s.append('<option value="'+c+'">'+LogCaptionInfo[c]+"("+c+")</option>")}},R=function(a){u.empty(),delete EventCaptionInfo.dashboard_yn;for(var b in EventCaptionInfo)u.append('<option value="'+b+'">'+EventCaptionInfo[b]+"("+b+")</option>");for(var c in a){var d=a[c];u.append('<option value="'+d+'">'+LogCaptionInfo[d]+"("+d+")</option>")}var e=B?B.view_fields:[];for(var c in e){var f=e[c];!EventCaptionInfo[f]&&a.indexOf(f)<0&&u.append('<option value="'+f+'">undefined('+f+")</option>")}u.chosen({search_contains:!0,placeholder_text_multiple:"[선택하세요]",width:"100%",max_selected_options:30}),u.siblings(".chosen-container").find(".chosen-results").css("max-height","100px"),u.siblings(".chosen-container").find(".chosen-choices").css({"max-height":"55px","min-height":"55px","overflow-y":"auto"})},S=function(){var a,b,c=k.find("thead").empty(),d=B.view_fields;b=$("<tr />"),b.append('<th scope="col">번호</th>');for(var e in d){a=EventCaptionInfo[d[e]],a||(a=LogCaptionInfo[d[e]]);var f=$('<th scope="col" />');"cnt"==d[e]&&f.attr("title","로그건수/이벤트건수"),b.append(f.append(a?a:d[e])),D++}c.append(b)},T=function(a,b,c){var d=b,e={chart:U,categories:[],dataset:[]},f=[],h=[],i=ComCodes.CS0005,j=a.groupByPeriod,k=a.categorys,l="";for(var m in k)h.push({label:_SL.formatDate(k[m].event_time,"MM-dd HH:mm")});var n,o,p={},q={};for(var r in i){var s=i[r];q[s]=0}if(j>1){for(var m in k){var q={};for(var r in i){var s=i[r];q[s]=0}n=k[m].event_time,o=_SL.formatDate.addMin(n,j),p[n]=q;for(var r=0;r<j;r++){var t;if(t=0==r?n:_SL.formatDate.addMin(n,r),d[t])for(var u in i){var s=i[u];d[t][s]&&(p[n][s]+=d[t][s])}}}d=p}for(var r in i){var s=i[r],v={seriesname:s,data:[]};for(var u in k){l=k[u].event_time;var w=0,x=k[u].event_time,y=_SL.formatDate.addMin(x,j),z='javascript:$.Dashboard.componentInstance["'+g+'"].chartSearchEvent("'+r+'","'+x+'","'+y+'")';d[l]&&d[l][s]&&(w=d[l][s]),v.data.push({value:w,link:z})}f.push(v)}e.categories.push({category:h}),e.dataset=f,c===!0&&void 0!=$.Dashboard.chartInstance[g]?$.Dashboard.chartInstance[g].setJSONData(e):FusionCharts.ready(function(){$.Dashboard.chartInstance[g]=new FusionCharts({type:"stackedcolumn2d",renderAt:"chart-container_"+g,width:"100%",height:"240",dataFormat:"json",dataSource:e}).render()})},U={caption:"",subCaption:"",numberPrefix:"",showValues:"0"},V=function(a){var b=i.find("[name=listForm]"),c=a.data("s_event_time"),d=_SL.formatDate.addMin(a.data("event_time"),1);$("[name=start_time]",b).val(c),$("[name=end_time]",b).val(d),$("[name=s_ruleset_id]",b).val(a.data("ruleset_id")),$("[name=s_group_cd]",b).val(a.data("group_cd")),$("[name=s_event_cate_cd]",b).val(a.data("event_cate_cd")),$("[name=s_event_nm]",b).val(a.data("event_nm")),$("[name=s_event_level]",b).val(a.data("event_level"));var e="searchEventSearchWin_"+(new Date).getTime();b.attr({action:z,target:e,method:"post"}).submit()},W=function(a,b,c){var d=i.find("[name=listForm]");$("input[type=hidden]",d).val(""),$("[name=start_time]",d).val(b),$("[name=end_time]",d).val(c),$("[name=s_event_level]",d).val(a);
var e="searchEventSearchWin_"+(new Date).getTime();d.attr({action:z,target:e,method:"post"}).submit()};return{config_param:B,component_title:C,load:G,refresh:H,showConfig:I,beforeSaveConfig:J,afterSaveConfig:K,chartSearchEvent:W}},_SL.nmspc("slapp.component").search_stats_top_time=function(a,b,c){var d=a,e=$("#componentheader_"+d),f=$("#componentbody_"+d),g=$("#config_"+d+" form"),h=(f.find(".chart-group"),e.find(".area-title")),i=g.find("[name=last_period]"),j=g.find("[name=top_code]"),k=(gCONTEXT_PATH+"sysdata/comcode_map.json",gCONTEXT_PATH+"component/top_stats_mng_use_list.json"),l=gCONTEXT_PATH+"component/search_stats_calc_time_total.json",m={last_period:"10080",top_code:"",time_reference:"",start_time:"",end_time:""},n=b,o=c,p=function(){this.config_param=n=$.extend({},m,n),v=$.extend(this.chartstyles,v),v.paletteColors=v.unitColor,n.time_reference="",u(),q()},q=function(a){var b=function(b){if(n.time_reference=b.end_time,n.start_time=b.start_time,n.end_time=b.end_time,b.top_mng){var c="",e=g.find("[name=last_period]").find("[value="+n.last_period+"]");c=b.top_mng.top_name+"/시간별 현황 합계 ["+e.text()+"]",h.text(c)}for(var f=[],i={},j=0,k=b.time_list.length;j<k;j++){var l=b.time_list[j];i={},i.label=l.time.toString(),i.value=l.total,f.push(i),"18"==l.time&&(f.push({vline:!0,label:" 주간 ",dashed:"1",dashLen:"3",dashGap:"2",labelHAlign:"right"}),f.push({vline:!0,label:" 야간 ",dashed:"1",dashLen:"3",dashGap:"2",labelHAlign:"left"}))}a===!0&&void 0!=$.Dashboard.chartInstance[d]?$.Dashboard.chartInstance[d].setJSONData({chart:v,data:f}):FusionCharts.ready(function(){$.Dashboard.chartInstance[d]=new FusionCharts({type:"area2d",renderAt:"chart-container_"+d,width:"100%",height:240,dataFormat:"json",dataSource:{chart:v,data:f}}).render()})};$("body").requestData(l,n,{callback:b})},r=function(){i.val(n.last_period),j.val(n.top_code)},s=function(){n.last_period=i.val(),n.top_code=j.val()},t=function(){q(!0)},u=function(){var a=function(a){for(var b in a.topMngUseList)$("<option />").val(a.topMngUseList[b].top_code).text(a.topMngUseList[b].top_name).appendTo(j)};$("body").requestData(k,{},{callback:a})},v={plotfillalpha:"60",showvalues:"0",formatnumberscale:"1"};return{config_param:n,component_title:o,load:p,refresh:q,showConfig:r,beforeSaveConfig:s,afterSaveConfig:t}},_SL.nmspc("slapp.component").search_stats_top_total=function(a,b,c){var d=a,e=$("#componentheader_"+d),f=$("#componentbody_"+d),g=$("#config_"+d+" form"),h=f.find(".table-total"),i=e.find(".area-title"),j=g.find("[name=last_period]"),k=g.find("[name=top_code]"),l=(gCONTEXT_PATH+"sysdata/comcode_map.json",gCONTEXT_PATH+"component/top_stats_mng_use_list.json"),m=gCONTEXT_PATH+"component/search_stats_calc_time_total.json",n={last_period:"10080",top_code:"",time_reference:"",start_time:"",end_time:""},o=b,p=c,q=function(){this.config_param=o=$.extend({},n,o),o.time_reference="",v(),r()},r=function(){var a=function(a){if(o.time_reference=a.end_time,o.start_time=a.start_time,o.end_time=a.end_time,a.top_mng){var b="",c=g.find("[name=last_period]").find("[value="+o.last_period+"]");b=a.top_mng.top_name+"/전체 합계 ["+c.text()+"]",i.text(b)}var d,e=a.total,j=a.day_avg_cnt,k=a.weekday_cnt_1;d=0==e?0:k/e*100;var l,m=a.weekday_cnt_2;l=0==e?0:m/e*100;var n,p=k+m;n=0==e?0:(k+m)/e*100;var q,r=a.weekday_avg_cnt,s=a.weekend_cnt_1;q=0==e?0:s/e*100;var t,u=a.weekend_cnt_2;t=0==e?0:u/e*100;var v,w=s+u;v=0==e?0:(s+u)/e*100;var x=a.weekend_avg_cnt;f.find(".total_count").text(_SL.toComma(e)),f.find(".day_avg_cnt").text(_SL.toComma(j)),h.find(".weekday_cnt_1").text(_SL.toComma(k)),h.find(".weekday_cnt_1_percent").text(_SL.formatNumber(d)+"%"),h.find(".weekday_cnt_2").text(_SL.toComma(m)),h.find(".weekday_cnt_2_percent").text(_SL.formatNumber(l)+"%"),h.find(".weekday_cnt").text(_SL.toComma(p)),h.find(".weekday_cnt_percent").text(_SL.formatNumber(n)+"%"),h.find(".weekday_avg").text(_SL.toComma(r)),h.find(".weekend_cnt_1").text(_SL.toComma(s)),h.find(".weekend_cnt_1_percent").text(_SL.formatNumber(q)+"%"),h.find(".weekend_cnt_2").text(_SL.toComma(u)),h.find(".weekend_cnt_2_percent").text(_SL.formatNumber(t)+"%"),h.find(".weekend_cnt").text(_SL.toComma(w)),h.find(".weekend_cnt_percent").text(_SL.formatNumber(v)+"%"),h.find(".weekend_avg").text(_SL.toComma(x))};$("body").requestData(m,o,{callback:a})},s=function(){j.val(o.last_period),k.val(o.top_code)},t=function(){o.last_period=j.val(),o.top_code=k.val()},u=function(){r()},v=function(){var a=function(a){for(var b in a.topMngUseList)$("<option />").val(a.topMngUseList[b].top_code).text(a.topMngUseList[b].top_name).appendTo(k)};$("body").requestData(l,{},{callback:a})};return{config_param:o,component_title:p,load:q,refresh:r,showConfig:s,beforeSaveConfig:t,afterSaveConfig:u}},_SL.nmspc("slapp.component").search_stats_top_week=function(a,b,c){var d=a,e=$("#componentheader_"+d),f=$("#componentbody_"+d),g=$("#config_"+d+" form"),h=(f.find(".chart-group"),e.find(".area-title")),i=g.find("[name=last_period]"),j=g.find("[name=top_code]"),k=(gCONTEXT_PATH+"sysdata/comcode_map.json",gCONTEXT_PATH+"component/top_stats_mng_use_list.json"),l=gCONTEXT_PATH+"component/search_stats_calc_time_total.json",m={last_period:"10080",top_code:"",time_reference:"",start_time:"",end_time:""},n=b,o=c,p=function(){this.config_param=n=$.extend({},m,n),v=$.extend(this.chartstyles,v),v.paletteColors=v.unitColor,n.time_reference="",u(),q()},q=function(a){var b=function(b){var c=[{label:"Mon",value:b.week_1},{label:"Tue",value:b.week_2},{label:"Wed",value:b.week_3},{label:"Thu",value:b.week_4},{label:"Fri",value:b.week_5},{label:"Sat",value:b.week_6},{label:"Sun",value:b.week_0}];if(n.time_reference=b.end_time,n.start_time=b.start_time,n.end_time=b.end_time,b.top_mng){var e="",f=g.find("[name=last_period] [value="+n.last_period+"]");e=b.top_mng.top_name+"/요일별 현황 합계 ["+f.text()+"]",h.text(e)}a===!0&&void 0!=$.Dashboard.chartInstance[d]?$.Dashboard.chartInstance[d].setJSONData({chart:v,data:c}):FusionCharts.ready(function(){$.Dashboard.chartInstance[d]=new FusionCharts({type:"column2d",renderAt:"chart-container_"+d,width:"100%",height:240,dataFormat:"json",dataSource:{chart:v,data:c}}).render()})};$("body").requestData(l,n,{callback:b})},r=function(){i.val(n.last_period),j.val(n.top_code)},s=function(){n.last_period=i.val(),n.top_code=j.val()},t=function(){q(!0)},u=function(){var a=function(a){for(var b in a.topMngUseList)$("<option />").val(a.topMngUseList[b].top_code).text(a.topMngUseList[b].top_name).appendTo(j)};$("body").requestData(k,{},{callback:a})},v={caption:"",subCaption:"",numberPrefix:""};return{config_param:n,component_title:o,load:p,refresh:q,showConfig:r,beforeSaveConfig:s,afterSaveConfig:t}},_SL.nmspc("slapp.component").search_stats_top=function(a,b,c){var d=a,e=$("#componentheader_"+d),f=$("#componentbody_"+d),g=$("#config_"+d+" form"),h=f.find(".grid-table-group"),i=(f.find(".chart-group"),e.find(".area-title")),j=g.find("[name=last_period]"),k=g.find("[data-name=group_field]"),l=g.find("[name=rows]"),m=(g.find("[name=list_yn]"),gCONTEXT_PATH+"sysdata/comcode_map.json",gCONTEXT_PATH+"component/top_stats_mng_use_list.json"),n=gCONTEXT_PATH+"component/top_stats_data_1h.json",o=gCONTEXT_PATH+"monitoring/log_search.html",p={last_period:"10080",rows:"5",list_yn:"N",top_code:"",item_seq:"",field_nm:"",time_reference:"",start_time:"",end_time:""},q=b,r=c,s=null,t=null,u=null,v=function(){this.config_param=q=$.extend({},p,q),B=$.extend(this.chartstyles,B),B.paletteColors=B.top5Colors,q.time_reference="",A(),w()},w=function(a){var b=function(b){s=b,q.time_reference=b.end_time,q.start_time=b.start_time,q.end_time=b.end_time;var c,e=[],f=[],j="COUNT";if(null!=b.top_item_mng){var k=b.top_item_mng;t=e=k.group_fields.split(",");for(var l in e)f[l]=LogCaptionInfo[e[l]];if(c=f.join(","),j=k.func.toUpperCase(),"count"!=k.func){var m=LogCaptionInfo[k.field_nm]?LogCaptionInfo[k.field_nm]:k.field_nm;j+="("+m+")"}B.xAxisName=c,B.yAxisName=j}var n="";if(null!=c){var o=g.find("[name=last_period]").find("[value="+q.last_period+"]");n=b.top_mng.top_name+"/"+c+" 순위 ["+o.text()+"]",i.text(n)}if("N"==q.list_yn)h.hide();else{var p=h.find("thead").empty(),r=h.find("tbody").empty(),u="<tr>";u+='<th scope="col">순위</th>';for(var v in f)u+='<th scope="col">'+f[v]+"</th>";if(u+='<th scope="col">'+j+"</th>",u+='<th scope="col">비율</th>',u+="</tr>",p.html(u),0==b.list.length){var w=p.find("th").size();r.html('<tr><td colspan="'+w+'" class="list-empty">There is no Result.</td></tr>')}else{for(var x=0,l=0,y=b.list.length;l<y;l++){var z='javascript:$.Dashboard.componentInstance["'+d+'"].goSearchPopup("'+b.start_time+'","'+b.end_time+'","'+l+'")',A="<tr>";A+="<td>"+(l+1)+"</td>";for(var v in e)A+="<td><a href='"+z+"'>"+b.list[l][e[v]]+"</a></td>";A+="<td>"+_SL.toComma(b.list[l].value)+"</td>",A+=0==b.total?"<td>"+_SL.formatNumber(b.total)+"%</td>":"<td>"+_SL.formatNumber({decimals:2},b.list[l].value/b.total*100)+"%</td>",A+="</tr>",r.append(A),x+=b.list[l].value,b.list[l].link=z}var C=b.total-x;if(C>0){var D="<tr>";D+="<td>기타</td>";for(var v in e)D+="<td></td>";D+="<td>"+_SL.toComma(C)+"</td>",D+="<td>"+_SL.formatNumber({decimals:2},C/b.total*100)+"%</td>",D+="</tr>",r.append(D)}}h.show()}a===!0&&void 0!=$.Dashboard.chartInstance[d]?$.Dashboard.chartInstance[d].setJSONData({chart:B,data:b.list}):FusionCharts.ready(function(){$.Dashboard.chartInstance[d]=new FusionCharts({type:"bar2d",renderAt:"chart-container_"+d,width:"100%",height:"5"==q.rows?220:260,dataFormat:"json",dataSource:{chart:B,data:b.list}}).render()})};q.item_seq&&$("body").requestData(n,q,{callback:b})},x=function(){j.val(q.last_period),l.val(q.rows),g.find("[name=list_yn]:input[value="+q.list_yn+"]").prop("checked",!0),k.dynatree("getTree").activateKey(q.top_code+"|"+q.item_seq)},y=function(){q.group_field=k.val(),q.last_period=j.val(),q.rows=l.val(),q.list_yn=g.find("[name=list_yn]:checked").val();var a=k.dynatree("getTree").getActiveNode();if(a){var b=a.data.key;q.top_code=b.split("|")[0],q.item_seq=b.split("|")[1]}},z=function(){w(!0)},A=function(){var a=function(a,b,c){var d,e,f,g=null,h=[];for(var i in a.topMngGroupFieldUseList){d=a.topMngGroupFieldUseList[i],e=d.top_name,f=d.group_feild==q.field_nm,null!=g&&g.title==e||(g={title:e,isFolder:!0,children:[]},h.push(g)),f&&(g.expand=!0);var j=d.group_field.split(",");for(var l in j)j[l]=LogCaptionInfo[j[l]];g.children.push({title:d.item_seq-1+"."+j.join(",")+"("+d.func.toUpperCase()+")["+d.group_field+"]",tooltip:d.item_seq-1+"."+j.join(",")+"["+d.group_field+"]",key:d.top_code+"|"+d.item_seq})}k.dynatree({minExpandLevel:1,clickFolderMode:2,autoCollapse:!0,children:h}),u=k.dynatree("getTree")};$("body").requestData(m,{},{callback:a})},B={caption:"",subCaption:"",numberPrefix:""},C=function(a,b,c){var d,e="";for(var g in t)d=s.list[c][t[g]],""!=e&&(e+=" AND "),e+="-"==d?"NOT "+t[g]+":*":t[g]+":"+_SL.luceneValueEscape(d);e+=" AND ("+s.top_mng.search_condition+")";var h=f.find("[name=logSearchForm]");$("[name=start_time]",h).val(a),$("[name=end_time]",h).val(b),$("[name=expert_keyword]",h).val(e);var i="logSearchWin_"+(new Date).getTime();h.attr({action:o,target:i,method:"post"}).submit()};return{config_param:q,component_title:r,load:v,refresh:w,showConfig:x,beforeSaveConfig:y,afterSaveConfig:z,goSearchPopup:C}};var goPerformance=function(a,b,c){var d=c.split(":"),e=_SL.formatDate().substring(0,8)+d[0]+d[1],f=_SL.formatDate.addMin(e,-10),g=gCONTEXT_PATH+"monitoring/performance_view.html?s_eqp_type_cd="+a+"&s_eqp_ip="+b+"&start_time="+f+"&end_time="+e;window.open(g,"SystemView"+(new Date).getTime())};_SL.nmspc("slapp.component").system_status=function(a,b,c){var d,e=a,f=b,g=c,h={bLoaded:!1},i=[],j=gCONTEXT_PATH+"component/system_status.json",k=(gCONTEXT_PATH+"component/eqp_list.json",gCONTEXT_PATH+"monitoring/performance_view.html",$("#system-status-"+e)),l=$("#config_"+e+" form"),m=k.find(".sp-title"),n=l.find("[name=eqp_ip]"),o=$("#cpu_stat_"+e),p=$("#memory_stat_"+e),q=$("#read_stat_"+e),r=function(){this.config_param=f,w=$.extend(this.chartstyles,w),w.paletteColors=w.unitColor,FusionCharts&&(FusionCharts.items[e+"_id"]=null,delete FusionCharts.items[e+"_id"]),n.chosen({search_contains:!0,width:"100%"}),s()},s=function(a){var b=$.extend({curDate:(new Date).getTime()},h,f),c=function(b){i=b.EQP_LIST;var c=b.chartData,g=JSON.parse(i),j="";for(var k in g)f.eqp_ip==g[k].eqp_ip&&(j=g[k].eqp_type_cd);"undefined"==typeof b.cpu&&(b.cpu="-"),"undefined"==typeof b.memory&&(b.memory="-"),"undefined"==typeof b.read_bytes&&(b.read_bytes="-"),"undefined"==typeof b.write_bytes&&(b.write_bytes="-"),o.text(" "+b.cpu+"%"),p.text(" "+b.memory+"%"),q.text(" "+_SL.formatNumber(b.read_bytes)+"/"+_SL.formatNumber(b.write_bytes));for(var l={chart:w,categories:[{category:c}],dataset:[]},n=[],r=[],s=0,t=0==c.length?"":c.length-1,k=0,u=c.length;k<u;k++)s=Math.max(Math.max(c[k].value,c[k].value2),s),n[k]={value:c[k].value,link:'javascript:goPerformance("'+j+'","'+f.eqp_ip+'","'+c[t].label+'")'},r[k]={value:c[k].value2,link:'javascript:goPerformance("'+j+'","'+f.eqp_ip+'","'+c[t].label+'")'};if(l.chart.yAxisMaxValue=_SL.getChartMaxValue(s),""!=t?(d=b.chartData[t].label,l.chart.logoLink="javascript:goPerformance('"+j+"','"+f.eqp_ip+"','"+c[t].label+"')"):d=_SL.formatDate(_SL.formatDate(),"yyyyMMddHHmm","HH:mm"),l.dataset[0]={seriesname:"Inbound",color:"#89cf43",data:n},l.dataset[1]={seriesname:"Outbound",color:"#0099ff",data:r},!h.bLoaded){if(!b.eqp_ip)return;h.title=b.eqp_nm+"["+b.eqp_ip+"]",h.bLoaded=!0,f.eqp_ip||(f.eqp_ip=b.eqp_ip),m.html("<a href=\"javascript:goPerformance('"+j+"','"+f.eqp_ip+"','"+d+"');\"><h5>"+h.title+"</h5></a>")}a===!0&&void 0!=$.Dashboard.chartInstance[e]?$.Dashboard.chartInstance[e].setJSONData(l):FusionCharts.ready(function(){$.Dashboard.chartInstance[e]=new FusionCharts({type:"msarea",renderAt:"chart-container-"+e,width:"100%",height:"200",dataFormat:"json",dataSource:l}).render()})};$("body").requestData(j,b,{callback:c})},t=function(){n.empty();for(var a in EquipList){var b=EquipList[a];n.append('<option value="'+b.eqp_ip+'">'+b.eqp_nm+"["+b.eqp_ip+"]</option>")}n.val(f.eqp_ip),n.trigger("chosen:updated")},u=function(){var a=n.find("option:selected").val(),b=n.find("option:selected").text();""==a?delete f.eqp_ip:(f.eqp_ip=a,h.title=b,m.html("<a href=\"javascript:$.Dashboard.componentInstance['"+e+"'].goPerformance();\"><h5>"+h.title+"</h5></a>"))},v=function(){s(!0)},w={plotfillalpha:"60",showValues:"0"};return{containerId:e,config_param:f,component_title:g,options:h,load:r,refresh:s,showConfig:t,beforeSaveConfig:u,afterSaveConfig:v,goPerformance:goPerformance}};var viewTop5LogSearch=function(a,b,c,d,e){var f=$("#componentbody_"+e+" [name=searchForm]");$("input[type=hidden]",f).val(""),$("[name=start_time]",f).val(a),$("[name=end_time]",f).val(b),$("[name=expert_keyword]",f).val(d);var g="TOP5_"+(new Date).getTime();f.attr({action:gCONTEXT_PATH+"monitoring/log_search.html",target:g,method:"post"}).submit()};_SL.nmspc("slapp.component").top5=function(a,b,c,d){var e=a,f=($("#componentheader_"+e),$("#componentbody_"+e)),g=$("#config_"+e+" form"),h=f.find(".sp-title"),i=f.find(".table-group"),j=i.find(".grid-table-group"),k=i.find(".grid-table-group th:nth-child(3)"),l=g.find(".label_type_tr"),m=g.find("[name=last_period]"),n=g.find("[name=label_type]"),o=g.find("[name=rows]"),p=g.find("[name=group_cd]"),q=g.find("[name=log_cate_cd]"),r=f.find("[data-name=th_field_caption]"),s=f.find("[data-name=th_asset_caption]"),t=(f.find("[name=th_asset]"),gCONTEXT_PATH+"management/equip_stat_list.html",gCONTEXT_PATH+"sysdata/comcode_map.json"),u=gCONTEXT_PATH+"component/top5_chart.json",v=(gCONTEXT_PATH+"monitoring/performance_view.html",c),w=$.parseJSON(d),x={last_period:"10",label_type:"IP",rows:"5",list_yn:"N",curDate:(new Date).getTime(),section_name:w.section_name,log_cate_cd:"",group_cd:""},y=b,z=null,A=function(){this.config_param=y=$.extend({},x,y),F=$.extend(this.chartstyles,F),F.paletteColors=F.top5Colors,B(),r.html(LogCaptionInfo[w.section_name]),F.xAxisName=w.section_name,D()},B=function(){if(ComCodes.CS0010)I();else{var a=function(a){ComCodes.CS0010=a,I()};$("body").requestData(t,{code_type:"CS0010"},{callback:a})}if(ComCodes.CS0011)J();else{var a=function(a){ComCodes.CS0011=a,J()};$("body").requestData(t,{code_type:"CS0011"},{callback:a})}},C=function(){var a,b;ComCodes.CS0010&&(a=y.log_cate_cd?ComCodes.CS0010[y.log_cate_cd]:""),ComCodes.CS0011&&(b=y.group_cd?ComCodes.CS0011[y.group_cd]:""),""==a&&""==b?h.html("<h5>전체</h5>"):""==b?h.html("<h5>로그분류 : "+a+"</h5>"):""==a?h.html("<h5>기관 : "+b+"</h5>"):h.html("<h5>기관 : "+b+" , 로그종류  : "+a+"</h5>")},D=function(a){var b=function(b){z=$.extend(!0,{},b);var c=j.find("tbody").empty(),d=!!y.label_type;if("Y"==y.list_yn){i.show();var f;d&&"ASSET"==y.label_type?(s.show(),f=4):(s.hide(),f=3),0==b.list.length&&j.append('<tr><td class="list-empty" colspan="'+f+'">There is no result.</td></tr>')}else i.hide();for(var g=0;g<b.list.length;g++){var h=w.section_name+":"+_SL.luceneValueEscape(b.list[g].label),k=(JSON.stringify(h),"javascript:viewTop5LogSearch('"+b.start_time+"', '"+b.end_time+"', '"+g+"', '"+w.section_name+":"+_SL.luceneValueEscape(z.list[g].label)+"', '"+e+"')");if("Y"==y.list_yn){var l,m=$("<tr />").append("<td>"+(g+1)+"</td>").append('<td><a href="'+k+"\" name='search_log'>"+b.list[g].label+"</a></td>").append(d&&"ASSET"==y.label_type?$("<td>").text(b.list[g].asset_name).attr("title",b.list[g].asset_name):"").append("<td>"+_SL.toComma(b.list[g].value)+"</td>").appendTo(c);w.section_name.indexOf("country_name")!=-1&&(l=b.list[g].country_code,"N/A"==b.list[g].label&&(l="N-A"),"PRN"!=l?m.find("td:eq(1)").prepend('<img src="/resources/images/flag/'+l+'.png" alt="'+l+'" width="16" height="11">'):m.find("td:eq(1)").prepend('<i class="icon-lock"></i>'))}b.list[g].link=k,d&&"ASSET"==y.label_type?(b.list[g].toolText=(""==b.list[g].asset_name?b.list[g].label:b.list[g].asset_name+"("+b.list[g].label+")")+", "+b.list[g].value,b.list[g].label=""==b.list[g].asset_name?b.list[g].label:b.list[g].asset_name):"dstn_port"==w.section_name&&(b.list[g].label=" Port No : "+b.list[g].label)}c=null,C(),a===!0&&void 0!=$.Dashboard.chartInstance[e]?$.Dashboard.chartInstance[e].setJSONData({chart:F,categories:[],data:b.list}):FusionCharts.ready(function(){$.Dashboard.chartInstance[e]=new FusionCharts({type:"bar2d",renderAt:"chart-container_"+e,width:"100%",height:240,dataFormat:"json",dataSource:{chart:F,categories:[],data:b.list}}).render()})};w.section_name.indexOf("_ip")==-1&&(delete y.label_type,l.remove(),k.remove()),$("body").requestData(u,y,{callback:b})},E=function(){p.val(y.group_cd),q.val(y.log_cate_cd),m.val(y.last_period),n.val(y.label_type),o.val(y.rows),g.find("[name=list_yn]:input[value="+y.list_yn+"]").prop("checked",!0)},F={caption:"",subCaption:"",xAxisName:"",yAxisName:"Count",numberPrefix:"",maxLabelWidthPercent:"20"},G=function(){y.last_period=m.val(),y.label_type=n.val(),y.rows=o.val(),y.list_yn=g.find("[name=list_yn]:checked").val(),y.curDate=(new Date).getTime(),y.section_name=w.section_name,y.log_cate_cd=q.val(),y.group_cd=p.val()},H=function(){C(),D(!0)},I=function(){q.html('<option value="">[선택하세요]</option>');for(var a in ComCodes.CS0010)q.append($("<option>").val(a).text(ComCodes.CS0010[a]))},J=function(){p.html('<option value="">[선택하세요]</option>');for(var a in ComCodes.CS0011)p.append($("<option>").val(a).text(ComCodes.CS0011[a]))};return{config_param:y,component_title:v,load:A,refresh:D,showConfig:E,beforeSaveConfig:G,afterSaveConfig:H}},_SL.nmspc("slapp.component").total_risk=function(a,b,c,d){var e=a,f=($("#componentbody_"+e),$("#config_"+e+" form")),g=$("#result-container_"+e),h=f.find("#area-table-risk-level"),i=f.find("#area-table-risk-ruleset"),j=gCONTEXT_PATH+"component/total_risk_chart.json",k=gCONTEXT_PATH+"component/total_risk_data.json",l=gCONTEXT_PATH+"system/risk_ruleset_update.do",m=c,n=function(){o()},o=function(){$("body").requestData(j,{curDate:(new Date).getTime()},{callback:function(a){a>0&&a<6&&p(a)}})},p=function(a){switch(a){case 1:g.attr("class","text-success").text("Normal");break;case 2:g.attr("class","text-info").text("Attention");break;case 3:g.attr("class","text-attention").text("Notice");break;case 4:g.attr("class","text-warning").text("Alert");break;case 5:g.attr("class","text-danger").text("Serious")}},q=function(){$("body").requestData(k,{async:!1},{callback:function(a){h.empty(),i.empty(),r(a.level_list),s(a.levels,a.events,a.evtWgtConfig),f.find("[name=ratio]").change(t),f.find("[name=ratio]").css("background-color","")}})},r=function(a){var b=$('<table class="board-table-group table-risk-ruleset"></table>'),c=$("<colgroup>"),d=$("<thead>"),e=$("<tbody>"),f=$("<tr>");c.append("<col width=118>").append("<col span=4>"),f.append('<th scope="col">구분</th>');for(var g=1;g<a.length;g++)f.append('<th scope="col">'+a[g].risk_nm+"<br>"+a[g].risk_nm_eng+"</th>");d.append(f),f=$("<tr>"),f.append("<td>위험률</td>");for(var g=1;g<a.length;g++)f.append('<td><input type="text" name="risk_range_from" class="form-input" value="'+a[g].risk_range_from+'" data-valid="required,number,min=0,max=100">').append('<input type="hidden" name="risk_level" class="form-input" value="'+a[g].risk_level+'"</td>');e.append(f),b.append(c).append(d).append(e),b.appendTo(h)},s=function(a,b,c){var d=Object.keys(a).length,e=$('<table class="board-table-group table-risk-ruleset"></table>'),f=$("<colgroup>"),g=$("<thead>"),h=$("<tbody>"),j=$("<tr>");f.append("<col width=118>").append("<col width=84>").append("<col span=3>").append("<col width=72>"),j.append('<th scope="col" rowspan="2">이벤트</th>').append('<th scope="col" rowspan="2">위험도 비중(%)</th>').append('<th scope="col" colspan="3">등급 가중치(건당)</th>').append('<th scope="col" rowspan="2">위험도 산출<br/> 최대 건수</th>'),g.append(j),j=$("<tr>");for(var k=d;k>0;k--){var l;switch(k){case 1:l="highlight-success";break;case 2:l="highlight-attention";break;case 3:l="highlight-danger"}j.append('<th scope="col" class="'+l+'">'+a[k]+"</th>")}g.append(j);for(var m in b){if(j=$("<tr>"),5!=m){if(j.append("<td>"+b[m]+'<input type="hidden" name="event_type" value="'+m+'"></td>').append('<td><input type="text" name="ratio" class="form-input" value="'+c[m].ratio+'" data-valid="required,number,min=0,max=100"></td>'),4==m)for(var n=$("<td>").text("-").addClass("align-center").attr("colspan","3").appendTo(j),o=d;o>0;o--)n.append('<input type="hidden" name="lv'+o+'" class="form-input" value="1" data-valid="등급가중치,required,number,min=0,max=100">');else for(var o=d;o>0;o--)j.append('<td><input type="text" name="lv'+o+'" class="form-input" value="'+c[m]["lv"+o]+'" data-valid="등급가중치,required,number,min=0,max=100"></td>');j.append('<td><input type="text" name="max_cnt" class="form-input" value="'+c[m].max_cnt+'" data-valid="산정 최대건수,required,number,min=0,max=99999"></td>')}h.append(j)}e.append(f).append(g).append(h).appendTo(i)},t=function(){var a,b=f.find("[name=ratio]"),c=b.length-1,d=parseInt(this.value,10),e=b.eq(c)[0]==this,g=0;if(isNaN(d)||d<0||d>100){_alert("잘못된 입력 값입니다.");for(var h=0;h<=c;h++)a=b.eq(h)[0],this!=a&&(g+=parseInt(a.value,10));return this.value=100-g,this.focus(),!1}b.css("background-color",""),$(this).css("background-color","#ffff44"),g=d;for(var h=0;h<=c;h++)a=b.eq(h)[0],this!=a&&(g+=parseInt(a.value,10),(g>100||h==c+(e?-1:0))&&(a.value=parseInt(a.value,10)+100-g,$(a).css("background-color","#ffff44"),g=100))},u=function(){var a=f.find("[name=risk_range_from]"),b=-1,c=!0;if(!_SL.validate(f))return!1;for(var d=0;d<a.size();d++){if(parseInt(a.eq(d).val())<=b)return void _alert("이전 단계보다 위험율이 커야 합니다.",{onAgree:function(){a.eq(d).focus(),c=!1}});b=parseInt(a.eq(d).val())}return!!c&&($("body").requestData(l+"?"+f.serialize()),!0)},v=function(){o()};return{component_title:m,load:n,refresh:o,showConfig:q,validateConfig:u,afterSaveConfig:v}},_SL.nmspc("slapp.component").web_attack_top=function(a,b,c){var d=a,e=($("#"+d+"_inner_container"),$("#"+d+"_inner_container .goSmsView"),$("#componentbody_"+d)),f=$("#config_"+d+" form"),g=gCONTEXT_PATH+"component/web_attack_top_list.json",h=gCONTEXT_PATH+"event2/eps_security_event_list.html",i=$("#config_"+d+" .btn-apply"),j={last_period:"1440",rows:"5",start_time:""},k=b,l=c,m=function(){this.title=l,this.config_param=k=$.extend({},j,k),p(),s(),r()},n=function(){f.off().on("click",i,function(){k=$.extend({},_SL.serializeMap(f)),p(),s(),r()}),e.find(".grid-table-group tbody").find("[class*=color_ec]").off().on("click",function(){var a=$(this),b=a.data("s_src_ip"),c="1",d=a.data("s_event_cate_cd"),f=e.find("[name=webAttackTopForm]");$("[name=s_src_ip]",f).val(b),$("[name=s_tc_type]",f).val(c),$("[name=s_event_cate_cd]",f).val(d);var g="webAttackTopFormWin_"+(new Date).getTime();f.attr({action:h,target:g,method:"post"}).submit()}),$(".toolkitImg").each(function(){$(this).on("click",function(){o($(this).attr("data-ip"))})})},o=function(a){$("#hiddenIFrame").attr("src","/monitoring/va_toolkit.do?"+$.param({start_time:$("[name=start_time]").val(),end_time:$("[name=end_time]").val(),expert_keyword:"",src_ip:a,tc_type:1}))},p=function(){var a=e.find(".grid-table-group tbody"),b=e.find(".grid-table-group thead");a.empty(),b.empty(),a.children().remove(),k=k=$.extend({},j,k),$("body").requestData(g,k,{callback:function(c){var d=c.rsList,e=c.eventCates;$("[name=start_time]").val(c.start_time),$("[name=end_time]").val(c.end_time),b.append("<th scope='col'>HOST</th>");for(var f in e){var g=d[f],h="";h+="<th scope='col'>",h+="<span>",h+=1*f+1+"단계",h+="</span><br>("+e[f].code_name+")",b.append(h)}if(b.append("<th scope='col'>위험도</th>"),0==d.length){var i=$("<tr>");i.append($("<td colspan='8'> 검색 결과가 없습니다. </td>")),i.appendTo(a)}for(var f in d){var g=d[f],i=$("<tr>");i.append($("<td>"+g.src_ip+"</td>"));for(var j in e){var k=g["cate"+(1*j+1)+"_cnt"],l=$("<td>");l.append(k),0!=k&&l.attr("tabindex","1").addClass("color_ec"+(1*j+1)).data("s_src_ip",g.src_ip).data("s_event_cate_cd",1*j+1),l.appendTo(i)}var m="";m+="<td>"+g.risk_score+"%",m+="&nbsp; <button type='button' class='text-purple icon-download-square toolkitImg' data-ip='"+g.src_ip+"'></button>",m+="</td>",i.append($(m)),i.appendTo(a)}n()}})},q=function(){p()},r=function(){k.rows&&$("#config_"+d+" [name=rows] option").each(function(){$(this).val()==k.rows&&$(this).attr("selected",!0)})},s=function(){};return{config_param:k,component_title:l,load:m,refresh:q}};