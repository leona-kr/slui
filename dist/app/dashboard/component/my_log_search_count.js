"use strict";_SL.nmspc("slapp.component").my_log_search_count=function(a,b,c){var d=a,e=gCONTEXT_PATH+"monitoring/myfilter_list.json",f=gCONTEXT_PATH+"monitoring/myfilter_keywords.json",g=gCONTEXT_PATH+"monitoring/log_search_list.json",h=gCONTEXT_PATH+"monitoring/log_search.html",i={ok:"text-success",low:"text-attention",middle:"text-warning",high:"text-danger"},j=b,k=j.component_nm?j.component_nm:c,l={max_period_min:_SL.ifNull(1*slapp.component.my_log_search_count.admin_config.max_period_min,60)},m={component_nm:c,myfilter_name:"검색조건 : 없음",strQuery:"",searchPeriod:5,normal:0,low:0,middle:0,high:0,font_size:""},n={delay:1},o={tit:$("#componentheader_"+d+" .area-title"),body:$("#componentbody_"+d),form:$("#config_"+d+" form"),chtCntnr:$("#count-container_"+d)},p=function(){$("[name=searchPeriod] option",o.form).each(function(){this.value>l.max_period_min&&$(this).remove()}),$.extend(n,m,j),v(n.myfilter_id,n.myfilter_type,function(a){a.myfilter_id&&(n.strQuery=j.strQuery=a.strQuery),w(),q()}),o.chtCntnr.off("click").on("click",B)},q=function(){(j.component_nm||""==j.component_nm)&&o.tit.text(j.component_nm);var a=n.end_time=x(),b=n.start_time=_SL.formatDate.addMin(a,-n.searchPeriod),c={start_time:b,end_time:a,query:n.strQuery,search_type:"onlyCount"};z(),n.font_size?o.chtCntnr.css("font-size",n.font_size+"px"):o.chtCntnr.css("font-size",""),""!=n.strQuery&&$("body").requestData(g,c,{callback:function(a){A(a)}})},r=function(){var a=j.myfilter_id;o.form.find("[name=component_nm]").val(n.component_nm),o.form.find("[name=searchPeriod]").val(n.searchPeriod),o.form.find("[name=low]").val(n.low),o.form.find("[name=middle]").val(n.middle),o.form.find("[name=high]").val(n.high),o.form.find("[name=font_size]").val(n.font_size),$("body").requestData(e,{},{callback:function(b,c,e){var f=o.form.find("[name=myfilterInfo]");f.html('<option value="0">[선택하세요]</option>');for(var g=0,h=b.length;g<h;g++)$("<option>").attr(a==b[g].myfilter_id?{selected:!0}:{}).val(JSON.stringify(b[g])).text(b[g].myfilter_name).appendTo(f);slui.attach.setTransformSelect("#config_"+d+" form"),f.trigger("change")}}),(n.component_nm||""==n.component_nm)&&$("#config_"+d).find("h4").text(n.component_nm)},s=function(){return!!_SL.validate(o.form)},t=function(){for(var a,b=o.form.serializeArray(),c={},d=0;d<b.length;d++)c[b[d].name]=b[d].value;""!=c.myfilterInfo?(a=$.parseJSON(c.myfilterInfo),c.myfilter_id=a.myfilter_id,c.myfilter_type=a.myfilter_type,c.myfilter_name=a.myfilter_name):(c.myfilter_id="",c.myfilter_type="",c.myfilter_name=m.myfilter_name),delete c.myfilterInfo,this.config_param=j=c},u=function(){v(j.myfilter_id,j.myfilter_type,function(a){j.strQuery=a.strQuery,w(),q()})},v=function(a,b,c){var d={myfilter_id:"",myfilter_type:"",strQuery:""};a?$("body").requestData(f,{myfilter_id:a},{callback:function(e){e.view_fields&&$.extend(d,{myfilter_id:a,myfilter_type:b,viewFeidls:e.view_fields.split(",")}),d.strQuery=e.keywords,c(d)}}):c(d)},w=function(){$.extend(n,j);var a=x(),b=_SL.formatDate.addMin(a,-n.searchPeriod);n.start_time=b,n.end_time=a,y()},x=function(){return _SL.formatDate.addMin(gGetServerTime(),-n.delay)},y=function(){var a=o.body.find(".filter-detail h5"),b=n.myfilter_name,c=""==n.strQuery?"없음":n.strQuery;a.attr("data-ui","tooltip").data("text","검색조건 : "+c).html(b),z(),slui.attach.tooltip("#componentcontainer_"+d)},z=function(){var a=n.start_time,b=n.end_time;""!=n.strQuery?o.body.find(".rows-detail").text("["+_SL.formatDate(a,"HH:mm")+"~"+_SL.formatDate(b,"HH:mm")+"]"):o.body.find(".rows-detail").hide()},A=function(a){var b,c=j.low,d=j.middle,e=j.high,f=a.total;b=f<c?i.ok:f<d?i.low:f<e?i.middle:i.high,o.chtCntnr.removeClass().addClass(b).html(f)},B=function(){var a=n.strQuery,b=n.start_time,c=n.end_time,d=$("<form>").attr({target:"logSearchWin_"+(new Date).getTime(),action:h,method:"post"});d.append($("<input type='hidden' name='start_time'>").val(b)).append($("<input type='hidden' name='end_time'>").val(c)).append($("<input type='hidden' name='myfilter_id'>").val(j.myfilter_id)).append($("<input type='hidden' name='expert_keyword'>").val(a)).append($("<input type='hidden' name='template_id'>").val("popup")).appendTo("body").submit().remove()};return{config_param:j,component_title:k,load:p,refresh:q,beforeSaveConfig:t,validateConfig:s,afterSaveConfig:u,showConfig:r}};