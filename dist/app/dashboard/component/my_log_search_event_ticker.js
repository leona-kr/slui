"use strict";_SL.nmspc("component").my_log_search_event_ticker=function(a,b,c){var d=a,e=gCONTEXT_PATH+"component/my_log_search_event_ticker.json",f=gCONTEXT_PATH+"monitoring/myfilter_list.json",g=gCONTEXT_PATH+"monitoring/myfilter_keywords.json",h=gCONTEXT_PATH+"monitoring/log_search.html",i={ok:"highlight-success",low:"highlight-attention",middle:"highlight-warning",high:"highlight-danger"},j=b,k=j.component_nm?j.component_nm:c,l=!1,m={limit_period_min:_SL.ifNull(slapp.component.my_log_search_event_ticker.admin_config.limit_period_min,60),limit_row:_SL.ifNull(slapp.component.my_log_search_event_ticker.admin_config.limit_row,1e4)},n={isFirst:!0},o={component_nm:c,myFilterName:"",viewFields:["src_ip","dstn_ip","dstn_port"],searchRows:10,strQuery:"",limitRow:m.limit_row,limitMin:30,low:0,middle:0,high:0,delay:1},p={},q={tit:$("#componentheader_"+d+" .area-title"),body:$("#componentbody_"+d),listTable:$("#list_table_"+d),form:$("#config_"+d+" form")},r=function(){if($.extend(p,o),n.isFirst&&(q.form.find("[name=limitMin] option").each(function(){parseInt(this.value)>m.limit_period_min&&$(this).remove()}),q.form.find(".list_row").text(_SL.toComma(p.limitRow)),n.isFirst=!1),q.listTable.off("click").on("click",".mylogdata-td",function(a){a.preventDefault(),A($(this).parent())}),j){if($.extend(p,j),j.myfilter_type)return"1"==j.myfilter_type?void console.log("미지원 myfilter_type[1]!!!"):void $("body").requestData(g,{myfilter_id:p.myfilter_id},{callback:function(a){p.strQuery=a.keywords,p.myFilterName=j.myfilter_name,a.view_fields&&(p.viewFields=a.view_fields.replace(",eqp_dt","").replace("eqp_dt,","").split(","),j.viewFields||(that.config_param.viewFields=j.viewFields=p.viewFields)),x(),s(),t()}})}else this.config_param=j={};x(),s(),t()},s=function(){var a=1,b=p.limitMin,c=Math.min(b,360);p.periodUnit=a;var d=_SL.formatDate.addMin(gGetServerTime(),-p.delay),e=parseInt(d.substring(10,12),10)%a;0!=e&&(d=_SL.formatDate.addMin(d,a-e)),p.schEndTime=d,p.schStartTime=_SL.formatDate.addMin(d,-c)},t=function(){if((j.component_nm||""==j.component_nm)&&q.tit.text(j.component_nm),!l)if(""==p.myFilterName||""==p.strQuery)y({});else{p.schEndTime<_SL.formatDate.addMin(gGetServerTime(),-p.delay)&&(p.schEndTime=_SL.formatDate.addMin(p.schEndTime,p.periodUnit),p.schStartTime<=_SL.formatDate.addMin(p.schEndTime,-p.limitMin)&&(p.schStartTime=_SL.formatDate.addMin(p.schStartTime,p.periodUnit)));var a={query:p.strQuery,pageRow:p.searchRows,limitMin:p.limitMin,schStartTime:p.schStartTime,schEndTime:p.schEndTime,periodUnit:p.periodUnit,delay:p.delay,viewFields:p.viewFields.join(",")};$("body").requestData(e,a,{callback:function(a){p.limitMin=a.limit_min,p.limitRow=a.limit_row;var b=q.body.find(".sp-title h5");q.body.find(".list_row").html(_SL.toComma(p.limitRow));var c="["+_SL.formatDate(p.schStartTime,"yyyyMMddHHmm","MM-dd HH:mm");c+=" ~ ",c+=_SL.formatDate(p.schEndTime,"yyyyMMddHHmm","MM-dd HH:mm")+"]",""==p.myFilterName&&(p.myFilterName="검색조건 없음"),b.html(p.myFilterName+" - "+c).attr("data-ui","tooltip").data("text","검색조건 : "+p.strQuery),y(a)}})}},u=function(){this.isOpenConfig=l=!0;var a=j.myfilter_id;q.form.find("[name=component_nm]").val(p.component_nm),q.form.find("[name=limitMin]").val(p.limitMin),q.form.find("[name=searchRows]").val(p.searchRows),q.form.find("[name=low]").val(p.low),q.form.find("[name=middle]").val(p.middle),q.form.find("[name=high]").val(p.high),$("body").requestData(f,{},{callback:function(b){for(var c=q.form.find("[name=myFilterInfo]").html('<option value="">[선택하세요]</option>'),d=0,e=b.length;d<e;d++)$("<option />").attr(a==b[d].myfilter_id?{selected:!0}:{}).val(JSON.stringify(b[d])).text(b[d].myfilter_name).appendTo(c)}}),(p.component_nm||""==p.component_nm)&&$("#config_"+d+" h4").text(p.component_nm)},v=function(){var a,b;j.component_nm=q.form.find("[name=component_nm]").val(),j.limitMin=q.form.find("[name=limitMin]").val(),j.searchRows=q.form.find("[name=searchRows]").val(),j.low=q.form.find("[name=low]").val(),j.middle=q.form.find("[name=middle]").val(),j.high=q.form.find("[name=high]").val(),a=q.form.find("[name=myFilterInfo]").val(),""==a||null==a?(delete j.myfilter_id,delete j.myfilter_type,delete j.myfilter_name):""!=a&&(b=$.parseJSON(a),j.myfilter_id=b.myfilter_id,j.myfilter_type=b.myfilter_type,j.myfilter_name=b.myfilter_name),this.config_param=j},w=function(){this.isOpenConfig=l=!1,this.load()},x=function(){var a,b=(q.body.find(".sp_title"),q.listTable),c="";""==p.myFilterName&&(p.myFilterName="검색조건 없음"),p.schStartTime&&(c+=" - [",c+=_SL.formatDate(p.schStartTime,"yyyyMMddHHmm","yyyy-MM-dd HH:mm")+" ~ "+_SL.formatDate(p.schEndTime,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),c+="]");var d=j.viewFields?j.viewFields.join(","):"",e=p.viewFields?p.viewFields.join(","):"",f=b.find("thead"),g=b.find("tbody");if(d!=e&&(j.viewFields=p.viewFields,f.empty(),g.empty()),0==f.find("th").length){var a=$("<tr>").append("<th>번호</th>").append("<th>위험도</th>").append("<th>최근발생시간</th>");for(var h in p.viewFields)"eqp_dt"!=p.viewFields[h]&&a.append("<th>"+_SL.ifNull(LogCaptionInfo[p.viewFields[h]],p.viewFields[h])+"</th>");a.append("<th>건수</th>"),f.append(a)}0==g.find("td").length&&g.append('<tr><td colspan="'+p.viewFields.length+'4">검색중입니다...</td></tr>')},y=function(a){var b,c,e,f,g,h,j,k,l,m=_SL.ifNull(a.rsList,{}),n=_SL.ifNull(a.assetMap,{}),o=q.listTable,r=o.find("tbody").empty();if(m&&m.length>0){for(var s in m){b=m[s],j=b.group_by_count,g=$("<tr>"),k=parseInt(s)+1,g.append("<td class='mylogdata-td'>"+k+"</td>"),l=z(j),g.append("<td class='mylogdata-td '"+i[l]+">"+l+"</td>"),g.addClass("row-link"),h=$("<td>"),e=b.max_eqp_dt+"",f=_SL.formatDate(e,"yyyyMMddHHmm"),e=_SL.formatDate(e,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),h.attr("title",e).attr("data-value",f).append(e).appendTo(g);for(var t in p.viewFields)if(c=p.viewFields[t],e=b[c]+"",h=$("<td class='mylogdata-td'>"),"eqp_dt"!=c){if(c.indexOf("ip")>-1&&"-"!=e){var u="* 자산정보",v=n[e];v?(u+="<br> - 자산명 : "+v.asset_nm,u+="<br> - 아이피 : "+v.sip+"~"+v.eip,u+="<br> - 직급 : "+_SL.ifNull(v.grade,""),u+="<br> - 본부 : "+_SL.ifNull(v.division,""),u+="<br> - 부서 : "+_SL.ifNull(v.department,""),u+="<br> - 관리자 : "+_SL.ifNull(v.manager,"")):u+="가 없습니다.",h.attr({"data-value2":e,"data-ui":"tooltip"}).data("text",u).append(e)}else"recv_time"==c?(h.attr("data-value2",e),e=_SL.formatDate(e,"yyyyMMddHHmmss","yyyy-MM-dd HH:mm:ss"),h.append(e)):"dstn_country_code"==c||"src_country_code"==c?(h.attr("aria-value2",e),prefix=c.match(/^[^_]+_/),flagCode=b[prefix+"country_code"],flagCode&&("PRN"==flagCode?flagCode="PR-N":"N/A"==b[prefix+"country_name"]&&(flagCode="N-A"),h.append("<img src='/resources/images/flag/"+flagCode+".png' style='margin-right:5px;'>")),h.append(e)):(h.attr("data-value2",e),e.length>55&&(h.attr("title",e),e=_SL.htmlEscape(e),e=e.substring(0,55)+"..."),h.append(e));g.append(h)}g.append("<td class='mylogdata-td'>"+_SL.toComma(j)+"</td>").appendTo(r).hide().fadeIn(1500)}}else g=$("<tr height=25>").append("<td colspan='"+p.viewFields.length+"4'>검색 결과가 없습니다.</td>").appendTo(r).hide().fadeIn(1500);slui.attach.tooltip("#componentcontainer_"+d)},z=function(a){var b=p.low,c=p.middle,d=p.high;return 0==b&&(b=a+1),0==c&&(c=a+1),0==d&&(d=a+1),a>=b&&a<c?"low":a>=c&&a<d?"middle":a>=d?"high":"ok"},A=function(a){var b,c,d,e=p.viewFields,f=[],g=[],i="("+p.strQuery+")",j=a.find("td");for(var k in e)c=parseInt(k),d=e[c],b=$.trim(j.eq(c+3).attr("data-value2")),"eqp_dt"!=d&&("-"==b||""==b?g.push(d+":*"):f.push(d+":"+_SL.luceneValueEscape(b)));i+=" AND "+f.join(" AND "),g.length>0&&(i+=" NOT "+g.join(" NOT ")),$("<form>").attr({target:"MyLogSearchTickerWin_"+(new Date).getTime(),action:h,method:"post"}).append($("<input type='hidden' name='start_time'>").val(p.schStartTime)).append($("<input type='hidden' name='end_time'>").val(p.schEndTime)).append($("<input type='hidden' name='expert_keyword'>").val(i)).append($("<input type='hidden' name='template_id'>").val("popup")).appendTo("body").submit().remove()};return{config_param:j,component_title:k,isOpenConfig:l,load:r,refresh:t,showConfig:u,beforeSaveConfig:v,afterSaveConfig:w,goLogSearch:A}};