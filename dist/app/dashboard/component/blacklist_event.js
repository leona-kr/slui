"use strict";_SL.nmspc("slapp.component").blacklist_event=function(a,b,c){var d=a,e=$("#componentbody_"+d),f=$("#config_"+d+" form"),g=($("#config_"+d+" .btn-apply"),e.find("#"+d+"_table thead"),e.find(".grid-table-group")),h=(e.find(".goLogSearchView"),f.find("[name=last_period]")),i=f.find("[name=s_type]"),j=f.find("[name=ip_view_opt]"),k=f.find("[name=rows]"),l=(f.find("input:radio[name='pie']"),f.find("input:radio[name='area']"),f.find("input:radio[name='list']"),d+"_pie_chart_container"),m=d+"_area_chart_container",n="subPieChartContainer",o="subAreaChartContainer",p=gCONTEXT_PATH+"sysdata/comcode_map.json",q=gCONTEXT_PATH+"component/blacklist_event_list.json",r=gCONTEXT_PATH+"event/blacklist_event_main_chart_data.json",s=gCONTEXT_PATH+"event/blacklist_event_sub_chart_form.html",t=gCONTEXT_PATH+"event/blacklist_event_sub_chart_data.json",u=gCONTEXT_PATH+"monitoring/log_search.html",v=(gCONTEXT_PATH+"event/blacklist_event_update.json",{last_period:"10",list:"on"}),w=b,x=c,y=function(){this.title=x,this.config_param=w=$.extend({},v,w),$.Dashboard.chartInstance[d]=[],z(),P.dataSource.chart=$.extend(L,this.chartstyles),Q.dataSource.chart=$.extend(M,this.chartstyles),Q.dataSource.chart.labelDisplay="stagger",e.on("click",".goLogSearchView_"+d,function(){var a=$(this).attr("data-key").split(","),b=a[0],c=a[1],d=a[2];return J(b,c,d),!1}),FusionCharts&&(FusionCharts.items[d+"_pie_chart_id"]=null,delete FusionCharts.items[d+"_pie_chart_id"],FusionCharts.items[d+"_area_chart_id"]=null,delete FusionCharts.items[d+"_area_chart_id"],FusionCharts.items.subPieChartContainer=null,delete FusionCharts.items.subPieChartContainer,FusionCharts.items.subPreaChartContainer=null,delete FusionCharts.items.subPreaChartContainer),E()},z=function(){ComCodes.CS0021?I():$("body").requestData(p,{code_type:"CS0021"},{callback:function(a,b,c){ComCodes.CS0021=a,I()}}),F()},A=function(){h.val(w.last_period),i.val(w.s_type),j.val(w.ip_view_opt),k.val(w.rows)},B=function(){w.last_period=h.val(),w.s_type=i.val(),w.ip_view_opt=j.val(),w.rows=k.val(),w.pie=f.find("[name=pie]:checked").val(),w.area=f.find("[name=area]:checked").val(),w.list=void 0==f.find("[name=list]:checked").val()?"":f.find("[name=list]:checked").val()},C=function(){E()},D=function(a,b,c){new ModalPopup(s,{width:1e3,height:350,onOpen:R(a,b,c)})},E=function(a){var b,c=[],e=w&&"ASSET"==w.ip_view_opt,f=g.find("tbody"),h=w.last_period?w.last_period:v.last_period;w.end_time=_SL.formatDate(),w.start_time=_SL.formatDate.addMin(w.end_time,-h),"on"==w.list?(g.show(),$("body").requestData(q,w,{callback:function(a){f.children().remove();var g=a&&a.rsList?a.rsList:[];if(g&&0!=g.length)for(var h=0;h<g.length;h++){b=!!e&&""!=g[h].asset_name;var i="";i=0==h?"no1":"",i=h%2?"bg":"";var j="";j=b?g[h].asset_name+"("+g[h].blacklist_ip+")":g[h].blacklist_ip,""==g[h].domain&&(g[h].domain="-"),""==g[h].nation&&(g[h].nation="-"),""==g[h].type_nm&&(g[h].type_nm="-"),c[h]+="<tr class='"+i+"'><td>"+(h+1)+"</td>",c[h]+="<td><a href='#' class='goLogSearchView_"+d+"' aria-value='"+h+"' title='"+j+"' data-key='"+g[h].blacklist_ip+","+g[h].event_time+","+g[h].ip_type+"'>"+j+"</a></td>",c[h]+="<td>"+g[h].domain+"</td>",c[h]+="<td>"+g[h].nation+"</td>",c[h]+="<td>"+g[h].type_nm+"</td>",c[h]+="<td title='"+_SL.formatDate(g[h].event_time,"MM-dd HH:mm")+"'>"+_SL.formatDate(g[h].event_time,"MM-dd HH:mm")+"</td></tr>"}else f.append('<tr><td class="list-empty" colspan="6">There is no Search Result</td></tr>');f.append(""+c.join(",")),c=[]}})):g.hide(),w.area||w.pie?H(a):($("#"+d+"_pie_chart_container").hide(),$("#"+d+"_area_chart_container").hide()),G()},F=function(){w.last_period&&$("#config_"+d+" [name=last_period] option").each(function(){$(this).val()==w.last_period&&$(this).prop("selected",!0)}),w.ip_view_opt&&$("#config_"+d+" [name=ip_view_opt] option").each(function(){$(this).val()==w.ip_view_opt&&$(this).prop("selected",!0)}),I(),w.rows&&$("#config_"+d+" [name=rows] option").each(function(){$(this).val()==w.rows&&$(this).prop("selected",!0)}),w.pie&&$("#config_"+d+" #pie").prop("checked",!0),w.area&&$("#config_"+d+" #area").prop("checked",!0),w.list&&$("#config_"+d+" #list").prop("checked",!0)},G=function(){var a="",b=0;for(var c in w)""!=w[c]&&"s_type"==c&&(a+="IP유형 : ",ComCodes.CS0021?a+=ComCodes.CS0021[w[c]]:$("body").requestData(p,{code_type:"CS0021"},{callback:function(b,d,e){ComCodes.CS0021=b,a+=ComCodes.CS0021[w[c]]}}),b++);var e=0==b?"전체":a;$("#componentbody_"+d+" .sp-title h5").text(e)},H=function(a){var b,c,e=w.last_period?w.last_period:v.last_period;c=_SL.formatDate(),b=_SL.formatDate.addMin(c,-e),w.pie||$("#"+d+"_pie_chart_container").hide(),w.area||$("#"+d+"_area_chart_container").hide(),$.getJSON(r,{start_time:b,end_time:c,s_type:w.s_type},function(b){S.groupByPeriod=b.groupByPeriod;var c=b.labels,e=b.pieChartDataList,f=b.areaChartDataList,g=b.categorys;""!=w.s_type&&(c=[ComCodes.CS0021[w.s_type]]);var h=P,i=Q;h.renderAt=l,i.renderAt=m,h.dataSource.chart.caption="유형별 현황",i.dataSource.chart.caption="유형별 시간대별 현황",h.dataSource.data=[],i.dataSource.categories=[],i.dataSource.dataset=[],i.dataSource.categories.push({category:g});for(var j in c)if(w.pie&&(h.dataSource.data.push(S.getData(c[j],e,!1)),$("#"+d+"_pie_chart_container").show()),w.area){i.dataSource.dataset.push({seriesname:c[j],data:[]});for(var k in g)i.dataSource.dataset[j].data.push(S.getDataset(c[j],g[k].label,f,!1));$("#"+d+"_area_chart_container").show()}setTimeout(function(){1!=a&&void 0==$.Dashboard.chartInstance[d]|void 0==$.Dashboard.chartInstance[d][0]?FusionCharts.ready(function(){$.Dashboard.chartInstance[d][0]=new FusionCharts(h).render()}):$.Dashboard.chartInstance[d][0].setJSONData(h.dataSource),1!=a&&void 0==$.Dashboard.chartInstance[d][1]?FusionCharts.ready(function(){$.Dashboard.chartInstance[d][1]=new FusionCharts(i).render()}):$.Dashboard.chartInstance[d][1].setJSONData(i.dataSource)},1e3)})},I=function(){i.empty(),i.append(new Option("[선택하세요]",""));for(var a in ComCodes.CS0021){var b=new Option(ComCodes.CS0021[a],a);w.s_type==a&&(b.selected=!0),i.append(b)}},J=function(a,b,c){var d=b,e=_SL.formatDate.addMin(d,1),g="1"==c?"src_ip":"dstn_ip",h=f.find("[name='logSearchForm']");0==h.length&&(h=$('<form name="logSearchForm">'),h.append('<input type="hidden" name="start_time">'),h.append('<input type="hidden" name="end_time">'),h.append('<input type="hidden" name="filter_type"'),h.append('<input type="hidden" name="expert_keyword">'),h.append('<input type="hidden" name="template_id" value="popup">'),f.append(h)),$("[name=start_time]",h).val(d),$("[name=end_time]",h).val(e),$("[name=filter_type]",h).val("2"),$("[name=expert_keyword]",h).val(g+":"+a);var i="logSearchWin_"+(new Date).getTime();h.attr({target:i,action:u}).submit()},K=function(a,b){b=b.replace(/\D/gi,"");var c,d,e=w.last_period?w.last_period:v.last_period;d=_SL.formatDate(),c=_SL.formatDate.addMin(d,-e),""!=b&&(d=_SL.formatDate.addMin(b,S.groupByPeriod),c=b);var g=f.find("[name='logSearchForm']");0==g.length&&(g=$('<form name="logSearchForm">'),g.append('<input type="hidden" name="start_time">'),g.append('<input type="hidden" name="end_time">'),g.append('<input type="hidden" name="filter_type"'),g.append('<input type="hidden" name="expert_keyword">'),g.append('<input type="hidden" name="template_id" value="popup">'),f.append(g)),$("[name=start_time]",g).val(c),$("[name=end_time]",g).val(d),$("[name=filter_type]",g).val("2"),$("[name=expert_keyword]",g).val("src_ip:"+a+" OR dstn_ip:"+a);var h="logSearchWin_"+(new Date).getTime();g.attr({target:h,action:u}).submit()},L={caption:"유형별 현황",pieRadius:"130",showpercentintooltip:"0",startingangle:"125"},M={caption:"유형별 시간대별 현황",numvdivlines:"10",showlabels:"0",showvalues:"0"},N={caption:"유형별 현황",pieRadius:"130",showpercentintooltip:"0",startingangle:"125"},O={caption:"유형별 시간대별 현황",numvdivlines:"10",showlabels:"0",showvalues:"0"},P={type:"pie3d",renderAt:l,width:"100%",height:"240",dataFormat:"json",dataSource:{chart:L,data:[]}},Q={type:"msline",renderAt:m,width:"100%",height:"240",dataFormat:"json",dataSource:{chart:M,categories:[],dataset:[]}},R=function(a,b,c){a=a.replace(/\D/gi,""),S.ip_type=b;var e=$.extend(!0,{},P),f=$.extend(!0,{},Q);e.dataSource.chart.showBorder="1",f.dataSource.chart.showBorder="1",e.renderAt=n,f.renderAt=o,e.height="300",f.height="300",e.dataSource.chart=$.extend(N,slui.chart.chartConfig),f.dataSource.chart=$.extend(O,slui.chart.chartConfig),e.dataSource.chart.showBorder="1",f.dataSource.chart.showBorder="1",e.dataSource.chart.caption="["+decodeURIComponent(c)+"]TOP "+S.top_limit+" 현황",f.dataSource.chart.caption="["+decodeURIComponent(c)+"]시간대별 TOP "+S.top_limit+" 현황";var g,h,i=w.last_period?w.last_period:v.last_period;h=_SL.formatDate(),g=_SL.formatDate.addMin(h,-i),""!=a&&(h=_SL.formatDate.addMin(a,S.groupByPeriod),g=a),$.getJSON(t,{top_limit:S.top_limit,start_time:g,end_time:h,s_type:b,s_blacklist_ip:$("input[name=s_blacklist_ip]").val(),s_domain:$("input[name=s_domain]").val(),s_nation:$("input[name=s_nation]").val()},function(a){S.groupByPeriod=a.groupByPeriod;var b=a.labels,c=a.pieChartDataList,g=a.areaChartDataList,h=a.categorys;e.dataSource.data=[],f.dataSource.categories=[],f.dataSource.dataset=[],f.dataSource.categories.push({category:h});for(var i in b){e.dataSource.data.push(S.getData(b[i],c,!0)),f.dataSource.dataset.push({seriesname:b[i],data:[]});for(var j in h)f.dataSource.dataset[i].data.push(S.getDataset(b[i],h[j].label,g,!0))}$.Dashboard.chartInstance[d].length>2&&($.Dashboard.chartInstance[d][2].dispose(),$.Dashboard.chartInstance[d][3].dispose()),setTimeout(function(){FusionCharts.ready(function(){$.Dashboard.chartInstance[d][2]=new FusionCharts(e).render()}),FusionCharts.ready(function(){$.Dashboard.chartInstance[d][3]=new FusionCharts(f).render()})},1e3)})},S={top_limit:10,groupByPeriod:1,getDataset:function(a,b,c,e){var f={value:0};for(var g in c)if(a==c[g].label&&b==c[g].category){f=e?{value:c[g].value,link:'javascript:$.Dashboard.componentInstance["'+d+'"].goSearchPopup("'+c[g].label+'", "'+c[g].category+'")'}:{value:c[g].value,link:'javascript:$.Dashboard.componentInstance["'+d+'"].subChartInit("'+c[g].category+'", "'+c[g].type+'", "'+_SL.htmlEscape(c[g].label)+'")'};break}return f},getData:function(a,b,c){var e={label:a,value:0};for(var f in b)if(a==b[f].label){e=c?{label:b[f].label,value:b[f].value,link:'javascript:$.Dashboard.componentInstance["'+d+'"].goSearchPopup("'+b[f].label+'", "")'}:{label:b[f].label,value:b[f].value,link:'javascript:$.Dashboard.componentInstance["'+d+'"].subChartInit("", "'+b[f].type+'", "'+_SL.htmlEscape(b[f].label)+'")'};break}return e}};return{config_param:w,component_title:x,load:y,refresh:E,subChartInit:D,goSearchPopup:K,showConfig:A,beforeSaveConfig:B,afterSaveConfig:C}};