"use strict";_SL.nmspc("blacklist").list=function(){var a={gridId:"#gridBlacklist",formId:"#searchBlacklist",urlList:gCONTEXT_PATH+"event/blacklist_list.json",urlForm:gCONTEXT_PATH+"event/blacklist_form.html",urlDelete:gCONTEXT_PATH+"event/blacklist_delete.do",urlImportForm:gCONTEXT_PATH+"event/blacklist_import_form.html",urlDownload:gCONTEXT_PATH+"event/blacklist_export.do"},b={grid:$(a.gridId),form:$(a.formId)},c=function(){e(b.grid),d()},d=function(){var c=b.grid.parent().siblings(".grid-bottom").find(".btn-add"),d=b.grid.parent().siblings(".grid-bottom").find(".btn-delete"),e=b.grid.parent().siblings(".grid-bottom").find(".btn-import"),j=b.form.find(".btn-download");b.form.find(".form-submit").on("click",function(){f()}),c.off().on("click",function(){g(a.urlForm)}),d.off().on("click",function(){var a=[],c=b.grid.jqxGrid("selectedrowindexes"),d=b.grid.jqxGrid("getdisplayrows"),e=[];for(var f in d)for(var g=0,i=c.length;g<i;g++)c[g]==d[f].boundindex&&e.push(d[f].boundindex);if(e.length>0){for(var g in e){var j=b.grid.jqxGrid("getrowdata",e[g]);if(!j)break;a.push(j.blacklist_ip)}h(a)}else _alert("선택한 IP가 없습니다.")}),e.off().on("click",function(){new ModalPopup(a.urlImportForm,{height:170,onClose:function(){f()}})}),j.off().on("click",function(){i()})},e=function(c){var d={datatype:"json",datafields:[{name:"blacklist_ip",type:"string"},{name:"type_nm",type:"string"},{name:"domain",type:"string"},{name:"nation",type:"string"},{name:"expire_dt",type:"string"},{name:"reg_dt",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(d.totalrecords=a.totalRows)},cache:!1,url:a.urlList},e=new $.jqx.dataAdapter(d,{beforeLoadComplete:function(a){for(var b in a)a[b].reg_dt=_SL.formatDate(a[b].reg_dt,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),a[b].expire_dt&&(a[b].expire_dt=_SL.formatDate(a[b].expire_dt,"yyyyMMdd","yyyy-MM-dd"));return a},formatData:function(a){var c,d={},e=b.form.serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(a,d),a},loadError:function(a,b,c){alert(c)}});c.jqxGrid({source:e,sortable:!0,width:"100%",virtualmode:!0,selectionmode:"checkbox",enablehover:!1,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"유해IP",datafield:"blacklist_ip",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).html('<button type="button" class="btn-link">'+c+"</button>")[0].outerHTML}},{text:"유형",datafield:"type_nm",cellsalign:"center"},{text:"도메인",datafield:"domain"},{text:"국가",datafield:"nation",cellsalign:"center",width:"15%"},{text:"만료일자",datafield:"expire_dt",cellsalign:"center",width:"12%"},{text:"등록시간",datafield:"reg_dt",cellsalign:"center",width:"15%"}]}),c.on("cellclick",function(b){if("blacklist_ip"===b.args.datafield){var c=b.args.row.bounddata.blacklist_ip;g(a.urlForm+"?blacklist_ip="+c)}})},f=function(){_SL.validate(b.form)&&(b.grid.jqxGrid("updatebounddata"),b.grid.jqxGrid("clearselection"))},g=function(a){new ModalPopup(a,{height:340,onClose:function(){f()}})},h=function(b){_confirm("삭제 하시겠습니까?",{onAgree:function(){$("body").requestData(a.urlDelete,{del_ip_list:b},{callback:function(a){f()}})}})},i=function(){_SL.validate(b.form)&&b.form.attr({action:a.urlDownload}).submit()};return{init:c}}(),$(function(){slapp.blacklist.list.init()});