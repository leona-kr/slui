"use strict";_SL.nmspc("blacklist").form=function(){var a={formId:"#formBlacklist",urlSelect:gCONTEXT_PATH+"event/blacklist.json",urlComCodeForm:gCONTEXT_PATH+"sysdata/comcode_form.html",urlExist:gCONTEXT_PATH+"event/blacklist_exist.json",urlDelete:gCONTEXT_PATH+"event/blacklist_delete.do",urlRangeInsert:gCONTEXT_PATH+"event/blacklist_range_add.do",add:{action:gCONTEXT_PATH+"event/blacklist_insert.do",message:"등록 하시겠습니까?"},update:{action:gCONTEXT_PATH+"event/blacklist_update.do",message:"수정 하시겠습니까?"}},b={form:$(a.formId),blacklistIp:$(a.formId+" [name=blacklist_ip]"),blacklistIp2:$(a.formId+" [name=blacklist_ip2]"),btnTypeCodeAdd:$(a.formId+" .btn-register-type"),expDt:$(a.formId+" [name=expire_dt]"),timeSet:$(a.formId+" [name=timeSet]")},c={isNew:""==b.blacklistIp.val(),mode:""==b.blacklistIp.val()?a.add:a.update},d=function(){e(),c.isNew?b.form.find(".btn-delete").hide():(b.blacklistIp.addClass("form-text").prop("readonly",!0),b.form.find(".blacklist_ip2_text").hide()),c.isNew||f()},e=function(){b.form.find(".btn-save").on("click",g),b.form.find(".btn-delete").on("click",h),b.btnTypeCodeAdd.exModalPopup(a.urlComCodeForm+"?code_type="+b.btnTypeCodeAdd.data("value"),{width:550,height:455,draggable:!0,onClose:function(){i(b.form.find("[name=type]")),slui.attach.setTransformSelect(a.formId)}}),b.timeSet.change(function(){var a=this.value,c=_SL.formatDate("yyyyMMdd");if(0==a)b.expDt.val("");else{var d=_SL.formatDate.addMin(c+"0000",a);b.expDt.val(d.substring(0,8))}}),b.expDt.change(function(){b.timeSet.val(0),slui.attach.setTransformSelect(a.formId)})},f=function(){var c={blacklist_ip:b.blacklistIp.val()},d=function(a){_SL.setDataToForm(a,b.form)};$("body").requestData(a.urlSelect,c,{callback:d})},g=function(){if(_SL.validate(b.form)){var d=1==$(this).data("after-close"),e=b.blacklistIp.val(),f=b.blacklistIp2.val(),g=b.expDt.val(),h=function(){$("body").requestData(c.mode.action,_SL.serializeMap(b.form),{callback:function(a,b,c){_alert(c,{onAgree:function(){j(d)}})}})};if(g){var i=_SL.formatDate("yyyyMMdd");if(i>g)return void _alert("만료일이 현재시간보다 작습니다.")}if(f){if(1==_SL.ip.compare(e,f))return void _alert("시작 IP가 종료 IP보다 큽니다.",{onAgree:function(){b.blacklistIp.focus()}});$("body").requestData(a.urlRangeInsert,_SL.serializeMap(b.form),{callback:function(a,b,c){1==a?_alert(c,{onAgree:function(){j(d)}}):_alert(c)}})}else c.isNew?$("body").requestData(a.urlExist,{blacklist_ip:e},{callback:function(a,b,c){1==a?h():_alert(c)}}):h()}},h=function(){var c=1==$(this).data("after-close");_confirm("삭제하시겠습니까?",{onAgree:function(){var d=b.blacklistIp.val();$("body").requestData(a.urlDelete,{blacklist_ip:d},{callback:function(a,b,d){_alert(d,{onAgree:function(){j(c)}})}})}})},i=function(a){var b=slapp.comcode.form.getCode();a.append("<option value='"+b.code_id+"' selected='selected'>"+b.code_name+"</option>")},j=function(a){a&&b.form.find("[data-layer-close=true]").click()};return{init:d}}(),$(function(){slapp.blacklist.form.init()});