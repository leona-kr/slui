"use strict";_SL.nmspc("searchEventDuplication").form=function(){var a={formId:"#formSearchDuplication",urlSelect:gCONTEXT_PATH+"event/search_event_duplication.json",urlDuplInfo:gCONTEXT_PATH+"event/get_search_event_duplication_info.json",urlComCodeForm:gCONTEXT_PATH+"sysdata/comcode_form.html",urlDelete:gCONTEXT_PATH+"event/search_event_duplication_delete.do",add:{action:gCONTEXT_PATH+"event/search_event_duplication_add.do",message:"등록 하시겠습니까?"},update:{action:gCONTEXT_PATH+"event/search_event_duplication_update.do",message:"수정 하시겠습니까?"}},b={form:$(a.formId),seq:$(a.formId+" [name=seq]"),chk:$(a.formId+" [name=chk]"),rulesetId:$(a.formId+" [name=ruleset_id]"),timeSet:$(a.formId+" [name=timeSet]"),schStartDay:$(a.formId+" [name=schStartDay]"),schStartHour:$(a.formId+" [name=schStartHour]"),schStartMin:$(a.formId+" [name=schStartMin]"),schEndDay:$(a.formId+" [name=schEndDay]"),schEndHour:$(a.formId+" [name=schEndHour]"),schEndMin:$(a.formId+" [name=schEndMin]"),groupFieldSel:$(a.formId+" [name=group_field_sel]")},c={isNew:"insert"==b.chk.val(),mode:"insert"==b.chk.val()?a.add:a.update},d=function(){e(),c.isNew&&b.form.find(".btn-delete").hide(),c.isNew?g():f()},e=function(){b.form.find(".btn-save").on("click",h),b.form.find(".btn-delete").on("click",i),b.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var c=_SL.formatDate.addMin(_SL.formatDate(),+a);b.form.find("[name=schEndDay]").val(c.substring(0,8)),b.form.find("[name=schEndHour]").val(c.substring(8,10)),b.form.find("[name=schEndMin]").val(c.substring(10,12))}}),b.form.find("[name=schStartDay],[name=schStartHour],[name=schStartMin],[name=schEndDay],[name=schEndHour],[name=schEndMin]").change(function(){b.form.find("[name=timeSet]").val(0)})},f=function(){var c=b.seq.val(),d={seq:c},e=function(a){if(_SL.setDataToForm(a,b.form),a.group_field){var c=a.group_field.split(",");for(var d in c){var e=c[d];b.groupFieldSel.append("<option value='"+e+"'>"+gFieldCaptions[e]+"("+e+")</option>")}}};$("body").requestData(a.urlSelect,d,{callback:e})},g=function(){var c=b.seq.val(),d={event_seq:c},e=function(a){if(_SL.setDataToForm(a,b.form),a.group_field){var c=a.group_field.split(",");for(var d in c){var e=c[d];b.groupFieldSel.append("<option value='"+e+"'>"+gFieldCaptions[e]+"("+e+")</option>")}}};$("body").requestData(a.urlDuplInfo,d,{callback:e})},h=function(){if(_SL.validate(b.form)){var a=b.schStartDay.val()+b.schStartHour.val()+b.schStartMin.val(),d=b.schEndDay.val()+b.schEndHour.val()+b.schEndMin.val(),e=_SL.formatDate.diff(a,d);if(e<=0)return void alert("중복기간 종료시간이 시작시간보다 커야 합니다.");b.groupFieldSel.find("option").attr("selected",!0);var f=1==$(this).data("after-close"),g=b.groupFieldSel.val()?b.groupFieldSel.val().join(","):"",h=b.rulesetId.val(),i=$.extend(_SL.serializeMap(b.form),{ruleset_id:h,group_field:g}),k=function(){$("body").requestData(c.mode.action,i,{callback:function(a,b,d){_alert(d,{onAgree:function(){j(f),c.isNew&&slapp.searchEvent.manager.refresh()}})}})};k()}},i=function(){var c=1==$(this).data("after-close");_confirm("삭제하시겠습니까?",{onAgree:function(){var d=b.seq.val();$("body").requestData(a.urlDelete,{seq:d},{callback:function(a,b,d){_alert(d,{onAgree:function(){j(c)}})}})}})},j=function(a){a&&b.form.find("[data-layer-close=true]").click()};return{init:d}}(),$(function(){slapp.searchEventDuplication.form.init()});