"use strict";_SL.nmspc("searchRuleset").list=function(){var a={gridId:"#gridSearchRuleset",formId:"#searchSearchRuleset",urlList:gCONTEXT_PATH+"event/search_ruleset_list.json",urlForm:gCONTEXT_PATH+"event/search_ruleset_form.html",urlOnOff:gCONTEXT_PATH+"event/search_ruleset_onoff.json",urlImportForm:gCONTEXT_PATH+"event/search_ruleset_import_form.html",urlDownload:gCONTEXT_PATH+"event/search_ruleset_export.do"},b={grid:$(a.gridId),form:$(a.formId)},c=function(){d(b.grid),e()},d=function(c){var d=["Low","Middle","High"],e=["label-success","label-attention","label-danger"],f={datatype:"json",datafields:[{name:"ruleset_id",type:"string"},{name:"use_yn",type:"string"},{name:"event_nm",type:"string"},{name:"event_cate_nm",type:"string"},{name:"event_level",type:"string"},{name:"cvt_group_field",type:"string"},{name:"limit_count",type:"string"},{name:"distinct_count",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(f.totalrecords=a.totalRows)},cache:!1,url:a.urlList},g=new $.jqx.dataAdapter(f,{beforeLoadComplete:function(a){},formatData:function(a){var c,d={},e=b.form.serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(a,d),a},loadError:function(a,b,c){alert(c)}});c.jqxGrid({source:g,sortable:!0,width:"100%",virtualmode:!0,selectionmode:"checkbox",enablehover:!1,rendergridrows:function(a){return a.data},columns:[{text:"상태",datafield:"use_yn",width:50,cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g="on",h="1";return"N"==c&&(g="off",h="0"),$(d).css("margin-top","4px").html('<button type="button" data-ruleset_id="'+f.ruleset_id+'" class="onoff-icon btn-switch-'+g+'" value="'+h+'" data-switch-toggle="true"><span class="text-on">ON</span><span class="text-off">OFF</span></button>')[0].outerHTML}},{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"이벤트명",datafield:"event_nm",width:"25%",cellsrenderer:function(a,b,c,d,e,f){return $(d).html('<button type="button" class="btn-link">'+c+"</button>")[0].outerHTML}},{text:"분류",datafield:"event_cate_nm",cellsalign:"center"},{text:"등급",datafield:"event_level",cellsalign:"center",cellsrenderer:function(a,b,c,f,g,h){return $(f).html('<span class="'+e[c-1]+'" style="float:left;margin-left:10px;">'+d[c-1]+"</span>")[0].outerHTML}},{text:"기준필드",datafield:"cvt_group_field",width:"18%"},{text:"임계치",datafield:"limit_count",cellsalign:"center",width:100,cellsrenderer:function(a,b,c,d,e,f){var g=c;return f.distinct_count&&(g=c+"/"+f.distinct_count),$(d).html(g)[0].outerHTML}}]}),c.on("cellclick",function(b){if("event_nm"===b.args.datafield){var c=b.args.row.bounddata.ruleset_id;i(a.urlForm+"?ruleset_id="+c)}})},e=function(){var c=b.grid.parent().siblings(".grid-bottom").find(".btn-add"),d=b.grid.parent().siblings(".grid-bottom").find(".btn-import"),e=b.grid.parent().siblings(".grid-bottom").find(".btn-apply"),j=b.form.find(".btn-download");b.form.find(".form-submit").on("click",function(){h()}),c.off().on("click",function(){i(a.urlForm)}),e.off().on("click",function(){f()}),j.off().on("click",function(){g()}),d.off().on("click",function(){new ModalPopup(a.urlImportForm,{height:175,onClose:function(){h()}})})},f=function(){var c=[];b.grid.find("*[class*='btn-switch-']").each(function(){c.push({ruleset_id:$(this).data("ruleset_id"),use_yn:"1"==$(this).val()?"Y":"N"})}),0==c.length?_alert("On/Off 적용할 건을 선택하세요."):_confirm("적용 하시겠습니까??",{onAgree:function(){$("body").requestData(a.urlOnOff,c,{callback:function(a,b,c){h(),_alert(c)}})},onDisagree:function(){}})},g=function(){b.form.attr({action:a.urlDownload}).submit()},h=function(){b.grid.jqxGrid("updatebounddata"),b.grid.jqxGrid("clearselection")},i=function(a){new ModalPopup(a,{width:800,height:500,onClose:function(){h()}})},g=function(){_SL.validate(b.form)&&b.form.attr({action:a.urlDownload}).submit()};return{init:c}}(),$(function(){slapp.searchRuleset.list.init()});