"use strict";_SL.nmspc("sms").list=function(){var a={s_eqp_type_cd:"",s_eqp_ip:""},b={urlList:gCONTEXT_PATH+"event/sms_event_list.json",urlView:gCONTEXT_PATH+"monitoring/performance_view.html",urlUpdate:gCONTEXT_PATH+"event/sms_event_update.json",urlLoadEqpType:gCONTEXT_PATH+"common/eqp_type_use_list.json",urlLoadEqp:gCONTEXT_PATH+"common/equipment_list.json",gridId:"#gridSmsEventList",formId:"#searchSmsEventList",progBarId:"#view_dlg_progressBar"},c={grid:$(b.gridId),form:$(b.formId),progBar:$(b.progBarId)},d=function(){f(c.grid),c.form.find(".form-submit").off().on("click",function(){return""==c.form.find("[name=s_eqp_ip]").val()&&""!=c.form.find("[name=s_eqp_type_cd]").val()?_alert("장비IP를 선택하세요"):void(_SL.validate(c.form)&&g())}),c.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var b=function(a,b){var c=a.siblings(".tform-select");c.find(".tform-select-t").text(b).end().find(".tform-select-option[data-value="+b+"]").addClass("selected").end(),a.val(b)},d=_SL.formatDate.addMin(c.form.find("[name=endDay]").val()+c.form.find("[name=endHour]").val()+c.form.find("[name=endMin]").val(),-a);b(c.form.find("[name=startDay]"),d.substring(0,8)),b(c.form.find("[name=startHour]"),d.substring(8,10)),b(c.form.find("[name=startMin]"),d.substring(10,12))}}),c.form.find("[name=startDay],[name=startHour],[name=startMin],[name=endDay],[name=endHour],[name=endMin]").change(function(){var a=c.form.find("[name=timeSet]"),b=a.siblings(".tform-select").find("[data-value=0]").text();a.val(0).siblings(".tform-select").find(".tform-select-t").text(b)}),e(),c.form.find("[name=s_eqp_type_cd]").change(j),i()},e=function(){var a=c.grid.parent().siblings(".grid-bottom").find(".btn-handling");a.off().on("click",function(){var a=c.grid.jqxGrid("selectedrowindexes"),d=a.length,e=c.grid.jqxGrid("getdisplayrows"),f=e.length,h=$(this).attr("data-handle-type"),i=$(this).text();return d<1?void _alert(i+"할 이벤트를 체크해주세요."):void _confirm("이벤트를 "+i+" 하시겠습니까?",{onAgree:function(){for(var c=0,i=0;i<d;i++){if(i==f)return g();var j=e[a[i]],k=(_SL.formatDate(j.eqp_time,"yyyy-MM-dd HH-mm","yyyyMMddHHmm"),j.eqp_dt+","+j.eqp_ip+","+h);$("body").requestData(b.urlUpdate,{key:k},{callback:function(a){c++,c==d&&g()}})}}})})},f=function(a){var d={datatype:"json",datafields:[{name:"eqp_time",type:"string"},{name:"eqp_ip",type:"string"},{name:"eqp_type_cd",type:"string"},{name:"eqp_nm",type:"string"},{name:"cpu_status",type:"string"},{name:"cpu_used",type:"string"},{name:"cpu_limit",type:"string"},{name:"cpu_level",type:"string"},{name:"mem_status",type:"string"},{name:"mem_used",type:"string"},{name:"mem_limit",type:"string"},{name:"mem_level",type:"string"},{name:"io_read_status",type:"string"},{name:"read_bytes",type:"string"},{name:"io_read_limit",type:"string"},{name:"io_read_level",type:"string"},{name:"io_write_status",type:"string"},{name:"write_bytes",type:"string"},{name:"io_write_limit",type:"string"},{name:"io_write_level",type:"string"},{name:"net_rx_status",type:"string"},{name:"rx_bytes",type:"string"},{name:"net_rx_limit",type:"string"},{name:"net_rx_level",type:"string"},{name:"net_tx_status",type:"string"},{name:"tx_bytes",type:"string"},{name:"net_tx_limit",type:"string"},{name:"net_tx_level",type:"string"},{name:"handling_type_cd",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(d.totalrecords=a.totalRows)},cache:!1,url:b.urlList},e=new $.jqx.dataAdapter(d,{beforeLoadComplete:function(a){_SL.formatNumber.Options.decimals=1;for(var b in a)switch(a[b].eqp_dt=a[b].eqp_time,a[b].eqp_time=_SL.formatDate(a[b].eqp_time,"yyyyMMddHHmm","yyyy-MM-dd HH:mm"),a[b].mem_limit=_SL.formatNumber(a[b].mem_limit),a[b].mem_used=_SL.formatNumber(a[b].mem_used),a[b].io_read_limit=_SL.formatNumber(a[b].io_read_limit),a[b].read_bytes=_SL.formatNumber(a[b].read_bytes),a[b].io_write_limit=_SL.formatNumber(a[b].io_write_limit),a[b].write_bytes=_SL.formatNumber(a[b].write_bytes),a[b].net_rx_limit=_SL.formatNumber(a[b].net_rx_limit),a[b].rx_bytes=_SL.formatNumber(a[b].rx_bytes),a[b].net_tx_limit=_SL.formatNumber(a[b].net_tx_limit),a[b].tx_bytes=_SL.formatNumber(a[b].tx_bytes),a[b].handling_type_cd){case"0":a[b].handling_type_cd="미처리";break;case"1":a[b].handling_type_cd="처리";break;case"2":a[b].handling_type_cd="참고";break;case"3":a[b].handling_type_cd="이관";break;case"4":a[b].handling_type_cd="중복";break;case"5":a[b].handling_type_cd="예외";break;default:a[b].handling_type_cd="-"}return a},formatData:function(a){var b,d={},e=c.form.serializeArray();for(b in e)d[e[b].name]=e[b].value;return $.extend(a,d),a},loadError:function(a,b,c){_alert(c)}}),f='<span class="label-info">정상</span>',g='<span class="label-attention">비정상 Low</span>',i='<span class="label-warning">비정상 Middle</span>',j='<span class="label-danger">비정상 High</span>';a.jqxGrid({source:e,width:"100%",virtualmode:!0,selectionmode:"checkbox",enablehover:!1,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:"만료일자",datafield:"eqp_time",cellsalign:"center"},{text:"장비명[IP]",datafield:"eqp_nm",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).html('<button type="button" class="btn-link" data-type-cd="'+f.eqp_dt+","+f.eqp_type_cd+","+f.eqp_ip+'">'+c+"["+f.eqp_ip+"]</button>")[0].outerHTML}},{text:"CPU(%)<br>측정값/임계치",datafield:"cpu_status",cellsalign:"center",width:"12%",cellsrenderer:function(a,b,c,d,e,h){if("0"===c)var k=f;else if("1"===c)var k=g;else if("2"===c)var k=i;else if("3"===c)var k=j;return $(d).html(k+" ["+h.cpu_used+" / "+h.cpu_limit+"]")[0].outerHTML}},{text:"Memory(%)<br>측정값/임계치",datafield:"mem_status",cellsalign:"center",width:"12%",cellsrenderer:function(a,b,c,d,e,h){if("0"===c)var k=f;else if("1"===c)var k=g;else if("2"===c)var k=i;else if("3"===c)var k=j;return $(d).html(k+" ["+h.mem_used+" / "+h.mem_limit+"]")[0].outerHTML}},{text:"Read",datafield:"io_read_status",width:"10%",cellsalign:"center",columngroup:"disk_mbps",cellsrenderer:function(a,b,c,d,e,h){if("0"===c)var k=f;else if("1"===c)var k=g;else if("2"===c)var k=i;else if("3"===c)var k=j;return $(d).html(k+" ["+h.read_bytes+" / "+h.io_read_limit+"]")[0].outerHTML}},{text:"Write",datafield:"io_write_status",width:"10%",cellsalign:"center",columngroup:"disk_mbps",cellsrenderer:function(a,b,c,d,e,h){if("0"===c)var k=f;else if("1"===c)var k=g;else if("2"===c)var k=i;else if("3"===c)var k=j;return $(d).html(k+" ["+h.write_bytes+" / "+h.io_write_limit+"]")[0].outerHTML}},{text:"Inbound",datafield:"net_rx_status",width:"10%",cellsalign:"center",columngroup:"netw_mbps",cellsrenderer:function(a,b,c,d,e,h){if("0"===c)var k=f;else if("1"===c)var k=g;else if("2"===c)var k=i;else if("3"===c)var k=j;return $(d).html(k+" ["+h.rx_bytes+" / "+h.net_rx_limit+"]")[0].outerHTML}},{text:"Outbound",datafield:"net_tx_status",width:"10%",cellsalign:"center",columngroup:"netw_mbps",cellsrenderer:function(a,b,c,d,e,h){if("0"===c)var k=f;else if("1"===c)var k=g;else if("2"===c)var k=i;else if("3"===c)var k=j;return $(d).html(k+" ["+h.tx_bytes+" / "+h.net_tx_limit+"]")[0].outerHTML}},{text:"상태",datafield:"handling_type_cd",cellsalign:"center"}],columngroups:[{text:"Disk(MBps)",align:"center",name:"disk_mbps"},{text:"Network(MBps)",align:"center",name:"netw_mbps"}]}),a.on("cellclick",function(a){if("eqp_nm"===a.args.datafield){var c=a.args.row.bounddata.eqp_ip,d=a.args.row.bounddata.eqp_type_cd,e=_SL.formatDate.addMin(a.args.row.bounddata.eqp_dt,1),f=_SL.formatDate.addMin(e,-30);h(b.urlView+"?s_eqp_type_cd="+d+"&s_eqp_ip="+c+"&start_time="+f+"&end_time="+e)}})},g=function(){c.grid.jqxGrid("updatebounddata"),c.grid.jqxGrid("clearselection")},h=function(a){new ModalPopup(a,{width:1e3,height:820,setScroll:!0,onClose:function(){g()}})},i=function(){$("body").requestData(b.urlLoadEqpType,{},{callback:function(d){var e=c.form.find("[name=s_eqp_type_cd]");$.each(d.eqp_type_list,function(){e.append('<option value="'+this.eqp_type_cd+'">'+this.eqp_type_nm+"</option>")}),""!=a.s_eqp_type_cd&&(e.value=a.s_eqp_type_cd,a.s_eqp_type_cd="",j()),slui.attach.setTransformSelect(b.formId)}})},j=function(){var d=c.form.find("[name=s_eqp_type_cd]").val();c.form.find("[name=s_eqp_ip]").children().remove(),c.form.find("[name=s_eqp_ip]").html("<option value=''>[ 선택하세요 ]</option>"),null==d&&(d=""),""!=d&&$("body").requestData(b.urlLoadEqp,{s_eqp_type_cd:d},{callback:function(d){var e=c.form.find("[name=s_eqp_ip]");$.each(d.eqp_list,function(){e.append("<option value='"+this.eqp_ip+"'>"+this.eqp_nm+"("+this.eqp_ip+")</option>")}),""!=a.s_eqp_ip&&(e.value=a.s_eqp_ip,a.s_eqp_ip=""),slui.attach.setTransformSelect(b.formId)}})};return{init:d}}(),$(function(){slapp.sms.list.init(),$("#btnSettingPerfomLimit").togglePage(gCONTEXT_PATH+"event/performance_limit_list.html")});